<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=5.0, user-scalable=yes">
    <meta name="theme-color" content="#3a86ff">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="default">
    
    <title>OptimumWork - AI-Powered Workforce Optimization Platform, AI Employee Management System</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        /* ====== ENHANCED RESPONSIVE DESIGN ====== */

        
/* Large Desktop (1400px+) */

@media (min-width: 1400px) {
    .container {
        max-width: 1400px;
        margin: 20px auto;
    }
    
    .metrics-grid {
        grid-template-columns: repeat(4, 1fr);
    }
}

/* Standard Desktop (1200px - 1399px) */
@media (max-width: 1399px) and (min-width: 1200px) {
    .container {
        max-width: 95%;
        margin: 15px auto;
    }
}

/* Small Desktop (992px - 1199px) */
@media (max-width: 1199px) and (min-width: 992px) {
    .container {
        max-width: 97%;
        margin: 15px auto;
    }
    
    .metrics-grid {
        grid-template-columns: repeat(2, 1fr);
    }
    
    .charts-container {
        grid-template-columns: 1fr;
    }
}

/* Tablet Landscape (768px - 991px) */
@media (max-width: 991px) and (min-width: 768px) {
    body {
        padding: 15px;
        background: var(--bg-primary);
    }
    
    .container {
        max-width: 100%;
        margin: 0;
        border-radius: 15px;
    }
    
    .header {
        padding: 25px 20px;
    }
    
    .header h1 {
        font-size: 2rem;
    }
    
    .metrics-grid {
        grid-template-columns: repeat(2, 1fr);
        gap: 15px;
    }
    
    .nav-tabs {
        flex-wrap: wrap;
        padding: 0 15px;
    }
    
    .nav-tab {
        flex: 1 0 25%;
        min-width: 120px;
        padding: 12px 15px;
        font-size: 0.85rem;
    }
    
    .tab-content {
        padding: 20px;
    }
    
    /* Mobile-optimized tables */
    .employee-table {
        display: block;
        overflow-x: auto;
        white-space: nowrap;
    }
}

/* Tablet Portrait (576px - 767px) */
@media (max-width: 767px) and (min-width: 576px) {
    body {
        padding: 10px;
    }
    
    .container {
        border-radius: 12px;
    }
    
    .header {
        padding: 20px 15px;
    }
    
    .header h1 {
        font-size: 1.8rem;
    }
    
    .ai-badge {
        display: block;
        margin: 10px 0 0 0;
        width: fit-content;
    }
    
    .metrics-grid {
        grid-template-columns: 1fr;
        gap: 12px;
    }
    
    .metric-card {
        padding: 20px;
    }
    
    .nav-tabs {
        padding: 0 10px;
        gap: 5px;
    }
    
    .nav-tab {
        flex: 1 0 33%;
        padding: 10px 12px;
        font-size: 0.8rem;
    }
    
    .tab-content {
        padding: 15px;
    }
}

/* Mobile Devices (375px - 575px) */
@media (max-width: 575px) and (min-width: 375px) {
    body {
        padding: 8px;
        font-size: 14px;
    }
    
    .container {
        border-radius: 10px;
    }
    
    .header {
        padding: 15px 12px;
    }
    
    .header h1 {
        font-size: 1.5rem;
        text-align: center;
    }
    
    .header p {
        font-size: 0.9rem;
        text-align: center;
    }
    
    .ai-badge {
        display: block;
        margin: 8px auto 0 auto;
        width: fit-content;
    }
    
    .metrics-grid {
        grid-template-columns: 1fr;
        gap: 10px;
    }
    
    .metric-card {
        padding: 15px;
    }
    
    .metric-value {
        font-size: 2rem;
    }
    
    .nav-tabs {
        padding: 0 8px;
        gap: 3px;
    }
    
    .nav-tab {
        flex: 1 0 50%;
        padding: 8px 10px;
        font-size: 0.75rem;
        text-align: center;
    }
    
    .tab-content {
        padding: 12px;
    }
    
    /* Mobile-optimized forms */
    .form-control {
        padding: 10px 12px;
        font-size: 16px; /* Prevents zoom on iOS */
    }
    
    .btn {
        padding: 10px 20px;
        font-size: 14px;
    }
}

/* Small Mobile Devices (320px - 374px) */
@media (max-width: 374px) {
    body {
        padding: 5px;
        font-size: 13px;
    }
    
    .container {
        border-radius: 8px;
    }
    
    .header {
        padding: 12px 10px;
    }
    
    .header h1 {
        font-size: 1.3rem;
    }
    
    .nav-tab {
        flex: 1 0 100%;
        padding: 8px;
        font-size: 0.7rem;
    }
    
    .metric-card {
        padding: 12px;
    }
    
    .search-box input {
        padding: 10px 35px 10px 12px;
    }
}

/* ====== TOUCH DEVICE OPTIMIZATIONS ====== */
@media (hover: none) and (pointer: coarse) {
    /* Better touch targets */
    .btn, .nav-tab, .metric-card {
        min-height: 44px;
        min-width: 44px;
    }
    
    /* Remove hover effects on touch devices */
    .metric-card:hover {
        transform: none;
    }
    
    .nav-tab:hover {
        background: transparent;
    }
    
    /* Improve scrolling */
    .tab-content {
        -webkit-overflow-scrolling: touch;
    }
}

/* ====== ORIENTATION SPECIFIC STYLES ====== */
@media (orientation: landscape) and (max-height: 500px) {
    .container {
        max-height: 90vh;
        overflow-y: auto;
    }
    
    .header {
        padding: 15px 20px;
    }
    
    .nav-tabs {
        position: sticky;
        top: 0;
        background: var(--light);
        z-index: 100;
    }
}

/* ====== HIGH DPI DISPLAY SUPPORT ====== */
@media (-webkit-min-device-pixel-ratio: 2), (min-resolution: 192dpi) {
    .metric-card, .chart-box, .employee-table {
        border-width: 0.5px;
    }
}

/* ====== PRINT STYLES ====== */
@media print {
    body {
        background: white !important;
        color: black !important;
        padding: 0 !important;
    }
    
    .container {
        box-shadow: none !important;
        border: none !important;
    }
    
    .nav-tabs, .theme-toggle, .settings-toggle, .btn {
        display: none !important;
    }
    
    .tab-content {
        display: block !important;
        opacity: 1 !important;
    }
}

/* ====== ACCESSIBILITY ENHANCEMENTS ====== */
@media (prefers-reduced-motion: reduce) {
    * {
        animation-duration: 0.01ms !important;
        animation-iteration-count: 1 !important;
        transition-duration: 0.01ms !important;
    }
}
/* Mobile-specific enhancements */
.mobile-device .container {
    box-shadow: 0 2px 10px rgba(0,0,0,0.1);
}

.mobile-device .metric-card {
    margin: 5px 0;
}

.mobile-device .employee-table {
    font-size: 12px;
}

.mobile-device .btn {
    padding: 12px 20px;
    font-size: 14px;
}

/* iOS specific fixes */
.ios-device .tab-content {
    -webkit-overflow-scrolling: touch;
}

.ios-device input,
.ios-device select,
.ios-device textarea {
    font-size: 16px; /* Prevents zoom */
}

/* Safe area insets for notch devices */
@supports(padding: max(0px)) {
    .container {
        padding-left: max(15px, env(safe-area-inset-left));
        padding-right: max(15px, env(safe-area-inset-right));
    }
}
/* ====== DARK MODE AUTO DETECTION ====== */
@media (prefers-color-scheme: dark) {
    :root:not([data-theme]) {
        --bg-primary: #1a202c;
        --bg-card: #2d3748;
        --text-primary: #f7fafc;
        --border-color: #4a5568;
    }
}
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }

        :root {
            --primary: #3a86ff;
            --secondary: #8338ec;
            --success: #06d6a0;
            --warning: #ffd166;
            --danger: #ef476f;
            --dark: #1a1a2e;
            --light: #f8f9fa;
            --gray: #6c757d;
        }

        body {
            background: linear(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            background: white;
            border-radius: 20px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
            overflow: hidden;
        }

        /* Add this at the top of your CSS */
:root {
  /* Light Theme Colors */
  --primary: #3a86ff;
  --secondary: #8338ec;
  --success: #06d6a0;
  --warning: #ffd166;
  --danger: #ef476f;
  --dark: #1a1a2e;
  --light: #f1fff4;
  --gray: #6c757d;
  --bg-primary: #b8b8b8ba;
  --bg-secondary: #f8f9fa;
  --bg-card: #ffffff;
  --text-primary: #1a1a2e;
  --text-secondary: #6c757d;
  --border-color: #e9ecef;
  --shadow: 0 5px 15px rgba(0,0,0,0.08);
  --header-bg: linear-gradient(135deg, var(--primary), var(--secondary));
}

[data-theme="dark"] {
  /* Dark Theme Colors */
  --primary: #4dabf7;
  --secondary: #9775fa;
  --success: #40c057;
  --warning: #ffa94d;
  --danger: #ff6b6b;
  --dark: #f8f9fa;
  --light: #2d3748;
  --gray: #a0aec0;
  --bg-primary: #1a202c;
  --bg-secondary: #2d3748;
  --bg-card: #2d3748;
  --text-primary: #f7fafc;
  --text-secondary: #e2e8f0;
  --border-color: #4a5568;
  --shadow: 0 5px 15px rgba(0,0,0,0.3);
  --header-bg: linear-gradient(135deg, #2d3748, #4a5568);
}

/* Add smooth transitions */
* {
  transition: background-color 0.3s ease, color 0.3s ease, border-color 0.3s ease, box-shadow 0.3s ease;
}
        /* Header Styles */
        .header {
            background: linear(135deg, var(--primary), var(--secondary));
            color: white;
            padding: 30px;
            text-align: center;
            position: relative;
            overflow: hidden;
            
        }
  
        .header::before {
            content: '';
            position: absolute;
            top: -50%;
            left: -50%;
            width: 200%;
            height: 200%;
            background: radial-gradient(circle, rgba(255, 255, 255, 0.1) 1px, transparent 1px);
            background-size: 20px 20px;
            animation: float 200s linear infinite;
            z-index: 1;
        }

        @keyframes float {
            0% { 
                transform: translate(0, 0) rotate(0deg); 
            }
            100% { 
                transform: translate(-20px, -200px) rotate(3600deg); 
            }
        }

        .header h1 {
            font-size: 2.5rem;
            margin-bottom: 10px;
            position: relative;
        }

        .header p {
            font-size: 1.1rem;
            opacity: 0.9;
            position: relative;
        }

        .ai-badge {
            background: rgba(255,255,255,0.2);
            padding: 8px 16px;
            border-radius: 20px;
            font-size: 0.9rem;
            margin-left: 10px;
            backdrop-filter: blur(10px);
        }

        /* Navigation */
        .nav-tabs {
            display: flex;
            background: var(--light);
            border-bottom: 2px solid #e9ecef;
            padding: 0 20px;
        }

        .nav-tab {
            padding: 15px 25px;
            cursor: pointer;
            border-bottom: 3px solid transparent;
            transition: all 0.3s ease;
            font-weight: 500;
            color: var(--gray);
        }

        .nav-tab.active {
            color: var(--primary);
            border-bottom-color: var(--primary);
            background: rgba(58, 134, 255, 0.05);
        }

        .nav-tab:hover {
            color: var(--primary);
            background: rgba(58, 134, 255, 0.05);
        }

        /* Content Areas */
        .tab-content {
            display: none;
            padding: 30px;
            animation: fadeIn 0.5s ease;
        }

        .tab-content.active {
            display: block;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        /* Dashboard Grid */
        .metrics-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .metric-card {
            background: white;
            padding: 25px;
            border-radius: 15px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.08);
            border-left: 5px solid var(--primary);
            transition: transform 0.3s ease, box-shadow 0.3s ease;
        }

        .metric-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 25px rgba(0,0,0,0.15);
        }

        .metric-card.productivity { border-left-color: var(--success); }
        .metric-card.risk { border-left-color: var(--danger); }
        .metric-card.efficiency { border-left-color: var(--warning); }
        .metric-card.predictions { border-left-color: var(--secondary); }

        .metric-icon {
            font-size: 2rem;
            margin-bottom: 15px;
        }

        .metric-value {
            font-size: 2.5rem;
            font-weight: bold;
            margin: 10px 0;
            color: var(--dark);
        }

        .ai-trend {
            color: var(--success);
            font-weight: 500;
            font-size: 0.9rem;
        }

        .ai-warning {
            color: var(--danger);
            font-weight: 500;
            font-size: 0.9rem;
        }

        /* Charts Container */
        .charts-container {
            display: grid;
            grid-template-columns: 2fr 1fr;
            gap: 20px;
            margin: 30px 0;
        }

        .chart-box {
            background: white;
            padding: 25px;
            border-radius: 15px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.08);
        }

        .chart-box h3 {
            margin-bottom: 20px;
            color: var(--dark);
            font-size: 1.3rem;
        }

        /* Employee Table */
        .employee-table {
            width: 100%;
            border-collapse: collapse;
            margin: 20px 0;
            background: white;
            border-radius: 10px;
            overflow: hidden;
            box-shadow: 0 5px 15px rgba(0,0,0,0.08);
        }

        .employee-table th,
        .employee-table td {
            padding: 15px;
            text-align: left;
            border-bottom: 1px solid #e9ecef;
        }

        .employee-table th {
            background: var(--primary);
            color: white;
            font-weight: 600;
        }

        .employee-table tr:hover {
            background: rgba(58, 134, 255, 0.05);
        }

        .status-badge {
            padding: 5px 12px;
            border-radius: 20px;
            font-size: 0.8rem;
            font-weight: 500;
        }

        .status-active {
            background: rgba(6, 214, 160, 0.2);
            color: var(--success);
        }

        .status-inactive {
            background: rgba(239, 71, 111, 0.2);
            color: var(--danger);
        }

        /* Forms */
        .form-group {
            margin-bottom: 20px;
        }

        .form-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 500;
            color: var(--dark);
        }

        .form-control {
            width: 100%;
            padding: 12px 15px;
            border: 2px solid #e9ecef;
            border-radius: 10px;
            font-size: 1rem;
            transition: border-color 0.3s ease;
        }

        .form-control:focus {
            outline: none;
            border-color: var(--primary);
        }

        .btn {
            padding: 12px 25px;
            border: none;
            border-radius: 10px;
            font-size: 1rem;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .btn-primary {
            background: var(--primary);
            color: white;
        }

        .btn-primary:hover {
            background: #2a75ff;
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(58, 134, 255, 0.4);
        }

        .btn-success {
            background: var(--success);
            color: white;
        }

        .btn-danger {
            background: var(--danger);
            color: white;
        }

        /* AI Recommendations */
        .ai-recommendations {
            background: linear(135deg, #667eea, #764ba2);
            color: white;
            padding: 25px;
            border-radius: 15px;
            margin: 20px 0;
        }

        .recommendation-item {
            background: rgba(255,255,255,0.1);
            padding: 15px;
            margin: 10px 0;
            border-radius: 10px;
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255,255,255,0.2);
        }

        /* Recruitment Section */
        .recruitment-container {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 30px;
        }

        .screening-results {
            background: var(--light);
            padding: 25px;
            border-radius: 15px;
        }

        .score-circle {
            width: 100px;
            height: 100px;
            border-radius: 50%;
            background: var(--primary);
            color: white;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.5rem;
            font-weight: bold;
            margin: 20px auto;
        }

        /* Search Bar */
        .search-container {
            margin: 20px 0;
            display: flex;
            gap: 15px;
            align-items: center;
        }

        .search-box {
            flex: 1;
            position: relative;
        }

        .search-box input {
            width: 100%;
            padding: 12px 45px 12px 15px;
            border: 2px solid #e9ecef;
            border-radius: 10px;
            font-size: 1rem;
        }

        .search-icon {
            position: absolute;
            right: 15px;
            top: 50%;
            transform: translateY(-50%);
            color: var(--gray);
        }

        /* Modal Styles */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.5);
            z-index: 1000;
            align-items: center;
            justify-content: center;
        }

        .modal-content {
            background: white;
            padding: 30px;
            border-radius: 15px;
            width: 90%;
            max-width: 500px;
            max-height: 90vh;
            overflow-y: auto;
        }

        .modal-header {
            display: flex;
            justify-content: between;
            align-items: center;
            margin-bottom: 20px;
        }

        .close-modal {
            background: none;
            border: none;
            font-size: 1.5rem;
            cursor: pointer;
            color: var(--gray);
        }

        /* File Upload */
        .file-upload {
            border: 2px dashed #e9ecef;
            border-radius: 10px;
            padding: 30px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .file-upload:hover {
            border-color: var(--primary);
            background: rgba(58, 134, 255, 0.05);
        }

        .file-upload input {
            display: none;
        }

        /* Attendance Styles */
        .attendance-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin: 20px 0;
        }

        .attendance-card {
            background: white;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 3px 10px rgba(0,0,0,0.1);
            text-align: center;
        }

        /* Responsive Design */
        @media (max-width: 768px) {
            .charts-container,
            .recruitment-container {
                grid-template-columns: 1fr;
            }
            
            .nav-tabs {
                flex-wrap: wrap;
            }
            
            .nav-tab {
                flex: 1;
                min-width: 120px;
                text-align: center;
            }
            
            .metrics-grid {
                grid-template-columns: 1fr;
            }
        }

        /* Loading Animation */
        .loading {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 3px solid rgba(255,255,255,.3);
            border-radius: 50%;
            border-top-color: #fff;
            animation: spin 1s ease-in-out infinite;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        /* Notification */
        .notification {
            position: fixed;
            top: 20px;
            right: 20px;
            padding: 15px 25px;
            background: var(--success);
            color: white;
            border-radius: 10px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.2);
            transform: translateX(400px);
            transition: transform 0.3s ease;
            z-index: 1000;
        }

        .notification.show {
            transform: translateX(0);
        }

        .notification.error {
            background: var(--danger);
        }

        /* Action Buttons */
        .action-buttons {
            display: flex;
            gap: 8px;
        }

        .btn-sm {
            padding: 8px 15px;
            font-size: 0.9rem;
        }

        /* Theme Toggle Styles */
.theme-toggle {
    position: fixed;
    top: 20px;
    right: 20px;
    z-index: 1000;
}

.toggle-btn {
    background: var(--bg-card);
    border: 2px solid var(--border-color);
    border-radius: 50px;
    padding: 12px 20px;
    cursor: pointer;
    display: flex;
    align-items: center;
    gap: 10px;
    font-weight: 600;
    color: var(--text-primary);
    box-shadow: var(--shadow);
    transition: all 0.3s ease;
    backdrop-filter: blur(10px);
}

.toggle-btn:hover {
    transform: translateY(-2px);
    box-shadow: 0 8px 25px rgba(0,0,0,0.15);
    border-color: var(--primary);
}

.toggle-icon {
    font-size: 1.3rem;
    transition: transform 0.5s ease;
}

.toggle-btn:hover .toggle-icon {
    transform: rotate(180deg);
}

/* Remove old body background and add this */
body {
    background: var(--bg-primary);
    min-height: 100vh;
    padding: 20px;
    color: var(--text-primary);
}

/* Update container */
.container {
    max-width: 1400px;
    margin: 0 auto;
    background: var(--bg-primary);
    border-radius: 20px;
    box-shadow: var(--shadow);
    overflow: hidden;
    border: 1px solid var(--border-color);
}

/* Update header */
.header {
    background: var(--header-bg);
    color: white; /* Keep white text for header */
    padding: 30px;
    text-align: center;
    position: relative;
    overflow: hidden;
}

/* Update metric cards */
.metric-card {
    background: var(--bg-card);
    padding: 25px;
    border-radius: 15px;
    box-shadow: var(--shadow);
    border-left: 5px solid var(--primary);
    transition: transform 0.3s ease, box-shadow 0.3s ease;
    color: var(--text-primary);
}

/* Update charts */
.chart-box {
    background: var(--bg-card);
    padding: 25px;
    border-radius: 15px;
    box-shadow: var(--shadow);
    color: var(--text-primary);
}

/* Update tables */
.employee-table {
    width: 100%;
    border-collapse: collapse;
    margin: 20px 0;
    background: var(--bg-card);
    border-radius: 10px;
    overflow: hidden;
    box-shadow: var(--shadow);
    color: var(--text-primary);
}

.employee-table th {
    background: var(--primary);
    color: white; /* Keep white text for table headers */
}

.employee-table td {
    border-bottom: 1px solid var(--border-color);
    color: var(--text-primary);
}

/* Update forms */
.form-control {
    width: 100%;
    padding: 12px 15px;
    border: 2px solid var(--border-color);
    border-radius: 10px;
    font-size: 1rem;
    transition: border-color 0.3s ease;
    background: var(--bg-card);
    color: var(--text-primary);
}

.form-control:focus {
    outline: none;
    border-color: var(--primary);
}

/* Update search box */
.search-box input {
    width: 100%;
    padding: 12px 45px 12px 15px;
    border: 2px solid var(--border-color);
    border-radius: 10px;
    font-size: 1rem;
    background: var(--bg-card);
    color: var(--text-primary);
}

/* Update modal */
.modal-content {
    background: var(--bg-card);
    padding: 30px;
    border-radius: 15px;
    width: 90%;
    max-width: 500px;
    max-height: 90vh;
    overflow-y: auto;
    color: var(--text-primary);
}

/* Update file upload */
.file-upload {
    border: 2px dashed var(--border-color);
    border-radius: 10px;
    padding: 30px;
    text-align: center;
    cursor: pointer;
    transition: all 0.3s ease;
    background: var(--bg-card);
    color: var(--text-primary);
}

.file-upload:hover {
    border-color: var(--primary);
    background: rgba(58, 134, 255, 0.05);
}

/* Update attendance cards */
.attendance-card {
    background: var(--bg-card);
    padding: 20px;
    border-radius: 10px;
    box-shadow: var(--shadow);
    text-align: center;
    color: var(--text-primary);
}

/* Update AI recommendations */
.ai-recommendations {
    background: var(--header-bg);
    color: white; /* Keep white text for recommendations */
    padding: 25px;
    border-radius: 15px;
    margin: 20px 0;
}

.recommendation-item {
    background: rgba(255,255,255,0.1);
    padding: 15px;
    margin: 10px 0;
    border-radius: 10px;
    backdrop-filter: blur(10px);
    border: 1px solid rgba(255,255,255,0.2);
}

/* Update screening results */
.screening-results {
    background: var(--bg-secondary);
    padding: 25px;
    border-radius: 15px;
    color: var(--text-primary);
}

/* Just add these lines at the end of your existing CSS */
[data-theme="dark"] {
  --bg-primary: #1a202c;
  --bg-card: #2d3748;
  --text-primary: #f7fafc;
  --border-color: #4a5568;
}

[data-theme="dark"] body {
  background: var(--bg-primary);
  color: var(--text-primary);
}

[data-theme="dark"] .container {
  background: var(--bg-primary);
  border-color: var(--border-color);
}

[data-theme="dark"] .metric-card,
[data-theme="dark"] .chart-box,
[data-theme="dark"] .employee-table,
[data-theme="dark"] .modal-content {
  background: var(--bg-card);
  color: var(--text-primary);
}


/* Project Management Styles */
.projects-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 30px;
    padding-bottom: 20px;
    border-bottom: 2px solid var(--border-color);
}

.project-actions {
    display: flex;
    gap: 15px;
}

/* Project Stats */
.project-stats {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
    gap: 20px;
    margin-bottom: 30px;
}

.stat-card {
    background: var(--bg-card);
    padding: 20px;
    border-radius: 15px;
    box-shadow: var(--shadow);
    display: flex;
    align-items: center;
    gap: 15px;
    transition: transform 0.3s ease;
}

.stat-card:hover {
    transform: translateY(-5px);
}

.stat-icon {
    font-size: 2.5rem;
}

.stat-info h3 {
    font-size: 2rem;
    margin-bottom: 5px;
    color: var(--primary);
}

.stat-info p {
    color: var(--text-secondary);
    margin: 0;
}

/* AI Suggestions */
.ai-suggestions {
    background: linear-gradient(135deg, #667eea, #764ba2);
    color: white;
    padding: 20px;
    border-radius: 15px;
    margin-bottom: 30px;
    animation: slideDown 0.5s ease;
}

.suggestion-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 15px;
}

.suggestion-item {
    background: rgba(255,255,255,0.1);
    padding: 15px;
    margin: 10px 0;
    border-radius: 10px;
    backdrop-filter: blur(10px);
    display: flex;
    justify-content: space-between;
    align-items: center;
}

/* Kanban Board */
.kanban-container {
    overflow-x: auto;
    margin-bottom: 30px;
}

.kanban-board {
    display: grid;
    grid-template-columns: repeat(4, 1fr);
    gap: 20px;
    min-width: 1000px;
    padding: 20px 0;
}

.kanban-column {
    background: var(--bg-secondary);
    border-radius: 15px;
    padding: 20px;
    min-height: 600px;
    border: 2px solid var(--border-color);
    transition: all 0.3s ease;
}

.kanban-column:hover {
    border-color: var(--primary);
    transform: translateY(-2px);
}

.kanban-column[data-status="todo"] {
    border-left: 5px solid #6c757d;
}

.kanban-column[data-status="progress"] {
    border-left: 5px solid #ffd166;
}

.kanban-column[data-status="review"] {
    border-left: 5px solid #3a86ff;
}

.kanban-column[data-status="done"] {
    border-left: 5px solid #06d6a0;
}

.column-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 20px;
    padding-bottom: 15px;
    border-bottom: 2px solid var(--border-color);
}

.column-header h3 {
    margin: 0;
    font-size: 1.2rem;
}

.task-count {
    background: var(--primary);
    color: white;
    padding: 4px 12px;
    border-radius: 20px;
    font-size: 0.9rem;
    font-weight: bold;
}

.tasks-list {
    min-height: 400px;
    transition: all 0.3s ease;
}

.task-card {
    background: var(--bg-card);
    padding: 15px;
    margin-bottom: 15px;
    border-radius: 10px;
    box-shadow: var(--shadow);
    border-left: 4px solid #6c757d;
    cursor: grab;
    transition: all 0.3s ease;
    animation: slideIn 0.3s ease;
}

.task-card:hover {
    transform: translateY(-2px);
    box-shadow: 0 8px 25px rgba(0,0,0,0.15);
}

.task-card:active {
    cursor: grabbing;
    transform: scale(0.98);
}

.task-card[data-priority="high"] {
    border-left-color: var(--danger);
}

.task-card[data-priority="medium"] {
    border-left-color: var(--warning);
}

.task-card[data-priority="low"] {
    border-left-color: var(--success);
}

.task-header {
    display: flex;
    justify-content: space-between;
    align-items: flex-start;
    margin-bottom: 10px;
}

.task-title {
    font-weight: 600;
    margin: 0;
    flex: 1;
}

.task-priority {
    padding: 2px 8px;
    border-radius: 12px;
    font-size: 0.7rem;
    font-weight: bold;
    text-transform: uppercase;
}

.priority-high {
    background: var(--danger);
    color: white;
}

.priority-medium {
    background: var(--warning);
    color: var(--dark);
}

.priority-low {
    background: var(--success);
    color: white;
}

.task-description {
    color: var(--text-secondary);
    font-size: 0.9rem;
    margin-bottom: 10px;
}

.task-meta {
    display: flex;
    justify-content: space-between;
    align-items: center;
    font-size: 0.8rem;
    color: var(--text-secondary);
}

.task-assignee {
    display: flex;
    align-items: center;
    gap: 5px;
}

.assignee-avatar {
    width: 24px;
    height: 24px;
    border-radius: 50%;
    background: var(--primary);
    color: white;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 0.7rem;
    font-weight: bold;
}

.task-due {
    color: var(--danger);
    font-weight: 500;
}

.task-actions {
    display: flex;
    gap: 5px;
    margin-top: 10px;
}

.task-btn {
    padding: 4px 8px;
    border: none;
    border-radius: 5px;
    font-size: 0.7rem;
    cursor: pointer;
    transition: all 0.3s ease;
}

.btn-edit {
    background: var(--primary);
    color: white;
}

.btn-delete {
    background: var(--danger);
    color: white;
}

.add-task-btn {
    width: 100%;
    padding: 12px;
    background: transparent;
    border: 2px dashed var(--border-color);
    border-radius: 10px;
    color: var(--text-secondary);
    cursor: pointer;
    transition: all 0.3s ease;
    margin-top: 15px;
}

.add-task-btn:hover {
    border-color: var(--primary);
    color: var(--primary);
    background: rgba(58, 134, 255, 0.05);
}

/* Progress Charts */
.project-progress {
    margin-top: 40px;
}

.progress-charts {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 20px;
}

/* Team Members */
.team-members {
    display: flex;
    flex-wrap: wrap;
    gap: 10px;
    margin-bottom: 15px;
}

.team-member {
    background: var(--primary);
    color: white;
    padding: 5px 12px;
    border-radius: 20px;
    font-size: 0.9rem;
    display: flex;
    align-items: center;
    gap: 5px;
}

.remove-member {
    background: none;
    border: none;
    color: white;
    cursor: pointer;
    font-weight: bold;
}

/* Animations */
@keyframes slideIn {
    from {
        opacity: 0;
        transform: translateY(20px);
    }
    to {
        opacity: 1;
        transform: translateY(0);
    }
}

@keyframes slideDown {
    from {
        opacity: 0;
        transform: translateY(-20px);
    }
    to {
        opacity: 1;
        transform: translateY(0);
    }
}

@keyframes pulse {
    0% { transform: scale(1); }
    50% { transform: scale(1.05); }
    100% { transform: scale(1); }
}

.task-card.dragging {
    opacity: 0.5;
    transform: rotate(5deg);
    animation: pulse 1s infinite;
}

.kanban-column.drag-over {
    background: rgba(58, 134, 255, 0.1);
    border-color: var(--primary);
}

/* Responsive Design */
@media (max-width: 768px) {
    .kanban-board {
        grid-template-columns: 1fr;
        min-width: auto;
    }
    
    .progress-charts {
        grid-template-columns: 1fr;
    }
    
    .projects-header {
        flex-direction: column;
        gap: 15px;
        align-items: flex-start;
    }
}


/* Project Task Assignment Styles */
.project-list {
    margin-bottom: 30px;
}

.projects-grid {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
    gap: 20px;
    margin-top: 20px;
}

.project-card {
    background: var(--bg-card);
    border-radius: 15px;
    padding: 20px;
    box-shadow: var(--shadow);
    border-left: 5px solid var(--primary);
    transition: all 0.3s ease;
}

.project-card:hover {
    transform: translateY(-5px);
    box-shadow: 0 10px 25px rgba(0,0,0,0.15);
}

.project-header {
    display: flex;
    justify-content: space-between;
    align-items: flex-start;
    margin-bottom: 15px;
}

.project-title {
    font-size: 1.2rem;
    font-weight: 600;
    margin: 0;
    color: var(--text-primary);
}

.project-status {
    padding: 4px 12px;
    border-radius: 20px;
    font-size: 0.8rem;
    font-weight: 500;
}

.status-active {
    background: rgba(6, 214, 160, 0.2);
    color: var(--success);
}

.status-completed {
    background: rgba(58, 134, 255, 0.2);
    color: var(--primary);
}

.status-pending {
    background: rgba(255, 209, 102, 0.2);
    color: var(--warning);
}

.project-description {
    color: var(--text-secondary);
    margin-bottom: 15px;
    font-size: 0.9rem;
}

.project-meta {
    display: flex;
    justify-content: space-between;
    font-size: 0.8rem;
    color: var(--text-secondary);
    margin-bottom: 15px;
}

.project-team {
    display: flex;
    flex-wrap: wrap;
    gap: 5px;
    margin-bottom: 15px;
}

.team-member {
    background: var(--primary);
    color: white;
    padding: 2px 8px;
    border-radius: 12px;
    font-size: 0.7rem;
    display: flex;
    align-items: center;
    gap: 3px;
}

.task-list-section {
    margin-top: 30px;
}

.tasks-container {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(350px, 1fr));
    gap: 20px;
    margin-top: 20px;
}

.task-card {
    background: var(--bg-card);
    border-radius: 15px;
    padding: 20px;
    box-shadow: var(--shadow);
    border-left: 4px solid var(--primary);
    transition: all 0.3s ease;
    position: relative;
}

.task-card:hover {
    transform: translateY(-3px);
    box-shadow: 0 8px 20px rgba(0,0,0,0.12);
}

.task-card[data-priority="high"] {
    border-left-color: var(--danger);
}

.task-card[data-priority="medium"] {
    border-left-color: var(--warning);
}

.task-card[data-priority="low"] {
    border-left-color: var(--success);
}

.task-card-header {
    display: flex;
    justify-content: space-between;
    align-items: flex-start;
    margin-bottom: 10px;
}

.task-card-title {
    font-weight: 600;
    margin: 0;
    flex: 1;
}

.task-priority-badge {
    padding: 3px 10px;
    border-radius: 12px;
    font-size: 0.7rem;
    font-weight: bold;
    text-transform: uppercase;
}

.task-description {
    color: var(--text-secondary);
    font-size: 0.9rem;
    margin-bottom: 15px;
}

.task-details {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 10px;
    margin-bottom: 15px;
    font-size: 0.8rem;
}

.task-detail-item {
    display: flex;
    align-items: center;
    gap: 5px;
    color: var(--text-secondary);
}

.task-actions {
    display: flex;
    gap: 8px;
    flex-wrap: wrap;
}

.task-file {
    margin-top: 15px;
    padding: 10px;
    background: var(--bg-secondary);
    border-radius: 8px;
    font-size: 0.8rem;
}

.file-info {
    display: flex;
    justify-content: space-between;
    align-items: center;
}

.file-actions {
    display: flex;
    gap: 5px;
}

.submission-section {
    margin-top: 15px;
    padding-top: 15px;
    border-top: 1px solid var(--border-color);
}

.upload-area {
    border: 2px dashed var(--border-color);
    border-radius: 10px;
    padding: 20px;
    text-align: center;
    cursor: pointer;
    transition: all 0.3s ease;
    margin-bottom: 10px;
}

.upload-area:hover {
    border-color: var(--primary);
    background: rgba(58, 134, 255, 0.05);
}

.upload-area input {
    display: none;
}

.submission-history {
    margin-top: 15px;
    max-height: 150px;
    overflow-y: auto;
}

.submission-item {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 8px;
    background: var(--bg-secondary);
    border-radius: 6px;
    margin-bottom: 5px;
    font-size: 0.8rem;
}

.submission-actions {
    display: flex;
    gap: 5px;
}

/* Modal Styles */
.modal-large {
    max-width: 700px;
}

.assignment-form {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 20px;
}

.assignment-form .form-group {
    margin-bottom: 15px;
}

.assignment-form .form-group:last-child {
    grid-column: 1 / -1;
}

/* Responsive Design */
@media (max-width: 768px) {
    .projects-grid,
    .tasks-container {
        grid-template-columns: 1fr;
    }
    
    .assignment-form {
        grid-template-columns: 1fr;
    }
    
    .task-details {
        grid-template-columns: 1fr;
    }
}


/* Employee Details Modal Styles */
.employee-details-modal {
    max-width: 800px;
    width: 95%;
}

.employee-details-header {
    display: flex;
    align-items: center;
    margin-bottom: 20px;
    border-bottom: 2px solid var(--border-color);
    padding-bottom: 15px;
}

.employee-avatar {
    width: 80px;
    height: 80px;
    border-radius: 50%;
    background: linear-gradient(135deg, var(--primary), var(--secondary));
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 2rem;
    color: white;
    margin-right: 20px;
}

.employee-basic-info h3 {
    margin: 0 0 5px 0;
    font-size: 1.5rem;
}

.employee-basic-info p {
    margin: 0;
    color: var(--text-secondary);
}

.employee-details-grid {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 20px;
    margin-bottom: 20px;
}

.detail-group {
    margin-bottom: 15px;
}

.detail-label {
    font-weight: 600;
    color: var(--text-secondary);
    font-size: 0.9rem;
    margin-bottom: 5px;
}

.detail-value {
    font-size: 1rem;
}

.projects-section {
    margin-top: 20px;
    padding-top: 20px;
    border-top: 2px solid var(--border-color);
}

.projects-list {
    max-height: 200px;
    overflow-y: auto;
    margin-top: 10px;
}

.project-item {
    background: var(--bg-secondary);
    padding: 10px 15px;
    border-radius: 8px;
    margin-bottom: 10px;
    display: flex;
    justify-content: space-between;
    align-items: center;
}

.no-projects {
    text-align: center;
    padding: 20px;
    color: var(--text-secondary);
    font-style: italic;
}

.assign-project-btn {
    background: var(--success);
    color: white;
}

.assign-project-btn:hover {
    background: #05c189;
}

/* Project Assignment Modal */
.project-assignment-modal {
    max-width: 600px;
}

.project-list-container {
    max-height: 300px;
    overflow-y: auto;
    margin: 15px 0;
    border: 1px solid var(--border-color);
    border-radius: 10px;
    padding: 10px;
}

.project-option {
    padding: 12px 15px;
    border-bottom: 1px solid var(--border-color);
    cursor: pointer;
    transition: background-color 0.2s;
}

.project-option:hover {
    background-color: var(--bg-secondary);
}

.project-option:last-child {
    border-bottom: none;
}

.project-option.selected {
    background-color: rgba(58, 134, 255, 0.1);
    border-left: 3px solid var(--primary);
}

.project-details {
    margin-top: 10px;
    padding: 10px;
    background: var(--bg-secondary);
    border-radius: 8px;
    font-size: 0.9rem;
}

/* Row click effect */
.employee-table tr {
    cursor: pointer;
}

/* Action buttons */
.action-buttons {
    display: flex;
    gap: 8px;
}

.btn-sm {
    padding: 8px 15px;
    font-size: 0.9rem;
}

.btn-project {
    background: var(--success);
    color: white;
}

.btn-project:hover {
    background: #05c189;
}

.modal-footer {
    display: flex;
    justify-content: flex-end;
    gap: 10px;
    margin-top: 20px;
    padding-top: 20px;
    border-top: 1px solid var(--border-color);
}

/* Smart Attendance Styles */
.attendance-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 30px;
    padding-bottom: 20px;
    border-bottom: 2px solid var(--border-color);
}

.summary-cards {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
    gap: 20px;
    margin-bottom: 30px;
}

.summary-card {
    background: var(--bg-card);
    padding: 20px;
    border-radius: 15px;
    box-shadow: var(--shadow);
    display: flex;
    align-items: center;
    gap: 15px;
    transition: transform 0.3s ease;
}

.summary-card:hover {
    transform: translateY(-5px);
}

.summary-icon {
    font-size: 2.5rem;
}

.summary-info h3 {
    font-size: 2rem;
    margin-bottom: 5px;
    color: var(--primary);
}

.summary-info p {
    color: var(--text-secondary);
    margin: 0;
}

.manual-attendance-section {
    background: var(--bg-card);
    padding: 25px;
    border-radius: 15px;
    box-shadow: var(--shadow);
    margin-bottom: 30px;
}

.employee-list {
    max-height: 400px;
    overflow-y: auto;
    margin-top: 20px;
}

.employee-item {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 15px;
    background: var(--bg-secondary);
    border-radius: 10px;
    margin-bottom: 10px;
    border-left: 4px solid var(--primary);
}

.employee-info h4 {
    margin: 0 0 5px 0;
    color: var(--text-primary);
}

.employee-info p {
    margin: 0;
    color: var(--text-secondary);
    font-size: 0.9rem;
}

.attendance-status {
    padding: 6px 12px;
    border-radius: 20px;
    font-size: 0.8rem;
    font-weight: 500;
}

.status-present {
    background: rgba(6, 214, 160, 0.2);
    color: var(--success);
}

.status-absent {
    background: rgba(239, 71, 111, 0.2);
    color: var(--danger);
}

.status-late {
    background: rgba(255, 209, 102, 0.2);
    color: var(--warning);
}

.table-container {
    max-height: 500px;
    overflow-y: auto;
    background: var(--bg-card);
    border-radius: 15px;
    box-shadow: var(--shadow);
}

.attendance-controls {
    display: flex;
    gap: 15px;
}

 
.leave-application-item {
    background: var(--bg-card);
    border-radius: 10px;
    padding: 20px;
    margin-bottom: 15px;
    box-shadow: var(--shadow);
    border-left: 4px solid var(--primary);
}

.application-header {
    display: flex;
    justify-content: space-between;
    align-items: flex-start;
    margin-bottom: 10px;
}

.application-info h4 {
    margin: 0 0 5px 0;
    color: var(--text-primary);
}

.application-info p {
    margin: 2px 0;
    color: var(--text-secondary);
    font-size: 0.9rem;
}

.application-reason {
    margin: 10px 0;
    padding: 10px;
    background: var(--bg-secondary);
    border-radius: 5px;
}

.application-reason p {
    margin: 0;
    color: var(--text-secondary);
}

.application-actions {
    display: flex;
    gap: 8px;
    margin-top: 15px;
}

.no-applications {
    text-align: center;
    padding: 40px;
    color: var(--text-secondary);
    font-style: italic;
}

.application-details .detail-group {
    margin-bottom: 15px;
    padding-bottom: 15px;
    border-bottom: 1px solid var(--border-color);
}

.application-details label {
    font-weight: bold;
    color: var(--text-primary);
    display: block;
    margin-bottom: 5px;
}

.application-details p {
    margin: 0;
    color: var(--text-secondary);
    line-height: 1.5;
}
/* Payroll Styles */
.payslip {
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    color: white;
    padding: 30px;
    border-radius: 15px;
    box-shadow: 0 10px 30px rgba(0,0,0,0.3);
}

.payroll-summary {
    animation: slideDown 0.5s ease;
}

@keyframes slideDown {
    from {
        opacity: 0;
        transform: translateY(-20px);
    }
    to {
        opacity: 1;
        transform: translateY(0);
    }
}

.payroll-actions {
    display: flex;
    gap: 10px;
    margin: 20px 0;
}

.salary-breakdown {
    background: var(--bg-card);
    padding: 20px;
    border-radius: 10px;
    margin: 15px 0;
    border-left: 4px solid var(--success);
}

.tax-calculation {
    background: var(--bg-card);
    padding: 15px;
    border-radius: 8px;
    margin: 10px 0;
    border-left: 4px solid var(--warning);
}

/* Payroll Specific Styles */
.payroll-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 30px;
    padding-bottom: 20px;
    border-bottom: 2px solid var(--border-color);
}

.payroll-actions {
    display: flex;
    gap: 15px;
}

.payroll-summary {
    margin: 20px 0;
}

/* Animation for payroll elements */
@keyframes payrollSlideIn {
    from {
        opacity: 0;
        transform: translateX(-20px);
    }
    to {
        opacity: 1;
        transform: translateX(0);
    }
}

.payroll-table {
    animation: payrollSlideIn 0.5s ease;
}

/* Responsive payroll */
@media (max-width: 768px) {
    .payroll-header {
        flex-direction: column;
        gap: 15px;
        align-items: flex-start;
    }
    
    .payroll-actions {
        flex-wrap: wrap;
    }
}
/* Performance Management Styles */
.performance-stats {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
    gap: 20px;
    margin-bottom: 30px;
}

.performance-card {
    background: var(--bg-card);
    padding: 25px;
    border-radius: 15px;
    box-shadow: var(--shadow);
    border-left: 5px solid var(--primary);
    transition: all 0.3s ease;
    animation: slideUp 0.5s ease;
}

.performance-card:hover {
    transform: translateY(-5px);
    box-shadow: 0 10px 25px rgba(0,0,0,0.15);
}

.performance-card.rating-excellent { border-left-color: var(--success); }
.performance-card.rating-good { border-left-color: var(--warning); }
.performance-card.rating-average { border-left-color: var(--primary); }
.performance-card.rating-poor { border-left-color: var(--danger); }

.rating-circle {
    width: 80px;
    height: 80px;
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 1.5rem;
    font-weight: bold;
    margin: 0 auto 15px;
    position: relative;
    animation: pulse 2s infinite;
}

.rating-excellent .rating-circle {
    background: rgba(6, 214, 160, 0.2);
    color: var(--success);
    border: 3px solid var(--success);
}

.rating-good .rating-circle {
    background: rgba(255, 209, 102, 0.2);
    color: var(--warning);
    border: 3px solid var(--warning);
}

.rating-average .rating-circle {
    background: rgba(58, 134, 255, 0.2);
    color: var(--primary);
    border: 3px solid var(--primary);
}

.rating-poor .rating-circle {
    background: rgba(239, 71, 111, 0.2);
    color: var(--danger);
    border: 3px solid var(--danger);
}

.okr-container {
    background: var(--bg-card);
    border-radius: 15px;
    padding: 25px;
    margin: 20px 0;
    box-shadow: var(--shadow);
    animation: fadeIn 0.5s ease;
}

.okr-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
    gap: 20px;
    margin-top: 20px;
}

.okr-item {
    background: var(--bg-secondary);
    padding: 20px;
    border-radius: 10px;
    border-left: 4px solid var(--primary);
    transition: all 0.3s ease;
}

.okr-item:hover {
    transform: translateX(5px);
    box-shadow: 0 5px 15px rgba(0,0,0,0.1);
}

.okr-progress {
    height: 8px;
    background: var(--border-color);
    border-radius: 10px;
    margin: 10px 0;
    overflow: hidden;
}

.okr-progress-bar {
    height: 100%;
    border-radius: 10px;
    transition: width 1s ease-in-out;
    background: linear-gradient(90deg, var(--primary), var(--secondary));
}

.feedback-system {
    background: var(--bg-card);
    border-radius: 15px;
    padding: 25px;
    margin: 20px 0;
    box-shadow: var(--shadow);
}

.feedback-item {
    background: var(--bg-secondary);
    padding: 20px;
    border-radius: 10px;
    margin: 15px 0;
    border-left: 4px solid var(--primary);
    animation: slideInRight 0.5s ease;
}

.feedback-actions {
    display: flex;
    gap: 10px;
    margin-top: 15px;
}

.performance-review {
    background: linear-gradient(135deg, var(--primary), var(--secondary));
    color: white;
    padding: 25px;
    border-radius: 15px;
    margin: 20px 0;
}

.review-section {
    background: rgba(255,255,255,0.1);
    padding: 20px;
    border-radius: 10px;
    margin: 15px 0;
    backdrop-filter: blur(10px);
}

.performance-charts {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 20px;
    margin: 30px 0;
}

/* Animations */
@keyframes slideUp {
    from {
        opacity: 0;
        transform: translateY(30px);
    }
    to {
        opacity: 1;
        transform: translateY(0);
    }
}

@keyframes slideInRight {
    from {
        opacity: 0;
        transform: translateX(30px);
    }
    to {
        opacity: 1;
        transform: translateX(0);
    }
}

@keyframes pulse {
    0% { transform: scale(1); }
    50% { transform: scale(1.05); }
    100% { transform: scale(1); }
}

@keyframes progressFill {
    from { width: 0%; }
    to { width: var(--progress-width); }
}

/* Badge Styles */
.badge {
    padding: 4px 12px;
    border-radius: 20px;
    font-size: 0.8rem;
    font-weight: 500;
}

.badge-success { background: var(--success); color: white; }
.badge-warning { background: var(--warning); color: var(--dark); }
.badge-primary { background: var(--primary); color: white; }
.badge-danger { background: var(--danger); color: white; }

/* Goal Status */
.status-on-track { color: var(--success); }
.status-at-risk { color: var(--warning); }
.status-off-track { color: var(--danger); }

/* Responsive Design */
@media (max-width: 768px) {
    .performance-charts {
        grid-template-columns: 1fr;
    }
    
    .performance-stats {
        grid-template-columns: 1fr;
    }
    
    .okr-grid {
        grid-template-columns: 1fr;
    }
}

/* Advanced Employee Database Styles */
.employee-database-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 30px;
    padding-bottom: 20px;
    border-bottom: 2px solid var(--border-color);
}

.advanced-filters {
    background: var(--bg-card);
    padding: 25px;
    border-radius: 15px;
    box-shadow: var(--shadow);
    margin-bottom: 25px;
    animation: slideDown 0.5s ease;
}

.filter-row {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
    gap: 15px;
    margin-bottom: 15px;
}

.filter-actions {
    display: flex;
    gap: 10px;
    justify-content: flex-end;
    margin-top: 15px;
}

.employee-profile-modal {
    max-width: 900px;
    width: 95%;
}

.profile-tabs {
    display: flex;
    border-bottom: 2px solid var(--border-color);
    margin-bottom: 20px;
}

.profile-tab {
    padding: 12px 25px;
    cursor: pointer;
    border-bottom: 3px solid transparent;
    transition: all 0.3s ease;
    font-weight: 500;
    color: var(--text-secondary);
}

.profile-tab.active {
    color: var(--primary);
    border-bottom-color: var(--primary);
}

.profile-content {
    display: none;
    animation: fadeIn 0.5s ease;
}

.profile-content.active {
    display: block;
}

.profile-header {
    display: flex;
    align-items: center;
    margin-bottom: 30px;
    padding: 20px;
    background: linear-gradient(135deg, var(--primary), var(--secondary));
    color: white;
    border-radius: 15px;
}

.profile-avatar {
    width: 100px;
    height: 100px;
    border-radius: 50%;
    background: rgba(255,255,255,0.2);
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 2.5rem;
    margin-right: 25px;
    border: 4px solid white;
}

.profile-basic-info h2 {
    margin: 0 0 10px 0;
    font-size: 1.8rem;
}

.profile-basic-info p {
    margin: 5px 0;
    opacity: 0.9;
}

.profile-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
    gap: 25px;
    margin-bottom: 30px;
}

.info-card {
    background: var(--bg-card);
    padding: 20px;
    border-radius: 12px;
    box-shadow: var(--shadow);
    border-left: 4px solid var(--primary);
}

.info-card h4 {
    margin: 0 0 15px 0;
    color: var(--primary);
    font-size: 1.1rem;
}

.info-item {
    display: flex;
    justify-content: space-between;
    padding: 8px 0;
    border-bottom: 1px solid var(--border-color);
}

.info-item:last-child {
    border-bottom: none;
}

.info-label {
    font-weight: 600;
    color: var(--text-secondary);
}

.info-value {
    color: var(--text-primary);
}

.documents-grid {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
    gap: 15px;
    margin-top: 15px;
}

.document-card {
    background: var(--bg-secondary);
    padding: 15px;
    border-radius: 10px;
    text-align: center;
    transition: all 0.3s ease;
    cursor: pointer;
}

.document-card:hover {
    transform: translateY(-3px);
    box-shadow: 0 5px 15px rgba(0,0,0,0.1);
}

.document-icon {
    font-size: 2rem;
    margin-bottom: 10px;
}

.timeline {
    position: relative;
    margin: 30px 0;
    padding-left: 30px;
}

.timeline::before {
    content: '';
    position: absolute;
    left: 15px;
    top: 0;
    bottom: 0;
    width: 2px;
    background: var(--primary);
}

.timeline-item {
    position: relative;
    margin-bottom: 25px;
    padding: 20px;
    background: var(--bg-card);
    border-radius: 10px;
    box-shadow: var(--shadow);
    animation: slideInRight 0.5s ease;
}

.timeline-item::before {
    content: '';
    position: absolute;
    left: -38px;
    top: 25px;
    width: 12px;
    height: 12px;
    border-radius: 50%;
    background: var(--primary);
    border: 3px solid white;
    box-shadow: 0 0 0 3px var(--primary);
}

.timeline-date {
    font-weight: 600;
    color: var(--primary);
    margin-bottom: 5px;
}

.timeline-title {
    font-weight: 600;
    margin-bottom: 5px;
}

.timeline-description {
    color: var(--text-secondary);
    font-size: 0.9rem;
}

.organization-chart {
    background: var(--bg-card);
    padding: 25px;
    border-radius: 15px;
    box-shadow: var(--shadow);
    margin: 25px 0;
    overflow-x: auto;
}

.chart-container {
    min-width: 800px;
    padding: 20px;
}

.org-node {
    background: white;
    border: 2px solid var(--primary);
    border-radius: 10px;
    padding: 15px;
    margin: 10px;
    text-align: center;
    box-shadow: 0 3px 10px rgba(0,0,0,0.1);
    transition: all 0.3s ease;
    cursor: pointer;
    min-width: 180px;
}

.org-node:hover {
    transform: translateY(-2px);
    box-shadow: 0 5px 15px rgba(0,0,0,0.2);
    border-color: var(--secondary);
}

.org-node.ceo {
    background: linear-gradient(135deg, var(--primary), var(--secondary));
    color: white;
}

.org-node.manager {
    background: var(--primary);
    color: white;
}

.org-node.team-lead {
    background: var(--warning);
    color: var(--dark);
}

.org-node.employee {
    background: var(--success);
    color: white;
}

.org-children {
    display: flex;
    justify-content: center;
    position: relative;
}

.org-children::before {
    content: '';
    position: absolute;
    top: 0;
    left: 50%;
    width: 2px;
    height: 20px;
    background: var(--border-color);
}

.org-node .node-name {
    font-weight: 600;
    margin-bottom: 5px;
}

.org-node .node-position {
    font-size: 0.8rem;
    opacity: 0.9;
}

.quick-actions {
    display: flex;
    gap: 10px;
    flex-wrap: wrap;
    margin: 20px 0;
}

.export-options {
    display: flex;
    gap: 10px;
    margin: 15px 0;
}

.employee-stats {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
    gap: 15px;
    margin: 20px 0;
}

.stat-item {
    background: var(--bg-secondary);
    padding: 15px;
    border-radius: 10px;
    text-align: center;
}

.stat-value {
    font-size: 1.5rem;
    font-weight: bold;
    color: var(--primary);
    margin-bottom: 5px;
}

.stat-label {
    font-size: 0.8rem;
    color: var(--text-secondary);
}

/* Advanced Search Styles */
.advanced-search {
    position: relative;
}

.search-results {
    position: absolute;
    top: 100%;
    left: 0;
    right: 0;
    background: var(--bg-card);
    border-radius: 0 0 10px 10px;
    box-shadow: 0 5px 15px rgba(0,0,0,0.2);
    z-index: 1000;
    max-height: 300px;
    overflow-y: auto;
    display: none;
}

.search-result-item {
    padding: 12px 15px;
    border-bottom: 1px solid var(--border-color);
    cursor: pointer;
    transition: background-color 0.2s;
}

.search-result-item:hover {
    background: var(--bg-secondary);
}

.search-result-item:last-child {
    border-bottom: none;
}

/* Animation Keyframes */
@keyframes slideDown {
    from {
        opacity: 0;
        transform: translateY(-20px);
    }
    to {
        opacity: 1;
        transform: translateY(0);
    }
}

@keyframes slideInRight {
    from {
        opacity: 0;
        transform: translateX(30px);
    }
    to {
        opacity: 1;
        transform: translateX(0);
    }
}

@keyframes fadeIn {
    from { opacity: 0; }
    to { opacity: 1; }
}

/* Responsive Design */
@media (max-width: 768px) {
    .profile-header {
        flex-direction: column;
        text-align: center;
    }
    
    .profile-avatar {
        margin-right: 0;
        margin-bottom: 15px;
    }
    
    .profile-grid {
        grid-template-columns: 1fr;
    }
    
    .filter-row {
        grid-template-columns: 1fr;
    }
    
    .org-node {
        min-width: 140px;
    }
    
    .employee-database-header {
        flex-direction: column;
        gap: 15px;
        align-items: flex-start;
    }
    
    .quick-actions {
        justify-content: flex-start;
    }
}

/* Remote Workforce Management Styles */
.remote-work-section {
    background: var(--bg-card);
    padding: 25px;
    border-radius: 15px;
    box-shadow: var(--shadow);
    margin: 25px 0;
    border-left: 4px solid var(--primary);
}

.remote-stats-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
    gap: 15px;
    margin-bottom: 25px;
}

.remote-stat-card {
    background: var(--bg-secondary);
    padding: 20px;
    border-radius: 12px;
    display: flex;
    align-items: center;
    gap: 15px;
    transition: transform 0.3s ease;
}

.remote-stat-card:hover {
    transform: translateY(-2px);
}

.remote-stat-icon {
    font-size: 2rem;
    width: 60px;
    height: 60px;
    display: flex;
    align-items: center;
    justify-content: center;
    background: var(--primary);
    color: white;
    border-radius: 50%;
}

.remote-stat-value {
    font-size: 1.8rem;
    font-weight: bold;
    color: var(--primary);
    margin-bottom: 5px;
}

.remote-stat-label {
    color: var(--text-secondary);
    font-size: 0.9rem;
}

.remote-quick-actions {
    display: flex;
    gap: 10px;
    flex-wrap: wrap;
    margin-bottom: 25px;
    padding-bottom: 20px;
    border-bottom: 2px solid var(--border-color);
}

.section-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 15px;
}

.section-header h4 {
    margin: 0;
    color: var(--text-primary);
}

.online-indicator {
    background: var(--success);
    color: white;
    padding: 4px 12px;
    border-radius: 15px;
    font-size: 0.8rem;
    font-weight: 500;
}

.total-hours {
    color: var(--text-secondary);
    font-weight: 500;
}

/* Task Management Styles */
.tasks-container {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
    gap: 15px;
    margin-bottom: 25px;
}

.task-card {
    background: var(--bg-secondary);
    padding: 15px;
    border-radius: 10px;
    border-left: 4px solid var(--primary);
    transition: all 0.3s ease;
}

.task-card:hover {
    transform: translateY(-2px);
    box-shadow: 0 5px 15px rgba(0,0,0,0.1);
}

.task-card.high-priority {
    border-left-color: var(--danger);
}

.task-card.medium-priority {
    border-left-color: var(--warning);
}

.task-card.low-priority {
    border-left-color: var(--success);
}

.task-header {
    display: flex;
    justify-content: space-between;
    align-items: flex-start;
    margin-bottom: 10px;
}

.task-title {
    font-weight: 600;
    margin: 0;
    flex: 1;
}

.task-priority {
    padding: 3px 8px;
    border-radius: 8px;
    font-size: 0.7rem;
    font-weight: bold;
    text-transform: uppercase;
}

.priority-high {
    background: var(--danger);
    color: white;
}

.priority-medium {
    background: var(--warning);
    color: var(--dark);
}

.priority-low {
    background: var(--success);
    color: white;
}

.task-meta {
    display: flex;
    justify-content: space-between;
    font-size: 0.8rem;
    color: var(--text-secondary);
    margin-bottom: 10px;
}

.task-progress {
    height: 6px;
    background: var(--border-color);
    border-radius: 3px;
    overflow: hidden;
    margin: 10px 0;
}

.task-progress-bar {
    height: 100%;
    background: var(--primary);
    border-radius: 3px;
    transition: width 0.5s ease;
}

.task-actions {
    display: flex;
    gap: 8px;
    margin-top: 10px;
}

/* Team Activity Styles */
.team-members-list {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
    gap: 10px;
}

.team-member-card {
    background: var(--bg-secondary);
    padding: 15px;
    border-radius: 10px;
    display: flex;
    align-items: center;
    gap: 12px;
    transition: all 0.3s ease;
}

.team-member-card:hover {
    background: var(--bg-card);
    transform: translateX(5px);
}

.member-avatar {
    width: 40px;
    height: 40px;
    border-radius: 50%;
    background: var(--primary);
    color: white;
    display: flex;
    align-items: center;
    justify-content: center;
    font-weight: bold;
}

.member-info {
    flex: 1;
}

.member-name {
    font-weight: 600;
    margin: 0 0 3px 0;
}

.member-status {
    font-size: 0.8rem;
    color: var(--text-secondary);
}

.status-online {
    color: var(--success);
}

.status-offline {
    color: var(--gray);
}

.status-away {
    color: var(--warning);
}

/* Time Tracking Styles */
.time-tracking-chart {
    background: white;
    padding: 20px;
    border-radius: 10px;
    height: 200px;
}

/* Chat Styles */
.chat-container {
    display: flex;
    height: calc(80vh - 120px);
    border: 1px solid var(--border-color);
    border-radius: 10px;
    overflow: hidden;
}

.chat-sidebar {
    width: 250px;
    background: var(--bg-secondary);
    border-right: 1px solid var(--border-color);
    padding: 15px;
    overflow-y: auto;
}

.chat-main {
    flex: 1;
    display: flex;
    flex-direction: column;
}

.chat-messages {
    flex: 1;
    padding: 20px;
    overflow-y: auto;
    background: var(--bg-card);
}

.chat-input-container {
    display: flex;
    padding: 15px;
    border-top: 1px solid var(--border-color);
    background: white;
}

.chat-input {
    flex: 1;
    padding: 12px 15px;
    border: 1px solid var(--border-color);
    border-radius: 25px;
    margin-right: 10px;
}

.chat-channels {
    margin-bottom: 20px;
}

.chat-channels h5 {
    margin: 0 0 10px 0;
    color: var(--text-secondary);
}

.channel {
    padding: 8px 12px;
    border-radius: 5px;
    cursor: pointer;
    margin-bottom: 5px;
    transition: background-color 0.2s;
}

.channel:hover {
    background: var(--bg-card);
}

.channel.active {
    background: var(--primary);
    color: white;
}

.online-users h5 {
    margin: 0 0 10px 0;
    color: var(--text-secondary);
}

.online-user {
    display: flex;
    align-items: center;
    gap: 8px;
    padding: 8px;
    border-radius: 5px;
    margin-bottom: 5px;
}

.online-user.active {
    background: var(--bg-card);
}

.user-status {
    width: 8px;
    height: 8px;
    border-radius: 50%;
    background: var(--success);
}

.user-status.away {
    background: var(--warning);
}

.message {
    margin-bottom: 15px;
    padding: 10px 15px;
    border-radius: 10px;
    background: var(--bg-secondary);
    max-width: 70%;
}

.message.own {
    background: var(--primary);
    color: white;
    margin-left: auto;
}

.message-header {
    display: flex;
    justify-content: space-between;
    margin-bottom: 5px;
    font-size: 0.8rem;
}

.message-sender {
    font-weight: 600;
}

.message-time {
    color: var(--text-secondary);
}

.message.own .message-time {
    color: rgba(255,255,255,0.8);
}

/* Video Call Styles */
.video-call-container {
    display: flex;
    height: calc(90vh - 120px);
}

.video-grid {
    flex: 1;
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
    gap: 15px;
    padding: 20px;
    background: var(--bg-secondary);
}

.video-participant {
    background: var(--bg-card);
    border-radius: 10px;
    padding: 15px;
    text-align: center;
    position: relative;
}

.video-participant.local {
    border: 2px solid var(--primary);
}

.video-placeholder {
    width: 100%;
    height: 200px;
    background: var(--bg-secondary);
    border-radius: 8px;
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    margin-bottom: 10px;
}

.user-avatar {
    width: 80px;
    height: 80px;
    border-radius: 50%;
    background: var(--primary);
    color: white;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 1.5rem;
    font-weight: bold;
    margin-bottom: 10px;
}

.participant-status {
    position: absolute;
    top: 10px;
    right: 10px;
    background: var(--danger);
    color: white;
    padding: 2px 8px;
    border-radius: 10px;
    font-size: 0.7rem;
}

.call-participants {
    width: 250px;
    background: var(--bg-secondary);
    border-left: 1px solid var(--border-color);
    padding: 15px;
    overflow-y: auto;
}

.call-participants h5 {
    margin: 0 0 15px 0;
    color: var(--text-secondary);
}

.call-participant {
    display: flex;
    align-items: center;
    gap: 10px;
    padding: 8px;
    border-radius: 5px;
    margin-bottom: 8px;
    background: var(--bg-card);
}

/* Form Styles */
.form-row {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 15px;
}

.chat-header-actions {
    display: flex;
    align-items: center;
    gap: 10px;
}

.online-count {
    background: var(--success);
    color: white;
    padding: 4px 12px;
    border-radius: 15px;
    font-size: 0.8rem;
}

.call-controls {
    display: flex;
    gap: 8px;
    align-items: center;
}

/* Animations */
@keyframes slideInUp {
    from {
        opacity: 0;
        transform: translateY(20px);
    }
    to {
        opacity: 1;
        transform: translateY(0);
    }
}

.task-card {
    animation: slideInUp 0.3s ease;
}

.team-member-card {
    animation: slideInUp 0.3s ease;
}

/* Responsive Design */
@media (max-width: 768px) {
    .remote-stats-grid {
        grid-template-columns: 1fr 1fr;
    }
    
    .remote-quick-actions {
        flex-direction: column;
    }
    
    .tasks-container {
        grid-template-columns: 1fr;
    }
    
    .team-members-list {
        grid-template-columns: 1fr;
    }
    
    .form-row {
        grid-template-columns: 1fr;
    }
    
    .chat-container {
        flex-direction: column;
        height: 70vh;
    }
    
    .chat-sidebar {
        width: 100%;
        height: 150px;
        border-right: none;
        border-bottom: 1px solid var(--border-color);
    }
    
    .video-call-container {
        flex-direction: column;
    }
    
    .call-participants {
        width: 100%;
        height: 150px;
        border-left: none;
        border-top: 1px solid var(--border-color);
    }
}

/* Settings Button Styles */
.settings-toggle {
    position: fixed;
    top: 20px;
    right: 170px;
    z-index: 1000;
}

.settings-btn {
    background: var(--bg-card);
    border: 2px solid var(--border-color);
    border-radius: 50px;
    padding: 12px 20px;
    cursor: pointer;
    display: flex;
    align-items: center;
    gap: 10px;
    font-weight: 600;
    color: var(--text-primary);
    box-shadow: var(--shadow);
    transition: all 0.3s ease;
    backdrop-filter: blur(10px);
}

.settings-btn:hover {
    transform: translateY(-2px);
    box-shadow: 0 8px 25px rgba(0,0,0,0.15);
    border-color: var(--primary);
}

.settings-icon {
    font-size: 1.3rem;
    transition: transform 0.5s ease;
}

.settings-btn:hover .settings-icon {
    transform: rotate(90deg);
}

/* Settings Modal Styles */
.settings-modal {
    max-width: 800px;
    max-height: 90vh;
}

.settings-tabs {
    display: flex;
    border-bottom: 2px solid var(--border-color);
    margin-bottom: 20px;
    flex-wrap: wrap;
}

.settings-tab {
    padding: 12px 20px;
    cursor: pointer;
    border-bottom: 3px solid transparent;
    transition: all 0.3s ease;
    font-weight: 500;
    color: var(--text-secondary);
    flex: 1;
    min-width: 120px;
    text-align: center;
}

.settings-tab.active {
    color: var(--primary);
    border-bottom-color: var(--primary);
    background: rgba(58, 134, 255, 0.05);
}

.settings-content {
    display: none;
    animation: fadeIn 0.5s ease;
    max-height: 60vh;
    overflow-y: auto;
    padding: 10px;
}

.settings-content.active {
    display: block;
}

.settings-section {
    margin-bottom: 25px;
    padding-bottom: 20px;
    border-bottom: 1px solid var(--border-color);
}

.settings-section:last-child {
    border-bottom: none;
}

.settings-section h4 {
    margin-bottom: 15px;
    color: var(--primary);
    display: flex;
    align-items: center;
    gap: 8px;
}

.setting-item {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 12px 0;
    border-bottom: 1px solid var(--border-color);
}

.setting-item:last-child {
    border-bottom: none;
}

.setting-info {
    flex: 1;
}

.setting-title {
    font-weight: 600;
    margin-bottom: 5px;
}

.setting-description {
    font-size: 0.9rem;
    color: var(--text-secondary);
}

/* Toggle Switch */
.toggle-switch {
    position: relative;
    display: inline-block;
    width: 50px;
    height: 24px;
}

.toggle-switch input {
    opacity: 0;
    width: 0;
    height: 0;
}

.toggle-slider {
    position: absolute;
    cursor: pointer;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background-color: var(--border-color);
    transition: .4s;
    border-radius: 34px;
}

.toggle-slider:before {
    position: absolute;
    content: "";
    height: 16px;
    width: 16px;
    left: 4px;
    bottom: 4px;
    background-color: white;
    transition: .4s;
    border-radius: 50%;
}

input:checked + .toggle-slider {
    background-color: var(--primary);
}

input:checked + .toggle-slider:before {
    transform: translateX(26px);
}

/* Select and Input Styles */
.setting-control {
    padding: 8px 12px;
    border: 1px solid var(--border-color);
    border-radius: 6px;
    background: var(--bg-card);
    color: var(--text-primary);
    min-width: 150px;
}

/* Notification Test Area */
.notification-test {
    display: flex;
    gap: 10px;
    margin-top: 15px;
}

/* Color Picker */
.color-picker {
    display: flex;
    gap: 10px;
    align-items: center;
}

.color-option {
    width: 30px;
    height: 30px;
    border-radius: 50%;
    cursor: pointer;
    border: 2px solid transparent;
    transition: all 0.3s ease;
}

.color-option.active {
    border-color: var(--text-primary);
    transform: scale(1.1);
}

/* Reset Button */
.reset-section {
    text-align: center;
    padding: 20px;
    background: rgba(239, 71, 111, 0.1);
    border-radius: 10px;
    margin-top: 20px;
}

/* Responsive Design */
@media (max-width: 768px) {
    .settings-toggle {
        right: 80px;
    }
    
    .settings-btn {
        padding: 10px 15px;
        font-size: 0.9rem;
    }
    
    .settings-tabs {
        flex-direction: column;
    }
    
    .settings-tab {
        min-width: 100%;
    }
    
    .setting-item {
        flex-direction: column;
        align-items: flex-start;
        gap: 10px;
    }
    
    .setting-control {
        min-width: 100%;
    }
}

/* Button loading state */
.btn:disabled {
    opacity: 0.7;
    cursor: not-allowed;
}

/* Table row animations */
#employeeDatabaseTable tr {
    transition: all 0.3s ease;
}

/* Enhanced Employees Section Styles */
.advanced-filters-employees {
    background: var(--bg-card);
    padding: 20px;
    border-radius: 12px;
    box-shadow: var(--shadow);
    border-left: 4px solid var(--primary);
    animation: slideDown 0.3s ease;
}

.filter-section h4 {
    margin-bottom: 15px;
    color: var(--primary);
    display: flex;
    align-items: center;
    gap: 8px;
}

.filter-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
    gap: 15px;
    margin-bottom: 20px;
}

.quick-actions {
    display: flex;
    gap: 8px;
    flex-wrap: wrap;
    justify-content: center;
}

.quick-actions .btn {
    margin: 2px;
    font-size: 0.8rem;
    padding: 6px 12px;
}

/* Clickable employee names */
.employee-name-clickable {
    color: var(--primary);
    cursor: pointer;
    transition: all 0.3s ease;
    padding: 2px 5px;
    border-radius: 4px;
}

.employee-name-clickable:hover {
    background: rgba(58, 134, 255, 0.1);
    text-decoration: underline;
}

/* Row animations */
.fade-in-row {
    animation: fadeInUp 0.5s ease forwards;
    opacity: 0;
}

@keyframes fadeInUp {
    from {
        opacity: 0;
        transform: translateY(20px);
    }
    to {
        opacity: 1;
        transform: translateY(0);
    }
}

@keyframes slideDown {
    from {
        opacity: 0;
        transform: translateY(-20px);
    }
    to {
        opacity: 1;
        transform: translateY(0);
    }
}

/* Status badges */
.status-badge {
    padding: 4px 8px;
    border-radius: 12px;
    font-size: 0.7rem;
    font-weight: 500;
}

.status-active {
    background: rgba(6, 214, 160, 0.2);
    color: var(--success);
}

.status-inactive {
    background: rgba(239, 71, 111, 0.2);
    color: var(--danger);
}

/* Action buttons */
.action-buttons {
    display: flex;
    gap: 5px;
    flex-wrap: wrap;
}

.action-buttons .btn-sm {
    padding: 4px 8px;
    font-size: 0.7rem;
}
/* Time Tracking Styles */
.time-tracking-section {
    background: var(--bg-card);
    padding: 25px;
    border-radius: 15px;
    box-shadow: var(--shadow);
    margin: 20px 0;
    border-left: 5px solid var(--primary);
}

.time-tracking-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 20px;
    padding-bottom: 15px;
    border-bottom: 2px solid var(--border-color);
}

.current-time {
    background: var(--primary);
    color: white;
    padding: 8px 15px;
    border-radius: 20px;
    font-weight: bold;
    font-family: monospace;
}

.time-tracking-content {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 20px;
    margin-bottom: 25px;
}

@media (max-width: 768px) {
    .time-tracking-content {
        grid-template-columns: 1fr;
    }
}

.employee-self-tracking, .today-summary {
    background: var(--bg-secondary);
    padding: 20px;
    border-radius: 12px;
}

.time-status-card {
    text-align: center;
}

.status-indicator {
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 10px;
    margin-bottom: 15px;
    font-weight: bold;
}

.status-dot {
    width: 12px;
    height: 12px;
    border-radius: 50%;
    background: var(--danger);
}

.status-dot.active {
    background: var(--success);
    animation: pulse 2s infinite;
}

.time-controls {
    display: flex;
    gap: 10px;
    justify-content: center;
    flex-wrap: wrap;
    margin-bottom: 15px;
}

.session-info {
    font-size: 0.9rem;
    color: var(--text-secondary);
}

.summary-grid {
    display: grid;
    grid-template-columns: repeat(3, 1fr);
    gap: 15px;
}

.summary-item {
    text-align: center;
    padding: 15px;
    background: var(--bg-card);
    border-radius: 10px;
}

.summary-value {
    font-size: 1.3rem;
    font-weight: bold;
    color: var(--primary);
    margin-bottom: 5px;
}

.summary-label {
    font-size: 0.8rem;
    color: var(--text-secondary);
}

.type-badge {
    padding: 3px 8px;
    border-radius: 10px;
    font-size: 0.7rem;
    font-weight: bold;
}

.type-badge.full-time {
    background: rgba(58, 134, 255, 0.2);
    color: var(--primary);
}

.type-badge.part-time {
    background: rgba(255, 209, 102, 0.2);
    color: var(--warning);
}

@keyframes pulse {
    0% { opacity: 1; }
    50% { opacity: 0.5; }
    100% { opacity: 1; }
}

.time-records-table {
    margin-top: 20px;
}

.time-records-table h4 {
    margin-bottom: 15px;
    color: var(--primary);
}



/* Team Building Specific Styles */
.events-section {
    margin: 30px 0;
}

.events-grid {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(350px, 1fr));
    gap: 20px;
    margin-top: 20px;
}

.event-card {
    background: var(--bg-card);
    border-radius: 15px;
    padding: 20px;
    box-shadow: var(--shadow);
    border-left: 5px solid #3a86ff;
    transition: all 0.3s ease;
}

.event-card:hover {
    transform: translateY(-5px);
    box-shadow: 0 10px 25px rgba(0,0,0,0.15);
}

.event-header {
    display: flex;
    justify-content: space-between;
    align-items: flex-start;
    margin-bottom: 15px;
}

.event-title {
    font-size: 1.2rem;
    font-weight: 600;
    margin: 0;
    color: var(--text-primary);
}

.event-type {
    padding: 4px 12px;
    border-radius: 20px;
    font-size: 0.8rem;
    font-weight: 500;
    background: var(--primary);
    color: white;
}

.event-details {
    margin: 15px 0;
}

.event-detail-item {
    display: flex;
    align-items: center;
    gap: 8px;
    margin-bottom: 8px;
    color: var(--text-secondary);
    font-size: 0.9rem;
}

.event-actions {
    display: flex;
    gap: 8px;
    margin-top: 15px;
}

/* Activities Library */
.activities-library {
    margin: 30px 0;
}

.activity-filters {
    display: flex;
    gap: 10px;
    flex-wrap: wrap;
    margin: 20px 0;
}

.activities-grid {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
    gap: 20px;
}

.activity-card {
    background: var(--bg-card);
    border-radius: 15px;
    padding: 20px;
    box-shadow: var(--shadow);
    transition: all 0.3s ease;
    cursor: pointer;
    border: 2px solid transparent;
}

.activity-card:hover {
    transform: translateY(-3px);
    box-shadow: 0 8px 20px rgba(0,0,0,0.12);
    border-color: var(--primary);
}

.activity-icon {
    font-size: 2.5rem;
    margin-bottom: 15px;
    text-align: center;
}

.activity-info h4 {
    margin: 0 0 10px 0;
    color: var(--text-primary);
}

.activity-description {
    color: var(--text-secondary);
    font-size: 0.9rem;
    margin-bottom: 15px;
    line-height: 1.4;
}

.activity-meta {
    display: flex;
    justify-content: space-between;
    font-size: 0.8rem;
    color: var(--text-secondary);
    margin-bottom: 15px;
}

.activity-meta-item {
    display: flex;
    align-items: center;
    gap: 5px;
}

.no-events {
    text-align: center;
    padding: 40px;
    color: var(--text-secondary);
    grid-column: 1 / -1;
}

/* Responsive */
@media (max-width: 768px) {
    .events-grid,
    .activities-grid {
        grid-template-columns: 1fr;
    }
    
    .activity-filters {
        justify-content: center;
    }
}


/* Navigation Tabs - Scrollable and Compact */
.nav-tabs {
    display: flex;
    background: var(--light);
    border-bottom: 2px solid #e9ecef;
    padding: 0 20px;
    overflow-x: auto;
    overflow-y: hidden;
    white-space: nowrap;
    scrollbar-width: thin;
    scrollbar-color: var(--primary) transparent;
    -ms-overflow-style: -ms-autohiding-scrollbar;
    scroll-behavior: smooth;
}

/* Webkit Scrollbar Styling */
.nav-tabs::-webkit-scrollbar {
    height: 6px;
}

.nav-tabs::-webkit-scrollbar-track {
    background: transparent;
    border-radius: 10px;
}

.nav-tabs::-webkit-scrollbar-thumb {
    background: var(--primary);
    border-radius: 10px;
    opacity: 0.6;
}

.nav-tabs::-webkit-scrollbar-thumb:hover {
    background: var(--secondary);
    opacity: 1;
}

/* Compact Navigation Tabs */
.nav-tab {
    padding: 12px 20px;
    cursor: pointer;
    border-bottom: 3px solid transparent;
    transition: all 0.3s ease;
    font-weight: 500;
    color: var(--gray);
    font-size: 0.9rem;
    min-width: auto;
    flex-shrink: 0;
    display: flex;
    align-items: center;
    gap: 8px;
}

.nav-tab.active {
    color: var(--primary);
    border-bottom-color: var(--primary);
    background: rgba(58, 134, 255, 0.05);
    font-weight: 600;
}

.nav-tab:hover {
    color: var(--primary);
    background: rgba(58, 134, 255, 0.05);
    transform: translateY(-1px);
}

/* Mobile Responsive */
@media (max-width: 768px) {
    .nav-tabs {
        padding: 0 15px;
        gap: 5px;
    }
    
    .nav-tab {
        padding: 10px 15px;
        font-size: 0.85rem;
        gap: 5px;
    }
}

/* Small screens */
@media (max-width: 480px) {
    .nav-tabs {
        padding: 0 10px;
    }
    
    .nav-tab {
        padding: 8px 12px;
        font-size: 0.8rem;
    }
}

/* Navigation Icons Size */
.nav-tab .nav-icon {
    font-size: 1rem;
    flex-shrink: 0;
}

/* Smooth scrolling for navigation */
.nav-tabs-container {
    position: relative;
    background: var(--light);
    border-bottom: 2px solid #e9ecef;
}

/* Scroll buttons for navigation (optional) */
.nav-scroll-btn {
    position: absolute;
    top: 0;
    bottom: 0;
    width: 30px;
    background: rgba(255, 255, 255, 0.9);
    border: none;
    cursor: pointer;
    z-index: 10;
    display: flex;
    align-items: center;
    justify-content: center;
    color: var(--primary);
    font-size: 1.2rem;
    transition: all 0.3s ease;
}

.nav-scroll-btn:hover {
    background: var(--primary);
    color: white;
}

.nav-scroll-btn.left {
    left: 0;
}

.nav-scroll-btn.right {
    right: 0;
}

/* Hide scroll buttons on mobile */
@media (max-width: 768px) {
    .nav-scroll-btn {
        display: none;
    }
}

/* Compact Navigation Mode */
.nav-tabs.compact-mode .nav-tab {
    padding: 10px 15px;
    font-size: 0.85rem;
    min-width: 80px;
}

.nav-tabs.compact-mode .nav-tab .nav-icon {
    font-size: 0.9rem;
    margin-right: 4px;
}

/* Even more compact for very small screens */
@media (max-width: 480px) {
    .nav-tabs.compact-mode .nav-tab {
        padding: 8px 12px;
        font-size: 0.8rem;
        min-width: 70px;
    }
    
    .nav-tabs.compact-mode .nav-tab .nav-icon {
        font-size: 0.8rem;
        margin-right: 3px;
    }
}

/* Navigation tooltips for compact text */
.nav-tab[title] {
    position: relative;
}

.nav-tab[title]:hover::after {
    content: attr(title);
    position: absolute;
    bottom: -40px;
    left: 50%;
    transform: translateX(-50%);
    background: var(--dark);
    color: white;
    padding: 8px 12px;
    border-radius: 6px;
    font-size: 0.8rem;
    white-space: nowrap;
    z-index: 1000;
    box-shadow: 0 4px 12px rgba(0,0,0,0.2);
}

.nav-tab[title]:hover::before {
    content: '';
    position: absolute;
    bottom: -8px;
    left: 50%;
    transform: translateX(-50%);
    border: 5px solid transparent;
    border-bottom-color: var(--dark);
    z-index: 1000;
}

/* Active state enhancements */
.nav-tab.active {
    position: relative;
    z-index: 5;
}

.nav-tab.active::after {
    content: '';
    position: absolute;
    bottom: -2px;
    left: 0;
    right: 0;
    height: 3px;
    background: var(--primary);
    border-radius: 3px 3px 0 0;
}

/* Navigation loading states */
.nav-tab.loading {
    opacity: 0.7;
    pointer-events: none;
}

.nav-tab.loading::after {
    content: '...';
    margin-left: 5px;
    animation: loadingDots 1.5s infinite;
}

@keyframes loadingDots {
    0%, 20% { content: '.'; }
    40% { content: '..'; }
    60%, 100% { content: '...'; }
}

/* Navigation scroll indicators */
.nav-tabs::before,
.nav-tabs::after {
    content: '';
    position: absolute;
    top: 0;
    bottom: 0;
    width: 20px;
    pointer-events: none;
    z-index: 2;
    transition: opacity 0.3s ease;
}

.nav-tabs::before {
    left: 0;
    background: linear-gradient(to right, var(--light), transparent);
}

.nav-tabs::after {
    right: 0;
    background: linear-gradient(to left, var(--light), transparent);
}

.nav-tabs.scroll-start::before,
.nav-tabs.scroll-end::after {
    opacity: 0;
}

/* Smooth transitions */
.nav-tab {
    transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
}

/* Focus states for accessibility */
.nav-tab:focus {
    outline: 2px solid var(--primary);
    outline-offset: 2px;
}

/* High contrast mode support */
@media (prefers-contrast: high) {
    .nav-tab {
        border: 1px solid transparent;
    }
    
    .nav-tab.active {
        border-color: var(--primary);
        background: var(--primary);
        color: white;
    }
}

/* Quick Fix - Immediate Scrollable Navigation */
.nav-tabs {
    overflow-x: auto !important;
    white-space: nowrap !important;
    scrollbar-width: thin !important;
    padding: 0 15px !important;
}

.nav-tab {
    display: inline-block !important;
    float: none !important;
    min-width: 120px !important;
    text-align: center !important;
    padding: 12px 15px !important;
    font-size: 0.9rem !important;
}

/* Hide scrollbar but keep functionality */
.nav-tabs::-webkit-scrollbar {
    height: 4px !important;
}

.nav-tabs::-webkit-scrollbar-thumb {
    background: var(--primary) !important;
    border-radius: 2px !important;
}
/* AI Chatbot Styles */
#aiChatbotContainer {
    position: fixed;
    bottom: 20px;
    right: 20px;
    z-index: 10000;
    font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
}

/* Chatbot Toggle Button */
.chatbot-toggle {
    position: relative;
    width: 60px;
    height: 60px;
    background: linear-gradient(135deg, var(--primary), var(--secondary));
    border-radius: 50%;
    cursor: pointer;
    box-shadow: 0 8px 25px rgba(58, 134, 255, 0.4);
    display: flex;
    align-items: center;
    justify-content: center;
    transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
    animation: float 3s ease-in-out infinite;
}

.chatbot-toggle:hover {
    transform: scale(1.1) rotate(5deg);
    box-shadow: 0 12px 35px rgba(58, 134, 255, 0.6);
}

.chatbot-icon .bot-face {
    font-size: 1.8rem;
    filter: drop-shadow(0 2px 4px rgba(0,0,0,0.2));
}

.chatbot-pulse {
    position: absolute;
    width: 100%;
    height: 100%;
    border-radius: 50%;
    background: transparent;
    border: 2px solid var(--primary);
    animation: pulse 2s infinite;
    opacity: 0;
}

/* Chatbot Window */
.chatbot-window {
    position: absolute;
    bottom: 80px;
    right: 0;
    width: 350px;
    height: 500px;
    background: white;
    border-radius: 20px;
    box-shadow: 0 15px 50px rgba(0,0,0,0.2);
    display: none;
    flex-direction: column;
    overflow: hidden;
    transform: translateY(20px);
    opacity: 0;
    transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
    border: 1px solid #e1e5e9;
}

.chatbot-window.active {
    display: flex;
    transform: translateY(0);
    opacity: 1;
    animation: slideUp 0.5s cubic-bezier(0.4, 0, 0.2, 1);
}

/* Chat Header */
.chatbot-header {
    background: linear-gradient(135deg, var(--primary), var(--secondary));
    color: white;
    padding: 20px;
    display: flex;
    align-items: center;
    gap: 12px;
    position: relative;
}

.chatbot-avatar {
    width: 40px;
    height: 40px;
    background: rgba(255,255,255,0.2);
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    backdrop-filter: blur(10px);
}

.chatbot-info h3 {
    margin: 0;
    font-size: 1.1rem;
    font-weight: 600;
}

.chatbot-info p {
    margin: 2px 0 0 0;
    font-size: 0.8rem;
    opacity: 0.9;
}

.chatbot-actions {
    position: absolute;
    top: 15px;
    right: 15px;
    display: flex;
    gap: 5px;
}

.btn-minimize, .btn-close {
    background: rgba(255,255,255,0.2);
    border: none;
    color: white;
    width: 25px;
    height: 25px;
    border-radius: 50%;
    cursor: pointer;
    font-size: 0.9rem;
    display: flex;
    align-items: center;
    justify-content: center;
    transition: all 0.2s ease;
    backdrop-filter: blur(10px);
}

.btn-minimize:hover, .btn-close:hover {
    background: rgba(255,255,255,0.3);
    transform: scale(1.1);
}

/* Chat Messages */
.chatbot-messages {
    flex: 1;
    padding: 20px;
    overflow-y: auto;
    background: #f8f9fa;
    display: flex;
    flex-direction: column;
    gap: 15px;
}

.message {
    max-width: 80%;
    padding: 12px 16px;
    border-radius: 18px;
    animation: messageSlide 0.3s ease-out;
    position: relative;
    line-height: 1.4;
}

.message.bot {
    align-self: flex-start;
    background: white;
    border-bottom-left-radius: 5px;
    box-shadow: 0 2px 8px rgba(0,0,0,0.1);
    border: 1px solid #e9ecef;
}

.message.user {
    align-self: flex-end;
    background: linear-gradient(135deg, var(--primary), var(--secondary));
    color: white;
    border-bottom-right-radius: 5px;
    box-shadow: 0 2px 8px rgba(58, 134, 255, 0.3);
}

.message-typing {
    align-self: flex-start;
    background: white;
    padding: 12px 16px;
    border-radius: 18px;
    border-bottom-left-radius: 5px;
    display: flex;
    gap: 4px;
    box-shadow: 0 2px 8px rgba(0,0,0,0.1);
}

.typing-dot {
    width: 8px;
    height: 8px;
    background: var(--gray);
    border-radius: 50%;
    animation: typing 1.4s infinite ease-in-out;
}

.typing-dot:nth-child(1) { animation-delay: -0.32s; }
.typing-dot:nth-child(2) { animation-delay: -0.16s; }

/* Quick Actions */
.quick-actions {
    padding: 15px 20px;
    background: white;
    border-top: 1px solid #e9ecef;
    display: flex;
    gap: 8px;
    flex-wrap: wrap;
}

.quick-btn {
    background: #f8f9fa;
    border: 1px solid #e9ecef;
    padding: 8px 12px;
    border-radius: 20px;
    font-size: 0.75rem;
    cursor: pointer;
    transition: all 0.2s ease;
    color: var(--dark);
}

.quick-btn:hover {
    background: var(--primary);
    color: white;
    transform: translateY(-1px);
    box-shadow: 0 4px 12px rgba(58, 134, 255, 0.3);
}

/* Chat Input */
.chatbot-input-container {
    padding: 15px 20px;
    background: white;
    border-top: 1px solid #e9ecef;
    display: flex;
    gap: 10px;
    align-items: center;
}

#chatbotInput {
    flex: 1;
    padding: 12px 16px;
    border: 2px solid #e9ecef;
    border-radius: 25px;
    outline: none;
    font-size: 0.9rem;
    transition: all 0.3s ease;
}

#chatbotInput:focus {
    border-color: var(--primary);
    box-shadow: 0 0 0 3px rgba(58, 134, 255, 0.1);
}

.btn-send {
    width: 45px;
    height: 45px;
    background: linear-gradient(135deg, var(--primary), var(--secondary));
    border: none;
    border-radius: 50%;
    color: white;
    cursor: pointer;
    display: flex;
    align-items: center;
    justify-content: center;
    transition: all 0.3s ease;
    box-shadow: 0 4px 15px rgba(58, 134, 255, 0.4);
}

.btn-send:hover {
    transform: scale(1.1) rotate(15deg);
    box-shadow: 0 6px 20px rgba(58, 134, 255, 0.6);
}

.btn-send span {
    font-size: 1.1rem;
    margin-left: 2px;
}

/* Animations */
@keyframes float {
    0%, 100% { transform: translateY(0px) rotate(0deg); }
    50% { transform: translateY(-10px) rotate(2deg); }
}

@keyframes pulse {
    0% { transform: scale(1); opacity: 1; }
    100% { transform: scale(1.5); opacity: 0; }
}

@keyframes slideUp {
    0% { transform: translateY(20px); opacity: 0; }
    100% { transform: translateY(0); opacity: 1; }
}

@keyframes messageSlide {
    0% { transform: translateY(10px); opacity: 0; }
    100% { transform: translateY(0); opacity: 1; }
}

@keyframes typing {
    0%, 60%, 100% { transform: scale(1); opacity: 0.5; }
    30% { transform: scale(1.2); opacity: 1; }
}

/* Welcome Message Animation */
.welcome-message {
    text-align: center;
    padding: 20px;
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    color: white;
    border-radius: 15px;
    margin-bottom: 15px;
    animation: welcomePulse 2s ease-in-out;
}

@keyframes welcomePulse {
    0% { transform: scale(0.9); opacity: 0; }
    50% { transform: scale(1.02); }
    100% { transform: scale(1); opacity: 1; }
}

/* Responsive Design */
@media (max-width: 768px) {
    #aiChatbotContainer {
        bottom: 10px;
        right: 10px;
    }
    
    .chatbot-window {
        width: calc(100vw - 40px);
        height: 70vh;
        right: -10px;
    }
    
    .chatbot-toggle {
        width: 50px;
        height: 50px;
    }
}

/* Scrollbar Styling */
.chatbot-messages::-webkit-scrollbar {
    width: 6px;
}

.chatbot-messages::-webkit-scrollbar-track {
    background: #f1f1f1;
    border-radius: 3px;
}

.chatbot-messages::-webkit-scrollbar-thumb {
    background: var(--primary);
    border-radius: 3px;
}

.chatbot-messages::-webkit-scrollbar-thumb:hover {
    background: var(--secondary);
}
/* Dark Mode Support for Chatbot */
[data-theme="dark"] .chatbot-window {
    background: var(--bg-card);
    color: var(--text-primary);
    border-color: var(--border-color);
}

[data-theme="dark"] .chatbot-messages {
    background: var(--bg-secondary);
}

[data-theme="dark"] .message.bot {
    background: var(--bg-card);
    border-color: var(--border-color);
    color: var(--text-primary);
}

[data-theme="dark"] .message.user {
    background: linear-gradient(135deg, var(--primary), var(--secondary));
    color: white;
}

[data-theme="dark"] .quick-actions {
    background: var(--bg-card);
    border-color: var(--border-color);
}

[data-theme="dark"] .quick-btn {
    background: var(--bg-secondary);
    border-color: var(--border-color);
    color: var(--text-primary);
}

[data-theme="dark"] .quick-btn:hover {
    background: var(--primary);
    color: white;
}

[data-theme="dark"] .chatbot-input-container {
    background: var(--bg-card);
    border-color: var(--border-color);
}

[data-theme="dark"] #chatbotInput {
    background: var(--bg-secondary);
    border-color: var(--border-color);
    color: var(--text-primary);
}

[data-theme="dark"] #chatbotInput:focus {
    border-color: var(--primary);
    background: var(--bg-card);
}

[data-theme="dark"] .message-typing {
    background: var(--bg-card);
    border-color: var(--border-color);
}

[data-theme="dark"] .typing-dot {
    background: var(--text-secondary);
}

[data-theme="dark"] .welcome-message {
    background: linear-gradient(135deg, var(--primary), var(--secondary));
    color: white;
}
/* AI Chatbot Styles */
#aiChatbotContainer {
    position: fixed;
    bottom: 20px;
    right: 20px;
    z-index: 10000;
    font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
}

/* Chatbot Toggle Button */
.chatbot-toggle {
    position: relative;
    width: 60px;
    height: 60px;
    background: linear-gradient(135deg, var(--primary), var(--secondary));
    border-radius: 50%;
    cursor: pointer;
    box-shadow: 0 8px 25px rgba(58, 134, 255, 0.4);
    display: flex;
    align-items: center;
    justify-content: center;
    transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
    animation: float 3s ease-in-out infinite;
}

.chatbot-toggle:hover {
    transform: scale(1.1) rotate(5deg);
    box-shadow: 0 12px 35px rgba(58, 134, 255, 0.6);
}

.chatbot-icon .bot-face {
    font-size: 1.8rem;
    filter: drop-shadow(0 2px 4px rgba(0,0,0,0.2));
}

.chatbot-pulse {
    position: absolute;
    width: 100%;
    height: 100%;
    border-radius: 50%;
    background: transparent;
    border: 2px solid var(--primary);
    animation: pulse 2s infinite;
    opacity: 0;
}

/* Chatbot Window */
.chatbot-window {
    position: absolute;
    bottom: 80px;
    right: 0;
    width: 350px;
    height: 500px;
    background: white;
    border-radius: 20px;
    box-shadow: 0 15px 50px rgba(0,0,0,0.2);
    display: none;
    flex-direction: column;
    overflow: hidden;
    transform: translateY(20px);
    opacity: 0;
    transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
    border: 1px solid #e1e5e9;
}

.chatbot-window.active {
    display: flex;
    transform: translateY(0);
    opacity: 1;
    animation: slideUp 0.5s cubic-bezier(0.4, 0, 0.2, 1);
}

/* Chat Header */
.chatbot-header {
    background: linear-gradient(135deg, var(--primary), var(--secondary));
    color: white;
    padding: 20px;
    display: flex;
    align-items: center;
    gap: 12px;
    position: relative;
}

.chatbot-avatar {
    width: 40px;
    height: 40px;
    background: rgba(255,255,255,0.2);
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    backdrop-filter: blur(10px);
}

.chatbot-info h3 {
    margin: 0;
    font-size: 1.1rem;
    font-weight: 600;
}

.chatbot-info p {
    margin: 2px 0 0 0;
    font-size: 0.8rem;
    opacity: 0.9;
}

.chatbot-actions {
    position: absolute;
    top: 15px;
    right: 15px;
    display: flex;
    gap: 5px;
}

.btn-minimize, .btn-close {
    background: rgba(255,255,255,0.2);
    border: none;
    color: white;
    width: 25px;
    height: 25px;
    border-radius: 50%;
    cursor: pointer;
    font-size: 0.9rem;
    display: flex;
    align-items: center;
    justify-content: center;
    transition: all 0.2s ease;
    backdrop-filter: blur(10px);
}

.btn-minimize:hover, .btn-close:hover {
    background: rgba(255,255,255,0.3);
    transform: scale(1.1);
}

/* Chat Messages */
.chatbot-messages {
    flex: 1;
    padding: 20px;
    overflow-y: auto;
    background: #f8f9fa;
    display: flex;
    flex-direction: column;
    gap: 15px;
}

.message {
    max-width: 80%;
    padding: 12px 16px;
    border-radius: 18px;
    animation: messageSlide 0.3s ease-out;
    position: relative;
    line-height: 1.4;
}

.message.bot {
    align-self: flex-start;
    background: white;
    border-bottom-left-radius: 5px;
    box-shadow: 0 2px 8px rgba(0,0,0,0.1);
    border: 1px solid #e9ecef;
    color: #333; /* Ensure text is visible */
}

.message.user {
    align-self: flex-end;
    background: linear-gradient(135deg, var(--primary), var(--secondary));
    color: white;
    border-bottom-right-radius: 5px;
    box-shadow: 0 2px 8px rgba(58, 134, 255, 0.3);
}

.message-typing {
    align-self: flex-start;
    background: white;
    padding: 12px 16px;
    border-radius: 18px;
    border-bottom-left-radius: 5px;
    display: flex;
    gap: 4px;
    box-shadow: 0 2px 8px rgba(0,0,0,0.1);
}

.typing-dot {
    width: 8px;
    height: 8px;
    background: var(--gray);
    border-radius: 50%;
    animation: typing 1.4s infinite ease-in-out;
}

.typing-dot:nth-child(1) { animation-delay: -0.32s; }
.typing-dot:nth-child(2) { animation-delay: -0.16s; }

/* Quick Actions */
.quick-actions {
    padding: 15px 20px;
    background: white;
    border-top: 1px solid #e9ecef;
    display: flex;
    gap: 8px;
    flex-wrap: wrap;
}

.quick-btn {
    background: #f8f9fa;
    border: 1px solid #e9ecef;
    padding: 8px 12px;
    border-radius: 20px;
    font-size: 0.75rem;
    cursor: pointer;
    transition: all 0.2s ease;
    color: var(--dark);
}

.quick-btn:hover {
    background: var(--primary);
    color: white;
    transform: translateY(-1px);
    box-shadow: 0 4px 12px rgba(58, 134, 255, 0.3);
}

/* Chat Input */
.chatbot-input-container {
    padding: 15px 20px;
    background: white;
    border-top: 1px solid #e9ecef;
    display: flex;
    gap: 10px;
    align-items: center;
}

#chatbotInput {
    flex: 1;
    padding: 12px 16px;
    border: 2px solid #e9ecef;
    border-radius: 25px;
    outline: none;
    font-size: 0.9rem;
    transition: all 0.3s ease;
    color: #333; /* Ensure text is visible */
}

#chatbotInput:focus {
    border-color: var(--primary);
    box-shadow: 0 0 0 3px rgba(58, 134, 255, 0.1);
}

.btn-send {
    width: 45px;
    height: 45px;
    background: linear-gradient(135deg, var(--primary), var(--secondary));
    border: none;
    border-radius: 50%;
    color: white;
    cursor: pointer;
    display: flex;
    align-items: center;
    justify-content: center;
    transition: all 0.3s ease;
    box-shadow: 0 4px 15px rgba(58, 134, 255, 0.4);
}

.btn-send:hover {
    transform: scale(1.1) rotate(15deg);
    box-shadow: 0 6px 20px rgba(58, 134, 255, 0.6);
}

.btn-send span {
    font-size: 1.1rem;
    margin-left: 2px;
}

/* Animations */
@keyframes float {
    0%, 100% { transform: translateY(0px) rotate(0deg); }
    50% { transform: translateY(-10px) rotate(2deg); }
}

@keyframes pulse {
    0% { transform: scale(1); opacity: 1; }
    100% { transform: scale(1.5); opacity: 0; }
}

@keyframes slideUp {
    0% { transform: translateY(20px); opacity: 0; }
    100% { transform: translateY(0); opacity: 1; }
}

@keyframes messageSlide {
    0% { transform: translateY(10px); opacity: 0; }
    100% { transform: translateY(0); opacity: 1; }
}

@keyframes typing {
    0%, 60%, 100% { transform: scale(1); opacity: 0.5; }
    30% { transform: scale(1.2); opacity: 1; }
}

/* Welcome Message Animation */
.welcome-message {
    text-align: center;
    padding: 20px;
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    color: white;
    border-radius: 15px;
    margin-bottom: 15px;
    animation: welcomePulse 2s ease-in-out;
}

@keyframes welcomePulse {
    0% { transform: scale(0.9); opacity: 0; }
    50% { transform: scale(1.02); }
    100% { transform: scale(1); opacity: 1; }
}

/* DARK MODE FIXES */
[data-theme="dark"] .chatbot-window {
    background: var(--bg-card);
    color: var(--text-primary);
    border-color: var(--border-color);
}

[data-theme="dark"] .chatbot-messages {
    background: var(--bg-secondary);
}

[data-theme="dark"] .message.bot {
    background: var(--bg-card);
    border-color: var(--border-color);
    color: var(--text-primary);
}

[data-theme="dark"] .message.user {
    background: linear-gradient(135deg, var(--primary), var(--secondary));
    color: white;
}

[data-theme="dark"] .quick-actions {
    background: var(--bg-card);
    border-color: var(--border-color);
}

[data-theme="dark"] .quick-btn {
    background: var(--bg-secondary);
    border-color: var(--border-color);
    color: var(--text-primary);
}

[data-theme="dark"] .quick-btn:hover {
    background: var(--primary);
    color: white;
}

[data-theme="dark"] .chatbot-input-container {
    background: var(--bg-card);
    border-color: var(--border-color);
}

[data-theme="dark"] #chatbotInput {
    background: var(--bg-secondary);
    border-color: var(--border-color);
    color: var(--text-primary);
}

[data-theme="dark"] #chatbotInput:focus {
    border-color: var(--primary);
    background: var(--bg-card);
}

[data-theme="dark"] .message-typing {
    background: var(--bg-card);
    border-color: var(--border-color);
}

[data-theme="dark"] .typing-dot {
    background: var(--text-secondary);
}

[data-theme="dark"] .welcome-message {
    background: linear-gradient(135deg, var(--primary), var(--secondary));
    color: white;
}

[data-theme="dark"] .message.bot {
    color: var(--text-primary) !important;
}

[data-theme="dark"] .message.bot * {
    color: var(--text-primary) !important;
}

/* Responsive Design */
@media (max-width: 768px) {
    #aiChatbotContainer {
        bottom: 10px;
        right: 10px;
    }
    
    .chatbot-window {
        width: calc(100vw - 40px);
        height: 70vh;
        right: -10px;
    }
    
    .chatbot-toggle {
        width: 50px;
        height: 50px;
    }
}

/* Scrollbar Styling */
.chatbot-messages::-webkit-scrollbar {
    width: 6px;
}

.chatbot-messages::-webkit-scrollbar-track {
    background: #f1f1f1;
    border-radius: 3px;
}

.chatbot-messages::-webkit-scrollbar-thumb {
    background: var(--primary);
    border-radius: 3px;
}

.chatbot-messages::-webkit-scrollbar-thumb:hover {
    background: var(--secondary);
}

[data-theme="dark"] .chatbot-messages::-webkit-scrollbar-track {
    background: var(--bg-secondary);
}

[data-theme="dark"] .chatbot-messages::-webkit-scrollbar-thumb {
    background: var(--primary);
}

/* Resume Builder Styles */
.resume-modal {
    max-width: 95%;
    width: 100%;
    max-height: 95vh;
    margin: 20px auto;
}

.resume-builder-container {
    padding: 20px;
    max-height: 80vh;
    overflow-y: auto;
}

.builder-step {
    display: none;
    animation: fadeIn 0.3s ease;
}

.builder-step.active {
    display: block;
}

/* Template Selection */
.templates-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
    gap: 20px;
    margin: 20px 0;
}

.template-card {
    border: 2px solid var(--border-color);
    border-radius: 10px;
    padding: 15px;
    cursor: pointer;
    transition: all 0.3s ease;
    text-align: center;
}

.template-card.active {
    border-color: var(--primary);
    background: rgba(58, 134, 255, 0.05);
}

.template-card:hover {
    transform: translateY(-2px);
    box-shadow: 0 5px 15px rgba(0,0,0,0.1);
}

.template-preview {
    height: 200px;
    border: 1px solid #e9ecef;
    border-radius: 8px;
    margin-bottom: 10px;
    overflow: hidden;
}

/* Template Styles */
.modern-template {
    background: white;
    padding: 15px;
}

.modern-template .preview-header {
    display: flex;
    align-items: center;
    gap: 15px;
    margin-bottom: 15px;
}

.modern-template .preview-avatar {
    width: 50px;
    height: 50px;
    background: var(--primary);
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    color: white;
    font-weight: bold;
}

.professional-template {
    background: #f8f9fa;
    padding: 15px;
}

.creative-template {
    background: linear-gradient(135deg, #667eea, #764ba2);
    color: white;
    padding: 15px;
}

.creative-template .preview-header.creative {
    text-align: center;
}

/* Form Styles */
.form-grid {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 15px;
    margin: 20px 0;
}

.form-group.full-width {
    grid-column: 1 / -1;
}

.form-group label {
    display: block;
    margin-bottom: 5px;
    font-weight: 600;
    color: var(--text-primary);
}

.form-group input,
.form-group textarea {
    width: 100%;
    padding: 10px;
    border: 2px solid var(--border-color);
    border-radius: 8px;
    font-size: 14px;
    transition: border-color 0.3s ease;
}

.form-group input:focus,
.form-group textarea:focus {
    outline: none;
    border-color: var(--primary);
}

/* Photo Upload */
.photo-upload {
    display: flex;
    align-items: center;
    gap: 15px;
}

.upload-btn {
    background: var(--primary);
    color: white;
    padding: 10px 20px;
    border-radius: 8px;
    cursor: pointer;
    transition: background-color 0.3s ease;
}

.upload-btn:hover {
    background: #2a75ff;
}

.photo-preview {
    width: 80px;
    height: 80px;
    border-radius: 50%;
    overflow: hidden;
    border: 3px solid var(--primary);
}

.photo-preview img {
    width: 100%;
    height: 100%;
    object-fit: cover;
}

/* Skills Section */
.skills-input {
    display: flex;
    gap: 10px;
    margin-bottom: 15px;
}

.skills-input input {
    flex: 1;
}

.skills-list {
    display: flex;
    flex-wrap: wrap;
    gap: 8px;
}

.skill-tag {
    background: var(--primary);
    color: white;
    padding: 5px 12px;
    border-radius: 20px;
    font-size: 12px;
    display: flex;
    align-items: center;
    gap: 5px;
}

.skill-tag .remove-skill {
    background: none;
    border: none;
    color: white;
    cursor: pointer;
    font-size: 14px;
}

/* Dynamic Forms */
.section-group {
    margin-bottom: 25px;
    padding-bottom: 20px;
    border-bottom: 1px solid var(--border-color);
}

.section-group h4 {
    margin-bottom: 15px;
    color: var(--primary);
}

.dynamic-form {
    margin-bottom: 10px;
}

.form-row {
    display: grid;
    grid-template-columns: 1fr 1fr 1fr auto;
    gap: 10px;
    align-items: start;
    margin-bottom: 10px;
}

.form-row textarea {
    grid-column: 1 / -1;
    min-height: 60px;
    resize: vertical;
}

/* Step Actions */
.step-actions {
    display: flex;
    justify-content: space-between;
    margin-top: 30px;
    padding-top: 20px;
    border-top: 1px solid var(--border-color);
}

/* Resume Preview */
.preview-actions {
    display: flex;
    gap: 10px;
    margin-bottom: 20px;
    flex-wrap: wrap;
}

.resume-preview {
    background: white;
    border: 1px solid var(--border-color);
    border-radius: 10px;
    padding: 30px;
    min-height: 500px;
    box-shadow: 0 5px 15px rgba(0,0,0,0.1);
}

/* Modern Template Preview */
.resume-modern {
    font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
}

.resume-header {
    display: flex;
    align-items: center;
    gap: 20px;
    margin-bottom: 30px;
    padding-bottom: 20px;
    border-bottom: 2px solid var(--primary);
}

.resume-photo {
    width: 100px;
    height: 100px;
    border-radius: 50%;
    object-fit: cover;
    border: 3px solid var(--primary);
}

.resume-basic-info h1 {
    margin: 0;
    color: var(--primary);
    font-size: 2rem;
}

.resume-contact {
    display: flex;
    gap: 15px;
    flex-wrap: wrap;
    margin-top: 10px;
}

.resume-section {
    margin-bottom: 25px;
}

.resume-section h3 {
    color: var(--primary);
    border-bottom: 1px solid var(--border-color);
    padding-bottom: 5px;
    margin-bottom: 15px;
}

.skills-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
    gap: 10px;
}

.experience-item, .education-item {
    margin-bottom: 15px;
}

.experience-item h4, .education-item h4 {
    margin: 0;
    color: var(--text-primary);
}

.experience-meta, .education-meta {
    color: var(--text-secondary);
    font-size: 0.9rem;
    margin: 5px 0;
}

/* Animations */
@keyframes fadeIn {
    from { opacity: 0; transform: translateY(20px); }
    to { opacity: 1; transform: translateY(0); }
}

/* Responsive Design */
@media (max-width: 768px) {
    .resume-modal {
        margin: 10px;
        max-width: calc(100% - 20px);
    }
    
    .form-grid {
        grid-template-columns: 1fr;
    }
    
    .form-row {
        grid-template-columns: 1fr;
    }
    
    .preview-actions {
        flex-direction: column;
    }
    
    .resume-header {
        flex-direction: column;
        text-align: center;
    }
    
    .resume-contact {
        justify-content: center;
    }
}

/* Dark Mode Support */
[data-theme="dark"] .resume-preview {
    background: var(--bg-card);
    color: var(--text-primary);
}

[data-theme="dark"] .template-preview {
    background: var(--bg-secondary);
    border-color: var(--border-color);
}

    </style>
</head>
<body>
    <div class="container">
        <!-- Header -->
        <div class="header">
            <h1>🤖 AI OptimumWork<span class="ai-badge">Powered by AI</span></h1>
            <p>Intelligent workforce Optimization Platform & management with real-time analytics and predictions</p>
             
        </div>

        <!-- Navigation Tabs -->
        <div class="nav-tabs">
            <div class="nav-tab active" onclick="switchTab('dashboard')">📊 Dashboard</div>
            <div class="nav-tab" onclick="switchTab('employees')">👥 Employees</div>
            <div class="nav-tab" onclick="switchTab('attendance')">✅ Smart Attendance</div>
            <div class="nav-tab" onclick="switchTab('recruitment')">🎯 AI Recruitment</div>
            <div class="nav-tab" onclick="switchTab('analytics')">📈 Analytics</div>
            <div class="nav-tab" onclick="switchTab('projects'); initProjectsTab()">🚀 Projects</div>
            <div class="nav-tab" onclick="openResumeBuilder()">📄 AI Resume Builder</div>
            
            
        </div>  
<!-- Add this inside your container div, right after opening body tag -->
<div class="theme-toggle">
    <button class="toggle-btn" onclick="toggleTheme()">
        <span class="toggle-icon" id="themeIcon">🌙</span>
        <span id="themeText">Dark Mode</span>
    </button>
</div>

<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI Resume Builder</title>
    <link rel="stylesheet" href="resume-builder.css">
</head>
<body>
    <!-- Resume Builder Modal -->
    <div id="resumeBuilderModal" class="modal">
        <div class="modal-content resume-modal">
            <div class="modal-header">
                <h2>🤖 AI Resume Builder</h2>
                <button class="close-modal" onclick="closeResumeBuilder()">×</button>
            </div>

            <div class="resume-builder-container">
                <!-- Step 1: Template Selection -->
                <div class="builder-step active" id="step1">
                    <h3>🎨 Choose Resume Template</h3>
                    <div class="templates-grid">
                        <div class="template-card active" data-template="modern">
                            <div class="template-preview modern-template">
                                <div class="preview-header">
                                    <div class="preview-avatar">JD</div>
                                    <div class="preview-info">
                                        <h4>Ravi kumawat</h4>
                                        <p>Software Developer</p>
                                    </div>
                                </div>
                                <div class="preview-content">
                                    <div class="preview-section">
                                        <h5>Experience</h5>
                                        <p>Senior Developer - 3 years</p>
                                    </div>
                                </div>
                            </div>
                            <p>Modern</p>
                        </div>
                        
                        <div class="template-card" data-template="professional">
                            <div class="template-preview professional-template">
                                <div class="preview-header">
                                    <h4>Ravi kumawat</h4>
                                    <p>Software Developer</p>
                                </div>
                            </div>
                            <p>Professional</p>
                        </div>
                        
                        <div class="template-card" data-template="creative">
                            <div class="template-preview creative-template">
                                <div class="preview-header creative">
                                    <h4>Ravi kumawat</h4>
                                    <p>Creative Developer</p>
                                </div>
                            </div>
                            <p>Creative</p>
                        </div>
                    </div>
                    <button class="btn btn-primary next-step" onclick="nextStep(2)">Next →</button>
                </div>

                <!-- Step 2: Personal Information -->
                <div class="builder-step" id="step2">
                    <h3>👤 Personal Information</h3>
                    <div class="form-grid">
                        <div class="form-group">
                            <label>Full Name *</label>
                            <input type="text" id="resumeName" placeholder="Enter your full name">
                        </div>
                        <div class="form-group">
                            <label>Email *</label>
                            <input type="email" id="resumeEmail" placeholder="your.email@company.com">
                        </div>
                        <div class="form-group">
                            <label>Phone *</label>
                            <input type="tel" id="resumePhone" placeholder="+91 9876543210">
                        </div>
                        <div class="form-group">
                            <label>Location</label>
                            <input type="text" id="resumeLocation" placeholder="City, Country">
                        </div>
                        <div class="form-group full-width">
                            <label>Profile Photo</label>
                            <div class="photo-upload">
                                <input type="file" id="resumePhoto" accept="image/*" onchange="previewPhoto(event)">
                                <label for="resumePhoto" class="upload-btn">
                                    <span>📷 Upload Photo</span>
                                </label>
                                <div id="photoPreview" class="photo-preview"></div>
                            </div>
                        </div>
                        <div class="form-group full-width">
                            <label>Professional Summary</label>
                            <textarea id="resumeSummary" rows="3" placeholder="Brief professional summary..."></textarea>
                        </div>
                    </div>
                    <div class="step-actions">
                        <button class="btn" onclick="prevStep(1)">← Back</button>
                        <button class="btn btn-primary" onclick="nextStep(3)">Next →</button>
                    </div>
                </div>

                <!-- Step 3: Professional Details -->
                <div class="builder-step" id="step3">
                    <h3>💼 Professional Details</h3>
                    
                    <div class="section-group">
                        <h4>🛠️ Skills</h4>
                        <div class="skills-input">
                            <input type="text" id="skillInput" placeholder="Add skills (e.g., JavaScript, React)">
                            <button class="btn btn-sm" onclick="addSkill()">Add</button>
                        </div>
                        <div id="skillsList" class="skills-list"></div>
                    </div>

                    <div class="section-group">
                        <h4>🎓 Education</h4>
                        <div class="dynamic-form" id="educationForm">
                            <div class="form-row">
                                <input type="text" placeholder="Degree" class="edu-degree">
                                <input type="text" placeholder="Institution">
                                <input type="text" placeholder="Year">
                                <button class="btn btn-sm btn-danger" onclick="removeEducation(this)">−</button>
                            </div>
                        </div>
                        <button class="btn btn-sm" onclick="addEducation()">+ Add Education</button>
                    </div>

                    <div class="section-group">
                        <h4>💼 Work Experience</h4>
                        <div class="dynamic-form" id="experienceForm">
                            <div class="form-row">
                                <input type="text" placeholder="Job Title" class="exp-title">
                                <input type="text" placeholder="Company">
                                <input type="text" placeholder="Duration">
                                <textarea placeholder="Description"></textarea>
                                <button class="btn btn-sm btn-danger" onclick="removeExperience(this)">−</button>
                            </div>
                        </div>
                        <button class="btn btn-sm" onclick="addExperience()">+ Add Experience</button>
                    </div>

                    <div class="section-group">
                        <h4>🏆 Certifications</h4>
                        <div class="dynamic-form" id="certificationForm">
                            <div class="form-row">
                                <input type="text" placeholder="Certification Name">
                                <input type="text" placeholder="Issuing Organization">
                                <input type="text" placeholder="Year">
                                <button class="btn btn-sm btn-danger" onclick="removeCertification(this)">−</button>
                            </div>
                        </div>
                        <button class="btn btn-sm" onclick="addCertification()">+ Add Certification</button>
                    </div>

                    <div class="step-actions">
                        <button class="btn" onclick="prevStep(2)">← Back</button>
                        <button class="btn btn-primary" onclick="generateResume()">Generate Resume</button>
                    </div>
                </div>

                <!-- Step 4: Resume Preview -->
                <div class="builder-step" id="step4">
                    <h3>📄 Resume Preview</h3>
                    <div class="preview-actions">
                        <button class="btn btn-success" onclick="downloadResume()">📥 Download PDF</button>
                        <button class="btn btn-primary" onclick="addToPortfolio()">💼 Add to Portfolio</button>
                        <button class="btn" onclick="shareResume()">📤 Share</button>
                    </div>
                    <div id="resumePreview" class="resume-preview">
                        <!-- Resume will be generated here -->
                    </div>
                    <div class="step-actions">
                        <button class="btn" onclick="prevStep(3)">← Back</button>
                        <button class="btn btn-primary" onclick="closeResumeBuilder()">Finish</button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script src="resume-builder.js"></script>
</body>
</html>
        <!-- Dashboard Tab -->
        <div id="dashboard" class="tab-content active">
            <div class="metrics-grid">
                <div class="metric-card productivity">
                    <div class="metric-icon">📈</div>
                    <h3>Productivity Score</h3>
                    <div class="metric-value" id="productivityScore">85%</div>
                    <div class="ai-trend">↑ 12% improvement</div>
                </div>
                <div class="metric-card risk">
                    <div class="metric-icon">⚠️</div>
                    <h3>Attrition Risk</h3>
                    <div class="metric-value" id="attritionRisk">15%</div>
                    <div class="ai-warning">3 high-risk employees</div>
                </div>
                <div class="metric-card efficiency">
                    <div class="metric-icon">⚡</div>
                    <h3>AI Efficiency Score</h3>
                    <div class="metric-value" id="efficiencyScore">92%</div>
                    <div class="ai-trend">Optimal Performance</div>
                </div>
                <div class="metric-card predictions">
                    <div class="metric-icon">🎯</div>
                    <h3>AI Predictions</h3>
                    <div class="metric-value" id="predictionsCount">47</div>
                    <div class="ai-trend">This month</div>
                </div>
            </div>

            <div class="charts-container">
                <div class="chart-box">
                    <h3>Employee Performance Trends</h3>
                    <canvas id="performanceChart"></canvas>
                </div>
                <div class="chart-box">
                    <h3>Department Distribution</h3>
                    <canvas id="departmentChart"></canvas>
                </div>
            </div>
<!-- Add this to your dashboard tab after the AI Recommendations section -->
<div class="remote-work-section">
    <h3>🏠 Remote Workforce Management</h3>
    
    <!-- Remote Work Stats -->
    <div class="remote-stats-grid">
        <div class="remote-stat-card">
            <div class="remote-stat-icon">👥</div>
            <div class="remote-stat-info">
                <div class="remote-stat-value" id="remoteEmployees">12</div>
                <div class="remote-stat-label">Remote Employees</div>
            </div>
        </div>
        <div class="remote-stat-card">
            <div class="remote-stat-icon">⏱️</div>
            <div class="remote-stat-info">
                <div class="remote-stat-value" id="avgProductivity">87%</div>
                <div class="remote-stat-label">Avg Productivity</div>
            </div>
        </div>
        <div class="remote-stat-card">
            <div class="remote-stat-icon">✅</div>
            <div class="remote-stat-info">
                <div class="remote-stat-value" id="tasksCompleted">156</div>
                <div class="remote-stat-label">Tasks Completed</div>
            </div>
        </div>
        <div class="remote-stat-card">
            <div class="remote-stat-icon">🎯</div>
            <div class="remote-stat-info">
                <div class="remote-stat-value" id="activeProjects">8</div>
                <div class="remote-stat-label">Active Projects</div>
            </div>
        </div>
    </div>

    <!-- Quick Actions -->
    <div class="remote-quick-actions">
        <button class="btn btn-primary" onclick="showTaskAssignmentModal()">
            📋 Assign Task
        </button>
        <button class="btn btn-success" onclick="startVirtualMeeting()">
            🎥 Start Meeting
        </button>
        <button class="btn btn-warning" onclick="showTimeTrackingModal()">
            ⏱️ Log Time
        </button>
        <button class="btn btn-info" onclick="openTeamChat()">
            💬 Team Chat
        </button>
    </div>

    <!-- Task Management -->
    <div class="remote-task-section">
        <div class="section-header">
            <h4>📝 Task Management</h4>
            <button class="btn btn-sm btn-primary" onclick="showAllTasks()">View All</button>
        </div>
        <div class="tasks-container" id="remoteTasksContainer">
            <!-- Tasks will be loaded here -->
        </div>
    </div>

    <!-- Team Activity -->
    <div class="team-activity-section">
        <div class="section-header">
            <h4>👥 Team Activity</h4>
            <span class="online-indicator" id="onlineCount">5 online</span>
        </div>
        <div class="team-members-list" id="teamMembersList">
            <!-- Team members will be loaded here -->
        </div>
    </div>

    <!-- Time Tracking Summary -->
    <div class="time-tracking-section">
        <div class="section-header">
            <h4>⏰ Weekly Time Tracking</h4>
            <span class="total-hours" id="totalHours">Total: 240h</span>
        </div>
        <div class="time-tracking-chart">
            <canvas id="timeTrackingChart"></canvas>
        </div>
    </div>
</div>


<!-- Task Assignment Modal -->
<div id="taskAssignmentModal" class="modal">
    <div class="modal-content">
        <div class="modal-header">
            <h3>📋 Assign New Task</h3>
            <button class="close-modal" onclick="closeModal('taskAssignmentModal')">×</button>
        </div>
        <form id="taskAssignmentForm" onsubmit="assignTask(event)">
            <div class="form-group">
                <label>Task Title</label>
                <input type="text" class="form-control" id="taskTitle" required>
            </div>
            <div class="form-group">
                <label>Description</label>
                <textarea class="form-control" id="taskDescription" rows="3"></textarea>
            </div>
            <div class="form-row">
                <div class="form-group">
                    <label>Assign To</label>
                    <select class="form-control" id="taskAssignee" required>
                        <option value="">Select Employee</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>Priority</label>
                    <select class="form-control" id="taskPriority">
                        <option value="low">Low</option>
                        <option value="medium">Medium</option>
                        <option value="high">High</option>
                    </select>
                </div>
            </div>
            <div class="form-row">
                <div class="form-group">
                    <label>Due Date</label>
                    <input type="date" class="form-control" id="taskDueDate">
                </div>
                <div class="form-group">
                    <label>Estimated Hours</label>
                    <input type="number" class="form-control" id="taskEstimatedHours" min="1">
                </div>
            </div>
            <div class="form-group">
                <label>Project</label>
                <select class="form-control" id="taskProject">
                    <option value="">Select Project</option>
                </select>
            </div>
            <div class="modal-footer">
                <button type="submit" class="btn btn-primary">Assign Task</button>
                <button type="button" class="btn" onclick="closeModal('taskAssignmentModal')">Cancel</button>
            </div>
        </form>
    </div>
</div>

<!-- Time Tracking Modal -->
<div id="timeTrackingModal" class="modal">
    <div class="modal-content">
        <div class="modal-header">
            <h3>⏱️ Log Work Time</h3>
            <button class="close-modal" onclick="closeModal('timeTrackingModal')">×</button>
        </div>
        <form id="timeTrackingForm" onsubmit="logWorkTime(event)">
            <div class="form-group">
                <label>Select Task</label>
                <select class="form-control" id="timeTask" required>
                    <option value="">Select Task</option>
                </select>
            </div>
            <div class="form-row">
                <div class="form-group">
                    <label>Date</label>
                    <input type="date" class="form-control" id="workDate" required>
                </div>
                <div class="form-group">
                    <label>Hours Worked</label>
                    <input type="number" class="form-control" id="workHours" min="0.5" max="24" step="0.5" required>
                </div>
            </div>
            <div class="form-group">
                <label>Description of Work</label>
                <textarea class="form-control" id="workDescription" rows="3"></textarea>
            </div>
            <div class="modal-footer">
                <button type="submit" class="btn btn-primary">Log Time</button>
                <button type="button" class="btn" onclick="closeModal('timeTrackingModal')">Cancel</button>
            </div>
        </form>
    </div>
</div>

<!-- Team Chat Modal -->
<div id="teamChatModal" class="modal">
    <div class="modal-content" style="max-width: 800px; height: 80vh;">
        <div class="modal-header">
            <h3>💬 Team Chat</h3>
            <div class="chat-header-actions">
                <span class="online-count" id="chatOnlineCount">5 online</span>
                <button class="btn btn-sm btn-success" onclick="startVideoCall()">🎥 Video Call</button>
                <button class="close-modal" onclick="closeModal('teamChatModal')">×</button>
            </div>
        </div>
        <div class="chat-container">
            <div class="chat-sidebar">
                <div class="chat-channels">
                    <h5>Channels</h5>
                    <div class="channel active" onclick="switchChannel('general')"># general</div>
                    <div class="channel" onclick="switchChannel('projects')"># projects</div>
                    <div class="channel" onclick="switchChannel('random')"># random</div>
                </div>
                <div class="online-users">
                    <h5>Online Team Members</h5>
                    <div id="onlineUsersList">
                        <!-- Online users will be loaded here -->
                    </div>
                </div>
            </div>
            <div class="chat-main">
                <div class="chat-messages" id="chatMessages">
                    <!-- Messages will be loaded here -->
                </div>
                <div class="chat-input-container">
                    <input type="text" class="chat-input" id="chatInput" placeholder="Type a message...">
                    <button class="btn btn-primary" onclick="sendMessage()">Send</button>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Video Call Modal -->
<div id="videoCallModal" class="modal">
    <div class="modal-content" style="max-width: 95%; height: 90vh;">
        <div class="modal-header">
            <h3>🎥 Video Call</h3>
            <div class="call-controls">
                <button class="btn btn-danger btn-sm" onclick="endVideoCall()">📞 End Call</button>
                <button class="btn btn-warning btn-sm" onclick="toggleAudio()">🎤 Mute</button>
                <button class="btn btn-info btn-sm" onclick="toggleVideo()">📹 Stop Video</button>
                <button class="close-modal" onclick="closeModal('videoCallModal')">×</button>
            </div>
        </div>
        <div class="video-call-container">
            <div class="video-grid" id="videoGrid">
                <div class="video-participant local">
                    <div class="video-placeholder">
                        <div class="user-avatar">You</div>
                        <div class="user-name">You</div>
                    </div>
                    <div class="participant-status">🔴 Live</div>
                </div>
                <!-- Other participants will be added here -->
            </div>
            <div class="call-participants">
                <h5>Participants (4)</h5>
                <div id="callParticipantsList">
                    <!-- Participants list -->
                </div>
            </div>
        </div>
    </div>
</div>

            <!-- Add this to dashboard metrics grid -->
<div class="metric-card">
    <div class="metric-icon">✅</div>
    <h3>Today's Attendance</h3>
    <div class="metric-value" id="dashboardAttendance">0%</div>
    <div class="ai-trend" id="attendanceTrend">--</div>
</div>
            <div class="ai-recommendations">
                <h3>🤖 AI Recommendations</h3>
                <div id="recommendationsList">
                    <div class="recommendation-item">
                        <strong>📊 Productivity Boost:</strong> Schedule training for underperforming teams
                    </div>
                    <div class="recommendation-item">
                        <strong>⚠️ Retention Alert:</strong> High attrition risk in Sales department
                    </div>
                    <div class="recommendation-item">
                        <strong>💰 Cost Optimization:</strong> Reduce overtime in Marketing team
                    </div>
                </div>
            </div>
        </div>

        <!-- Employees Tab -->
        <div id="employees" class="tab-content">
            <div class="search-container">
                <div class="search-box">
                    <input type="text" id="searchEmployee" placeholder="Search employees by name, department, or ID..." onkeyup="searchEmployees()">
                    <span class="search-icon">🔍</span>
                </div>
                <button class="btn btn-primary" onclick="showAddEmployeeModal()">+ Add Employee</button>
            </div>
            
            <table class="employee-table">
                <thead>
                    <tr>
                        <th>ID</th>
                        <th>Name</th>
                        <th>Email</th>
                        <th>Phone</th>
                        <th>Department</th>
                        <th>Position</th>
                        <th>Join Date</th>
                        <th>Status</th>
                        <th>AI Score</th>
                        <th>Actions</th>
                    </tr>
                </thead>
                <tbody id="employeesTable">
                    <!-- Employees will be loaded here -->
                </tbody>
            </table>
        </div>

        <!-- Smart Attendance Tab -->
        <div id="attendance" class="tab-content">
            <h2>✅ Smart Attendance System</h2>
            
            <div class="search-container">
                <div class="search-box">
                    <input type="text" id="searchAttendance" placeholder="Search attendance records..." onkeyup="searchAttendance()">
                    <span class="search-icon">🔍</span>
                </div>
                <button class="btn btn-success" onclick="markAttendance()">📅 Mark Today's Attendance</button>
            </div>

            <div class="attendance-grid">
                <div class="attendance-card">
                    <h3>Present Today</h3>
                    <div class="metric-value" id="presentCount">24</div>
                </div>
                <div class="attendance-card">
                    <h3>Absent Today</h3>
                    <div class="metric-value" id="absentCount">3</div>
                </div>
                <div class="attendance-card">
                    <h3>Late Arrivals</h3>
                    <div class="metric-value" id="lateCount">2</div>
                </div>
                <div class="attendance-card">
                    <h3>Attendance %</h3>
                    <div class="metric-value" id="attendancePercent">92%</div>
                </div>
            </div>

            <div class="chart-box">
                <h3>Monthly Attendance Trend</h3>
                <canvas id="attendanceChart"></canvas>
            </div>

            <div class="chart-box">
                <h3>Attendance History</h3>
                <div style="max-height: 400px; overflow-y: auto;">
                    <table class="employee-table">
                        <thead>
                            <tr>
                                <th>Date</th>
                                <th>Employee ID</th>
                                <th>Employee name</th>
                                <th>Department</th>
                                <th>Check-in</th>
                                <th>Check-out</th>
                                <th>Status</th>
                                <th>Hours</th>
                            </tr>
                        </thead>
                        <tbody id="attendanceHistory">
                            <!-- Attendance history will be loaded here -->
                        </tbody>
                    </table>
                </div>
            </div>
        </div>

        <!-- Recruitment Tab -->
        <div id="recruitment" class="tab-content">
            <h2>🤖 AI Recruitment Assistant</h2>
            
            <div class="recruitment-container">
                <div>
                    <div class="form-group">
                        <label>Job Title:</label>
                        <input type="text" class="form-control" id="jobTitle" placeholder="e.g., Senior Developer">
                    </div>
                    
                    <div class="form-group">
                        <label>Job Description:</label>
                        <textarea class="form-control" id="jobDescription" rows="4" placeholder="Enter job requirements and responsibilities..."></textarea>
                    </div>
                    
                    <div class="form-group">
                        <label>Required Skills:</label>
                        <textarea class="form-control" id="requiredSkills" rows="3" placeholder="e.g., JavaScript, React, Node.js, Python"></textarea>
                    </div>

                    <div class="form-group">
                        <label>Upload Resume (PDF/Doc):</label>
                        <div class="file-upload" onclick="document.getElementById('resumeFile').click()">
                            <input type="file" id="resumeFile" accept=".pdf,.doc,.docx" onchange="handleResumeUpload()">
                            <h4>📁 Click to Upload Resume</h4>
                            <p>Supported formats: PDF, DOC, DOCX</p>
                            <p id="fileName" style="margin-top: 10px; color: var(--primary);"></p>
                        </div>
                    </div>
                    
                    <button class="btn btn-primary" onclick="analyzeResume()">🧠 AI Analyze Resume</button>
                </div>
                
                <div class="screening-results" id="screeningResults" style="display: none;">
                    <h3>AI Screening Results</h3>
                    <div class="score-circle" id="matchScore">85%</div>
                    
                    <div class="recommendation-item">
                        <strong>📊 Match Analysis</strong>
                        <div id="matchAnalysis"></div>
                    </div>
                    
                    <div class="recommendation-item">
                        <strong>✅ Strengths</strong>
                        <div id="strengthsList"></div>
                    </div>
                    
                    <div class="recommendation-item">
                        <strong>📝 Areas to Explore</strong>
                        <div id="weaknessesList"></div>
                    </div>
                    
                    <div class="recommendation-item">
                        <strong>🎯 AI Suggested Questions</strong>
                        <div id="questionsList"></div>
                    </div>

                    <div class="recommendation-item">
                        <strong>🤖 AI Final Recommendation</strong>
                        <div id="finalRecommendation"></div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Analytics Tab -->
        <div id="analytics" class="tab-content">
            <h2>📈 Advanced Analytics</h2>
            <div class="charts-container">
                <div class="chart-box">
                    <h3>Department-wise Performance</h3>
                    <canvas id="deptPerformanceChart"></canvas>
                </div>
                <div class="chart-box">
                    <h3>Skill Distribution</h3>
                    <canvas id="skillsChart"></canvas>
                </div>
            </div>
        </div>
    </div>

    <!-- Add Employee Modal -->
    <div id="addEmployeeModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>Add New Employee</h3>
                <button class="close-modal" onclick="closeModal('addEmployeeModal')">×</button>
            </div>
            <form id="employeeForm" onsubmit="saveEmployee(event)">
                <div class="form-group">
                    <label>Full Name:</label>
                    <input type="text" class="form-control" id="empName" required>
                </div>
                <div class="form-group">
                    <label>Email:</label>
                    <input type="email" class="form-control" id="empEmail" required>
                </div>
                <div class="form-group">
                    <label>Phone:</label>
                    <input type="tel" class="form-control" id="empPhone" required>
                </div>
                <div class="form-group">
                    <label>Department:</label>
                    <select class="form-control" id="empDepartment" required>
                        <option value="">Select Department</option>
                        <option value="Engineering">Engineering</option>
                        <option value="Sales">Sales</option>
                        <option value="Marketing">Marketing</option>
                        <option value="HR">Human Resources</option>
                        <option value="Finance">Finance</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>Position:</label>
                    <input type="text" class="form-control" id="empPosition" required>
                </div>
                <div class="form-group">
                    <label>Salary:</label>
                    <input type="number" class="form-control" id="empSalary" required>
                </div>
                <div class="form-group">
                    <label>Join Date:</label>
                    <input type="date" class="form-control" id="empJoinDate" required>
                </div>
                <button type="submit" class="btn btn-primary">Save Employee</button>
            </form>
        </div>
    </div>


    <!-- Project Management Tab -->
<div id="projects" class="tab-content">
    <div class="projects-header">
        <h2>🚀 AI Project Management</h2>
        <div class="project-actions">
            <button class="btn btn-primary" onclick="showCreateProjectModal()">
                + Create Project
            </button>
            <button class="btn btn-success" onclick="generateAITaskSuggestions()">
                🤖 AI Task Suggestions
            </button>
        </div>
    </div>

    <!-- Project Stats -->
    <div class="project-stats">
        <div class="stat-card">
            <div class="stat-icon">📋</div>
            <div class="stat-info">
                <h3 id="totalProjects">12</h3>
                <p>Total Projects</p>
            </div>
        </div>
        <div class="stat-card">
            <div class="stat-icon">⏳</div>
            <div class="stat-info">
                <h3 id="ongoingProjects">8</h3>
                <p>In Progress</p>
            </div>
        </div>
        <div class="stat-card">
            <div class="stat-icon">✅</div>
            <div class="stat-info">
                <h3 id="completedProjects">4</h3>
                <p>Completed</p>
            </div>
        </div>
        <div class="stat-card">
            <div class="stat-icon">⚠️</div>
            <div class="stat-info">
                <h3 id="delayedProjects">2</h3>
                <p>Delayed</p>
            </div>
        </div>
    </div>

    <!-- AI Project Suggestions -->
    <div class="ai-suggestions" id="aiSuggestions" style="display: none;">
        <div class="suggestion-header">
            <h4>🤖 AI Recommendations</h4>
            <button class="btn btn-sm" onclick="applyAllSuggestions()">Apply All</button>
        </div>
        <div id="suggestionsList"></div>
    </div>

    <!-- Kanban Board -->
    <div class="kanban-container">
        <div class="kanban-board" id="kanbanBoard">
            <div class="kanban-column" data-status="todo">
                <div class="column-header">
                    <h3>📝 To Do</h3>
                    <span class="task-count" id="todoCount">0</span>
                </div>
                <div class="tasks-list" id="todoTasks" ondrop="drop(event)" ondragover="allowDrop(event)">
                    <!-- Tasks will be added here dynamically -->
                </div>
                <button class="add-task-btn" onclick="addTask('todo')">+ Add Task</button>
            </div>

            <div class="kanban-column" data-status="progress">
                <div class="column-header">
                    <h3>⚡ In Progress</h3>
                    <span class="task-count" id="progressCount">0</span>
                </div>
                <div class="tasks-list" id="progressTasks" ondrop="drop(event)" ondragover="allowDrop(event)">
                    <!-- Tasks will be added here dynamically -->
                </div>
                <button class="add-task-btn" onclick="addTask('progress')">+ Add Task</button>
            </div>

            <div class="kanban-column" data-status="review">
                <div class="column-header">
                    <h3>🔍 In Review</h3>
                    <span class="task-count" id="reviewCount">0</span>
                </div>
                <div class="tasks-list" id="reviewTasks" ondrop="drop(event)" ondragover="allowDrop(event)">
                    <!-- Tasks will be added here dynamically -->
                </div>
                <button class="add-task-btn" onclick="addTask('review')">+ Add Task</button>
            </div>

            <div class="kanban-column" data-status="done">
                <div class="column-header">
                    <h3>✅ Done</h3>
                    <span class="task-count" id="doneCount">0</span>
                </div>
                <div class="tasks-list" id="doneTasks" ondrop="drop(event)" ondragover="allowDrop(event)">
                    <!-- Tasks will be added here dynamically -->
                </div>
                <button class="add-task-btn" onclick="addTask('done')">+ Add Task</button>
            </div>
        </div>
    </div>

    <!-- Project Progress -->
    <div class="project-progress">
        <h3>📊 Project Progress Analytics</h3>
        <div class="progress-charts">
            <div class="chart-box">
                <canvas id="projectProgressChart"></canvas>
            </div>
            <div class="chart-box">
                <canvas id="teamPerformanceChart"></canvas>
            </div>
        </div>
    </div>
</div>

<!-- Create Project Modal -->
<div id="createProjectModal" class="modal">
    <div class="modal-content">
        <div class="modal-header">
            <h3>Create New Project</h3>
            <button class="close-modal" onclick="closeModal('createProjectModal')">×</button>
        </div>
        <form id="projectForm" onsubmit="createProject(event)">
            <div class="form-group">
                <label>Project Name:</label>
                <input type="text" class="form-control" id="projectName" required>
            </div>
            <div class="form-group">
                <label>Description:</label>
                <textarea class="form-control" id="projectDescription" rows="3"></textarea>
            </div>
            <div class="form-group">
                <label>Team Members:</label>
                <div id="teamMembersList" class="team-members"></div>
                <select class="form-control" id="addTeamMember">
                    <option value="">Select Employee</option>
                </select>
                <button type="button" class="btn btn-sm" onclick="addTeamMember()">Add Member</button>
            </div>
            <div class="form-group">
                <label>Deadline:</label>
                <input type="date" class="form-control" id="projectDeadline" required>
            </div>
            <div class="form-group">
                <label>Priority:</label>
                <select class="form-control" id="projectPriority" required>
                    <option value="low">Low</option>
                    <option value="medium">Medium</option>
                    <option value="high">High</option>
                    <option value="urgent">Urgent</option>
                </select>
            </div>
            <button type="submit" class="btn btn-primary">Create Project</button>
        </form>
    </div>
</div>

<!-- Add Task Modal -->
<div id="addTaskModal" class="modal">
    <div class="modal-content">
        <div class="modal-header">
            <h3>Add New Task</h3>
            <button class="close-modal" onclick="closeModal('addTaskModal')">×</button>
        </div>
        <form id="taskForm" onsubmit="saveTask(event)">
            <input type="hidden" id="taskColumn">
            <div class="form-group">
                <label>Task Title:</label>
                <input type="text" class="form-control" id="taskTitle" required>
            </div>
            <div class="form-group">
                <label>Description:</label>
                <textarea class="form-control" id="taskDescription" rows="3"></textarea>
            </div>
            <div class="form-group">
                <label>Assigned To:</label>
                <select class="form-control" id="taskAssignee" required>
                    <option value="">Select Assignee</option>
                </select>
            </div>
            <div class="form-group">
                <label>Due Date:</label>
                <input type="date" class="form-control" id="taskDueDate">
            </div>
            <div class="form-group">
                <label>Priority:</label>
                <select class="form-control" id="taskPriority">
                    <option value="low">Low</option>
                    <option value="medium">Medium</option>
                    <option value="high">High</option>
                </select>
            </div>
            <div class="form-group">
                <label>Estimated Hours:</label>
                <input type="number" class="form-control" id="taskHours" min="1" max="100">
            </div>
            <button type="submit" class="btn btn-primary">Save Task</button>
        </form>
    </div>
</div>

<!-- Project Task Assignment Section -->
<div id="projectTasks" class="tab-content">
    <div class="projects-header">
        <h2>📋 Project Task Assignment</h2>
        <div class="project-actions">
            <button class="btn btn-primary" onclick="showCreateProjectModal()">
                + Create Project
            </button>
            <button class="btn btn-success" onclick="showAssignTaskModal()">
                ➕ Assign Task
            </button>
        </div>
    </div>

    <!-- Project List -->
    <div class="project-list">
        <h3>📂 Active Projects</h3>
        <div class="projects-grid" id="projectsGrid">
            <!-- Projects will be loaded here -->
        </div>
    </div>

    <!-- Task List -->
    <div class="task-list-section">
        <h3>📝 Assigned Tasks</h3>
        <div class="search-container">
            <div class="search-box">
                <input type="text" id="searchTasks" placeholder="Search tasks..." onkeyup="searchTasks()">
                <span class="search-icon">🔍</span>
            </div>
            <select class="form-control" id="taskFilter" onchange="filterTasks()" style="width: 200px;">
                <option value="all">All Tasks</option>
                <option value="assigned">Assigned to Me</option>
                <option value="pending">Pending</option>
                <option value="completed">Completed</option>
            </select>
        </div>
        
        <div class="tasks-container" id="tasksContainer">
            <!-- Tasks will be loaded here -->
        </div>
    </div>
</div>


<!-- Employee Details Modal -->
<div id="employeeDetailsModal" class="modal">
    <div class="modal-content employee-details-modal">
        <div class="modal-header">
            <h3>Employee Details</h3>
            <button class="close-modal" onclick="closeModal('employeeDetailsModal')">×</button>
        </div>
        
        <div class="employee-details-content" id="employeeDetailsContent">
            <!-- Content will be loaded dynamically -->
        </div>
    </div>
</div>

<!-- Project Assignment Modal -->
<div id="projectAssignmentModal" class="modal">
    <div class="modal-content project-assignment-modal">
        <div class="modal-header">
            <h3>Assign Project to Employee</h3>
            <button class="close-modal" onclick="closeModal('projectAssignmentModal')">×</button>
        </div>
        
        <div class="modal-body">
            <div class="form-group">
                <label>Select Project:</label>
                <div class="project-list-container" id="projectListContainer">
                    <!-- Projects will be loaded here -->
                </div>
            </div>
            
            <div class="form-group">
                <label>Project Role:</label>
                <input type="text" class="form-control" id="projectRole" placeholder="e.g., Developer, Designer, Tester">
            </div>
            
            <div class="form-group">
                <label>Start Date:</label>
                <input type="date" class="form-control" id="projectStartDate">
            </div>
            
            <div class="form-group">
                <label>End Date:</label>
                <input type="date" class="form-control" id="projectEndDate">
            </div>
        </div>
        
        <div class="modal-footer">
            <button class="btn btn-primary" onclick="assignProjectToEmployee()">Assign Project</button>
            <button class="btn" onclick="closeModal('projectAssignmentModal')">Cancel</button>
        </div>
    </div>
</div>


<!-- Smart Attendance Tab -->
<div id="attendance" class="tab-content">
    <div class="attendance-header">
        <h2>✅ Smart Attendance System</h2>
        <div class="attendance-controls">
            <button class="btn btn-success" onclick="markAutoAttendance()">
                🤖 Auto Mark Attendance
            </button>
            <button class="btn btn-primary" onclick="exportAttendanceToExcel()">
                📊 Export to Excel
            </button>
        </div>
    </div>

    <!-- Today's Summary -->
    <div class="summary-cards">
        <div class="summary-card">
            <div class="summary-icon">✅</div>
            <div class="summary-info">
                <h3 id="presentCount">0</h3>
                <p>Present Today</p>
            </div>
        </div>
        <div class="summary-card">
            <div class="summary-icon">❌</div>
            <div class="summary-info">
                <h3 id="absentCount">0</h3>
                <p>Absent Today</p>
            </div>
        </div>
        <div class="summary-card">
            <div class="summary-icon">⏰</div>
            <div class="summary-info">
                <h3 id="lateCount">0</h3>
                <p>Late Today</p>
            </div>
        </div>
        <div class="summary-card">
            <div class="summary-icon">📈</div>
            <div class="summary-info">
                <h3 id="attendancePercent">0%</h3>
                <p>Attendance %</p>
            </div>
        </div>
    </div>

    <!-- Manual Attendance Section -->
    <div class="manual-attendance-section">
        <h3>👤 Manual Attendance Marking</h3>
        <div class="search-box">
            <input type="text" id="searchEmployeeAttendance" placeholder="Search employee..." onkeyup="searchEmployeeAttendance()">
            <span class="search-icon">🔍</span>
        </div>
        <div class="employee-list" id="employeeAttendanceList">
            <!-- Employees will be loaded here -->
        </div>
    </div>

    <!-- Attendance History -->
    <div class="attendance-history">
        <h3>📋 Attendance History</h3>
        <div class="table-container">
            <table class="employee-table">
                <thead>
                    <tr>
                        <th>Date</th>
                        <th>Employee ID</th>
                        <th>Name</th>
                        <th>Department</th>
                        <th>Check-in</th>
                        <th>Check-out</th>
                        <th>Status</th>
                        <th>Hours</th>
                    </tr>
                </thead>
                <tbody id="attendanceHistory">
                    <!-- Attendance records will be loaded here -->
                </tbody>
            </table>
        </div>
    </div>
</div>

<!-- Payroll Tab Content -->
<div id="payroll" class="tab-content">
    <div class="payroll-header">
        <h2>💰 AI Payroll Management</h2>
        <div class="payroll-actions">
            <button class="btn btn-success" onclick="runPayrollForAll()">
                🏃‍♂️ Run Payroll
            </button>
            <button class="btn btn-primary" onclick="generatePayrollReport()">
                📊 Generate Report
            </button>
            <button class="btn btn-warning" onclick="showTaxSettings()">
                ⚙️ Tax Settings
            </button>
        </div>
    </div>

    <!-- Payroll Summary -->
    <div class="payroll-summary">
        <div class="metrics-grid">
            <div class="metric-card">
                <div class="metric-icon">👥</div>
                <h3>Total Employees</h3>
                <div class="metric-value" id="totalEmpCount">0</div>
                <div class="ai-trend">Active staff</div>
            </div>
            <div class="metric-card">
                <div class="metric-icon">💰</div>
                <h3>Total Salary</h3>
                <div class="metric-value" id="totalSalary">₹0</div>
                <div class="ai-trend">This month</div>
            </div>
            <div class="metric-card">
                <div class="metric-icon">📉</div>
                <h3>Total Deductions</h3>
                <div class="metric-value" id="totalDeductions">₹0</div>
                <div class="ai-trend">Tax & PF</div>
            </div>
            <div class="metric-card">
                <div class="metric-icon">💳</div>
                <h3>Net Payable</h3>
                <div class="metric-value" id="netPayable">₹0</div>
                <div class="ai-trend">After deductions</div>
            </div>
        </div>
    </div>

    <!-- Payroll Employee List -->
    <div class="search-container">
        <div class="search-box">
            <input type="text" id="searchPayroll" placeholder="Search employees..." onkeyup="searchPayrollEmployees()">
            <span class="search-icon">🔍</span>
        </div>
        <!-- TO THIS -->
<button class="btn btn-success" onclick="refreshPayrollData()">
    🔄 Refresh
</button>
         
    </div>

    <div class="table-container">
        <table class="employee-table">
            <thead>
                <tr>
                    <th>Employee ID</th>
                    <th>Name</th>
                    <th>Department</th>
                    <th>Basic Salary</th>
                    <th>Deductions</th>
                    <th>Net Salary</th>
                    <th>Status</th>
                    <th>Actions</th>
                </tr>
            </thead>
            <tbody id="payrollTable">
                <!-- Payroll data will be loaded here -->
            </tbody>
        </table>
    </div>

    <!-- AI Recommendations -->
    <div class="ai-recommendations">
        <h3>🤖 AI Payroll Insights</h3>
        <div id="payrollRecommendations">
            <div class="recommendation-item">
                <strong>💡 Optimization:</strong> Consider adjusting tax slabs for better savings
            </div>
            <div class="recommendation-item">
                <strong>📈 Trend:</strong> Engineering department has highest average salary
            </div>
            <div class="recommendation-item">
                <strong>💰 Savings:</strong> Potential PF optimization available
            </div>
        </div>
    </div>
</div>

<!-- Add this in the container after the Analytics tab -->
<div id="employeeDatabase" class="tab-content">
    <div class="employee-database-header">
        <h2>👥 Advanced Employee Database</h2>
        <div class="quick-actions">
            <button class="btn btn-primary" onclick="showAdvancedSearch()">
                🔍 Advanced Search
            </button>
            <button class="btn btn-success" onclick="exportEmployeeData('pdf')">
                📊 Export PDF
            </button>
            <button class="btn btn-warning" onclick="exportEmployeeData('excel')">
                📈 Export Excel
            </button>
            <button class="btn btn-info" onclick="showOrganizationChart()">
                🏢 Org Chart
            </button>
        </div>
    </div>

    <!-- Advanced Filters -->
    <div class="advanced-filters" id="advancedFilters" style="display: none;">
        <h3>🔍 Advanced Search & Filters</h3>
        <div class="filter-row">
            <div class="form-group">
                <label>Department</label>
                <select class="form-control" id="filterDepartment" onchange="applyFilters()">
                    <option value="">All Departments</option>
                    <option value="Engineering">Engineering</option>
                    <option value="Sales">Sales</option>
                    <option value="Marketing">Marketing</option>
                    <option value="HR">Human Resources</option>
                    <option value="Finance">Finance</option>
                </select>
            </div>
            <div class="form-group">
                <label>Position</label>
                <input type="text" class="form-control" id="filterPosition" placeholder="e.g., Developer" onkeyup="applyFilters()">
            </div>
            <div class="form-group">
                <label>Location</label>
                <select class="form-control" id="filterLocation" onchange="applyFilters()">
                    <option value="">All Locations</option>
                    <option value="Mumbai">Mumbai</option>
                    <option value="Delhi">Delhi</option>
                    <option value="Bangalore">Bangalore</option>
                    <option value="Hyderabad">Hyderabad</option>
                    <option value="Chennai">Chennai</option>
                </select>
            </div>
        </div>
        <div class="filter-row">
            <div class="form-group">
                <label>Skills</label>
                <input type="text" class="form-control" id="filterSkills" placeholder="e.g., Python, React" onkeyup="applyFilters()">
            </div>
            <div class="form-group">
                <label>Experience (Years)</label>
                <select class="form-control" id="filterExperience" onchange="applyFilters()">
                    <option value="">Any Experience</option>
                    <option value="0-2">0-2 Years</option>
                    <option value="2-5">2-5 Years</option>
                    <option value="5-10">5-10 Years</option>
                    <option value="10+">10+ Years</option>
                </select>
            </div>
            <div class="form-group">
                <label>Status</label>
                <select class="form-control" id="filterStatus" onchange="applyFilters()">
                    <option value="">All Status</option>
                    <option value="active">Active</option>
                    <option value="inactive">Inactive</option>
                </select>
            </div>
        </div>
        <div class="filter-actions">
            <button class="btn btn-primary" onclick="applyFilters()">
                Apply Filters
            </button>
            <button class="btn" onclick="clearFilters()">
                Clear All
            </button>
        </div>
    </div>

    <!-- Employee Stats -->
    <div class="employee-stats">
        <div class="stat-item">
            <div class="stat-value" id="totalEmployees">0</div>
            <div class="stat-label">Total Employees</div>
        </div>
        <div class="stat-item">
            <div class="stat-value" id="activeEmployees">0</div>
            <div class="stat-label">Active</div>
        </div>
        <div class="stat-item">
            <div class="stat-value" id="engineeringCount">0</div>
            <div class="stat-label">Engineering</div>
        </div>
        <div class="stat-item">
            <div class="stat-value" id="avgExperience">0</div>
            <div class="stat-label">Avg Experience</div>
        </div>
    </div>

    <!-- Enhanced Employee Table -->
    <div class="search-container">
        <div class="search-box advanced-search">
            <input type="text" id="searchEmployeeDatabase" placeholder="Search employees by name, skills, location..." onkeyup="searchEmployeeDatabase()">
            <span class="search-icon">🔍</span>
            <div class="search-results" id="searchResults"></div>
        </div>
        <button class="btn btn-primary" onclick="showAddEmployeeModal()">+ Add Employee</button>
    </div>
    
    <div class="table-container">
        <table class="employee-table">
            <thead>
                <tr>
                    <th>ID</th>
                    <th>Name</th>
                    <th>Department</th>
                    <th>Position</th>
                    <th>Location</th>
                    <th>Experience</th>
                    <th>Skills</th>
                    <th>Status</th>
                    <th>Actions</th>
                </tr>
            </thead>
            <tbody id="employeeDatabaseTable">
                <!-- Employees will be loaded here -->
            </tbody>
        </table>
    </div>
</div>

<!-- Advanced Employee Profile Modal -->
<div id="employeeProfileModal" class="modal">
    <div class="modal-content employee-profile-modal">
        <div class="modal-header">
            <h3>Employee Profile</h3>
            <button class="close-modal" onclick="closeModal('employeeProfileModal')">×</button>
        </div>
        
        <div class="profile-tabs">
            <div class="profile-tab active" onclick="switchProfileTab('basic')">Basic Info</div>
            <div class="profile-tab" onclick="switchProfileTab('professional')">Professional</div>
            <div class="profile-tab" onclick="switchProfileTab('documents')">Documents</div>
            <div class="profile-tab" onclick="switchProfileTab('history')">History</div>
        </div>
        
        <div id="employeeProfileContent">
            <!-- Content will be loaded dynamically -->
        </div>
    </div>
</div>

<!-- Organization Chart Modal -->
<div id="organizationChartModal" class="modal">
    <div class="modal-content" style="max-width: 95%; max-height: 90vh;">
        <div class="modal-header">
            <h3>🏢 Organization Chart</h3>
            <button class="close-modal" onclick="closeModal('organizationChartModal')">×</button>
        </div>
        <div class="organization-chart">
            <div class="chart-container" id="orgChartContainer">
                <!-- Organization chart will be loaded here -->
            </div>
        </div>
    </div>
</div>
<!-- Add this button next to your theme toggle -->
<div class="settings-toggle">
    <button class="settings-btn" onclick="openSettings()">
        <span class="settings-icon">⚙️</span>
        <span id="settingsText">Settings</span>
    </button>
</div>

<!-- Add this modal at the end of your body, before the closing </body> tag -->
<div id="settingsModal" class="modal">
    <div class="modal-content settings-modal">
        <div class="modal-header">
            <h3>⚙️ System Settings</h3>
            <button class="close-modal" onclick="closeModal('settingsModal')">×</button>
        </div>
        
        <div class="settings-tabs">
            <div class="settings-tab active" onclick="switchSettingsTab('general')">General</div>
            <div class="settings-tab" onclick="switchSettingsTab('notifications')">Notifications</div>
            <div class="settings-tab" onclick="switchSettingsTab('appearance')">Appearance</div>
            <div class="settings-tab" onclick="switchSettingsTab('privacy')">Privacy</div>
            <div class="settings-tab" onclick="switchSettingsTab('advanced')">Advanced</div>
        </div>
        
        <div id="settingsContent">
            <!-- Content will be loaded dynamically -->
        </div>
    </div>
</div>
<!-- Add this COMPLETE HTML code at the end of your container, before closing </div> -->
<div id="teamBuilding" class="tab-content">
    <div class="projects-header">
        <h2>🎉 Virtual Team Building</h2>
        <div class="project-actions">
            <button class="btn btn-primary" onclick="teamBuildingShowCreateModal()">
                🎯 Create New Event
            </button>
            <button class="btn btn-success" onclick="teamBuildingGenerateAISuggestions()">
                🤖 AI Activity Suggestions
            </button>
        </div>
    </div>

    <!-- Quick Stats -->
    <div class="metrics-grid">
        <div class="metric-card">
            <div class="metric-icon">🎯</div>
            <h3>Events This Month</h3>
            <div class="metric-value" id="teamMonthlyEvents">0</div>
            <div class="ai-trend">No events yet</div>
        </div>
        <div class="metric-card">
            <div class="metric-icon">👥</div>
            <h3>Team Participation</h3>
            <div class="metric-value" id="teamParticipationRate">0%</div>
            <div class="ai-trend">Get started!</div>
        </div>
        <div class="metric-card">
            <div class="metric-icon">😊</div>
            <h3>Team Morale</h3>
            <div class="metric-value" id="teamMoraleScore">0%</div>
            <div class="ai-trend">Schedule events</div>
        </div>
        <div class="metric-card">
            <div class="metric-icon">⚡</div>
            <h3>Collaboration Score</h3>
            <div class="metric-value" id="teamCollaborationScore">0%</div>
            <div class="ai-trend">Build connections</div>
        </div>
    </div>

    <!-- Upcoming Events -->
    <div class="events-section">
        <h3>📅 Upcoming Team Events</h3>
        <div class="events-grid" id="teamUpcomingEvents">
            <div class="no-events">
                <div style="font-size: 3rem; margin-bottom: 15px;">🎯</div>
                <h4>No upcoming events</h4>
                <p>Create your first team building event to get started!</p>
                <button class="btn btn-primary" onclick="teamBuildingShowCreateModal()" style="margin-top: 15px;">
                    Create First Event
                </button>
            </div>
        </div>
    </div>

    <!-- Activity Library -->
    <div class="activities-library">
        <h3>🎮 Activity Library</h3>
        <div class="activity-filters">
            <button class="btn btn-sm active" onclick="teamBuildingFilterActivities('all')">All</button>
            <button class="btn btn-sm" onclick="teamBuildingFilterActivities('puzzle')">🧩 Puzzle</button>
            <button class="btn btn-sm" onclick="teamBuildingFilterActivities('social')">💬 Social</button>
            <button class="btn btn-sm" onclick="teamBuildingFilterActivities('creative')">🎨 Creative</button>
            <button class="btn btn-sm" onclick="teamBuildingFilterActivities('competition')">⚡ Competition</button>
        </div>
        <div class="activities-grid" id="teamActivitiesGrid">
            <!-- Activities will load here -->
        </div>
    </div>
</div>

<!-- Modal for creating events -->
<div id="teamCreateEventModal" class="modal">
    <div class="modal-content" style="max-width: 600px;">
        <div class="modal-header">
            <h3>🎯 Create Team Building Event</h3>
            <button class="close-modal" onclick="teamBuildingCloseModal('teamCreateEventModal')">×</button>
        </div>
        <form id="teamEventForm" onsubmit="teamBuildingCreateNewEvent(event)">
            <div class="form-group">
                <label>Event Title</label>
                <input type="text" class="form-control" id="teamEventTitle" required 
                       placeholder="e.g., Virtual Escape Room Challenge">
            </div>
            
            <div class="form-group">
                <label>Select Activity</label>
                <select class="form-control" id="teamEventActivity" required>
                    <option value="">Choose an activity</option>
                </select>
            </div>
            
            <div class="form-group">
                <label>Date & Time</label>
                <input type="datetime-local" class="form-control" id="teamEventDateTime" required>
            </div>
            
            <div class="form-group">
                <label>Description (Optional)</label>
                <textarea class="form-control" id="teamEventDescription" rows="3" 
                          placeholder="Describe the event..."></textarea>
            </div>
            
            <div class="modal-footer">
                <button type="submit" class="btn btn-primary">Create Event</button>
                <button type="button" class="btn" onclick="teamBuildingCloseModal('teamCreateEventModal')">Cancel</button>
            </div>
        </form>
    </div>
</div>
<!-- Add this at the end of your body, before closing </body> tag -->
<div id="aiChatbotContainer">
    <!-- Chatbot Toggle Button -->
    <div id="chatbotToggle" class="chatbot-toggle">
        <div class="chatbot-icon">
            <span class="bot-face">🤖</span>
        </div>
        <div class="chatbot-pulse"></div>
    </div>

    <!-- Chatbot Window -->
    <div id="chatbotWindow" class="chatbot-window">
        <!-- Chat Header -->
        <div class="chatbot-header">
            <div class="chatbot-avatar">
                <span class="bot-face">🤖</span>
            </div>
            <div class="chatbot-info">
                <h3>HR Assistant</h3>
                <p>AI-powered HR support</p>
            </div>
            <div class="chatbot-actions">
                <button class="btn-minimize" onclick="toggleChatbot()">−</button>
                <button class="btn-close" onclick="closeChatbot()">×</button>
            </div>
        </div>

        <!-- Chat Messages Container -->
        <div id="chatbotMessages" class="chatbot-messages">
            <!-- Welcome message will be added here -->
        </div>

        <!-- Quick Actions -->
        <div class="quick-actions">
            <button class="quick-btn" onclick="sendQuickMessage('Leave balance')">Leave Balance</button>
            <button class="quick-btn" onclick="sendQuickMessage('Salary query')">Salary Query</button>
            <button class="quick-btn" onclick="sendQuickMessage('HR policies')">HR Policies</button>
        </div>

        <!-- Chat Input -->
        <div class="chatbot-input-container">
            <input type="text" id="chatbotInput" placeholder="Ask me anything about HR..." 
                   onkeypress="handleChatInput(event)">
            <button onclick="sendMessage()" class="btn-send">
                <span>➤</span>
            </button>
        </div>
    </div>
</div>
<!-- Remove any existing Team Building buttons from remote section -->
 
    <!-- Notification -->
    <div class="notification" id="notification">Operation completed successfully!</div>
 
    <script>

        
        // Sample employee data
        let employees = [
            { 
                id: 'EMP001', 
                name: ' Ram Kumawat', 
                email: ' ramkumawat@gmail.com',
                phone: ' 7889569586',
                department: 'Engineering', 
                position: 'Senior Developer', 
                salary: 85000,
                joinDate: '2023-01-15',
                status: 'active', 
                score: 92 
            },
            { 
                id: 'EMP002', 
                name: ' Lucky Kumawat', 
                email: ' luckykumawat21@company.com',
                phone: ' 5623955415',
                department: 'Sales', 
                position: 'Sales Manager', 
                salary: 75000,
                joinDate: '2023-02-20',
                status: 'active', 
                score: 88 
            },
            { 
                id: 'EMP003', 
                name: ' Rohit Kumawat', 
                email: ' rohitkumawat43@company.com',
                phone: ' 8954121002',
                department: 'Marketing', 
                position: 'Marketing Specialist', 
                salary: 65000,
                joinDate: '2023-03-10',
                status: 'inactive', 
                score: 65 
            },
            { 
                id: 'EMP004', 
                name: ' Rahul Kumawat', 
                email: ' rahulkumawat77@company.com',
                phone: '8956485652',
                department: 'HR', 
                position: 'HR Manager', 
                salary: 70000,
                joinDate: '2023-01-05',
                status: 'active', 
                score: 95 
            },
            { 
                id: 'EMP005', 
                name: 'Ravi Kumawat', 
                email: ' ravi1101@company.com',
                phone: ' 8956584578',
                department: 'Engineering', 
                position: 'DevOps Engineer', 
                salary: 90000,
                joinDate: '2023-04-15',
                status: 'active', 
                score: 89 
            }
        ];

        // Attendance data
        let attendanceRecords = [
            { date: '2024-01-15', employee: ' Ram Kumawat', checkIn: '09:00', checkOut: '17:00', status: 'Present', hours: 8.0 },
            { date: '2024-01-15', employee: ' Lucky Kumawat', checkIn: '09:15', checkOut: '17:30', status: 'Present', hours: 8.25 },
            { date: '2024-01-15', employee: ' Rohit Kumawat', checkIn: '10:00', checkOut: '16:00', status: 'Late', hours: 6.0 },
            { date: '2024-01-14', employee: ' Ram Kumawat', checkIn: '08:45', checkOut: '17:15', status: 'Present', hours: 8.5 },
            { date: '2024-01-14', employee: ' Rahul Kumawat', checkIn: '09:00', checkOut: '17:00', status: 'Present', hours: 8.0 }
        ];

        // Initialize the application
        document.addEventListener('DOMContentLoaded', function() {
    // Your existing code...
    loadEmployees();
    loadAttendanceHistory();
    initializeCharts();
    simulateAIData();
    updateAttendanceSummary();
    
    // ✅ ADD THIS LINE
    setTimeout(() => {
        addTimeTrackingToDashboard();
    }, 1000);
}); 

        // Tab switching function
        function switchTab(tabName) {
            document.querySelectorAll('.tab-content').forEach(tab => {
                tab.classList.remove('active');
            });
            
            document.querySelectorAll('.nav-tab').forEach(tab => {
                tab.classList.remove('active');
            });
            
            document.getElementById(tabName).classList.add('active');
            event.currentTarget.classList.add('active');
        }

        // Load employees into table
        function loadEmployees() {
            const table = document.getElementById('employeesTable');
            table.innerHTML = '';
            
            employees.forEach(emp => {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${emp.id}</td>
                    <td>${emp.name}</td>
                    <td>${emp.email}</td>
                    <td>${emp.phone}</td>
                    <td>${emp.department}</td>
                    <td>${emp.position}</td>
                    <td>${formatDate(emp.joinDate)}</td>
                    <td><span class="status-badge status-${emp.status}">${emp.status}</span></td>
                    <td>${emp.score}%</td>
                    <td class="action-buttons">
                        <button class="btn btn-primary btn-sm" onclick="editEmployee('${emp.id}')">Edit</button>
                        <button class="btn btn-danger btn-sm" onclick="deleteEmployee('${emp.id}')">Delete</button>
                    </td>
                `;
                table.appendChild(row);
            });
        }

        // Search employees
        function searchEmployees() {
            const searchTerm = document.getElementById('searchEmployee').value.toLowerCase();
            const filteredEmployees = employees.filter(emp => 
                emp.name.toLowerCase().includes(searchTerm) ||
                emp.department.toLowerCase().includes(searchTerm) ||
                emp.position.toLowerCase().includes(searchTerm) ||
                emp.id.toLowerCase().includes(searchTerm)
            );
            
            const table = document.getElementById('employeesTable');
            table.innerHTML = '';
            
            filteredEmployees.forEach(emp => {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${emp.id}</td>
                    <td>${emp.name}</td>
                    <td>${emp.email}</td>
                    <td>${emp.phone}</td>
                    <td>${emp.department}</td>
                    <td>${emp.position}</td>
                    <td>${formatDate(emp.joinDate)}</td>
                    <td><span class="status-badge status-${emp.status}">${emp.status}</span></td>
                    <td>${emp.score}%</td>
                    <td class="action-buttons">
                        <button class="btn btn-primary btn-sm" onclick="editEmployee('${emp.id}')">Edit</button>
                        <button class="btn btn-danger btn-sm" onclick="deleteEmployee('${emp.id}')">Delete</button>
                    </td>
                `;
                table.appendChild(row);
            });
        }

        // Show add employee modal
        function showAddEmployeeModal() {
            document.getElementById('employeeForm').reset();
            document.getElementById('addEmployeeModal').style.display = 'flex';
        }

        // Close modal
        function closeModal(modalId) {
            document.getElementById(modalId).style.display = 'none';
        }

        // Save employee
        function saveEmployee(event) {
            event.preventDefault();
            
            const newEmployee = {
                id: 'EMP' + String(employees.length + 1).padStart(3, '0'),
                name: document.getElementById('empName').value,
                email: document.getElementById('empEmail').value,
                phone: document.getElementById('empPhone').value,
                department: document.getElementById('empDepartment').value,
                position: document.getElementById('empPosition').value,
                salary: parseFloat(document.getElementById('empSalary').value),
                joinDate: document.getElementById('empJoinDate').value,
                status: 'active',
                score: Math.floor(Math.random() * 20) + 80 // Random score 80-100
            };
            
            employees.push(newEmployee);
            loadEmployees();
            closeModal('addEmployeeModal');
            showNotification('Employee added successfully!');
        }

        // Edit employee
        function editEmployee(empId) {
            const employee = employees.find(emp => emp.id === empId);
            if (employee) {
                document.getElementById('empName').value = employee.name;
                document.getElementById('empEmail').value = employee.email;
                document.getElementById('empPhone').value = employee.phone;
                document.getElementById('empDepartment').value = employee.department;
                document.getElementById('empPosition').value = employee.position;
                document.getElementById('empSalary').value = employee.salary;
                document.getElementById('empJoinDate').value = employee.joinDate;
                
                showAddEmployeeModal();
                showNotification(`Editing employee: ${employee.name}`);
            }
        }

        // Delete employee
        function deleteEmployee(empId) {
            if (confirm('Are you sure you want to delete this employee?')) {
                employees = employees.filter(emp => emp.id !== empId);
                loadEmployees();
                showNotification('Employee deleted successfully!');
            }
        }

        // Handle resume upload
        function handleResumeUpload() {
            const fileInput = document.getElementById('resumeFile');
            const fileName = document.getElementById('fileName');
            
            if (fileInput.files.length > 0) {
                fileName.textContent = `Selected: ${fileInput.files[0].name}`;
            }
        }

        // Analyze resume with AI
        function analyzeResume() {
            const jobTitle = document.getElementById('jobTitle').value;
            const jobDesc = document.getElementById('jobDescription').value;
            const requiredSkills = document.getElementById('requiredSkills').value;
            const resumeFile = document.getElementById('resumeFile').files[0];
            
            if (!jobTitle || !jobDesc || !requiredSkills || !resumeFile) {
                showNotification('Please fill all fields and upload resume', 'error');
                return;
            }

            showNotification('AI is analyzing resume...', 'info');
            
            setTimeout(() => {
                const matchScore = Math.floor(Math.random() * 25) + 75; // 75-100%
                
                document.getElementById('matchScore').textContent = matchScore + '%';
                document.getElementById('screeningResults').style.display = 'block';
                
                // Generate detailed analysis
                document.getElementById('matchAnalysis').innerHTML = `
                    <p>Strong match for <strong>${jobTitle}</strong> position</p>
                    <p>Skill alignment: ${matchScore}%</p>
                    <p>Experience level: Senior</p>
                    <p>Cultural fit: Excellent</p>
                `;
                
                document.getElementById('strengthsList').innerHTML = `
                    <p>✅ ${requiredSkills.split(',')[0] || 'Technical'} expertise</p>
                    <p>✅ Strong communication skills</p>
                    <p>✅ Relevant industry experience</p>
                    <p>✅ Leadership qualities</p>
                    <p>✅ Problem-solving ability</p>
                `;
                
                document.getElementById('weaknessesList').innerHTML = `
                    <p>❌ Limited ${jobTitle.includes('Senior') ? 'junior' : 'senior'} experience</p>
                    <p>❌ Could benefit from additional certifications</p>
                    <p>❌ Some skill gaps in emerging technologies</p>
                `;
                
                document.getElementById('questionsList').innerHTML = `
                    <p>🎯 "Can you describe your experience with team leadership?"</p>
                    <p>🎯 "How do you handle tight deadlines and pressure?"</p>
                    <p>🎯 "What's your approach to learning new technologies?"</p>
                    <p>🎯 "Tell me about a challenging project you completed."</p>
                `;
                
                let recommendation = '';
                if (matchScore >= 90) {
                    recommendation = '🏆 <strong>Highly Recommended</strong> - Strong candidate, schedule interview immediately';
                } else if (matchScore >= 80) {
                    recommendation = '✅ <strong>Recommended</strong> - Good fit, proceed with interview';
                } else if (matchScore >= 70) {
                    recommendation = '⚠️ <strong>Consider</strong> - Some gaps, but potential is there';
                } else {
                    recommendation = '❌ <strong>Not Recommended</strong> - Significant skill gaps';
                }
                
                document.getElementById('finalRecommendation').innerHTML = `<p>${recommendation}</p>`;
                
                showNotification('AI analysis completed successfully!', 'success');
            }, 3000);
        }

        // Load attendance history
        function loadAttendanceHistory() {
            const table = document.getElementById('attendanceHistory');
            table.innerHTML = '';
            
            attendanceRecords.forEach(record => {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${formatDate(record.date)}</td>
                    <td>${record.employee}</td>
                    <td>${record.checkIn}</td>
                    <td>${record.checkOut}</td>
                    <td><span class="status-badge ${record.status === 'Present' ? 'status-active' : 'status-inactive'}">${record.status}</span></td>
                    <td>${record.hours}h</td>
                `;
                table.appendChild(row);
            });
        }

        // Search attendance
        function searchAttendance() {
            const searchTerm = document.getElementById('searchAttendance').value.toLowerCase();
            const filteredRecords = attendanceRecords.filter(record => 
                record.employee.toLowerCase().includes(searchTerm) ||
                record.date.includes(searchTerm) ||
                record.status.toLowerCase().includes(searchTerm)
            );
            
            const table = document.getElementById('attendanceHistory');
            table.innerHTML = '';
            
            filteredRecords.forEach(record => {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${formatDate(record.date)}</td>
                    <td>${record.employee}</td>
                    <td>${record.checkIn}</td>
                    <td>${record.checkOut}</td>
                    <td><span class="status-badge ${record.status === 'Present' ? 'status-active' : 'status-inactive'}">${record.status}</span></td>
                    <td>${record.hours}h</td>
                `;
                table.appendChild(row);
            });
        }

        

        // Mark attendance
        function markAttendance() {
            const today = new Date().toISOString().split('T')[0];
            const presentCount = Math.floor(Math.random() * 5) + 20; // 20-25 present
            const totalEmployees = employees.filter(emp => emp.status === 'active').length;
            
            document.getElementById('presentCount').textContent = presentCount;
            document.getElementById('absentCount').textContent = totalEmployees - presentCount;
            document.getElementById('lateCount').textContent = Math.floor(Math.random() * 3);
            document.getElementById('attendancePercent').textContent = Math.round((presentCount / totalEmployees) * 100) + '%';
            
            showNotification(`Attendance marked for ${today}. ${presentCount} employees present.`);
        }

        // Update attendance summary
        function updateAttendanceSummary() {
            const presentCount = attendanceRecords.filter(r => r.status === 'Present').length;
            const totalRecords = attendanceRecords.length;
            
            document.getElementById('presentCount').textContent = presentCount;
            document.getElementById('absentCount').textContent = totalRecords - presentCount;
            document.getElementById('lateCount').textContent = attendanceRecords.filter(r => r.status === 'Late').length;
            document.getElementById('attendancePercent').textContent = Math.round((presentCount / totalRecords) * 100) + '%';
        }

        // Initialize charts
        function initializeCharts() {
            // Performance Chart
            const perfCtx = document.getElementById('performanceChart').getContext('2d');
            new Chart(perfCtx, {
                type: 'line',
                data: {
                    labels: ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun'],
                    datasets: [{
                        label: 'Productivity',
                        data: [75, 78, 82, 80, 85, 88],
                        borderColor: '#3a86ff',
                        backgroundColor: 'rgba(58, 134, 255, 0.1)',
                        tension: 0.4
                    }, {
                        label: 'Attendance',
                        data: [88, 85, 90, 87, 92, 95],
                        borderColor: '#06d6a0',
                        backgroundColor: 'rgba(6, 214, 160, 0.1)',
                        tension: 0.4
                    }]
                }
            });

            // Department Chart
            const deptCtx = document.getElementById('departmentChart').getContext('2d');
            new Chart(deptCtx, {
                type: 'doughnut',
                data: {
                    labels: ['Engineering', 'Sales', 'Marketing', 'HR', 'Finance'],
                    datasets: [{
                        data: [35, 25, 15, 15, 10],
                        backgroundColor: ['#3a86ff', '#8338ec', '#ff006e', '#fb5607', '#ffbe0b']
                    }]
                }
            });

            // Attendance Chart
            const attCtx = document.getElementById('attendanceChart').getContext('2d');
            new Chart(attCtx, {
                type: 'bar',
                data: {
                    labels: ['Week 1', 'Week 2', 'Week 3', 'Week 4'],
                    datasets: [{
                        label: 'Attendance %',
                        data: [92, 88, 95, 90],
                        backgroundColor: '#06d6a0'
                    }]
                }
            });

            // Department Performance Chart
            const deptPerfCtx = document.getElementById('deptPerformanceChart').getContext('2d');
            new Chart(deptPerfCtx, {
                type: 'radar',
                data: {
                    labels: ['Productivity', 'Efficiency', 'Innovation', 'Teamwork', 'Quality'],
                    datasets: [{
                        label: 'Engineering',
                        data: [85, 90, 88, 82, 95],
                        borderColor: '#3a86ff',
                        backgroundColor: 'rgba(58, 134, 255, 0.2)'
                    }, {
                        label: 'Sales',
                        data: [92, 78, 85, 90, 80],
                        borderColor: '#8338ec',
                        backgroundColor: 'rgba(131, 56, 236, 0.2)'
                    }]
                }
            });

            // Skills Chart
            const skillsCtx = document.getElementById('skillsChart').getContext('2d');
            new Chart(skillsCtx, {
                type: 'polarArea',
                data: {
                    labels: ['JavaScript', 'Python', 'React', 'Node.js', 'AWS', 'SQL'],
                    datasets: [{
                        data: [85, 78, 92, 88, 75, 82],
                        backgroundColor: ['#3a86ff', '#8338ec', '#06d6a0', '#ff006e', '#ffbe0b', '#fb5607']
                    }]
                }
            });
        }

        // Simulate AI data updates
        function simulateAIData() {
            setInterval(() => {
                document.getElementById('productivityScore').textContent = 
                    Math.min(100, Math.max(70, parseInt(document.getElementById('productivityScore').textContent) + Math.floor(Math.random() * 6 - 2))) + '%';
                
                document.getElementById('attritionRisk').textContent = 
                    Math.min(40, Math.max(5, parseInt(document.getElementById('attritionRisk').textContent) + Math.floor(Math.random() * 6 - 2))) + '%';
                
                document.getElementById('predictionsCount').textContent = 
                    parseInt(document.getElementById('predictionsCount').textContent) + 1;
            }, 5000);
        }

        // Show notification
        function showNotification(message, type = 'success') {
            const notification = document.getElementById('notification');
            notification.textContent = message;
            notification.className = 'notification';
            notification.classList.add(type === 'error' ? 'error' : 'success');
            notification.classList.add('show');
            
            setTimeout(() => {
                notification.classList.remove('show');
            }, 3000);
        }

        // Format date
        function formatDate(dateString) {
            const options = { year: 'numeric', month: 'short', day: 'numeric' };
            return new Date(dateString).toLocaleDateString(undefined, options);
        }

        // Close modal when clicking outside
        window.onclick = function(event) {
            if (event.target.classList.contains('modal')) {
                event.target.style.display = 'none';
            }
        }

        // Add this JavaScript code in your script section

// Theme management
function initTheme() {
    const savedTheme = localStorage.getItem('theme') || 'light';
    setTheme(savedTheme);
}

function toggleTheme() {
    const currentTheme = document.documentElement.getAttribute('data-theme') || 'light';
    const newTheme = currentTheme === 'light' ? 'dark' : 'light';
    setTheme(newTheme);
}

function setTheme(theme) {
    document.documentElement.setAttribute('data-theme', theme);
    localStorage.setItem('theme', theme);
    
    // Update toggle button
    const themeIcon = document.getElementById('themeIcon');
    const themeText = document.getElementById('themeText');
    
    if (theme === 'dark') {
        themeIcon.textContent = '☀️';
        themeText.textContent = 'Light Mode';
    } else {
        themeIcon.textContent = '🌙';
        themeText.textContent = 'Dark Mode';
    }
    
    // Update charts for theme
    updateChartsForTheme(theme);
}

function updateChartsForTheme(theme) {
    // This function will update chart colors based on theme
    // You might need to re-render charts when theme changes
    setTimeout(() => {
        if (window.myCharts) {
            window.myCharts.forEach(chart => chart.update());
        }
    }, 300);
}

// Initialize theme when page loads
document.addEventListener('DOMContentLoaded', function() {
    initTheme();
    // Your existing initialization code...
});
// Project Management System
let project = [];
let tasks = [];
let currentProject = null;

// Initialize project management
function initProjectManagement() {
    loadSampleData();
    updateProjectStats();
    renderTasks();
    populateEmployeeDropdowns();
}

// Load sample data
function loadSampleData() {
    tasks = [
        {
            id: '1',
            title: 'Design Homepage',
            description: 'Create new homepage design with modern UI',
            column: 'todo',
            assignee: 'EMP001',
            dueDate: '2024-02-15',
            priority: 'high',
            hours: 8,
            createdAt: new Date()
        },
        {
            id: '2',
            title: 'API Integration',
            description: 'Integrate payment gateway API',
            column: 'progress',
            assignee: 'EMP005',
            dueDate: '2024-02-20',
            priority: 'medium',
            hours: 16,
            createdAt: new Date()
        },
        {
            id: '3',
            title: 'Database Optimization',
            description: 'Optimize database queries for better performance',
            column: 'review',
            assignee: 'EMP001',
            dueDate: '2024-02-10',
            priority: 'high',
            hours: 12,
            createdAt: new Date()
        },
        {
            id: '4',
            title: 'Documentation',
            description: 'Update API documentation',
            column: 'done',
            assignee: 'EMP004',
            dueDate: '2024-02-05',
            priority: 'low',
            hours: 6,
            createdAt: new Date()
        }
    ];
}

// Drag and Drop functions
function allowDrop(ev) {
    ev.preventDefault();
    ev.currentTarget.classList.add('drag-over');
}

function drag(ev) {
    ev.dataTransfer.setData("text", ev.target.id);
    ev.target.classList.add('dragging');
}

function drop(ev) {
    ev.preventDefault();
    const data = ev.dataTransfer.getData("text");
    const taskElement = document.getElementById(data);
    const targetColumn = ev.currentTarget;
    
    if (taskElement && targetColumn) {
        targetColumn.appendChild(taskElement);
        taskElement.classList.remove('dragging');
        
        // Update task status in data
        const taskId = taskElement.dataset.taskId;
        const newStatus = targetColumn.parentElement.dataset.status;
        updateTaskStatus(taskId, newStatus);
        
        // AI auto-suggestions when moving tasks
        if (newStatus === 'progress') {
            suggestTaskOptimizations(taskId);
        }
    }
    
    // Remove drag-over class from all columns
    document.querySelectorAll('.tasks-list').forEach(col => {
        col.classList.remove('drag-over');
    });
}

// Update task status
function updateTaskStatus(taskId, newStatus) {
    const task = tasks.find(t => t.id === taskId);
    if (task) {
        task.column = newStatus;
        task.updatedAt = new Date();
        updateProjectStats();
        showNotification(`Task moved to ${newStatus}`);
        
        // AI: Check for deadline alerts
        checkDeadlineAlerts(task);
    }
}

// AI Task Suggestions
function generateAITaskSuggestions() {
    const suggestions = [
        {
            id: 1,
            type: 'priority',
            message: '3 high-priority tasks are approaching deadline',
            action: 'focus_on_deadlines'
        },
        {
            id: 2,
            type: 'resource',
            message: ' Ram Kumawat is overloaded with 5 tasks. Consider redistributing',
            action: 'balance_workload'
        },
        {
            id: 3,
            type: 'efficiency',
            message: 'Tasks in "To Do" for more than 3 days need attention',
            action: 'review_old_tasks'
        }
    ];
    
    displayAISuggestions(suggestions);
}

function displayAISuggestions(suggestions) {
    const container = document.getElementById('aiSuggestions');
    const list = document.getElementById('suggestionsList');
    
    list.innerHTML = '';
    suggestions.forEach(suggestion => {
        const suggestionElement = document.createElement('div');
        suggestionElement.className = 'suggestion-item';
        suggestionElement.innerHTML = `
            <div>
                <strong>${suggestion.type.toUpperCase()}:</strong> ${suggestion.message}
            </div>
            <button class="btn btn-sm" onclick="applySuggestion('${suggestion.action}')">
                Apply
            </button>
        `;
        list.appendChild(suggestionElement);
    });
    
    container.style.display = 'block';
    container.scrollIntoView({ behavior: 'smooth' });
}

function applySuggestion(action) {
    switch(action) {
        case 'focus_on_deadlines':
            focusOnDeadlineTasks();
            break;
        case 'balance_workload':
            balanceWorkload();
            break;
        case 'review_old_tasks':
            reviewOldTasks();
            break;
    }
    showNotification('AI suggestion applied successfully');
}

// AI-powered functions
function focusOnDeadlineTasks() {
    const urgentTasks = tasks.filter(task => {
        const dueDate = new Date(task.dueDate);
        const today = new Date();
        const diffTime = dueDate - today;
        const diffDays = Math.ceil(diffTime / (1000 * 60 * 60 * 24));
        return diffDays <= 3 && task.priority === 'high';
    });
    
    urgentTasks.forEach(task => {
        const taskElement = document.querySelector(`[data-task-id="${task.id}"]`);
        if (taskElement) {
            taskElement.style.animation = 'pulse 2s infinite';
            setTimeout(() => {
                taskElement.style.animation = '';
            }, 6000);
        }
    });
}

function balanceWorkload() {
    // AI logic to balance workload among team members
    const employeeWorkload = {};
    tasks.forEach(task => {
        if (task.assignee) {
            employeeWorkload[task.assignee] = (employeeWorkload[task.assignee] || 0) + 1;
        }
    });
    
    // Suggest reassignments
    console.log('Workload distribution:', employeeWorkload);
    showNotification('Workload analysis completed. Check console for details.');
}

function reviewOldTasks() {
    const oldTasks = tasks.filter(task => {
        const created = new Date(task.createdAt);
        const today = new Date();
        const diffTime = today - created;
        const diffDays = Math.floor(diffTime / (1000 * 60 * 60 * 24));
        return diffDays > 3 && task.column === 'todo';
    });
    
    oldTasks.forEach(task => {
        task.priority = 'high'; // Increase priority
    });
    
    renderTasks();
    showNotification(`${oldTasks.length} old tasks marked as high priority`);
}

function suggestTaskOptimizations(taskId) {
    const task = tasks.find(t => t.id === taskId);
    if (task && task.hours > 8) {
        showNotification(`💡 AI Suggestion: Consider breaking down "${task.title}" into smaller tasks for better efficiency`);
    }
}

function checkDeadlineAlerts(task) {
    if (task.dueDate) {
        const dueDate = new Date(task.dueDate);
        const today = new Date();
        const diffTime = dueDate - today;
        const diffDays = Math.ceil(diffTime / (1000 * 60 * 60 * 24));
        
        if (diffDays <= 1 && task.column !== 'done') {
            showNotification(`🚨 Deadline Alert: "${task.title}" is due tomorrow!`, 'error');
        }
    }
}

// Task Management
function addTask(column) {
    document.getElementById('taskColumn').value = column;
    document.getElementById('taskForm').reset();
    showModal('addTaskModal');
}

function saveTask(event) {
    event.preventDefault();
    
    const newTask = {
        id: 'task_' + Date.now(),
        title: document.getElementById('taskTitle').value,
        description: document.getElementById('taskDescription').value,
        column: document.getElementById('taskColumn').value,
        assignee: document.getElementById('taskAssignee').value,
        dueDate: document.getElementById('taskDueDate').value,
        priority: document.getElementById('taskPriority').value,
        hours: parseInt(document.getElementById('taskHours').value) || 0,
        createdAt: new Date()
    };
    
    tasks.push(newTask);
    renderTasks();
    updateProjectStats();
    closeModal('addTaskModal');
    showNotification('Task created successfully!');
    
    // AI: Auto-assign similar tasks based on skills
    autoAssignSimilarTasks(newTask);
}

function autoAssignSimilarTasks(newTask) {
    // AI logic to find similar tasks and suggest assignments
    const similarTasks = tasks.filter(task => 
        task.title.toLowerCase().includes(newTask.title.toLowerCase().split(' ')[0]) &&
        task.id !== newTask.id
    );
    
    if (similarTasks.length > 0) {
        showNotification(`💡 AI Found ${similarTasks.length} similar tasks. Consider same assignee for consistency`);
    }
}

function editTask(taskId) {
    const task = tasks.find(t => t.id === taskId);
    if (task) {
        document.getElementById('taskTitle').value = task.title;
        document.getElementById('taskDescription').value = task.description;
        document.getElementById('taskAssignee').value = task.assignee;
        document.getElementById('taskDueDate').value = task.dueDate;
        document.getElementById('taskPriority').value = task.priority;
        document.getElementById('taskHours').value = task.hours;
        document.getElementById('taskColumn').value = task.column;
        
        showModal('addTaskModal');
    }
}

function deleteTask(taskId) {
    if (confirm('Are you sure you want to delete this task?')) {
        tasks = tasks.filter(t => t.id !== taskId);
        renderTasks();
        updateProjectStats();
        showNotification('Task deleted successfully');
    }
}

// Render tasks to Kanban board
function renderTasks() {
    const columns = ['todo', 'progress', 'review', 'done'];
    
    columns.forEach(column => {
        const container = document.getElementById(column + 'Tasks');
        const columnTasks = tasks.filter(task => task.column === column);
        
        container.innerHTML = '';
        columnTasks.forEach(task => {
            const taskElement = createTaskElement(task);
            container.appendChild(taskElement);
        });
    });
    
    updateTaskCounts();
}

function createTaskElement(task) {
    const taskElement = document.createElement('div');
    taskElement.className = 'task-card';
    taskElement.id = 'task-' + task.id;
    taskElement.dataset.taskId = task.id;
    taskElement.draggable = true;
    taskElement.ondragstart = drag;
    taskElement.setAttribute('data-priority', task.priority);
    
    const assignee = employees.find(emp => emp.id === task.assignee);
    const assigneeName = assignee ? assignee.name : 'Unassigned';
    const assigneeInitials = assigneeName.split(' ').map(n => n[0]).join('').toUpperCase();
    
    const dueDate = task.dueDate ? new Date(task.dueDate) : null;
    const isOverdue = dueDate && dueDate < new Date() && task.column !== 'done';
    
    taskElement.innerHTML = `
        <div class="task-header">
            <div class="task-title">${task.title}</div>
            <span class="task-priority priority-${task.priority}">${task.priority}</span>
        </div>
        <div class="task-description">${task.description}</div>
        <div class="task-meta">
            <div class="task-assignee">
                <div class="assignee-avatar">${assigneeInitials}</div>
                <span>${assigneeName}</span>
            </div>
            ${dueDate ? `<div class="task-due ${isOverdue ? 'overdue' : ''}">${formatDate(dueDate)}</div>` : ''}
        </div>
        <div class="task-actions">
            <button class="task-btn btn-edit" onclick="editTask('${task.id}')">Edit</button>
            <button class="task-btn btn-delete" onclick="deleteTask('${task.id}')">Delete</button>
        </div>
    `;
    
    return taskElement;
}

function updateTaskCounts() {
    const counts = {
        todo: tasks.filter(t => t.column === 'todo').length,
        progress: tasks.filter(t => t.column === 'progress').length,
        review: tasks.filter(t => t.column === 'review').length,
        done: tasks.filter(t => t.column === 'done').length
    };
    
    Object.keys(counts).forEach(column => {
        document.getElementById(column + 'Count').textContent = counts[column];
    });
}

function updateProjectStats() {
    const total = tasks.length;
    const ongoing = tasks.filter(t => ['todo', 'progress', 'review'].includes(t.column)).length;
    const completed = tasks.filter(t => t.column === 'done').length;
    const delayed = tasks.filter(t => {
        if (!t.dueDate) return false;
        const dueDate = new Date(t.dueDate);
        return dueDate < new Date() && t.column !== 'done';
    }).length;
    
    document.getElementById('totalProjects').textContent = total;
    document.getElementById('ongoingProjects').textContent = ongoing;
    document.getElementById('completedProjects').textContent = completed;
    document.getElementById('delayedProjects').textContent = delayed;
}

// Utility functions
function populateEmployeeDropdowns() {
    const assigneeSelect = document.getElementById('taskAssignee');
    const teamMemberSelect = document.getElementById('addTeamMember');
    
    assigneeSelect.innerHTML = '<option value="">Select Assignee</option>';
    teamMemberSelect.innerHTML = '<option value="">Select Employee</option>';
    
    employees.forEach(emp => {
        if (emp.status === 'active') {
            const option1 = document.createElement('option');
            option1.value = emp.id;
            option1.textContent = emp.name;
            assigneeSelect.appendChild(option1);
            
            const option2 = document.createElement('option');
            option2.value = emp.id;
            option2.textContent = emp.name;
            teamMemberSelect.appendChild(option2);
        }
    });
}

function showModal(modalId) {
    document.getElementById(modalId).style.display = 'flex';
}

function closeModal(modalId) {
    document.getElementById(modalId).style.display = 'none';
}

// Initialize when tab is clicked
function initProjectsTab() {
    setTimeout(() => {
        initProjectManagement();
        initializeProjectCharts();
    }, 100);
}
// Add this to your existing charts code
function initializeProjectCharts() {
    // Project Progress Chart
    const progressCtx = document.getElementById('projectProgressChart').getContext('2d');
    new Chart(progressCtx, {
        type: 'doughnut',
        data: {
            labels: ['To Do', 'In Progress', 'In Review', 'Done'],
            datasets: [{
                data: [
                    tasks.filter(t => t.column === 'todo').length,
                    tasks.filter(t => t.column === 'progress').length,
                    tasks.filter(t => t.column === 'review').length,
                    tasks.filter(t => t.column === 'done').length
                ],
                backgroundColor: ['#6c757d', '#ffd166', '#3a86ff', '#06d6a0']
            }]
        }
    });

    // Team Performance Chart
    const teamCtx = document.getElementById('teamPerformanceChart').getContext('2d');
    new Chart(teamCtx, {
        type: 'bar',
        data: {
            labels: employees.map(emp => emp.name),
            datasets: [{
                label: 'Tasks Assigned',
                data: employees.map(emp => tasks.filter(t => t.assignee === emp.id).length),
                backgroundColor: '#3a86ff'
            }]
        }
    });
}

// Sample projects data
let projects = [
    {
        id: 'PROJ001',
        name: 'Website Redesign',
        description: 'Complete redesign of company website with modern UI/UX',
        status: 'In Progress',
        deadline: '2024-03-15',
        team: []
    },
    {
        id: 'PROJ002',
        name: 'Mobile App Development',
        description: 'Development of new mobile application for iOS and Android',
        status: 'Planning',
        deadline: '2024-04-30',
        team: []
    },
    {
        id: 'PROJ003',
        name: 'CRM System Upgrade',
        description: 'Upgrade and migration to new CRM platform',
        status: 'Completed',
        deadline: '2024-01-20',
        team: []
    },
    {
        id: 'PROJ004',
        name: 'AI Integration Project',
        description: 'Integration of AI capabilities into existing products',
        status: 'In Progress',
        deadline: '2024-05-10',
        team: []
    }
];

// Employee projects data
let employeeProjects = {};

// Show employee details when row is clicked
function showEmployeeDetails(empId) {
    const employee = employees.find(emp => emp.id === empId);
    if (!employee) return;
    
    const modalContent = document.getElementById('employeeDetailsContent');
    
    // Get employee's projects
    const empProjects = employeeProjects[empId] || [];
    
    modalContent.innerHTML = `
        <div class="employee-details-header">
            <div class="employee-avatar">
                ${employee.name.split(' ').map(n => n[0]).join('')}
            </div>
            <div class="employee-basic-info">
                <h3>${employee.name}</h3>
                <p>${employee.position} • ${employee.department}</p>
                <p>Employee ID: ${employee.id}</p>
            </div>
        </div>
        
        <div class="employee-details-grid">
            <div class="detail-group">
                <div class="detail-label">Email</div>
                <div class="detail-value">${employee.email}</div>
            </div>
            <div class="detail-group">
                <div class="detail-label">Phone</div>
                <div class="detail-value">${employee.phone}</div>
            </div>
            <div class="detail-group">
                <div class="detail-label">Department</div>
                <div class="detail-value">${employee.department}</div>
            </div>
            <div class="detail-group">
                <div class="detail-label">Position</div>
                <div class="detail-value">${employee.position}</div>
            </div>
            <div class="detail-group">
                <div class="detail-label">Join Date</div>
                <div class="detail-value">${formatDate(employee.joinDate)}</div>
            </div>
            <div class="detail-group">
                <div class="detail-label">Salary</div>
                <div class="detail-value">$${employee.salary.toLocaleString()}</div>
            </div>
            <div class="detail-group">
                <div class="detail-label">Status</div>
                <div class="detail-value">
                    <span class="status-badge status-${employee.status}">${employee.status}</span>
                </div>
            </div>
            <div class="detail-group">
                <div class="detail-label">AI Performance Score</div>
                <div class="detail-value">${employee.score}%</div>
            </div>
        </div>
        
        <div class="projects-section">
            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px;">
                <h4>Assigned Projects</h4>
                <button class="btn btn-primary btn-sm" onclick="showProjectAssignmentModal('${empId}')">
                    + Assign Project
                </button>
            </div>
            
            <div class="projects-list">
                ${empProjects.length > 0 ? 
                    empProjects.map(project => `
                        <div class="project-item">
                            <div>
                                <strong>${project.name}</strong>
                                <div style="font-size: 0.8rem; color: var(--text-secondary);">
                                    ${project.role} • ${formatDate(project.startDate)} to ${formatDate(project.endDate)}
                                </div>
                            </div>
                            <span class="status-badge status-${project.status.toLowerCase()}">${project.status}</span>
                        </div>
                    `).join('') : 
                    '<div class="no-projects">No projects assigned yet</div>'
                }
            </div>
        </div>
    `;
    
    document.getElementById('employeeDetailsModal').style.display = 'flex';
}

// Show project assignment modal
function showProjectAssignmentModal(empId) {
    // Store the current employee ID
    window.currentEmployeeId = empId;
    
    const projectList = document.getElementById('projectListContainer');
    projectList.innerHTML = '';
    
    // Get employee's current projects to avoid duplicates
    const currentProjects = employeeProjects[empId] || [];
    const currentProjectIds = currentProjects.map(p => p.id);
    
    projects.forEach(project => {
        // Skip if employee is already assigned to this project
        if (currentProjectIds.includes(project.id)) return;
        
        const projectOption = document.createElement('div');
        projectOption.className = 'project-option';
        projectOption.dataset.projectId = project.id;
        projectOption.innerHTML = `
            <div>
                <strong>${project.name}</strong>
                <div class="project-details">
                    ${project.description}<br>
                    <small>Status: ${project.status} • Deadline: ${formatDate(project.deadline)}</small>
                </div>
            </div>
        `;
        
        projectOption.onclick = function() {
            // Remove selection from all options
            document.querySelectorAll('.project-option').forEach(opt => {
                opt.classList.remove('selected');
            });
            
            // Select this option
            this.classList.add('selected');
            window.selectedProjectId = project.id;
        };
        
        projectList.appendChild(projectOption);
    });
    
    // Reset form
    document.getElementById('projectRole').value = '';
    document.getElementById('projectStartDate').value = '';
    document.getElementById('projectEndDate').value = '';
    
    document.getElementById('projectAssignmentModal').style.display = 'flex';
}

// Assign project to employee
function assignProjectToEmployee() {
    const empId = window.currentEmployeeId;
    const projectId = window.selectedProjectId;
    const role = document.getElementById('projectRole').value;
    const startDate = document.getElementById('projectStartDate').value;
    const endDate = document.getElementById('projectEndDate').value;
    
    if (!empId || !projectId) {
        showNotification('Please select a project', 'error');
        return;
    }
    
    if (!role) {
        showNotification('Please enter a project role', 'error');
        return;
    }
    
    // Find the project
    const project = projects.find(p => p.id === projectId);
    if (!project) {
        showNotification('Project not found', 'error');
        return;
    }
    
    // Initialize employee projects if needed
    if (!employeeProjects[empId]) {
        employeeProjects[empId] = [];
    }
    
    // Add project to employee
    employeeProjects[empId].push({
        id: project.id,
        name: project.name,
        role: role,
        startDate: startDate,
        endDate: endDate,
        status: project.status
    });
    
    // Also add employee to project team
    const employee = employees.find(emp => emp.id === empId);
    if (employee && !project.team.includes(empId)) {
        project.team.push(empId);
    }
    
    showNotification(`Project "${project.name}" assigned successfully!`);
    closeModal('projectAssignmentModal');
    
    // Refresh employee details if modal is open
    if (document.getElementById('employeeDetailsModal').style.display === 'flex') {
        showEmployeeDetails(empId);
    }
}

// Update the loadEmployees function to include project assignment button
function loadEmployees() {
    const table = document.getElementById('employeesTable');
    table.innerHTML = '';
    
    employees.forEach(emp => {
        const row = document.createElement('tr');
        row.onclick = () => showEmployeeDetails(emp.id);
        row.innerHTML = `
            <td>${emp.id}</td>
            <td>${emp.name}</td>
            <td>${emp.email}</td>
            <td>${emp.phone}</td>
            <td>${emp.department}</td>
            <td>${emp.position}</td>
            <td>${formatDate(emp.joinDate)}</td>
            <td><span class="status-badge status-${emp.status}">${emp.status}</span></td>
            <td>${emp.score}%</td>
            <td class="action-buttons">
                <button class="btn btn-primary btn-sm" onclick="event.stopPropagation(); editEmployee('${emp.id}')">Edit</button>
                <button class="btn btn-project btn-sm" onclick="event.stopPropagation(); showProjectAssignmentModal('${emp.id}')">Assign Project</button>
                <button class="btn btn-danger btn-sm" onclick="event.stopPropagation(); deleteEmployee('${emp.id}')">Delete</button>
            </td>
        `;
        table.appendChild(row);
    });
}

// Update the editEmployee function to fix the issue
function editEmployee(empId) {
    const employee = employees.find(emp => emp.id === empId);
    if (employee) {
        // Reset form first
        document.getElementById('employeeForm').reset();
        
        // Fill form with employee data
        document.getElementById('empName').value = employee.name;
        document.getElementById('empEmail').value = employee.email;
        document.getElementById('empPhone').value = employee.phone;
        document.getElementById('empDepartment').value = employee.department;
        document.getElementById('empPosition').value = employee.position;
        document.getElementById('empSalary').value = employee.salary;
        document.getElementById('empJoinDate').value = employee.joinDate;
        
        // Store the employee ID being edited
        document.getElementById('employeeForm').dataset.editingEmployeeId = empId;
        
        showAddEmployeeModal();
        showNotification(`Editing employee: ${employee.name}`);
    }
}

// Update the saveEmployee function to handle both add and edit
function saveEmployee(event) {
    event.preventDefault();
    
    const form = document.getElementById('employeeForm');
    const editingEmployeeId = form.dataset.editingEmployeeId;
    
    if (editingEmployeeId) {
        // Update existing employee
        const employeeIndex = employees.findIndex(emp => emp.id === editingEmployeeId);
        if (employeeIndex !== -1) {
            employees[employeeIndex] = {
                ...employees[employeeIndex],
                name: document.getElementById('empName').value,
                email: document.getElementById('empEmail').value,
                phone: document.getElementById('empPhone').value,
                department: document.getElementById('empDepartment').value,
                position: document.getElementById('empPosition').value,
                salary: parseFloat(document.getElementById('empSalary').value),
                joinDate: document.getElementById('empJoinDate').value
            };
            
            showNotification('Employee updated successfully!');
        }
        
        // Clear the editing ID
        delete form.dataset.editingEmployeeId;
    } else {
        // Add new employee
        const newEmployee = {
            id: 'EMP' + String(employees.length + 1).padStart(3, '0'),
            name: document.getElementById('empName').value,
            email: document.getElementById('empEmail').value,
            phone: document.getElementById('empPhone').value,
            department: document.getElementById('empDepartment').value,
            position: document.getElementById('empPosition').value,
            salary: parseFloat(document.getElementById('empSalary').value),
            joinDate: document.getElementById('empJoinDate').value,
            status: 'active',
            score: Math.floor(Math.random() * 20) + 80 // Random score 80-100
        };
        
        employees.push(newEmployee);
        showNotification('Employee added successfully!');
    }
    
    loadEmployees();
    closeModal('addEmployeeModal');
}


// Attendance System Data
let attendanceRecord = [];
let employee = [
    { 
        id: 'EMP001', 
        name: ' Ram Kumawat', 
        email: ' ramkumawat@gmail.com',
        phone: ' 9856784595',
        department: 'Engineering', 
        position: 'Senior Developer', 
        salary: 85000,
        joinDate: '2023-01-15',
        status: 'active', 
        score: 92 
    },
    { 
        id: 'EMP002', 
        name: ' Lucky Kumawat', 
        email: ' luckykumawat21@company.com',
        phone: '5689784595',
        department: 'Sales', 
        position: 'Sales Manager', 
        salary: 75000,
        joinDate: '2023-02-20',
        status: 'active', 
        score: 88 
    },
    { 
        id: 'EMP003', 
        name: ' Rohit Kumawat', 
        email: ' rohitkumawat43@company.com',
        phone: ' 9823564578',
        department: 'Marketing', 
        position: 'Marketing Specialist', 
        salary: 65000,
        joinDate: '2023-03-10',
        status: 'active', 
        score: 85 
    },
    { 
        id: 'EMP004', 
        name: ' Rahul Kumawat', 
        email: ' rahulkumawat77@company.com',
        phone: ' 5689784556',
        department: 'HR', 
        position: 'HR Manager', 
        salary: 70000,
        joinDate: '2023-01-05',
        status: 'active', 
        score: 95 
    },
    { 
        id: 'EMP005', 
        name: 'Ravi Kumawat', 
        email: ' ravi1101@company.com',
        phone: ' 5986955645',
        department: 'Engineering', 
        position: 'DevOps Engineer', 
        salary: 90000,
        joinDate: '2023-04-15',
        status: 'active', 
        score: 89 
    }
];

// Initialize Attendance System
function initAttendanceSystem() {
    loadAttendanceRecords();
    updateAttendanceSummary();
    loadEmployeeAttendanceList();
    loadAttendanceHistory();
}

// Load sample attendance records
function loadAttendanceRecords() {
    // Sample data for today
    const today = new Date().toISOString().split('T')[0];
    
    attendanceRecords = [
        {
            id: 'ATT001',
            date: today,
            employeeId: 'EMP001',
            employeeName: 'Ravi Kumawat',
            department: 'Engineering',
            checkIn: '09:00',
            checkOut: '17:00',
            status: 'Present',
            hours: 8.0
        },
        {
            id: 'ATT002',
            date: today,
            employeeId: 'EMP002',
            employeeName: 'Rahul Kumawat',
            department: 'Sales',
            checkIn: '09:15',
            checkOut: '17:30',
            status: 'Present',
            hours: 8.25
        },
        {
            id: 'ATT003',
            date: today,
            employeeId: 'EMP003',
            employeeName: 'Rohit Kumawat',
            department: 'Marketing',
            checkIn: '10:00',
            checkOut: '16:00',
            status: 'Late',
            hours: 6.0
        }
    ];
}

// Auto Mark Attendance for all employees
function markAutoAttendance() {
    const today = new Date().toISOString().split('T')[0];
    const activeEmployees = employees.filter(emp => emp.status === 'active');
    
    let markedCount = 0;
    
    activeEmployees.forEach(employee => {
        // Check if already marked today
        const alreadyMarked = attendanceRecords.some(record => 
            record.employeeId === employee.id && record.date === today
        );
        
        if (!alreadyMarked) {
            // Generate random check-in time between 8:00 AM and 10:00 AM
            const checkInHour = Math.floor(Math.random() * 3) + 8; // 8-10 AM
            const checkInMinute = Math.floor(Math.random() * 60);
            const checkInTime = `${checkInHour.toString().padStart(2, '0')}:${checkInMinute.toString().padStart(2, '0')}`;
            
            // Determine status based on check-in time
            let status = 'Present';
            if (checkInHour >= 9 && checkInMinute > 30) {
                status = 'Late';
            }
            
            // Generate check-out time (8-9 hours after check-in)
            const checkOutHour = checkInHour + 8 + Math.floor(Math.random() * 2);
            const checkOutMinute = Math.floor(Math.random() * 60);
            const checkOutTime = `${checkOutHour.toString().padStart(2, '0')}:${checkOutMinute.toString().padStart(2, '0')}`;
            
            // Calculate hours worked
            const hoursWorked = 8 + (Math.random() * 1).toFixed(1); // 8-9 hours
            
            const attendanceRecord = {
                id: 'ATT' + Date.now() + Math.random().toString(36).substr(2, 5),
                date: today,
                employeeId: employee.id,
                employeeName: employee.name,
                department: employee.department,
                checkIn: checkInTime,
                checkOut: checkOutTime,
                status: status,
                hours: parseFloat(hoursWorked)
            };
            
            attendanceRecords.push(attendanceRecord);
            markedCount++;
        }
    });
    
    updateAttendanceSummary();
    loadEmployeeAttendanceList();
    loadAttendanceHistory();
    
    showNotification(`Auto attendance marked for ${markedCount} employees`);
}

// Update attendance summary
function updateAttendanceSummary() {
    const today = new Date().toISOString().split('T')[0];
    const todayRecords = attendanceRecords.filter(record => record.date === today);
    const activeEmployees = employees.filter(emp => emp.status === 'active');
    
    const presentCount = todayRecords.length;
    const absentCount = activeEmployees.length - presentCount;
    const lateCount = todayRecords.filter(record => record.status === 'Late').length;
    const attendancePercent = activeEmployees.length > 0 ? 
        Math.round((presentCount / activeEmployees.length) * 100) : 0;
    
    document.getElementById('presentCount').textContent = presentCount;
    document.getElementById('absentCount').textContent = absentCount;
    document.getElementById('lateCount').textContent = lateCount;
    document.getElementById('attendancePercent').textContent = attendancePercent + '%';
}

// Load employee list for manual attendance
function loadEmployeeAttendanceList() {
    const container = document.getElementById('employeeAttendanceList');
    const activeEmployees = employees.filter(emp => emp.status === 'active');
    
    container.innerHTML = '';
    
    activeEmployees.forEach(employee => {
        const today = new Date().toISOString().split('T')[0];
        const todayRecord = attendanceRecords.find(record => 
            record.employeeId === employee.id && record.date === today
        );
        
        const employeeItem = document.createElement('div');
        employeeItem.className = 'employee-item';
        employeeItem.innerHTML = `
            <div class="employee-info">
                <h4>${employee.name}</h4>
                <p>${employee.department} • ${employee.position}</p>
            </div>
            <div>
                ${todayRecord ? 
                    `<span class="attendance-status status-${todayRecord.status.toLowerCase()}">
                        ${todayRecord.status} at ${todayRecord.checkIn}
                    </span>` :
                    `<button class="btn btn-primary btn-sm" onclick="markManualAttendance('${employee.id}')">
                        Mark Present
                    </button>`
                }
            </div>
        `;
        container.appendChild(employeeItem);
    });
}

// Mark manual attendance for specific employee
function markManualAttendance(employeeId) {
    const employee = employees.find(emp => emp.id === employeeId);
    if (!employee) return;
    
    const today = new Date().toISOString().split('T')[0];
    const now = new Date();
    const checkInTime = now.toTimeString().split(' ')[0].substring(0, 5);
    
    // Determine status based on current time
    let status = 'Present';
    const currentHour = now.getHours();
    const currentMinute = now.getMinutes();
    
    if (currentHour > 9 || (currentHour === 9 && currentMinute > 30)) {
        status = 'Late';
    }
    
    // Generate check-out time (8 hours later)
    const checkOutHour = currentHour + 8;
    const checkOutTime = `${checkOutHour.toString().padStart(2, '0')}:${checkInTime.substring(3)}`;
    
    const attendanceRecord = {
        id: 'ATT' + Date.now(),
        date: today,
        employeeId: employee.id,
        employeeName: employee.name,
        department: employee.department,
        checkIn: checkInTime,
        checkOut: checkOutTime,
        status: status,
        hours: 8.0
    };
    
    attendanceRecords.push(attendanceRecord);
    updateAttendanceSummary();
    loadEmployeeAttendanceList();
    loadAttendanceHistory();
    
    showNotification(`Attendance marked for ${employee.name}`);
}

// Search employees for manual attendance
function searchEmployeeAttendance() {
    const searchTerm = document.getElementById('searchEmployeeAttendance').value.toLowerCase();
    const filteredEmployees = employees.filter(emp => 
        emp.status === 'active' && 
        (emp.name.toLowerCase().includes(searchTerm) ||
         emp.department.toLowerCase().includes(searchTerm) ||
         emp.position.toLowerCase().includes(searchTerm))
    );
    
    const container = document.getElementById('employeeAttendanceList');
    container.innerHTML = '';
    
    filteredEmployees.forEach(employee => {
        const today = new Date().toISOString().split('T')[0];
        const todayRecord = attendanceRecords.find(record => 
            record.employeeId === employee.id && record.date === today
        );
        
        const employeeItem = document.createElement('div');
        employeeItem.className = 'employee-item';
        employeeItem.innerHTML = `
            <div class="employee-info">
                <h4>${employee.name}</h4>
                <p>${employee.department} • ${employee.position}</p>
            </div>
            <div>
                ${todayRecord ? 
                    `<span class="attendance-status status-${todayRecord.status.toLowerCase()}">
                        ${todayRecord.status} at ${todayRecord.checkIn}
                    </span>` :
                    `<button class="btn btn-primary btn-sm" onclick="markManualAttendance('${employee.id}')">
                        Mark Present
                    </button>`
                }
            </div>
        `;
        container.appendChild(employeeItem);
    });
}

// Load attendance history
function loadAttendanceHistory() {
    const table = document.getElementById('attendanceHistory');
    table.innerHTML = '';
    
    // Sort by date descending (newest first)
    const sortedRecords = [...attendanceRecords].sort((a, b) => 
        new Date(b.date) - new Date(a.date)
    );
    
    sortedRecords.forEach(record => {
        const row = document.createElement('tr');
        row.innerHTML = `
            <td>${formatDate(record.date)}</td>
            <td>${record.employeeId}</td>
            <td>${record.employeeName}</td>
            <td>${record.department}</td>
            <td>${record.checkIn}</td>
            <td>${record.checkOut}</td>
            <td>
                <span class="attendance-status status-${record.status.toLowerCase()}">
                    ${record.status}
                </span>
            </td>
            <td>${record.hours}h</td>
        `;
        table.appendChild(row);
    });
}

// Export attendance to Excel (CSV)
function exportAttendanceToExcel() {
    if (attendanceRecords.length === 0) {
        showNotification('No attendance records to export', 'error');
        return;
    }
    
    // Create CSV content
    let csvContent = 'Date,Employee ID,Employee Name,Department,Check-in,Check-out,Status,Hours Worked\n';
    
    attendanceRecords.forEach(record => {
        csvContent += `"${record.date}","${record.employeeId}","${record.employeeName}","${record.department}","${record.checkIn}","${record.checkOut}","${record.status}","${record.hours}"\n`;
    });
    
    // Create download link
    const blob = new Blob([csvContent], { type: 'text/csv;charset=utf-8;' });
    const link = document.createElement('a');
    const url = URL.createObjectURL(blob);
    
    link.setAttribute('href', url);
    link.setAttribute('download', `attendance_records_${new Date().toISOString().split('T')[0]}.csv`);
    link.style.visibility = 'hidden';
    
    document.body.appendChild(link);
    link.click();
    document.body.removeChild(link);
    
    showNotification('Attendance data exported to CSV successfully');
}

// Utility function to format date
function formatDate(dateString) {
    const options = { year: 'numeric', month: 'short', day: 'numeric' };
    return new Date(dateString).toLocaleDateString(undefined, options);
}

// Show notification
function showNotification(message, type = 'success') {
    alert(message); // Simple alert for demo
}

// Initialize when attendance tab is clicked
function switchTab(tabName) {
    // Hide all tabs
    document.querySelectorAll('.tab-content').forEach(tab => {
        tab.classList.remove('active');
    });
    
    // Remove active class from all tabs
    document.querySelectorAll('.nav-tab').forEach(tab => {
        tab.classList.remove('active');
    });
    
    // Show selected tab
    document.getElementById(tabName).classList.add('active');
    event.currentTarget.classList.add('active');
    
    // Initialize attendance system when tab is clicked
    if (tabName === 'attendance') {
        setTimeout(() => {
            initAttendanceSystem();
        }, 100);
    }
}

// Update dashboard attendance
function updateDashboardAttendance() {
    const today = new Date().toISOString().split('T')[0];
    const todayRecords = attendanceRecords.filter(record => record.date === today);
    const activeEmployees = employees.filter(emp => emp.status === 'active');
    
    const attendancePercent = activeEmployees.length > 0 ? 
        Math.round((todayRecords.length / activeEmployees.length) * 100) : 0;
    
    document.getElementById('dashboardAttendance').textContent = attendancePercent + '%';
    
    // Update trend
    const trendElement = document.getElementById('attendanceTrend');
    if (attendancePercent >= 90) {
        trendElement.textContent = 'Excellent';
        trendElement.style.color = 'var(--success)';
    } else if (attendancePercent >= 80) {
        trendElement.textContent = 'Good';
        trendElement.style.color = 'var(--warning)';
    } else {
        trendElement.textContent = 'Needs Attention';
        trendElement.style.color = 'var(--danger)';
    }
}

// Call this function whenever attendance changes
function refreshDashboard() {
    updateDashboardAttendance();
}

 // Payroll Management System - COMPLETE FIXED VERSION
class PayrollSystem {
    constructor() {
        this.taxSlabs = [
            { min: 0, max: 250000, rate: 0 },
            { min: 250001, max: 500000, rate: 5 },
            { min: 500001, max: 1000000, rate: 20 },
            { min: 1000001, max: Infinity, rate: 30 }
        ];
        this.pfRate = 0.12;
        this.professionalTax = 200;
    }

    calculateSalary(employee, attendanceDays, leavesTaken) {
        try {
            const basicSalary = employee.salary * 0.4;
            const hra = basicSalary * 0.5;
            const da = basicSalary * 0.2;
            
            const perDaySalary = employee.salary / 30;
            const actualWorkingDays = Math.max(0, attendanceDays - leavesTaken);
            const actualSalary = perDaySalary * actualWorkingDays;

            // Deductions
            const pf = basicSalary * this.pfRate;
            const incomeTax = this.calculateIncomeTax(actualSalary);

            const grossSalary = basicSalary + hra + da;
            const totalDeductions = pf + this.professionalTax + incomeTax;
            const netSalary = Math.max(0, grossSalary - totalDeductions);

            return {
                basic: Math.round(basicSalary),
                hra: Math.round(hra),
                da: Math.round(da),
                gross: Math.round(grossSalary),
                deductions: {
                    pf: Math.round(pf),
                    professionalTax: this.professionalTax,
                    incomeTax: Math.round(incomeTax),
                    total: Math.round(totalDeductions)
                },
                netSalary: Math.round(netSalary),
                workingDays: actualWorkingDays,
                leaves: leavesTaken
            };
        } catch (error) {
            console.error('Salary calculation error:', error);
            return this.getDefaultSalary();
        }
    }

    calculateIncomeTax(monthlySalary) {
        try {
            let tax = 0;
            let remainingSalary = monthlySalary * 12;
            
            // Standard deduction
            remainingSalary = Math.max(0, remainingSalary - 50000);

            for (const slab of this.taxSlabs) {
                if (remainingSalary <= 0) break;
                
                const slabAmount = Math.min(remainingSalary, slab.max - slab.min);
                if (slabAmount > 0) {
                    tax += (slabAmount * slab.rate) / 100;
                    remainingSalary -= slabAmount;
                }
            }

            return Math.max(0, tax / 12);
        } catch (error) {
            console.error('Tax calculation error:', error);
            return 0;
        }
    }

    getDefaultSalary() {
        return {
            basic: 0,
            hra: 0,
            da: 0,
            gross: 0,
            deductions: { pf: 0, professionalTax: 0, incomeTax: 0, total: 0 },
            netSalary: 0,
            workingDays: 0,
            leaves: 0
        };
    }
}

// Payroll UI Functions - FIXED VERSION
function loadPayrollData() {
    console.log('Loading payroll data...');
    
    try {
        const payrollSystem = new PayrollSystem();
        const activeEmployees = employees.filter(emp => emp.status === 'active');
        
        // Update summary cards
        document.getElementById('totalEmpCount').textContent = activeEmployees.length;

        let totalSalary = 0;
        let totalDeductions = 0;

        const table = document.getElementById('payrollTable');
        if (!table) {
            console.error('Payroll table not found!');
            return;
        }
        
        table.innerHTML = '';

        activeEmployees.forEach(emp => {
            const attendanceDays = 22; // Fixed for demo
            const salaryDetails = payrollSystem.calculateSalary(emp, attendanceDays, 2);

            totalSalary += salaryDetails.netSalary;
            totalDeductions += salaryDetails.deductions.total;

            const row = document.createElement('tr');
            row.innerHTML = `
                <td>${emp.id}</td>
                <td><strong>${emp.name}</strong></td>
                <td>${emp.department}</td>
                <td>₹${salaryDetails.basic.toLocaleString()}</td>
                <td>₹${salaryDetails.deductions.total.toLocaleString()}</td>
                <td><strong>₹${salaryDetails.netSalary.toLocaleString()}</strong></td>
                <td><span class="status-badge status-active">Active</span></td>
                <td class="action-buttons">
                    <button class="btn btn-primary btn-sm" onclick="viewPayslip('${emp.id}')">📄 View</button>
                    <button class="btn btn-success btn-sm" onclick="downloadPayslip('${emp.id}')">📥 Download</button>
                </td>
            `;
            table.appendChild(row);
        });

        // Update summary
        document.getElementById('totalSalary').textContent = `₹${totalSalary.toLocaleString()}`;
        document.getElementById('totalDeductions').textContent = `₹${totalDeductions.toLocaleString()}`;
        document.getElementById('netPayable').textContent = `₹${(totalSalary).toLocaleString()}`;
        
        console.log('Payroll data loaded successfully!');
        
    } catch (error) {
        console.error('Error loading payroll data:', error);
        showNotification('Error loading payroll data', 'error');
    }
}

function viewPayslip(empId) {
    console.log('Viewing payslip for:', empId);
    
    try {
        const employee = employees.find(emp => emp.id === empId);
        if (!employee) {
            showNotification('Employee not found!', 'error');
            return;
        }

        const payrollSystem = new PayrollSystem();
        const attendanceDays = 22;
        const salaryDetails = payrollSystem.calculateSalary(employee, attendanceDays, 2);
        
        const payslipHTML = generatePayslipHTML(employee, salaryDetails);
        
        // Create modal for payslip
        const modalHTML = `
            <div class="modal" id="payslipModal" style="display: flex; z-index: 10000;">
                <div class="modal-content" style="max-width: 800px; max-height: 90vh;">
                    <div class="modal-header">
                        <h3>📄 Payslip - ${employee.name}</h3>
                        <button class="close-modal" onclick="closeCurrentModal()">×</button>
                    </div>
                    <div style="max-height: 70vh; overflow-y: auto; padding: 20px;">
                        ${payslipHTML}
                    </div>
                    <div class="modal-footer">
                        <button class="btn btn-primary" onclick="downloadPayslip('${empId}')">📥 Download PDF</button>
                        <button class="btn" onclick="closeCurrentModal()">Close</button>
                    </div>
                </div>
            </div>
        `;

        // Remove existing modal if any
        const existingModal = document.getElementById('payslipModal');
        if (existingModal) {
            existingModal.remove();
        }

        document.body.insertAdjacentHTML('beforeend', modalHTML);
        
    } catch (error) {
        console.error('Error viewing payslip:', error);
        showNotification('Error generating payslip', 'error');
    }
}

function generatePayslipHTML(employee, salaryDetails) {
    return `
        <div class="payslip" style="padding: 30px; border: 2px solid #333; background: white; color: black; border-radius: 10px; font-family: Arial, sans-serif;">
            <div style="text-align: center; border-bottom: 2px solid #333; padding-bottom: 20px; margin-bottom: 20px;">
                <h2 style="color: #333; margin: 0;">PAYSLIP</h2>
                <p style="color: #666; margin: 5px 0;">AI Employee Management System</p>
                <p style="color: #666; margin: 0;">Payment Date: ${new Date().toLocaleDateString()}</p>
            </div>
            
            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin: 20px 0;">
                <div>
                    <p><strong>Employee ID:</strong> ${employee.id}</p>
                    <p><strong>Name:</strong> ${employee.name}</p>
                    <p><strong>Department:</strong> ${employee.department}</p>
                    <p><strong>Position:</strong> ${employee.position}</p>
                </div>
                <div>
                    <p><strong>Pay Period:</strong> ${new Date().toLocaleDateString('en-US', { month: 'long', year: 'numeric' })}</p>
                    <p><strong>Working Days:</strong> ${salaryDetails.workingDays}</p>
                    <p><strong>Leaves Taken:</strong> ${salaryDetails.leaves}</p>
                    <p><strong>Bank Account:</strong> ****1234</p>
                </div>
            </div>

            <table style="width: 100%; border-collapse: collapse; margin: 20px 0;">
                <tr style="background: #f8f9fa;">
                    <th colspan="2" style="padding: 15px; border: 1px solid #ddd; text-align: left; background: #007bff; color: white;">EARNINGS</th>
                </tr>
                <tr>
                    <td style="padding: 12px; border: 1px solid #ddd;">Basic Salary</td>
                    <td style="padding: 12px; border: 1px solid #ddd; text-align: right;">₹${salaryDetails.basic.toLocaleString()}</td>
                </tr>
                <tr>
                    <td style="padding: 12px; border: 1px solid #ddd;">House Rent Allowance (HRA)</td>
                    <td style="padding: 12px; border: 1px solid #ddd; text-align: right;">₹${salaryDetails.hra.toLocaleString()}</td>
                </tr>
                <tr>
                    <td style="padding: 12px; border: 1px solid #ddd;">Dearness Allowance (DA)</td>
                    <td style="padding: 12px; border: 1px solid #ddd; text-align: right;">₹${salaryDetails.da.toLocaleString()}</td>
                </tr>
                <tr style="background: #e7f3ff;">
                    <td style="padding: 12px; border: 1px solid #ddd; font-weight: bold;">Gross Salary</td>
                    <td style="padding: 12px; border: 1px solid #ddd; text-align: right; font-weight: bold;">₹${salaryDetails.gross.toLocaleString()}</td>
                </tr>

                <tr style="background: #f8f9fa;">
                    <th colspan="2" style="padding: 15px; border: 1px solid #ddd; text-align: left; background: #dc3545; color: white;">DEDUCTIONS</th>
                </tr>
                <tr>
                    <td style="padding: 12px; border: 1px solid #ddd;">Provident Fund (PF)</td>
                    <td style="padding: 12px; border: 1px solid #ddd; text-align: right;">₹${salaryDetails.deductions.pf.toLocaleString()}</td>
                </tr>
                <tr>
                    <td style="padding: 12px; border: 1px solid #ddd;">Professional Tax</td>
                    <td style="padding: 12px; border: 1px solid #ddd; text-align: right;">₹${salaryDetails.deductions.professionalTax.toLocaleString()}</td>
                </tr>
                <tr>
                    <td style="padding: 12px; border: 1px solid #ddd;">Income Tax (TDS)</td>
                    <td style="padding: 12px; border: 1px solid #ddd; text-align: right;">₹${salaryDetails.deductions.incomeTax.toLocaleString()}</td>
                </tr>
                <tr style="background: #ffe6e6;">
                    <td style="padding: 12px; border: 1px solid #ddd; font-weight: bold;">Total Deductions</td>
                    <td style="padding: 12px; border: 1px solid #ddd; text-align: right; font-weight: bold;">₹${salaryDetails.deductions.total.toLocaleString()}</td>
                </tr>

                <tr style="background: #d4edda;">
                    <td style="padding: 15px; border: 1px solid #ddd; font-weight: bold; font-size: 1.2em;">NET SALARY</td>
                    <td style="padding: 15px; border: 1px solid #ddd; text-align: right; font-weight: bold; font-size: 1.2em; color: #155724;">₹${salaryDetails.netSalary.toLocaleString()}</td>
                </tr>
            </table>

            <div style="margin-top: 30px; padding-top: 20px; border-top: 1px solid #ddd; text-align: center;">
                <p style="color: #666; font-size: 0.9em;">This is a computer-generated payslip and does not require signature.</p>
                <p style="color: #666; font-size: 0.9em;">Generated on: ${new Date().toLocaleString()}</p>
            </div>
        </div>
    `;
}

function downloadPayslip(empId) {
    try {
        const employee = employees.find(emp => emp.id === empId);
        const payrollSystem = new PayrollSystem();
        const attendanceDays = 22;
        const salaryDetails = payrollSystem.calculateSalary(employee, attendanceDays, 2);
        
        const payslipHTML = generatePayslipHTML(employee, salaryDetails);
        
        // Create a new window for printing/download
        const printWindow = window.open('', '_blank');
        printWindow.document.write(`
            <!DOCTYPE html>
            <html>
                <head>
                    <title>Payslip - ${employee.name}</title>
                    <style>
                        body { 
                            font-family: Arial, sans-serif; 
                            margin: 0; 
                            padding: 20px;
                            -webkit-print-color-adjust: exact;
                        }
                        @media print {
                            body { margin: 0; }
                            .no-print { display: none; }
                            .payslip { box-shadow: none; border: 2px solid #000; }
                        }
                        .payslip {
                            border: 2px solid #333;
                            padding: 30px;
                            background: white;
                            color: black;
                            border-radius: 10px;
                            max-width: 800px;
                            margin: 0 auto;
                        }
                    </style>
                </head>
                <body>
                    ${payslipHTML}
                    <div class="no-print" style="text-align: center; margin-top: 20px;">
                        <button onclick="window.print()" style="padding: 12px 24px; background: #007bff; color: white; border: none; border-radius: 5px; cursor: pointer; font-size: 16px; margin: 5px;">🖨️ Print Payslip</button>
                        <button onclick="window.close()" style="padding: 12px 24px; background: #6c757d; color: white; border: none; border-radius: 5px; cursor: pointer; font-size: 16px; margin: 5px;">❌ Close</button>
                    </div>
                </body>
            </html>
        `);
        printWindow.document.close();
        
        showNotification(`📄 Payslip generated for ${employee.name}`, 'success');
        
    } catch (error) {
        console.error('Error downloading payslip:', error);
        showNotification('Error generating payslip', 'error');
    }
}

function runPayrollForAll() {
    showNotification('🏃‍♂️ Running payroll for all employees...', 'info');
    
    // Show loading animation
    const runBtn = event.target;
    const originalText = runBtn.innerHTML;
    runBtn.innerHTML = '⏳ Processing...';
    runBtn.disabled = true;
    
    setTimeout(() => {
        loadPayrollData(); // Refresh data
        runBtn.innerHTML = originalText;
        runBtn.disabled = false;
        showNotification(`✅ Payroll completed successfully!`, 'success');
    }, 2000);
}

function generatePayrollReport() {
    showNotification('📊 Generating payroll report...', 'info');
    // Implement report generation logic here
    setTimeout(() => {
        showNotification('📈 Payroll report generated!', 'success');
    }, 1500);
}

function searchPayrollEmployees() {
    const searchTerm = document.getElementById('searchPayroll').value.toLowerCase();
    const rows = document.querySelectorAll('#payrollTable tr');
    
    rows.forEach(row => {
        const text = row.textContent.toLowerCase();
        row.style.display = text.includes(searchTerm) ? '' : 'none';
    });
}

function showTaxSettings() {
    showNotification('⚙️ Tax settings feature coming soon!', 'info');
}

// Utility Functions
function closeCurrentModal() {
    const modals = document.querySelectorAll('.modal');
    modals.forEach(modal => {
        if (modal.style.display === 'flex') {
            modal.style.display = 'none';
        }
    });
}

function showNotification(message, type = 'success') {
    // Use your existing notification system or create a simple one
    alert(`${type === 'error' ? '❌' : '✅'} ${message}`);
}

// Initialize Payroll when tab is clicked
function initPayrollTab() {
    console.log('Initializing payroll tab...');
    setTimeout(() => {
        loadPayrollData();
        console.log('Payroll tab ready!');
    }, 100);
}

// Add payroll tab to navigation when page loads
document.addEventListener('DOMContentLoaded', function() {
    console.log('Page loaded, adding payroll tab...');
    setTimeout(addPayrollToNavigation, 1000);
});

// Update the switchTab function to handle payroll
const  originalswitchtab = window.switchTab;
window.switchTab = function(tabName) {
    if ( originalswitchtab) {
         originalswitchtab(tabName);
    }
    
    if (tabName === 'payroll') {
        console.log('Switching to payroll tab...');
        initPayrollTab();
    }
};
// Navigation में Payroll Tab Add करें
function addPayrollToNavigation() {
    const navTabs = document.querySelector('.nav-tabs');
    
    // Check if payroll tab already exists
    if (document.querySelector('.nav-tab[onclick*="payroll"]')) {
        return;
    }
    
    const payrollTab = document.createElement('div');
    payrollTab.className = 'nav-tab';
    payrollTab.innerHTML = '💰 Payroll';
    payrollTab.setAttribute('onclick', "switchTab('payroll')");
    
    // Analytics tab के बाद add करें
    const analyticsTab = document.querySelector('.nav-tab[onclick*="analytics"]');
    if (analyticsTab) {
        analyticsTab.parentNode.insertBefore(payrollTab, analyticsTab.nextSibling);
    } else {
        navTabs.appendChild(payrollTab);
    }
}
// Initialize payroll system
document.addEventListener('DOMContentLoaded', function() {
    addPayrollTab();
});

// Add this code to fix navigation issues
function fixNavigation() {
    // Reattach all navigation event listeners
    const navTabs = document.querySelectorAll('.nav-tab');
    
    navTabs.forEach(tab => {
        // Remove existing click handlers
        const newTab = tab.cloneNode(true);
        tab.parentNode.replaceChild(newTab, tab);
    });
    
    // Reinitialize tab switching
    document.querySelectorAll('.nav-tab').forEach(tab => {
        const onclickAttr = tab.getAttribute('onclick');
        if (onclickAttr && onclickAttr.includes('switchTab')) {
            tab.addEventListener('click', function(e) {
                const tabName = onclickAttr.match(/switchTab\('([^']+)'\)/)[1];
                switchTab(tabName);
                e.stopPropagation();
            });
        }
    });
    
    console.log('Navigation fixed successfully');
}

// Call this function whenever you add new dynamic content
document.addEventListener('DOMContentLoaded', function() {
    // Your existing initialization code...
    
    // Fix navigation
    setTimeout(fixNavigation, 100);
});


// Fix view button functionality
function fixViewButtons() {
    // Use event delegation for dynamically created view buttons
    document.addEventListener('click', function(e) {
        if (e.target.classList.contains('view-btn') || 
            e.target.closest('.view-btn')) {
            const button = e.target.classList.contains('view-btn') ? 
                          e.target : e.target.closest('.view-btn');
            const applicationId = button.dataset.applicationId;
            viewApplication(applicationId);
        }
    });
}

// View application function
function viewApplication(applicationId) {
    // Find the application in your data
    const application = leaveApplications.find(app => app.id === applicationId);
    
    if (application) {
        // Create and show modal with application details
        const modalContent = `
            <div class="modal" id="viewApplicationModal" style="display: flex;">
                <div class="modal-content" style="max-width: 600px;">
                    <div class="modal-header">
                        <h3>📋 Leave Application Details</h3>
                        <button class="close-modal" onclick="closeModal('viewApplicationModal')">×</button>
                    </div>
                    <div style="padding: 20px;">
                        <div class="application-details">
                            <div class="detail-group">
                                <label>Employee:</label>
                                <span>${application.employeeName}</span>
                            </div>
                            <div class="detail-group">
                                <label>Leave Type:</label>
                                <span>${application.leaveType}</span>
                            </div>
                            <div class="detail-group">
                                <label>Start Date:</label>
                                <span>${application.startDate}</span>
                            </div>
                            <div class="detail-group">
                                <label>End Date:</label>
                                <span>${application.endDate}</span>
                            </div>
                            <div class="detail-group">
                                <label>Reason:</label>
                                <p>${application.reason}</p>
                            </div>
                            <div class="detail-group">
                                <label>Status:</label>
                                <span class="status-badge status-${application.status.toLowerCase()}">
                                    ${application.status}
                                </span>
                            </div>
                        </div>
                    </div>
                    <div class="modal-footer">
                        <button class="btn btn-primary" onclick="approveApplication('${applicationId}')">Approve</button>
                        <button class="btn btn-danger" onclick="rejectApplication('${applicationId}')">Reject</button>
                        <button class="btn" onclick="closeModal('viewApplicationModal')">Close</button>
                    </div>
                </div>
            </div>
        `;
        
        // Remove existing modal if any
        const existingModal = document.getElementById('viewApplicationModal');
        if (existingModal) {
            existingModal.remove();
        }
        
        document.body.insertAdjacentHTML('beforeend', modalContent);
    }
}

// Initialize view button fixes
document.addEventListener('DOMContentLoaded', function() {
    fixViewButtons();
});

// Leave Application System
let leaveApplications = [];
let applicationTemplates = [
    {
        id: 'template1',
        name: 'Casual Leave',
        content: `Respected [Recipient],

I am writing to request casual leave from [Start Date] to [End Date] due to [Reason].

During my absence, [Handover Details].

Thank you for your consideration.

Sincerely,
[Employee Name]`
    },
    {
        id: 'template2',
        name: 'Sick Leave',
        content: `Dear [Recipient],

I am unwell and unable to attend work from [Start Date] to [End Date]. I have attached my medical certificate for your reference.

I will complete pending tasks upon my return.

Thank you for your understanding.

Best regards,
[Employee Name]`
    },
    {
        id: 'template3',
        name: 'Vacation Leave',
        content: `Respected [Recipient],

I would like to apply for vacation leave from [Start Date] to [End Date] to [Reason].

All my current projects are up to date and I have briefed [Colleague Name] about ongoing work.

Thank you for approving my request.

Sincerely,
[Employee Name]`
    }
];

let applicationRecipients = [
    { id: 'boss', name: 'Company Director', email: 'director@company.com' },
    { id: 'hr', name: 'HR Manager', email: 'hr@company.com' },
    { id: 'dept_head', name: 'Department Head', email: 'depthead@company.com' },
    { id: 'manager', name: 'Immediate Manager', email: 'manager@company.com' },
    { id: 'admin', name: 'Administration', email: 'admin@company.com' }
];

// Initialize Leave Application System
function initLeaveApplicationSystem() {
    loadApplicationTemplates();
    loadApplicationRecipients();
    loadLeaveApplications();
}

// Load application templates
function loadApplicationTemplates() {
    const templateSelect = document.getElementById('applicationTemplate');
    if (!templateSelect) return;
    
    templateSelect.innerHTML = '<option value="">Select Template</option>';
    applicationTemplates.forEach(template => {
        const option = document.createElement('option');
        option.value = template.id;
        option.textContent = template.name;
        templateSelect.appendChild(option);
    });
}

// Load application recipients
function loadApplicationRecipients() {
    const recipientSelect = document.getElementById('applicationRecipient');
    if (!recipientSelect) return;
    
    recipientSelect.innerHTML = '';
    applicationRecipients.forEach(recipient => {
        const option = document.createElement('option');
        option.value = recipient.id;
        option.textContent = recipient.name;
        recipientSelect.appendChild(option);
    });
}

// Load leave applications
function loadLeaveApplications() {
    const container = document.getElementById('leaveApplicationsList');
    if (!container) return;
    
    container.innerHTML = '';
    
    if (leaveApplications.length === 0) {
        container.innerHTML = '<div class="no-applications">No leave applications found</div>';
        return;
    }
    
    leaveApplications.forEach(application => {
        const appElement = document.createElement('div');
        appElement.className = 'leave-application-item';
        appElement.innerHTML = `
            <div class="application-header">
                <div class="application-info">
                    <h4>${application.employeeName}</h4>
                    <p>${application.leaveType} • ${application.startDate} to ${application.endDate}</p>
                    <p>To: ${application.recipientName}</p>
                </div>
                <div class="application-status">
                    <span class="status-badge status-${application.status.toLowerCase()}">
                        ${application.status}
                    </span>
                </div>
            </div>
            <div class="application-reason">
                <p>${application.reason.substring(0, 100)}...</p>
            </div>
            <div class="application-actions">
                <button class="btn btn-primary btn-sm view-btn" data-application-id="${application.id}">
                    View Details
                </button>
                ${application.status === 'Pending' ? `
                    <button class="btn btn-success btn-sm" onclick="approveApplication('${application.id}')">
                        Approve
                    </button>
                    <button class="btn btn-danger btn-sm" onclick="rejectApplication('${application.id}')">
                        Reject
                    </button>
                ` : ''}
            </div>
        `;
        container.appendChild(appElement);
    });
}

// Create new leave application
function createLeaveApplication(event) {
    event.preventDefault();
    
    const employeeName = document.getElementById('applicationEmployee').value;
    const leaveType = document.getElementById('applicationType').value;
    const startDate = document.getElementById('applicationStartDate').value;
    const endDate = document.getElementById('applicationEndDate').value;
    const recipient = document.getElementById('applicationRecipient').value;
    const reason = document.getElementById('applicationReason').value;
    
    if (!employeeName || !leaveType || !startDate || !endDate || !recipient || !reason) {
        showNotification('Please fill all required fields', 'error');
        return;
    }
    
    const recipientObj = applicationRecipients.find(r => r.id === recipient);
    
    const newApplication = {
        id: 'APP_' + Date.now(),
        employeeName: employeeName,
        leaveType: leaveType,
        startDate: startDate,
        endDate: endDate,
        recipientId: recipient,
        recipientName: recipientObj.name,
        reason: reason,
        status: 'Pending',
        submittedDate: new Date().toISOString().split('T')[0]
    };
    
    leaveApplications.push(newApplication);
    loadLeaveApplications();
    closeModal('createApplicationModal');
    showNotification('Leave application submitted successfully!');
    
    // Reset form
    document.getElementById('leaveApplicationForm').reset();
}

// Apply template
function applyTemplate() {
    const templateId = document.getElementById('applicationTemplate').value;
    const template = applicationTemplates.find(t => t.id === templateId);
    
    if (template) {
        const currentEmployee = document.getElementById('applicationEmployee').value || '[Employee Name]';
        let templateContent = template.content;
        
        // Replace placeholders
        templateContent = templateContent.replace(/\[Employee Name\]/g, currentEmployee);
        templateContent = templateContent.replace(/\[Recipient\]/g, 'Appropriate Authority');
        templateContent = templateContent.replace(/\[Start Date\]/g, 'Select Start Date');
        templateContent = templateContent.replace(/\[End Date\]/g, 'Select End Date');
        templateContent = templateContent.replace(/\[Reason\]/g, 'Specify Reason');
        templateContent = templateContent.replace(/\[Handover Details\]/g, 'Work will be handed over to appropriate colleague');
        templateContent = templateContent.replace(/\[Colleague Name\]/g, 'Appropriate Colleague');
        
        document.getElementById('applicationReason').value = templateContent;
    }
}

// Application actions
function approveApplication(applicationId) {
    const application = leaveApplications.find(app => app.id === applicationId);
    if (application) {
        application.status = 'Approved';
        application.processedDate = new Date().toISOString().split('T')[0];
        loadLeaveApplications();
        closeModal('viewApplicationModal');
        showNotification('Leave application approved!');
    }
}

function rejectApplication(applicationId) {
    const application = leaveApplications.find(app => app.id === applicationId);
    if (application) {
        application.status = 'Rejected';
        application.processedDate = new Date().toISOString().split('T')[0];
        loadLeaveApplications();
        closeModal('viewApplicationModal');
        showNotification('Leave application rejected!');
    }
}

// Show create application modal
function showCreateApplicationModal() {
    // Populate employee dropdown
    const employeeSelect = document.getElementById('applicationEmployee');
    employeeSelect.innerHTML = '<option value="">Select Employee</option>';
    
    employees.forEach(emp => {
        if (emp.status === 'active') {
            const option = document.createElement('option');
            option.value = emp.name;
            option.textContent = emp.name;
            employeeSelect.appendChild(option);
        }
    });
    
    document.getElementById('createApplicationModal').style.display = 'flex';
}

// Add this CSS for leave application styling
const leaveApplicationCSS = `
.leave-application-item {
    background: var(--bg-card);
    border-radius: 10px;
    padding: 20px;
    margin-bottom: 15px;
    box-shadow: var(--shadow);
    border-left: 4px solid var(--primary);
}

.application-header {
    display: flex;
    justify-content: space-between;
    align-items: flex-start;
    margin-bottom: 10px;
}

.application-info h4 {
    margin: 0 0 5px 0;
    color: var(--text-primary);
}

.application-info p {
    margin: 2px 0;
    color: var(--text-secondary);
    font-size: 0.9rem;
}

.application-reason {
    margin: 10px 0;
    padding: 10px;
    background: var(--bg-secondary);
    border-radius: 5px;
}

.application-reason p {
    margin: 0;
    color: var(--text-secondary);
}

.application-actions {
    display: flex;
    gap: 8px;
    margin-top: 15px;
}

.no-applications {
    text-align: center;
    padding: 40px;
    color: var(--text-secondary);
    font-style: italic;
}

.application-details .detail-group {
    margin-bottom: 15px;
    padding-bottom: 15px;
    border-bottom: 1px solid var(--border-color);
}

.application-details label {
    font-weight: bold;
    color: var(--text-primary);
    display: block;
    margin-bottom: 5px;
}

.application-details p {
    margin: 0;
    color: var(--text-secondary);
    line-height: 1.5;
}
`;

// Add CSS to document
function addLeaveApplicationCSS() {
    if (!document.getElementById('leave-application-css')) {
        const style = document.createElement('style');
        style.id = 'leave-application-css';
        style.textContent = leaveApplicationCSS;
        document.head.appendChild(style);
    }
}

// Initialize when page loads
document.addEventListener('DOMContentLoaded', function() {
    addLeaveApplicationCSS();
    // Your other initialization code...
});
// Add leave application tab to navigation
function addLeaveApplicationTab() {
    const navTabs = document.querySelector('.nav-tabs');
    
    if (document.querySelector('.nav-tab[onclick*="leaveApplication"]')) {
        return;
    }
    
    const leaveTab = document.createElement('div');
    leaveTab.className = 'nav-tab';
    leaveTab.innerHTML = '📝 Leave Application';
    leaveTab.setAttribute('onclick', "switchTab('leaveApplication')");
    
    // Add after projects tab
    const projectsTab = document.querySelector('.nav-tab[onclick*="projects"]');
    if (projectsTab) {
        projectsTab.parentNode.insertBefore(leaveTab, projectsTab.nextSibling);
    } else {
        navTabs.appendChild(leaveTab);
    }
}

// Add leave application tab content
function addLeaveApplicationTabContent() {
    const tabContent = document.createElement('div');
    tabContent.id = 'leaveApplication';
    tabContent.className = 'tab-content';
    tabContent.innerHTML = `
        <div class="projects-header">
            <h2>📝 Leave Application System</h2>
            <div class="project-actions">
                <button class="btn btn-primary" onclick="showCreateApplicationModal()">
                    + New Application
                </button>
               <button class="btn btn-success" onclick="refreshLeaveApps()">
    🔄 Refresh
</button>
                
            </div>
        </div>

        <div class="application-stats">
            <div class="metrics-grid">
                <div class="metric-card">
                    <div class="metric-icon">📋</div>
                    <h3>Total Applications</h3>
                    <div class="metric-value" id="totalApplications">0</div>
                </div>
                <div class="metric-card">
                    <div class="metric-icon">⏳</div>
                    <h3>Pending</h3>
                    <div class="metric-value" id="pendingApplications">0</div>
                </div>
                <div class="metric-card">
                    <div class="metric-icon">✅</div>
                    <h3>Approved</h3>
                    <div class="metric-value" id="approvedApplications">0</div>
                </div>
                <div class="metric-card">
                    <div class="metric-icon">❌</div>
                    <h3>Rejected</h3>
                    <div class="metric-value" id="rejectedApplications">0</div>
                </div>
            </div>
        </div>

        <div class="applications-list">
            <h3>📂 Recent Applications</h3>
            <div id="leaveApplicationsList" class="applications-container">
                <!-- Applications will be loaded here -->
            </div>
        </div>
    `;
    
    document.querySelector('.container').appendChild(tabContent);
}

// Add modal for creating applications
function addApplicationModal() {
    const modalHTML = `
        <div id="createApplicationModal" class="modal">
            <div class="modal-content" style="max-width: 700px;">
                <div class="modal-header">
                    <h3>📝 Create Leave Application</h3>
                    <button class="close-modal" onclick="closeModal('createApplicationModal')">×</button>
                </div>
                <form id="leaveApplicationForm" onsubmit="createLeaveApplication(event)">
                    <div class="form-group">
                        <label>Employee Name:</label>
                        <select class="form-control" id="applicationEmployee" required>
                            <option value="">Select Employee</option>
                        </select>
                    </div>
                    
                    <div class="form-group">
                        <label>Application Template:</label>
                        <select class="form-control" id="applicationTemplate" onchange="applyTemplate()">
                            <option value="">Select Template</option>
                        </select>
                    </div>
                    
                    <div class="form-group">
                        <label>Send To:</label>
                        <select class="form-control" id="applicationRecipient" required>
                            <!-- Recipients will be loaded here -->
                        </select>
                    </div>
                    
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px;">
                        <div class="form-group">
                            <label>Leave Type:</label>
                            <select class="form-control" id="applicationType" required>
                                <option value="">Select Type</option>
                                <option value="Casual Leave">Casual Leave</option>
                                <option value="Sick Leave">Sick Leave</option>
                                <option value="Vacation Leave">Vacation Leave</option>
                                <option value="Emergency Leave">Emergency Leave</option>
                                <option value="Maternity/Paternity Leave">Maternity/Paternity Leave</option>
                            </select>
                        </div>
                        
                        <div class="form-group">
                            <label>Duration (Days):</label>
                            <input type="number" class="form-control" id="applicationDays" min="1" max="30" 
                                   onchange="calculateEndDate()" placeholder="Number of days">
                        </div>
                    </div>
                    
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px;">
                        <div class="form-group">
                            <label>Start Date:</label>
                            <input type="date" class="form-control" id="applicationStartDate" 
                                   onchange="calculateEndDate()" required>
                        </div>
                        
                        <div class="form-group">
                            <label>End Date:</label>
                            <input type="date" class="form-control" id="applicationEndDate" required>
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <label>Reason for Leave:</label>
                        <textarea class="form-control" id="applicationReason" rows="6" 
                                  placeholder="Enter detailed reason for leave..." required></textarea>
                    </div>
                    
                    <div class="modal-footer">
                        <button type="submit" class="btn btn-primary">Submit Application</button>
                        <button type="button" class="btn" onclick="closeModal('createApplicationModal')">Cancel</button>
                    </div>
                </form>
            </div>
        </div>
    `;
    
    document.body.insertAdjacentHTML('beforeend', modalHTML);
}

// Initialize leave application system
document.addEventListener('DOMContentLoaded', function() {
    addLeaveApplicationTab();
    addLeaveApplicationTabContent();
    addApplicationModal();
    
    // Initialize when tab is clicked
    const  originalswitchtab = window.switchTab;
    window.switchTab = function(tabName) {
        if ( originalswitchtab) {
             originalswitchtab(tabName);
        }
        
        if (tabName === 'leaveApplication') {
            setTimeout(() => {
                initLeaveApplicationSystem();
                fixNavigation();
                fixViewButtons();
            }, 100);
        }
    };
});
// Navigation mein Performance Tab add karo
function addPerformanceTab() {
    const navTabs = document.querySelector('.nav-tabs');
    
    if (document.querySelector('.nav-tab[onclick*="performance"]')) {
        return;
    }
    
    const performanceTab = document.createElement('div');
    performanceTab.className = 'nav-tab';
    performanceTab.innerHTML = '📊 Performance';
    performanceTab.setAttribute('onclick', "switchTab('performance')");
    
    // Projects tab ke baad add karo
    const projectsTab = document.querySelector('.nav-tab[onclick*="projects"]');
    if (projectsTab) {
        projectsTab.parentNode.insertBefore(performanceTab, projectsTab.nextSibling);
    } else {
        navTabs.appendChild(performanceTab);
    }
}
// Performance Tab Content
function addPerformanceTabContent() {
    const tabContent = document.createElement('div');
    tabContent.id = 'performance';
    tabContent.className = 'tab-content';
    tabContent.innerHTML = `
        <div class="projects-header">
            <h2>📊 Performance Management System</h2>
            <div class="project-actions">
                <button class="btn btn-primary" onclick="showSetGoalsModal()">
                    🎯 Set Goals
                </button>
                <button class="btn btn-success" onclick="showGiveFeedbackModal()">
                    💬 Give Feedback
                </button>
                <button class="btn btn-warning" onclick="generatePerformanceReport()">
                    📈 Generate Report
                </button>
            </div>
        </div>

        <!-- Performance Overview -->
        <div class="performance-stats">
            <div class="performance-card rating-excellent">
                <div class="rating-circle">4.8</div>
                <h3>Overall Rating</h3>
                <p>Team Performance Score</p>
                <div class="ai-trend">↑ 12% improvement</div>
            </div>
            <div class="performance-card rating-good">
                <div class="rating-circle">87%</div>
                <h3>Goal Completion</h3>
                <p>OKRs Achieved</p>
                <div class="ai-trend">5% above target</div>
            </div>
            <div class="performance-card rating-average">
                <div class="rating-circle">24</div>
                <h3>Feedback Given</h3>
                <p>This Month</p>
                <div class="ai-trend">Active engagement</div>
            </div>
            <div class="performance-card rating-poor">
                <div class="rating-circle">3</div>
                <h3>At Risk</h3>
                <p>Need Attention</p>
                <div class="ai-warning">Review required</div>
            </div>
        </div>

        <!-- Performance Charts -->
        <div class="performance-charts">
            <div class="chart-box">
                <h3>📈 Team Performance Trend</h3>
                <canvas id="performanceTrendChart"></canvas>
            </div>
            <div class="chart-box">
                <h3>🎯 Goal Completion Rate</h3>
                <canvas id="goalCompletionChart"></canvas>
            </div>
        </div>

        <!-- OKRs and Goals Section -->
        <div class="okr-container">
            <div class="projects-header">
                <h3>🎯 Objectives & Key Results (OKRs)</h3>
                <button class="btn btn-primary" onclick="showSetGoalsModal()">
                    + Add OKR
                </button>
            </div>
            
            <div class="okr-grid" id="okrList">
                <!-- OKRs will be loaded dynamically -->
            </div>
        </div>

        <!-- Feedback System -->
        <div class="feedback-system">
            <div class="projects-header">
                <h3>💬 Real-time Feedback</h3>
                <button class="btn btn-success" onclick="showGiveFeedbackModal()">
                    + Give Feedback
                </button>
            </div>
            
            <div id="feedbackList">
                <!-- Feedback items will be loaded dynamically -->
            </div>
        </div>

        <!-- Performance Reviews -->
        <div class="performance-review">
            <h3>📋 Performance Reviews</h3>
            <div class="review-section">
                <h4>Self-Assessment & Manager Review</h4>
                <div id="reviewList">
                    <!-- Reviews will be loaded dynamically -->
                </div>
            </div>
        </div>
    `;
    
    document.querySelector('.container').appendChild(tabContent);
}
// Performance Management System
class PerformanceManagementSystem {
    constructor() {
        this.okrs = this.loadOKRs();
        this.feedbacks = this.loadFeedbacks();
        this.reviews = this.loadReviews();
        this.performanceData = this.loadPerformanceData();
    }

    // Load data from localStorage
    loadOKRs() {
        try {
            const saved = localStorage.getItem('performanceOKRs');
            return saved ? JSON.parse(saved) : this.getDefaultOKRs();
        } catch (e) {
            console.error('Error loading OKRs:', e);
            return this.getDefaultOKRs();
        }
    }

    loadFeedbacks() {
        try {
            const saved = localStorage.getItem('performanceFeedbacks');
            return saved ? JSON.parse(saved) : this.getDefaultFeedbacks();
        } catch (e) {
            console.error('Error loading feedbacks:', e);
            return this.getDefaultFeedbacks();
        }
    }

    loadReviews() {
        try {
            const saved = localStorage.getItem('performanceReviews');
            return saved ? JSON.parse(saved) : this.getDefaultReviews();
        } catch (e) {
            console.error('Error loading reviews:', e);
            return this.getDefaultReviews();
        }
    }

    loadPerformanceData() {
        try {
            const saved = localStorage.getItem('performanceData');
            return saved ? JSON.parse(saved) : this.getDefaultPerformanceData();
        } catch (e) {
            console.error('Error loading performance data:', e);
            return this.getDefaultPerformanceData();
        }
    }

    // Save data to localStorage
    saveOKRs() {
        try {
            localStorage.setItem('performanceOKRs', JSON.stringify(this.okrs));
        } catch (e) {
            console.error('Error saving OKRs:', e);
        }
    }

    saveFeedbacks() {
        try {
            localStorage.setItem('performanceFeedbacks', JSON.stringify(this.feedbacks));
        } catch (e) {
            console.error('Error saving feedbacks:', e);
        }
    }

    saveReviews() {
        try {
            localStorage.setItem('performanceReviews', JSON.stringify(this.reviews));
        } catch (e) {
            console.error('Error saving reviews:', e);
        }
    }

    savePerformanceData() {
        try {
            localStorage.setItem('performanceData', JSON.stringify(this.performanceData));
        } catch (e) {
            console.error('Error saving performance data:', e);
        }
    }

    // Default data
    getDefaultOKRs() {
        return [
            {
                id: 'OKR001',
                objective: 'Increase Product Quality',
                keyResults: [
                    { description: 'Reduce bug count by 50%', progress: 75, target: 100 },
                    { description: 'Achieve 95% customer satisfaction', progress: 85, target: 100 },
                    { description: 'Implement automated testing', progress: 60, target: 100 }
                ],
                owner: 'EMP001',
                deadline: '2024-03-31',
                status: 'on-track',
                createdAt: new Date().toISOString()
            },
            {
                id: 'OKR002',
                objective: 'Improve Team Productivity',
                keyResults: [
                    { description: 'Reduce project delivery time by 20%', progress: 45, target: 100 },
                    { description: 'Increase code review efficiency', progress: 70, target: 100 },
                    { description: 'Implement agile methodologies', progress: 90, target: 100 }
                ],
                owner: 'EMP002',
                deadline: '2024-04-15',
                status: 'at-risk',
                createdAt: new Date().toISOString()
            }
        ];
    }

    getDefaultFeedbacks() {
        return [
            {
                id: 'FB001',
                from: 'EMP002',
                to: 'EMP001',
                message: 'Great work on the recent project delivery! Your attention to detail was impressive.',
                type: 'praise',
                timestamp: new Date().toISOString(),
                likes: 3
            },
            {
                id: 'FB002',
                from: 'EMP004',
                to: 'EMP001',
                message: 'Consider improving documentation for better team collaboration.',
                type: 'suggestion',
                timestamp: new Date(Date.now() - 86400000).toISOString(),
                likes: 1
            }
        ];
    }

    getDefaultReviews() {
        return [
            {
                id: 'REV001',
                employeeId: 'EMP001',
                period: 'Q1 2024',
                selfAssessment: 'I have successfully delivered all projects on time and improved my technical skills.',
                managerFeedback: 'Excellent performance. Shows great leadership and technical capabilities.',
                rating: 4.8,
                status: 'completed',
                createdAt: new Date().toISOString()
            }
        ];
    }

    getDefaultPerformanceData() {
        return {
            overallRating: 4.8,
            goalCompletion: 87,
            feedbackCount: 24,
            atRiskCount: 3,
            trendData: [4.2, 4.5, 4.6, 4.8],
            completionData: [75, 80, 82, 87]
        };
    }

    // OKR Management
    addOKR(objective, keyResults, owner, deadline) {
        const newOKR = {
            id: 'OKR' + Date.now(),
            objective: objective,
            keyResults: keyResults,
            owner: owner,
            deadline: deadline,
            status: 'on-track',
            createdAt: new Date().toISOString()
        };
        
        this.okrs.push(newOKR);
        this.saveOKRs();
        this.updatePerformanceStats();
        return newOKR;
    }

    updateOKRProgress(okrId, keyResultIndex, progress) {
        const okr = this.okrs.find(o => o.id === okrId);
        if (okr && okr.keyResults[keyResultIndex]) {
            okr.keyResults[keyResultIndex].progress = Math.min(100, Math.max(0, progress));
            
            // Update overall OKR status
            const avgProgress = okr.keyResults.reduce((sum, kr) => sum + kr.progress, 0) / okr.keyResults.length;
            if (avgProgress >= 80) okr.status = 'on-track';
            else if (avgProgress >= 50) okr.status = 'at-risk';
            else okr.status = 'off-track';
            
            this.saveOKRs();
            this.updatePerformanceStats();
        }
    }

    // Feedback Management
    giveFeedback(from, to, message, type = 'praise') {
        const newFeedback = {
            id: 'FB' + Date.now(),
            from: from,
            to: to,
            message: message,
            type: type,
            timestamp: new Date().toISOString(),
            likes: 0
        };
        
        this.feedbacks.push(newFeedback);
        this.saveFeedbacks();
        this.updatePerformanceStats();
        return newFeedback;
    }

    likeFeedback(feedbackId) {
        const feedback = this.feedbacks.find(f => f.id === feedbackId);
        if (feedback) {
            feedback.likes++;
            this.saveFeedbacks();
        }
    }

    // Review Management
    addReview(employeeId, period, selfAssessment, managerFeedback, rating) {
        const newReview = {
            id: 'REV' + Date.now(),
            employeeId: employeeId,
            period: period,
            selfAssessment: selfAssessment,
            managerFeedback: managerFeedback,
            rating: rating,
            status: 'completed',
            createdAt: new Date().toISOString()
        };
        
        this.reviews.push(newReview);
        this.saveReviews();
        this.updatePerformanceStats();
        return newReview;
    }

    // Performance Statistics
    updatePerformanceStats() {
        // Calculate overall rating from reviews
        if (this.reviews.length > 0) {
            const totalRating = this.reviews.reduce((sum, review) => sum + review.rating, 0);
            this.performanceData.overallRating = Math.round((totalRating / this.reviews.length) * 10) / 10;
        }

        // Calculate goal completion from OKRs
        if (this.okrs.length > 0) {
            const totalProgress = this.okrs.reduce((sum, okr) => {
                const okrProgress = okr.keyResults.reduce((krSum, kr) => krSum + kr.progress, 0) / okr.keyResults.length;
                return sum + okrProgress;
            }, 0);
            this.performanceData.goalCompletion = Math.round(totalProgress / this.okrs.length);
        }

        // Update other stats
        this.performanceData.feedbackCount = this.feedbacks.length;
        this.performanceData.atRiskCount = this.okrs.filter(okr => okr.status === 'at-risk' || okr.status === 'off-track').length;

        this.savePerformanceData();
    }

    // AI Recommendations
    getAIRecommendations() {
        const recommendations = [];
        
        // Analyze OKRs
        const atRiskOKRs = this.okrs.filter(okr => okr.status === 'at-risk');
        if (atRiskOKRs.length > 0) {
            recommendations.push({
                type: 'warning',
                message: `${atRiskOKRs.length} OKRs are at risk. Need immediate attention.`,
                action: 'review_okrs'
            });
        }

        // Analyze feedback frequency
        const recentFeedback = this.feedbacks.filter(f => 
            new Date(f.timestamp) > new Date(Date.now() - 7 * 86400000)
        );
        if (recentFeedback.length < 5) {
            recommendations.push({
                type: 'info',
                message: 'Low feedback activity this week. Encourage more team feedback.',
                action: 'encourage_feedback'
            });
        }

        // Analyze performance trends
        if (this.performanceData.overallRating < 4.0) {
            recommendations.push({
                type: 'danger',
                message: 'Overall performance rating below target. Consider training programs.',
                action: 'training_needed'
            });
        }

        return recommendations;
    }
}

// Global performance system instance
let performanceSystem = null;

// Initialize Performance System
function initPerformanceSystem() {
    if (!performanceSystem) {
        performanceSystem = new PerformanceManagementSystem();
    }
    renderPerformanceDashboard();
    initializePerformanceCharts();
}

// Render Performance Dashboard
function renderPerformanceDashboard() {
    if (!performanceSystem) return;

    // Update stats
    document.getElementById('totalApplications').textContent = performanceSystem.okrs.length;
    document.getElementById('pendingApplications').textContent = performanceSystem.feedbacks.length;
    document.getElementById('approvedApplications').textContent = performanceSystem.reviews.length;
    document.getElementById('rejectedApplications').textContent = performanceSystem.performanceData.atRiskCount;

    // Render OKRs
    renderOKRs();
    
    // Render Feedback
    renderFeedback();
    
    // Render Reviews
    renderReviews();
    
    // Render AI Recommendations
    renderAIRecommendations();
}

// Render OKRs
function renderOKRs() {
    const container = document.getElementById('okrList');
    if (!container) return;

    container.innerHTML = '';

    performanceSystem.okrs.forEach(okr => {
        const owner = employees.find(emp => emp.id === okr.owner);
        const okrElement = document.createElement('div');
        okrElement.className = 'okr-item';
        okrElement.style.animationDelay = `${performanceSystem.okrs.indexOf(okr) * 0.1}s`;
        
        okrElement.innerHTML = `
            <div class="okr-header">
                <h4>${okr.objective}</h4>
                <div>
                    <span class="badge badge-${okr.status === 'on-track' ? 'success' : okr.status === 'at-risk' ? 'warning' : 'danger'}">
                        ${okr.status.replace('-', ' ').toUpperCase()}
                    </span>
                </div>
            </div>
            <p><strong>Owner:</strong> ${owner ? owner.name : 'Unknown'}</p>
            <p><strong>Deadline:</strong> ${formatDate(okr.deadline)}</p>
            
            ${okr.keyResults.map((kr, index) => `
                <div class="key-result">
                    <div class="kr-info">
                        <span>${kr.description}</span>
                        <span>${kr.progress}%</span>
                    </div>
                    <div class="okr-progress">
                        <div class="okr-progress-bar" style="width: ${kr.progress}%"></div>
                    </div>
                    <input type="range" min="0" max="100" value="${kr.progress}" 
                           onchange="updateOKRProgress('${okr.id}', ${index}, this.value)"
                           style="width: 100%; margin-top: 5px;">
                </div>
            `).join('')}
            
            <div class="okr-actions">
                <button class="btn btn-sm btn-primary" onclick="editOKR('${okr.id}')">
                    ✏️ Edit
                </button>
                <button class="btn btn-sm btn-danger" onclick="deleteOKR('${okr.id}')">
                    🗑️ Delete
                </button>
            </div>
        `;
        
        container.appendChild(okrElement);
    });
}

// Render Feedback
function renderFeedback() {
    const container = document.getElementById('feedbackList');
    if (!container) return;

    container.innerHTML = '';

    performanceSystem.feedbacks.forEach(feedback => {
        const fromEmployee = employees.find(emp => emp.id === feedback.from);
        const toEmployee = employees.find(emp => emp.id === feedback.to);
        
        const feedbackElement = document.createElement('div');
        feedbackElement.className = 'feedback-item';
        feedbackElement.innerHTML = `
            <div class="feedback-header">
                <div>
                    <strong>${fromEmployee ? fromEmployee.name : 'Unknown'} → ${toEmployee ? toEmployee.name : 'Unknown'}</strong>
                    <span class="badge ${feedback.type === 'praise' ? 'badge-success' : 'badge-warning'}">
                        ${feedback.type}
                    </span>
                </div>
                <small>${formatDate(feedback.timestamp)}</small>
            </div>
            <p>${feedback.message}</p>
            <div class="feedback-actions">
                <button class="btn btn-sm" onclick="likeFeedback('${feedback.id}')">
                    👍 ${feedback.likes}
                </button>
                <button class="btn btn-sm btn-primary" onclick="replyToFeedback('${feedback.id}')">
                    💬 Reply
                </button>
            </div>
        `;
        
        container.appendChild(feedbackElement);
    });
}

// Render Reviews
function renderReviews() {
    const container = document.getElementById('reviewList');
    if (!container) return;

    container.innerHTML = '';

    performanceSystem.reviews.forEach(review => {
        const employee = employees.find(emp => emp.id === review.employeeId);
        
        const reviewElement = document.createElement('div');
        reviewElement.className = 'review-item';
        reviewElement.innerHTML = `
            <div class="review-header">
                <h5>${employee ? employee.name : 'Unknown'} - ${review.period}</h5>
                <div class="rating-circle" style="width: 60px; height: 60px; font-size: 1rem;">
                    ${review.rating}
                </div>
            </div>
            <div class="review-content">
                <div class="review-section">
                    <strong>Self Assessment:</strong>
                    <p>${review.selfAssessment}</p>
                </div>
                <div class="review-section">
                    <strong>Manager Feedback:</strong>
                    <p>${review.managerFeedback}</p>
                </div>
            </div>
        `;
        
        container.appendChild(reviewElement);
    });
}

// Render AI Recommendations
function renderAIRecommendations() {
    const recommendations = performanceSystem.getAIRecommendations();
    const container = document.querySelector('.ai-recommendations');
    if (!container) return;

    let recommendationsHTML = '<h3>🤖 AI Performance Insights</h3>';
    
    recommendations.forEach(rec => {
        recommendationsHTML += `
            <div class="recommendation-item">
                <strong>${rec.type.toUpperCase()}:</strong> ${rec.message}
                <button class="btn btn-sm" onclick="handleAIRecommendation('${rec.action}')">
                    Apply
                </button>
            </div>
        `;
    });
    
    container.innerHTML = recommendationsHTML;
}
// Modals for Performance Management
function addPerformanceModals() {
    const modalsHTML = `
        <!-- Set Goals Modal -->
        <div id="setGoalsModal" class="modal">
            <div class="modal-content" style="max-width: 700px;">
                <div class="modal-header">
                    <h3>🎯 Set New Goals (OKRs)</h3>
                    <button class="close-modal" onclick="closeModal('setGoalsModal')">×</button>
                </div>
                <form id="goalsForm" onsubmit="saveGoals(event)">
                    <div class="form-group">
                        <label>Objective:</label>
                        <input type="text" class="form-control" id="objective" 
                               placeholder="What do you want to achieve?" required>
                    </div>
                    
                    <div class="form-group">
                        <label>Key Results (Add at least 3):</label>
                        <div id="keyResultsContainer">
                            <div class="key-result-input">
                                <input type="text" class="form-control" placeholder="Measurable key result" required>
                                <button type="button" class="btn btn-danger btn-sm" onclick="removeKeyResult(this)">−</button>
                            </div>
                        </div>
                        <button type="button" class="btn btn-sm" onclick="addKeyResult()">+ Add Key Result</button>
                    </div>
                    
                    <div class="form-group">
                        <label>Owner:</label>
                        <select class="form-control" id="goalOwner" required>
                            <option value="">Select Employee</option>
                        </select>
                    </div>
                    
                    <div class="form-group">
                        <label>Deadline:</label>
                        <input type="date" class="form-control" id="goalDeadline" required>
                    </div>
                    
                    <div class="modal-footer">
                        <button type="submit" class="btn btn-primary">Save Goals</button>
                        <button type="button" class="btn" onclick="closeModal('setGoalsModal')">Cancel</button>
                    </div>
                </form>
            </div>
        </div>

        <!-- Give Feedback Modal -->
        <div id="giveFeedbackModal" class="modal">
            <div class="modal-content" style="max-width: 600px;">
                <div class="modal-header">
                    <h3>💬 Give Feedback</h3>
                    <button class="close-modal" onclick="closeModal('giveFeedbackModal')">×</button>
                </div>
                <form id="feedbackForm" onsubmit="saveFeedback(event)">
                    <div class="form-group">
                        <label>To:</label>
                        <select class="form-control" id="feedbackTo" required>
                            <option value="">Select Employee</option>
                        </select>
                    </div>
                    
                    <div class="form-group">
                        <label>Feedback Type:</label>
                        <select class="form-control" id="feedbackType" required>
                            <option value="praise">Praise</option>
                            <option value="suggestion">Suggestion</option>
                            <option value="constructive">Constructive Feedback</option>
                        </select>
                    </div>
                    
                    <div class="form-group">
                        <label>Message:</label>
                        <textarea class="form-control" id="feedbackMessage" rows="4" 
                                  placeholder="Be specific and constructive..." required></textarea>
                    </div>
                    
                    <div class="modal-footer">
                        <button type="submit" class="btn btn-success">Send Feedback</button>
                        <button type="button" class="btn" onclick="closeModal('giveFeedbackModal')">Cancel</button>
                    </div>
                </form>
            </div>
        </div>

        <!-- Performance Review Modal -->
        <div id="performanceReviewModal" class="modal">
            <div class="modal-content" style="max-width: 800px;">
                <div class="modal-header">
                    <h3>📋 Performance Review</h3>
                    <button class="close-modal" onclick="closeModal('performanceReviewModal')">×</button>
                </div>
                <form id="reviewForm" onsubmit="saveReview(event)">
                    <div class="form-group">
                        <label>Employee:</label>
                        <select class="form-control" id="reviewEmployee" required>
                            <option value="">Select Employee</option>
                        </select>
                    </div>
                    
                    <div class="form-group">
                        <label>Review Period:</label>
                        <input type="text" class="form-control" id="reviewPeriod" 
                               placeholder="e.g., Q1 2024" required>
                    </div>
                    
                    <div class="form-group">
                        <label>Self Assessment:</label>
                        <textarea class="form-control" id="selfAssessment" rows="3" 
                                  placeholder="Employee's self-assessment..." required></textarea>
                    </div>
                    
                    <div class="form-group">
                        <label>Manager Feedback:</label>
                        <textarea class="form-control" id="managerFeedback" rows="3" 
                                  placeholder="Manager's feedback..." required></textarea>
                    </div>
                    
                    <div class="form-group">
                        <label>Rating (1-5):</label>
                        <input type="number" class="form-control" id="reviewRating" 
                               min="1" max="5" step="0.1" required>
                    </div>
                    
                    <div class="modal-footer">
                        <button type="submit" class="btn btn-primary">Save Review</button>
                        <button type="button" class="btn" onclick="closeModal('performanceReviewModal')">Cancel</button>
                    </div>
                </form>
            </div>
        </div>
    `;
    
    document.body.insertAdjacentHTML('beforeend', modalsHTML);
}

// Event Handlers for Performance Management
function showSetGoalsModal() {
    // Populate employee dropdown
    const ownerSelect = document.getElementById('goalOwner');
    ownerSelect.innerHTML = '<option value="">Select Employee</option>';
    
    employees.forEach(emp => {
        if (emp.status === 'active') {
            const option = document.createElement('option');
            option.value = emp.id;
            option.textContent = emp.name;
            ownerSelect.appendChild(option);
        }
    });
    
    // Reset form
    document.getElementById('goalsForm').reset();
    document.getElementById('keyResultsContainer').innerHTML = `
        <div class="key-result-input">
            <input type="text" class="form-control" placeholder="Measurable key result" required>
            <button type="button" class="btn btn-danger btn-sm" onclick="removeKeyResult(this)">−</button>
        </div>
    `;
    
    document.getElementById('setGoalsModal').style.display = 'flex';
}

function addKeyResult() {
    const container = document.getElementById('keyResultsContainer');
    const newInput = document.createElement('div');
    newInput.className = 'key-result-input';
    newInput.innerHTML = `
        <input type="text" class="form-control" placeholder="Measurable key result" required>
        <button type="button" class="btn btn-danger btn-sm" onclick="removeKeyResult(this)">−</button>
    `;
    container.appendChild(newInput);
}

function removeKeyResult(button) {
    if (document.querySelectorAll('.key-result-input').length > 1) {
        button.parentElement.remove();
    }
}

function saveGoals(event) {
    event.preventDefault();
    
    const objective = document.getElementById('objective').value;
    const owner = document.getElementById('goalOwner').value;
    const deadline = document.getElementById('goalDeadline').value;
    
    const keyResults = Array.from(document.querySelectorAll('#keyResultsContainer input'))
        .map(input => ({
            description: input.value,
            progress: 0,
            target: 100
        }));
    
    if (keyResults.length < 1) {
        showNotification('Please add at least one key result', 'error');
        return;
    }
    
    performanceSystem.addOKR(objective, keyResults, owner, deadline);
    renderPerformanceDashboard();
    closeModal('setGoalsModal');
    showNotification('🎯 Goals set successfully!');
}

function showGiveFeedbackModal() {
    const toSelect = document.getElementById('feedbackTo');
    toSelect.innerHTML = '<option value="">Select Employee</option>';
    
    employees.forEach(emp => {
        if (emp.status === 'active') {
            const option = document.createElement('option');
            option.value = emp.id;
            option.textContent = emp.name;
            toSelect.appendChild(option);
        }
    });
    
    document.getElementById('giveFeedbackModal').style.display = 'flex';
}

function saveFeedback(event) {
    event.preventDefault();
    
    const to = document.getElementById('feedbackTo').value;
    const type = document.getElementById('feedbackType').value;
    const message = document.getElementById('feedbackMessage').value;
    
    // For demo, using first employee as sender
    const from = employees[0].id;
    
    performanceSystem.giveFeedback(from, to, message, type);
    renderPerformanceDashboard();
    closeModal('giveFeedbackModal');
    showNotification('💬 Feedback sent successfully!');
}

function updateOKRProgress(okrId, keyResultIndex, progress) {
    performanceSystem.updateOKRProgress(okrId, keyResultIndex, parseInt(progress));
    renderPerformanceDashboard();
}

function likeFeedback(feedbackId) {
    performanceSystem.likeFeedback(feedbackId);
    renderPerformanceDashboard();
}

function generatePerformanceReport() {
    showNotification('📈 Generating performance report...', 'info');
    
    // Simulate report generation
    setTimeout(() => {
        const reportData = {
            overallRating: performanceSystem.performanceData.overallRating,
            goalCompletion: performanceSystem.performanceData.goalCompletion,
            totalOKRs: performanceSystem.okrs.length,
            totalFeedback: performanceSystem.feedbacks.length,
            atRiskItems: performanceSystem.performanceData.atRiskCount,
            generatedAt: new Date().toLocaleString()
        };
        
        // Create downloadable report
        let reportContent = `PERFORMANCE REPORT\n`;
        reportContent += `================\n\n`;
        reportContent += `Generated: ${reportData.generatedAt}\n\n`;
        reportContent += `Overall Rating: ${reportData.overallRating}/5\n`;
        reportContent += `Goal Completion: ${reportData.goalCompletion}%\n`;
        reportContent += `Total OKRs: ${reportData.totalOKRs}\n`;
        reportContent += `Total Feedback: ${reportData.totalFeedback}\n`;
        reportContent += `At Risk Items: ${reportData.atRiskItems}\n\n`;
        
        reportContent += `OKRs:\n`;
        performanceSystem.okrs.forEach(okr => {
            reportContent += `- ${okr.objective} (${okr.status})\n`;
        });
        
        const blob = new Blob([reportContent], { type: 'text/plain' });
        const url = URL.createObjectURL(blob);
        const a = document.createElement('a');
        a.href = url;
        a.download = `performance_report_${new Date().getTime()}.txt`;
        document.body.appendChild(a);
        a.click();
        document.body.removeChild(a);
        URL.revokeObjectURL(url);
        
        showNotification('📊 Performance report downloaded!', 'success');
    }, 2000);
}

// Initialize Performance Charts
function initializePerformanceCharts() {
    // Performance Trend Chart
    const trendCtx = document.getElementById('performanceTrendChart').getContext('2d');
    new Chart(trendCtx, {
        type: 'line',
        data: {
            labels: ['Jan', 'Feb', 'Mar', 'Apr'],
            datasets: [{
                label: 'Team Performance',
                data: performanceSystem.performanceData.trendData,
                borderColor: '#3a86ff',
                backgroundColor: 'rgba(58, 134, 255, 0.1)',
                tension: 0.4,
                fill: true
            }]
        },
        options: {
            responsive: true,
            scales: {
                y: {
                    min: 3,
                    max: 5
                }
            }
        }
    });

    // Goal Completion Chart
    const goalCtx = document.getElementById('goalCompletionChart').getContext('2d');
    new Chart(goalCtx, {
        type: 'bar',
        data: {
            labels: ['Q1', 'Q2', 'Q3', 'Q4'],
            datasets: [{
                label: 'Goal Completion %',
                data: performanceSystem.performanceData.completionData,
                backgroundColor: '#06d6a0'
            }]
        }
    });
}

// Complete Performance System Initialization
function initPerformanceManagement() {
    addPerformanceTab();
    addPerformanceTabContent();
    addPerformanceModals();
    
    // Update switchTab function
    const  originalswitchtab = window.switchTab;
    window.switchTab = function(tabName) {
        if ( originalswitchtab) {
             originalswitchtab(tabName);
        }
        
        if (tabName === 'performance') {
            setTimeout(() => {
                initPerformanceSystem();
            }, 100);
        }
    };
}

// Page load pe initialize karo
document.addEventListener('DOMContentLoaded', function() {
    initPerformanceManagement();
});

// Advanced Employee Database System
class AdvancedEmployeeDatabase {
    constructor() {
        this.employees = this.loadEmployees();
        this.filters = {
            department: '',
            position: '',
            location: '',
            skills: '',
            experience: '',
            status: ''
        };
    }

    loadEmployees() {
        // Enhanced employee data with additional fields
        return [
            { 
                id: 'EMP001', 
                name: 'Ram Kumawat', 
                email: 'ramkumawat@gmail.com',
                phone: '7889569586',
                department: 'Engineering', 
                position: 'Senior Developer', 
                salary: 85000,
                joinDate: '2023-01-15',
                location: 'Mumbai',
                experience: 5,
                skills: ['JavaScript', 'React', 'Node.js', 'Python'],
                status: 'active', 
                score: 92,
                documents: [
                    { name: 'Resume.pdf', type: 'resume', uploadDate: '2023-01-10' },
                    { name: 'Offer_Letter.pdf', type: 'offer', uploadDate: '2023-01-12' },
                    { name: 'ID_Proof.jpg', type: 'id', uploadDate: '2023-01-12' }
                ],
                history: [
                    { type: 'joining', date: '2023-01-15', title: 'Joined Company', description: 'Started as Senior Developer' },
                    { type: 'promotion', date: '2023-06-15', title: 'Promoted to Team Lead', description: 'Promoted to Team Lead for excellent performance' },
                    { type: 'award', date: '2023-12-20', title: 'Employee of the Month', description: 'Awarded Employee of the Month for outstanding work' }
                ]
            },
            { 
                id: 'EMP002', 
                name: 'Lucky Kumawat', 
                email: 'luckykumawat21@company.com',
                phone: '5623955415',
                department: 'Sales', 
                position: 'Sales Manager', 
                salary: 75000,
                joinDate: '2023-02-20',
                location: 'Delhi',
                experience: 7,
                skills: ['Sales', 'Negotiation', 'CRM', 'Communication'],
                status: 'active', 
                score: 88,
                documents: [
                    { name: 'Resume.pdf', type: 'resume', uploadDate: '2023-02-15' },
                    { name: 'Offer_Letter.pdf', type: 'offer', uploadDate: '2023-02-18' }
                ],
                history: [
                    { type: 'joining', date: '2023-02-20', title: 'Joined Company', description: 'Started as Sales Manager' }
                ]
            },
            { 
                id: 'EMP003', 
                name: 'Rohit Kumawat', 
                email: 'rohitkumawat43@company.com',
                phone: '8954121002',
                department: 'Marketing', 
                position: 'Marketing Specialist', 
                salary: 65000,
                joinDate: '2023-03-10',
                location: 'Bangalore',
                experience: 3,
                skills: ['Digital Marketing', 'SEO', 'Content Writing', 'Social Media'],
                status: 'inactive', 
                score: 65,
                documents: [
                    { name: 'Resume.pdf', type: 'resume', uploadDate: '2023-03-05' }
                ],
                history: [
                    { type: 'joining', date: '2023-03-10', title: 'Joined Company', description: 'Started as Marketing Specialist' }
                ]
            },
            { 
                id: 'EMP004', 
                name: 'Rahul Kumawat', 
                email: 'rahulkumawat77@company.com',
                phone: '8956485652',
                department: 'HR', 
                position: 'HR Manager', 
                salary: 70000,
                joinDate: '2023-01-05',
                location: 'Hyderabad',
                experience: 8,
                skills: ['Recruitment', 'Employee Relations', 'HR Policies', 'Training'],
                status: 'active', 
                score: 95,
                documents: [
                    { name: 'Resume.pdf', type: 'resume', uploadDate: '2023-01-02' },
                    { name: 'Offer_Letter.pdf', type: 'offer', uploadDate: '2023-01-04' }
                ],
                history: [
                    { type: 'joining', date: '2023-01-05', title: 'Joined Company', description: 'Started as HR Manager' },
                    { type: 'training', date: '2023-08-10', title: 'Advanced HR Training', description: 'Completed advanced HR management training' }
                ]
            },
            { 
                id: 'EMP005', 
                name: 'Ravi Kumawat', 
                email: 'ravi1101@company.com',
                phone: '8956584578',
                department: 'Engineering', 
                position: 'DevOps Engineer', 
                salary: 90000,
                joinDate: '2023-04-15',
                location: 'Chennai',
                experience: 6,
                skills: ['AWS', 'Docker', 'Kubernetes', 'CI/CD', 'Linux'],
                status: 'active', 
                score: 89,
                documents: [
                    { name: 'Resume.pdf', type: 'resume', uploadDate: '2023-04-10' },
                    { name: 'Offer_Letter.pdf', type: 'offer', uploadDate: '2023-04-12' },
                    { name: 'AWS_Certification.pdf', type: 'certificate', uploadDate: '2023-05-20' }
                ],
                history: [
                    { type: 'joining', date: '2023-04-15', title: 'Joined Company', description: 'Started as DevOps Engineer' },
                    { type: 'certification', date: '2023-05-20', title: 'AWS Certified', description: 'Completed AWS Solutions Architect certification' }
                ]
            }
        ];
    }

    // Advanced search functionality
    searchEmployees(query) {
        if (!query) return [];
        
        const searchTerms = query.toLowerCase().split(' ');
        return this.employees.filter(employee => {
            const searchableText = `
                ${employee.name} ${employee.department} ${employee.position} 
                ${employee.location} ${employee.skills.join(' ')} ${employee.email}
            `.toLowerCase();
            
            return searchTerms.every(term => searchableText.includes(term));
        });
    }

    // Filter employees based on multiple criteria
    filterEmployees() {
        return this.employees.filter(employee => {
            return (
                (!this.filters.department || employee.department === this.filters.department) &&
                (!this.filters.position || employee.position.toLowerCase().includes(this.filters.position.toLowerCase())) &&
                (!this.filters.location || employee.location === this.filters.location) &&
                (!this.filters.skills || this.filters.skills.split(',').some(skill => 
                    employee.skills.some(empSkill => 
                        empSkill.toLowerCase().includes(skill.trim().toLowerCase())
                    )
                )) &&
                (!this.filters.status || employee.status === this.filters.status) &&
                this.filterByExperience(employee.experience)
            );
        });
    }

    filterByExperience(experience) {
        if (!this.filters.experience) return true;
        
        switch(this.filters.experience) {
            case '0-2': return experience >= 0 && experience <= 2;
            case '2-5': return experience > 2 && experience <= 5;
            case '5-10': return experience > 5 && experience <= 10;
            case '10+': return experience > 10;
            default: return true;
        }
    }

    // Get employee statistics
    getStatistics() {
        const total = this.employees.length;
        const active = this.employees.filter(emp => emp.status === 'active').length;
        const engineering = this.employees.filter(emp => emp.department === 'Engineering').length;
        const avgExperience = this.employees.reduce((sum, emp) => sum + emp.experience, 0) / total;
        
        return {
            total,
            active,
            engineering,
            avgExperience: avgExperience.toFixed(1)
        };
    }

    // Generate organization chart data
    generateOrgChart() {
        return {
            name: "CEO - Ravi kumawat",
            position: "Chief Executive Officer",
            type: "ceo",
            children: [
                {
                    name: "CTO -  Lucky kumawat",
                    position: "Chief Technology Officer",
                    type: "manager",
                    children: [
                        {
                            name: "Ram Kumawat",
                            position: "Senior Developer",
                            type: "team-lead",
                            children: [
                                { name: "Ravi Kumawat", position: "DevOps Engineer", type: "employee" },
                                { name: "Anjali Singh", position: "Frontend Developer", type: "employee" },
                                { name: "Vikram Patel", position: "Backend Developer", type: "employee" }
                            ]
                        }
                    ]
                },
                {
                    name: "Sales Director - Rohit kumawat",
                    position: "Sales Director",
                    type: "manager",
                    children: [
                        { name: "Lucky Kumawat", position: "Sales Manager", type: "team-lead" },
                        { name: "Neha Gupta", position: "Sales Executive", type: "employee" }
                    ]
                },
                {
                    name: "HR Head - Sneha Reddy",
                    position: "HR Head",
                    type: "manager",
                    children: [
                        { name: "Rahul Kumawat", position: "HR Manager", type: "employee" }
                    ]
                }
            ]
        };
    }
}

// Global instance
let employeeDB = null;

// Initialize Employee Database
function initEmployeeDatabase() {
    if (!employeeDB) {
        employeeDB = new AdvancedEmployeeDatabase();
    }
    renderEmployeeDatabase();
    updateEmployeeStats();
}

// Render employee database table
function renderEmployeeDatabase(filteredEmployees = null) {
    const employeesToRender = filteredEmployees || employeeDB.employees;
    const table = document.getElementById('employeeDatabaseTable');
    
    table.innerHTML = '';
    
    employeesToRender.forEach(emp => {
        const row = document.createElement('tr');
        row.innerHTML = `
            <td>${emp.id}</td>
            <td>
                <strong>${emp.name}</strong>
                <div style="font-size: 0.8rem; color: var(--text-secondary);">${emp.email}</div>
            </td>
            <td>${emp.department}</td>
            <td>${emp.position}</td>
            <td>${emp.location}</td>
            <td>${emp.experience} years</td>
            <td>
                <div style="display: flex; flex-wrap: wrap; gap: 4px;">
                    ${emp.skills.map(skill => 
                        `<span style="background: var(--primary); color: white; padding: 2px 6px; border-radius: 10px; font-size: 0.7rem;">${skill}</span>`
                    ).join('')}
                </div>
            </td>
            <td><span class="status-badge status-${emp.status}">${emp.status}</span></td>
            <td class="action-buttons">
                <button class="btn btn-primary btn-sm" onclick="viewEmployeeProfile('${emp.id}')">👁️ View</button>
                <button class="btn btn-success btn-sm" onclick="editEmployee('${emp.id}')">✏️ Edit</button>
            </td>
        `;
        table.appendChild(row);
    });
}

// Update employee statistics
function updateEmployeeStats() {
    const stats = employeeDB.getStatistics();
    
    document.getElementById('totalEmployees').textContent = stats.total;
    document.getElementById('activeEmployees').textContent = stats.active;
    document.getElementById('engineeringCount').textContent = stats.engineering;
    document.getElementById('avgExperience').textContent = stats.avgExperience;
}

// Advanced search functionality
function searchEmployeeDatabase() {
    const query = document.getElementById('searchEmployeeDatabase').value;
    const resultsContainer = document.getElementById('searchResults');
    
    if (query.length < 2) {
        resultsContainer.style.display = 'none';
        renderEmployeeDatabase();
        return;
    }
    
    const results = employeeDB.searchEmployees(query);
    resultsContainer.innerHTML = '';
    
    if (results.length === 0) {
        resultsContainer.innerHTML = '<div class="search-result-item">No employees found</div>';
    } else {
        results.slice(0, 5).forEach(emp => {
            const item = document.createElement('div');
            item.className = 'search-result-item';
            item.innerHTML = `
                <strong>${emp.name}</strong> - ${emp.position}<br>
                <small>${emp.department} • ${emp.location}</small>
            `;
            item.onclick = () => {
                document.getElementById('searchEmployeeDatabase').value = emp.name;
                resultsContainer.style.display = 'none';
                const filtered = employeeDB.searchEmployees(emp.name);
                renderEmployeeDatabase(filtered);
            };
            resultsContainer.appendChild(item);
        });
    }
    
    resultsContainer.style.display = 'block';
}

// Apply advanced filters
function applyFilters() {
    employeeDB.filters = {
        department: document.getElementById('filterDepartment').value,
        position: document.getElementById('filterPosition').value,
        location: document.getElementById('filterLocation').value,
        skills: document.getElementById('filterSkills').value,
        experience: document.getElementById('filterExperience').value,
        status: document.getElementById('filterStatus').value
    };
    
    const filteredEmployees = employeeDB.filterEmployees();
    renderEmployeeDatabase(filteredEmployees);
}

// Clear all filters
function clearFilters() {
    document.getElementById('filterDepartment').value = '';
    document.getElementById('filterPosition').value = '';
    document.getElementById('filterLocation').value = '';
    document.getElementById('filterSkills').value = '';
    document.getElementById('filterExperience').value = '';
    document.getElementById('filterStatus').value = '';
    
    employeeDB.filters = {
        department: '',
        position: '',
        location: '',
        skills: '',
        experience: '',
        status: ''
    };
    
    renderEmployeeDatabase();
}

// Show advanced search panel
function showAdvancedSearch() {
    const filtersPanel = document.getElementById('advancedFilters');
    if (filtersPanel.style.display === 'none') {
        filtersPanel.style.display = 'block';
        filtersPanel.scrollIntoView({ behavior: 'smooth' });
    } else {
        filtersPanel.style.display = 'none';
    }
}

// View detailed employee profile
function viewEmployeeProfile(employeeId) {
    const employee = employeeDB.employees.find(emp => emp.id === employeeId);
    if (!employee) return;
    
    const modalContent = document.getElementById('employeeProfileContent');
    
    modalContent.innerHTML = `
        <div class="profile-header">
            <div class="profile-avatar">
                ${employee.name.split(' ').map(n => n[0]).join('')}
            </div>
            <div class="profile-basic-info">
                <h2>${employee.name}</h2>
                <p>${employee.position} • ${employee.department}</p>
                <p>Employee ID: ${employee.id} | Location: ${employee.location}</p>
                <p>Experience: ${employee.experience} years | Status: 
                    <span class="status-badge status-${employee.status}">${employee.status}</span>
                </p>
            </div>
        </div>
        
        <!-- Basic Info Tab -->
        <div id="profile-basic" class="profile-content active">
            <div class="profile-grid">
                <div class="info-card">
                    <h4>📧 Contact Information</h4>
                    <div class="info-item">
                        <span class="info-label">Email:</span>
                        <span class="info-value">${employee.email}</span>
                    </div>
                    <div class="info-item">
                        <span class="info-label">Phone:</span>
                        <span class="info-value">${employee.phone}</span>
                    </div>
                    <div class="info-item">
                        <span class="info-label">Location:</span>
                        <span class="info-value">${employee.location}</span>
                    </div>
                </div>
                
                <div class="info-card">
                    <h4>💼 Professional Details</h4>
                    <div class="info-item">
                        <span class="info-label">Department:</span>
                        <span class="info-value">${employee.department}</span>
                    </div>
                    <div class="info-item">
                        <span class="info-label">Position:</span>
                        <span class="info-value">${employee.position}</span>
                    </div>
                    <div class="info-item">
                        <span class="info-label">Join Date:</span>
                        <span class="info-value">${formatDate(employee.joinDate)}</span>
                    </div>
                    <div class="info-item">
                        <span class="info-label">Experience:</span>
                        <span class="info-value">${employee.experience} years</span>
                    </div>
                </div>
                
                <div class="info-card">
                    <h4>💰 Compensation</h4>
                    <div class="info-item">
                        <span class="info-label">Salary:</span>
                        <span class="info-value">$${employee.salary.toLocaleString()}</span>
                    </div>
                    <div class="info-item">
                        <span class="info-label">AI Score:</span>
                        <span class="info-value">${employee.score}%</span>
                    </div>
                </div>
                
                <div class="info-card">
                    <h4>🛠️ Skills & Expertise</h4>
                    <div style="display: flex; flex-wrap: wrap; gap: 8px; margin-top: 10px;">
                        ${employee.skills.map(skill => 
                            `<span style="background: var(--primary); color: white; padding: 6px 12px; border-radius: 15px; font-size: 0.8rem;">${skill}</span>`
                        ).join('')}
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Professional Tab -->
        <div id="profile-professional" class="profile-content">
            <div class="profile-grid">
                <div class="info-card">
                    <h4>📊 Performance Metrics</h4>
                    <div class="info-item">
                        <span class="info-label">Productivity Score:</span>
                        <span class="info-value">${employee.score}%</span>
                    </div>
                    <div class="info-item">
                        <span class="info-label">Projects Completed:</span>
                        <span class="info-value">${Math.floor(Math.random() * 20) + 5}</span>
                    </div>
                    <div class="info-item">
                        <span class="info-label">Attendance Rate:</span>
                        <span class="info-value">${Math.floor(Math.random() * 10) + 90}%</span>
                    </div>
                </div>
                
                <div class="info-card">
                    <h4>🎯 Current Projects</h4>
                    <div class="info-item">
                        <span class="info-label">Active Projects:</span>
                        <span class="info-value">${Math.floor(Math.random() * 3) + 1}</span>
                    </div>
                    <div style="margin-top: 15px;">
                        <div style="background: var(--success); color: white; padding: 8px 12px; border-radius: 8px; margin-bottom: 8px;">
                            <strong>Website Redesign</strong> - 75% Complete
                        </div>
                        <div style="background: var(--warning); color: var(--dark); padding: 8px 12px; border-radius: 8px;">
                            <strong>Mobile App Development</strong> - 45% Complete
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Documents Tab -->
        <div id="profile-documents" class="profile-content">
            <h4>📁 Employee Documents</h4>
            <div class="documents-grid">
                ${employee.documents.map(doc => `
                    <div class="document-card" onclick="downloadDocument('${employee.id}', '${doc.name}')">
                        <div class="document-icon">
                            ${getDocumentIcon(doc.type)}
                        </div>
                        <div style="font-weight: 600; margin-bottom: 5px;">${doc.name}</div>
                        <div style="font-size: 0.8rem; color: var(--text-secondary);">
                            ${formatDate(doc.uploadDate)}
                        </div>
                    </div>
                `).join('')}
                
                <div class="document-card" onclick="uploadNewDocument('${employee.id}')" style="border: 2px dashed var(--border-color); background: transparent;">
                    <div class="document-icon">📤</div>
                    <div style="font-weight: 600;">Upload New Document</div>
                </div>
            </div>
        </div>
        
        <!-- History Tab -->
        <div id="profile-history" class="profile-content">
            <h4>📅 Employee History</h4>
            <div class="timeline">
                ${employee.history.map(event => `
                    <div class="timeline-item">
                        <div class="timeline-date">${formatDate(event.date)}</div>
                        <div class="timeline-title">${event.title}</div>
                        <div class="timeline-description">${event.description}</div>
                    </div>
                `).join('')}
            </div>
        </div>
    `;
    
    document.getElementById('employeeProfileModal').style.display = 'flex';
}

// Switch between profile tabs
function switchProfileTab(tabName) {
    // Hide all tabs
    document.querySelectorAll('.profile-content').forEach(tab => {
        tab.classList.remove('active');
    });
    
    // Remove active class from all tab buttons
    document.querySelectorAll('.profile-tab').forEach(tab => {
        tab.classList.remove('active');
    });
    
    // Show selected tab
    document.getElementById(`profile-${tabName}`).classList.add('active');
    event.currentTarget.classList.add('active');
}

// Get document icon based on type
function getDocumentIcon(type) {
    const icons = {
        'resume': '📄',
        'offer': '📝',
        'id': '🆔',
        'certificate': '🏆',
        'other': '📎'
    };
    return icons[type] || icons['other'];
}

// Show organization chart
function showOrganizationChart() {
    const orgData = employeeDB.generateOrgChart();
    const container = document.getElementById('orgChartContainer');
    
    container.innerHTML = generateOrgChartHTML(orgData);
    document.getElementById('organizationChartModal').style.display = 'flex';
}

// Generate organization chart HTML recursively
function generateOrgChartHTML(node, level = 0) {
    let html = `
        <div class="org-node ${node.type}" onclick="selectOrgNode('${node.name}')">
            <div class="node-name">${node.name}</div>
            <div class="node-position">${node.position}</div>
        </div>
    `;
    
    if (node.children && node.children.length > 0) {
        html += `<div class="org-children">`;
        node.children.forEach(child => {
            html += generateOrgChartHTML(child, level + 1);
        });
        html += `</div>`;
    }
    
    return html;
}

// Select organization node
function selectOrgNode(employeeName) {
    const employee = employeeDB.employees.find(emp => emp.name === employeeName);
    if (employee) {
        closeModal('organizationChartModal');
        viewEmployeeProfile(employee.id);
    } else {
        showNotification(`Profile for ${employeeName} not found in database`, 'error');
    }
}

// Export employee data
function exportEmployeeData(format) {
    const employees = employeeDB.employees;
    let content, mimeType, filename;
    
    if (format === 'pdf') {
        // For PDF, we'll create a simple text representation
        content = 'EMPLOYEE DATABASE REPORT\n\n';
        employees.forEach(emp => {
            content += `ID: ${emp.id}\n`;
            content += `Name: ${emp.name}\n`;
            content += `Department: ${emp.department}\n`;
            content += `Position: ${emp.position}\n`;
            content += `Location: ${emp.location}\n`;
            content += `Experience: ${emp.experience} years\n`;
            content += `Status: ${emp.status}\n`;
            content += '------------------------\n';
        });
        mimeType = 'text/plain';
        filename = 'employee_report.txt';
    } else if (format === 'excel') {
        // For Excel, create CSV
        content = 'ID,Name,Email,Department,Position,Location,Experience,Status\n';
        employees.forEach(emp => {
            content += `"${emp.id}","${emp.name}","${emp.email}","${emp.department}","${emp.position}","${emp.location}","${emp.experience}","${emp.status}"\n`;
        });
        mimeType = 'text/csv';
        filename = 'employee_database.csv';
    }
    
    const blob = new Blob([content], { type: mimeType });
    const url = URL.createObjectURL(blob);
    const a = document.createElement('a');
    a.href = url;
    a.download = filename;
    document.body.appendChild(a);
    a.click();
    document.body.removeChild(a);
    URL.revokeObjectURL(url);
    
    showNotification(`Employee data exported as ${format.toUpperCase()} successfully!`);
}

// Download document (simulated)
function downloadDocument(employeeId, documentName) {
    showNotification(`Downloading ${documentName}...`, 'info');
    // In a real application, this would trigger actual file download
    setTimeout(() => {
        showNotification(`${documentName} downloaded successfully!`);
    }, 1500);
}

// Upload new document (simulated)
function uploadNewDocument(employeeId) {
    showNotification('Document upload feature would open file selector in real implementation', 'info');
}

// Add Employee Database to navigation
function addEmployeeDatabaseTab() {
    const navTabs = document.querySelector('.nav-tabs');
    
    if (document.querySelector('.nav-tab[onclick*="employeeDatabase"]')) {
        return;
    }
    
    const dbTab = document.createElement('div');
    dbTab.className = 'nav-tab';
    dbTab.innerHTML = '🗃️ Employee DB';
    dbTab.setAttribute('onclick', "switchTab('employeeDatabase')");
    
    // Add after Analytics tab
    const analyticsTab = document.querySelector('.nav-tab[onclick*="analytics"]');
    if (analyticsTab) {
        analyticsTab.parentNode.insertBefore(dbTab, analyticsTab.nextSibling);
    } else {
        navTabs.appendChild(dbTab);
    }
}

// Initialize when page loads
document.addEventListener('DOMContentLoaded', function() {
    addEmployeeDatabaseTab();
    
    // Update switchTab function
    const  originalswitchtab = window.switchTab;
    window.switchTab = function(tabName) {
        if ( originalswitchtab) {
             originalswitchtab(tabName);
        }
        
        if (tabName === 'employeeDatabase') {
            setTimeout(() => {
                initEmployeeDatabase();
            }, 100);
        }
    };
});

// Close search results when clicking outside
document.addEventListener('click', function(e) {
    if (!e.target.closest('.advanced-search')) {
        document.getElementById('searchResults').style.display = 'none';
    }
});

// Format date utility function
function formatDate(dateString) {
    const options = { year: 'numeric', month: 'short', day: 'numeric' };
    return new Date(dateString).toLocaleDateString(undefined, options);
}

// Show notification utility function
function showNotification(message, type = 'success') {
    // Use your existing notification system
    alert(`${type === 'error' ? '❌' : '✅'} ${message}`);
}

// Close modal utility function
function closeModal(modalId) {
    document.getElementById(modalId).style.display = 'none';
}
// Remote Workforce Management System
class RemoteWorkforceManager {
    constructor() {
        this.tasks = this.loadTasks();
        this.teamMembers = this.loadTeamMembers();
        this.timeEntries = this.loadTimeEntries();
        this.chatMessages = this.loadChatMessages();
        this.currentUser = 'EMP001'; // Assuming current user is Ram Kumawat
    }

    loadTasks() {
        return [
            {
                id: 'TASK001',
                title: 'Design Homepage',
                description: 'Create new homepage design with modern UI',
                assignee: 'EMP001',
                assigner: 'EMP004',
                priority: 'high',
                status: 'in-progress',
                dueDate: '2024-02-15',
                estimatedHours: 8,
                actualHours: 6,
                progress: 75,
                project: 'Website Redesign',
                createdAt: new Date('2024-01-20')
            },
            {
                id: 'TASK002',
                title: 'API Integration',
                description: 'Integrate payment gateway API',
                assignee: 'EMP005',
                assigner: 'EMP004',
                priority: 'medium',
                status: 'not-started',
                dueDate: '2024-02-20',
                estimatedHours: 16,
                actualHours: 0,
                progress: 0,
                project: 'Mobile App',
                createdAt: new Date('2024-01-22')
            },
            {
                id: 'TASK003',
                title: 'Database Optimization',
                description: 'Optimize database queries for better performance',
                assignee: 'EMP001',
                assigner: 'EMP004',
                priority: 'high',
                status: 'completed',
                dueDate: '2024-02-10',
                estimatedHours: 12,
                actualHours: 10,
                progress: 100,
                project: 'System Upgrade',
                createdAt: new Date('2024-01-15')
            }
        ];
    }

    loadTeamMembers() {
        return [
            {
                id: 'EMP001',
                name: 'Ram Kumawat',
                position: 'Senior Developer',
                status: 'online',
                lastActive: new Date(),
                avatar: 'RK'
            },
            {
                id: 'EMP002',
                name: 'Lucky Kumawat',
                position: 'Sales Manager',
                status: 'online',
                lastActive: new Date(Date.now() - 300000), // 5 minutes ago
                avatar: 'LK'
            },
            {
                id: 'EMP003',
                name: 'Rohit Kumawat',
                position: 'Marketing Specialist',
                status: 'away',
                lastActive: new Date(Date.now() - 1800000), // 30 minutes ago
                avatar: 'RK'
            },
            {
                id: 'EMP004',
                name: 'Rahul Kumawat',
                position: 'HR Manager',
                status: 'online',
                lastActive: new Date(),
                avatar: 'RK'
            },
            {
                id: 'EMP005',
                name: 'Ravi Kumawat',
                position: 'DevOps Engineer',
                status: 'offline',
                lastActive: new Date(Date.now() - 3600000), // 1 hour ago
                avatar: 'RK'
            }
        ];
    }

    loadTimeEntries() {
        return [
            { taskId: 'TASK001', employeeId: 'EMP001', date: '2024-01-25', hours: 4, description: 'Homepage design work' },
            { taskId: 'TASK001', employeeId: 'EMP001', date: '2024-01-26', hours: 2, description: 'UI improvements' },
            { taskId: 'TASK003', employeeId: 'EMP001', date: '2024-01-20', hours: 6, description: 'Query optimization' },
            { taskId: 'TASK003', employeeId: 'EMP001', date: '2024-01-21', hours: 4, description: 'Performance testing' }
        ];
    }

    loadChatMessages() {
        return {
            general: [
                {
                    id: 'MSG001',
                    sender: 'EMP004',
                    senderName: 'Rahul Kumawat',
                    content: 'Good morning team! Any updates on the website redesign?',
                    timestamp: new Date('2024-01-26T09:30:00'),
                    channel: 'general'
                },
                {
                    id: 'MSG002',
                    sender: 'EMP001',
                    senderName: 'Ram Kumawat',
                    content: 'Working on the homepage design. Should have mockups ready by EOD.',
                    timestamp: new Date('2024-01-26T09:32:00'),
                    channel: 'general'
                },
                {
                    id: 'MSG003',
                    sender: 'EMP002',
                    senderName: 'Lucky Kumawat',
                    content: 'Sales team meeting at 2 PM today. Please join if available.',
                    timestamp: new Date('2024-01-26T10:15:00'),
                    channel: 'general'
                }
            ],
            projects: [
                {
                    id: 'MSG004',
                    sender: 'EMP001',
                    senderName: 'Ram Kumawat',
                    content: 'Started working on the mobile app API integration.',
                    timestamp: new Date('2024-01-25T14:20:00'),
                    channel: 'projects'
                }
            ],
            random: [
                {
                    id: 'MSG005',
                    sender: 'EMP005',
                    senderName: 'Ravi Kumawat',
                    content: 'Anyone tried the new coffee machine?',
                    timestamp: new Date('2024-01-25T11:45:00'),
                    channel: 'random'
                }
            ]
        };
    }

    // Task Management
    assignTask(taskData) {
        const newTask = {
            id: 'TASK' + Date.now(),
            ...taskData,
            status: 'not-started',
            progress: 0,
            actualHours: 0,
            createdAt: new Date()
        };
        
        this.tasks.push(newTask);
        this.saveData();
        return newTask;
    }

    updateTaskProgress(taskId, progress, hoursWorked = 0) {
        const task = this.tasks.find(t => t.id === taskId);
        if (task) {
            task.progress = progress;
            if (hoursWorked > 0) {
                task.actualHours += hoursWorked;
            }
            if (progress === 100) {
                task.status = 'completed';
            } else if (progress > 0) {
                task.status = 'in-progress';
            }
            this.saveData();
        }
    }

    // Time Tracking
    logTimeEntry(entryData) {
        const newEntry = {
            ...entryData,
            id: 'TIME' + Date.now()
        };
        
        this.timeEntries.push(newEntry);
        
        // Update task hours
        const task = this.tasks.find(t => t.id === entryData.taskId);
        if (task) {
            task.actualHours += entryData.hours;
            this.updateTaskProgress(task.id, Math.min(100, (task.actualHours / task.estimatedHours) * 100));
        }
        
        this.saveData();
        return newEntry;
    }

    getWeeklyTimeData() {
        const oneWeekAgo = new Date();
        oneWeekAgo.setDate(oneWeekAgo.getDate() - 7);
        
        const weeklyData = {};
        for (let i = 0; i < 7; i++) {
            const date = new Date();
            date.setDate(date.getDate() - i);
            const dateStr = date.toISOString().split('T')[0];
            weeklyData[dateStr] = 0;
        }
        
        this.timeEntries.forEach(entry => {
            if (new Date(entry.date) >= oneWeekAgo) {
                weeklyData[entry.date] = (weeklyData[entry.date] || 0) + entry.hours;
            }
        });
        
        return weeklyData;
    }

    // Chat System
    sendMessage(channel, content) {
        const message = {
            id: 'MSG' + Date.now(),
            sender: this.currentUser,
            senderName: this.getCurrentUser().name,
            content: content,
            timestamp: new Date(),
            channel: channel
        };
        
        if (!this.chatMessages[channel]) {
            this.chatMessages[channel] = [];
        }
        
        this.chatMessages[channel].push(message);
        this.saveData();
        return message;
    }

    getCurrentUser() {
        return this.teamMembers.find(member => member.id === this.currentUser);
    }

    // Utility methods
    saveData() {
        // In a real application, this would save to a backend
        localStorage.setItem('remoteWorkforceData', JSON.stringify({
            tasks: this.tasks,
            timeEntries: this.timeEntries,
            chatMessages: this.chatMessages
        }));
    }

    getOnlineUsers() {
        const fiveMinutesAgo = new Date(Date.now() - 300000);
        return this.teamMembers.filter(member => 
            member.status === 'online' || new Date(member.lastActive) > fiveMinutesAgo
        );
    }
}

// Global instance
let remoteManager = null;

// Initialize Remote Workforce Management
function initRemoteWorkforce() {
    if (!remoteManager) {
        remoteManager = new RemoteWorkforceManager();
    }
    renderRemoteWorkforceDashboard();
    initializeTimeTrackingChart();
}

// Render Dashboard
function renderRemoteWorkforceDashboard() {
    renderRemoteStats();
    renderTasks();
    renderTeamMembers();
}

// Render Remote Stats
function renderRemoteStats() {
    const onlineUsers = remoteManager.getOnlineUsers().length;
    const totalTasks = remoteManager.tasks.length;
    const completedTasks = remoteManager.tasks.filter(task => task.status === 'completed').length;
    const activeProjects = [...new Set(remoteManager.tasks.map(task => task.project))].length;
    
    document.getElementById('remoteEmployees').textContent = onlineUsers;
    document.getElementById('tasksCompleted').textContent = completedTasks;
    document.getElementById('activeProjects').textContent = activeProjects;
    
    // Calculate average productivity (simplified)
    const totalProgress = remoteManager.tasks.reduce((sum, task) => sum + task.progress, 0);
    const avgProductivity = totalTasks > 0 ? Math.round(totalProgress / totalTasks) : 0;
    document.getElementById('avgProductivity').textContent = avgProductivity + '%';
}

// Render Tasks
function renderTasks() {
    const container = document.getElementById('remoteTasksContainer');
    const userTasks = remoteManager.tasks.filter(task => 
        task.assignee === remoteManager.currentUser
    ).slice(0, 4); // Show only 4 tasks
    
    container.innerHTML = '';
    
    userTasks.forEach(task => {
        const taskElement = document.createElement('div');
        taskElement.className = `task-card ${task.priority}-priority`;
        taskElement.innerHTML = `
            <div class="task-header">
                <div class="task-title">${task.title}</div>
                <span class="task-priority priority-${task.priority}">${task.priority}</span>
            </div>
            <div class="task-meta">
                <span>Due: ${formatDate(task.dueDate)}</span>
                <span>${task.actualHours}h / ${task.estimatedHours}h</span>
            </div>
            <div class="task-progress">
                <div class="task-progress-bar" style="width: ${task.progress}%"></div>
            </div>
            <div class="task-actions">
                <button class="btn btn-sm btn-primary" onclick="updateTaskProgress('${task.id}', ${Math.min(100, task.progress + 25)})">
                    Update Progress
                </button>
                <button class="btn btn-sm btn-success" onclick="showTimeTrackingForTask('${task.id}')">
                    Log Time
                </button>
            </div>
        `;
        container.appendChild(taskElement);
    });
}

// Render Team Members
function renderTeamMembers() {
    const container = document.getElementById('teamMembersList');
    const onlineCount = document.getElementById('onlineCount');
    
    const onlineUsers = remoteManager.getOnlineUsers();
    onlineCount.textContent = onlineUsers.length + ' online';
    
    container.innerHTML = '';
    
    remoteManager.teamMembers.forEach(member => {
        const isOnline = onlineUsers.some(online => online.id === member.id);
        const memberElement = document.createElement('div');
        memberElement.className = 'team-member-card';
        memberElement.innerHTML = `
            <div class="member-avatar">${member.avatar}</div>
            <div class="member-info">
                <div class="member-name">${member.name}</div>
                <div class="member-status ${isOnline ? 'status-online' : 'status-offline'}">
                    ${isOnline ? 'Online' : 'Offline'} • ${member.position}
                </div>
            </div>
        `;
        container.appendChild(memberElement);
    });
}

// Initialize Time Tracking Chart
function initializeTimeTrackingChart() {
    const ctx = document.getElementById('timeTrackingChart').getContext('2d');
    const timeData = remoteManager.getWeeklyTimeData();
    
    const dates = Object.keys(timeData).sort();
    const hours = dates.map(date => timeData[date]);
    
    // Calculate total hours
    const totalHours = hours.reduce((sum, hour) => sum + hour, 0);
    document.getElementById('totalHours').textContent = 'Total: ' + totalHours + 'h';
    
    new Chart(ctx, {
        type: 'bar',
        data: {
            labels: dates.map(date => formatDate(date, 'short')),
            datasets: [{
                label: 'Hours Worked',
                data: hours,
                backgroundColor: '#3a86ff',
                borderColor: '#3a86ff',
                borderWidth: 1
            }]
        },
        options: {
            responsive: true,
            maintainAspectRatio: false,
            scales: {
                y: {
                    beginAtZero: true,
                    title: {
                        display: true,
                        text: 'Hours'
                    }
                },
                x: {
                    title: {
                        display: true,
                        text: 'Date'
                    }
                }
            }
        }
    });
}

// Modal Functions
function showTaskAssignmentModal() {
    const assigneeSelect = document.getElementById('taskAssignee');
    const projectSelect = document.getElementById('taskProject');
    
    // Populate assignee dropdown
    assigneeSelect.innerHTML = '<option value="">Select Employee</option>';
    remoteManager.teamMembers.forEach(member => {
        const option = document.createElement('option');
        option.value = member.id;
        option.textContent = member.name;
        assigneeSelect.appendChild(option);
    });
    
    // Populate project dropdown
    projectSelect.innerHTML = '<option value="">Select Project</option>';
    const projects = [...new Set(remoteManager.tasks.map(task => task.project))];
    projects.forEach(project => {
        const option = document.createElement('option');
        option.value = project;
        option.textContent = project;
        projectSelect.appendChild(option);
    });
    
    // Set default due date to 7 days from now
    const nextWeek = new Date();
    nextWeek.setDate(nextWeek.getDate() + 7);
    document.getElementById('taskDueDate').value = nextWeek.toISOString().split('T')[0];
    
    document.getElementById('taskAssignmentModal').style.display = 'flex';
}

function assignTask(event) {
    event.preventDefault();
    
    const taskData = {
        title: document.getElementById('taskTitle').value,
        description: document.getElementById('taskDescription').value,
        assignee: document.getElementById('taskAssignee').value,
        priority: document.getElementById('taskPriority').value,
        dueDate: document.getElementById('taskDueDate').value,
        estimatedHours: parseInt(document.getElementById('taskEstimatedHours').value) || 8,
        project: document.getElementById('taskProject').value,
        assigner: remoteManager.currentUser
    };
    
    remoteManager.assignTask(taskData);
    renderRemoteWorkforceDashboard();
    closeModal('taskAssignmentModal');
    showNotification('Task assigned successfully!');
    
    // Reset form
    document.getElementById('taskAssignmentForm').reset();
}

function showTimeTrackingModal() {
    const taskSelect = document.getElementById('timeTask');
    
    // Populate task dropdown with user's tasks
    taskSelect.innerHTML = '<option value="">Select Task</option>';
    const userTasks = remoteManager.tasks.filter(task => task.assignee === remoteManager.currentUser);
    userTasks.forEach(task => {
        const option = document.createElement('option');
        option.value = task.id;
        option.textContent = task.title;
        taskSelect.appendChild(option);
    });
    
    // Set default date to today
    document.getElementById('workDate').value = new Date().toISOString().split('T')[0];
    
    document.getElementById('timeTrackingModal').style.display = 'flex';
}

function showTimeTrackingForTask(taskId) {
    showTimeTrackingModal();
    document.getElementById('timeTask').value = taskId;
}

function logWorkTime(event) {
    event.preventDefault();
    
    const timeData = {
        taskId: document.getElementById('timeTask').value,
        employeeId: remoteManager.currentUser,
        date: document.getElementById('workDate').value,
        hours: parseFloat(document.getElementById('workHours').value),
        description: document.getElementById('workDescription').value
    };
    
    remoteManager.logTimeEntry(timeData);
    renderRemoteWorkforceDashboard();
    closeModal('timeTrackingModal');
    showNotification('Work time logged successfully!');
    
    // Reset form
    document.getElementById('timeTrackingForm').reset();
}

function updateTaskProgress(taskId, progress) {
    remoteManager.updateTaskProgress(taskId, progress);
    renderRemoteWorkforceDashboard();
    showNotification('Task progress updated!');
}

// Chat System
function openTeamChat() {
    renderChatInterface();
    document.getElementById('teamChatModal').style.display = 'flex';
}

function renderChatInterface() {
    renderOnlineUsers();
    renderChatMessages('general');
}

function renderOnlineUsers() {
    const container = document.getElementById('onlineUsersList');
    const onlineCount = document.getElementById('chatOnlineCount');
    
    const onlineUsers = remoteManager.getOnlineUsers();
    onlineCount.textContent = onlineUsers.length + ' online';
    
    container.innerHTML = '';
    
    onlineUsers.forEach(user => {
        const userElement = document.createElement('div');
        userElement.className = 'online-user';
        userElement.innerHTML = `
            <div class="user-status ${user.status === 'away' ? 'away' : ''}"></div>
            <div class="user-name">${user.name}</div>
        `;
        container.appendChild(userElement);
    });
}

function renderChatMessages(channel) {
    const container = document.getElementById('chatMessages');
    const messages = remoteManager.chatMessages[channel] || [];
    
    container.innerHTML = '';
    
    messages.forEach(message => {
        const messageElement = document.createElement('div');
        messageElement.className = `message ${message.sender === remoteManager.currentUser ? 'own' : ''}`;
        messageElement.innerHTML = `
            <div class="message-header">
                <span class="message-sender">${message.senderName}</span>
                <span class="message-time">${formatTime(message.timestamp)}</span>
            </div>
            <div class="message-content">${message.content}</div>
        `;
        container.appendChild(messageElement);
    });
    
    // Scroll to bottom
    container.scrollTop = container.scrollHeight;
    
    // Update active channel
    document.querySelectorAll('.channel').forEach(ch => ch.classList.remove('active'));
    document.querySelector(`.channel[onclick="switchChannel('${channel}')"]`).classList.add('active');
}

function switchChannel(channel) {
    renderChatMessages(channel);
}

function sendMessage() {
    const input = document.getElementById('chatInput');
    const content = input.value.trim();
    
    if (content) {
        const activeChannel = document.querySelector('.channel.active').textContent.replace('# ', '');
        remoteManager.sendMessage(activeChannel, content);
        renderChatMessages(activeChannel);
        input.value = '';
    }
}

// Video Call System
function startVirtualMeeting() {
    showNotification('Starting virtual meeting...', 'info');
    setTimeout(() => {
        document.getElementById('videoCallModal').style.display = 'flex';
        renderVideoCallParticipants();
    }, 1000);
}

function renderVideoCallParticipants() {
    const container = document.getElementById('videoGrid');
    const participantsList = document.getElementById('callParticipantsList');
    
    const onlineUsers = remoteManager.getOnlineUsers();
    
    // Clear existing participants (except local)
    const localParticipant = container.querySelector('.local');
    container.innerHTML = '';
    container.appendChild(localParticipant);
    
    participantsList.innerHTML = '';
    
    // Add other participants
    onlineUsers.forEach(user => {
        if (user.id !== remoteManager.currentUser) {
            const participantElement = document.createElement('div');
            participantElement.className = 'video-participant';
            participantElement.innerHTML = `
                <div class="video-placeholder">
                    <div class="user-avatar">${user.avatar}</div>
                    <div class="user-name">${user.name}</div>
                </div>
                <div class="participant-status">🔴 Live</div>
            `;
            container.appendChild(participantElement);
            
            // Add to participants list
            const listItem = document.createElement('div');
            listItem.className = 'call-participant';
            listItem.innerHTML = `
                <div class="user-avatar" style="width: 30px; height: 30px; font-size: 0.8rem;">${user.avatar}</div>
                <div>${user.name}</div>
            `;
            participantsList.appendChild(listItem);
        }
    });
}

function endVideoCall() {
    closeModal('videoCallModal');
    showNotification('Video call ended');
}

function toggleAudio() {
    showNotification('Audio toggled', 'info');
}

function toggleVideo() {
    showNotification('Video toggled', 'info');
}

// Utility Functions
function formatDate(dateString, format = 'long') {
    const date = new Date(dateString);
    if (format === 'short') {
        return date.toLocaleDateString('en-US', { month: 'short', day: 'numeric' });
    }
    return date.toLocaleDateString('en-US', { year: 'numeric', month: 'short', day: 'numeric' });
}

function formatTime(date) {
    return new Date(date).toLocaleTimeString('en-US', { hour: '2-digit', minute: '2-digit' });
}

function showAllTasks() {
    showNotification('Opening full task management view...', 'info');
    // In a full implementation, this would navigate to a dedicated tasks page
}

// Initialize when dashboard loads
document.addEventListener('DOMContentLoaded', function() {
    // Add this to your existing initialization
    setTimeout(() => {
        if (document.getElementById('dashboard').classList.contains('active')) {
            initRemoteWorkforce();
        }
    }, 100);
});

// Update the switchTab function to initialize remote workforce when dashboard is active
const originalSwitchTa = window.switchTab;
window.switchTab = function(tabName) {
    if ( originalswitchtab) {
         originalswitchtab(tabName);
    }
    
    if (tabName === 'dashboard') {
        setTimeout(() => {
            initRemoteWorkforce();
        }, 100);
    }
};

// Settings System
class SettingsManager {
    constructor() {
        this.settings = this.loadSettings();
        this.init();
    }

    // Default settings
    getDefaultSettings() {
        return {
            // General Settings
            language: 'en',
            timezone: 'UTC',
            dateFormat: 'MM/DD/YYYY',
            autoSave: true,
            
            // Notification Settings
            emailNotifications: true,
            pushNotifications: true,
            soundNotifications: true,
            desktopNotifications: true,
            notificationFrequency: 'immediate',
            
            // Appearance Settings
            theme: 'light',
            primaryColor: '#3a86ff',
            fontSize: 'medium',
            compactMode: false,
            animations: true,
            
            // Privacy Settings
            dataCollection: false,
            analytics: false,
            autoLogout: 30,
            showOnlineStatus: true,
            
            // Advanced Settings
            performanceMode: false,
            cacheData: true,
            debugMode: false,
            experimentalFeatures: false
        };
    }

    // Load settings from localStorage
    loadSettings() {
        try {
            const saved = localStorage.getItem('aiEmployeeSettings');
            return saved ? JSON.parse(saved) : this.getDefaultSettings();
        } catch (e) {
            console.error('Error loading settings:', e);
            return this.getDefaultSettings();
        }
    }

    // Save settings to localStorage
    saveSettings() {
        try {
            localStorage.setItem('aiEmployeeSettings', JSON.stringify(this.settings));
            this.applySettings();
            return true;
        } catch (e) {
            console.error('Error saving settings:', e);
            return false;
        }
    }

    // Apply settings to the application
    applySettings() {
        // Apply theme
        this.applyTheme(this.settings.theme);
        
        // Apply primary color
        this.applyPrimaryColor(this.settings.primaryColor);
        
        // Apply animations
        this.applyAnimations(this.settings.animations);
        
        // Apply other settings as needed
        console.log('Settings applied:', this.settings);
    }

    // Apply theme
    applyTheme(theme) {
        document.documentElement.setAttribute('data-theme', theme);
        
        // Update theme toggle button
        const themeIcon = document.getElementById('themeIcon');
        const themeText = document.getElementById('themeText');
        
        if (theme === 'dark') {
            if (themeIcon) themeIcon.textContent = '☀️';
            if (themeText) themeText.textContent = 'Light Mode';
        } else {
            if (themeIcon) themeIcon.textContent = '🌙';
            if (themeText) themeText.textContent = 'Dark Mode';
        }
    }

    // Apply primary color
    applyPrimaryColor(color) {
        document.documentElement.style.setProperty('--primary', color);
        
        // Generate secondary color (lighter version)
        const secondaryColor = this.lightenColor(color, 20);
        document.documentElement.style.setProperty('--secondary', secondaryColor);
    }

    // Lighten a color
    lightenColor(color, percent) {
        const num = parseInt(color.replace("#", ""), 16);
        const amt = Math.round(2.55 * percent);
        const R = (num >> 16) + amt;
        const G = (num >> 8 & 0x00FF) + amt;
        const B = (num & 0x0000FF) + amt;
        return "#" + (
            0x1000000 +
            (R < 255 ? R < 1 ? 0 : R : 255) * 0x10000 +
            (G < 255 ? G < 1 ? 0 : G : 255) * 0x100 +
            (B < 255 ? B < 1 ? 0 : B : 255)
        ).toString(16).slice(1);
    }

    // Apply animations
    applyAnimations(enabled) {
        if (enabled) {
            document.documentElement.style.setProperty('--animation-speed', '0.3s');
        } else {
            document.documentElement.style.setProperty('--animation-speed', '0s');
        }
    }

    // Reset to default settings
    resetToDefaults() {
        if (confirm('Are you sure you want to reset all settings to default?')) {
            this.settings = this.getDefaultSettings();
            this.saveSettings();
            this.renderSettings();
            showNotification('Settings reset to default successfully!');
        }
    }

    // Initialize settings system
    init() {
        this.applySettings();
        this.renderSettings();
    }

    // Render settings interface
    renderSettings() {
        const content = document.getElementById('settingsContent');
        if (!content) return;

        content.innerHTML = `
            <!-- General Settings -->
            <div id="settings-general" class="settings-content active">
                <div class="settings-section">
                    <h4>🌐 General Preferences</h4>
                    
                    <div class="setting-item">
                        <div class="setting-info">
                            <div class="setting-title">Language</div>
                            <div class="setting-description">Choose your preferred language</div>
                        </div>
                        <select class="setting-control" id="settingLanguage" onchange="settingsManager.updateSetting('language', this.value)">
                            <option value="en" ${this.settings.language === 'en' ? 'selected' : ''}>English</option>
                            <option value="hi" ${this.settings.language === 'hi' ? 'selected' : ''}>Hindi</option>
                            <option value="es" ${this.settings.language === 'es' ? 'selected' : ''}>Spanish</option>
                            <option value="fr" ${this.settings.language === 'fr' ? 'selected' : ''}>French</option>
                        </select>
                    </div>
                    
                    <div class="setting-item">
                        <div class="setting-info">
                            <div class="setting-title">Timezone</div>
                            <div class="setting-description">Set your local timezone</div>
                        </div>
                        <select class="setting-control" id="settingTimezone" onchange="settingsManager.updateSetting('timezone', this.value)">
                            <option value="UTC" ${this.settings.timezone === 'UTC' ? 'selected' : ''}>UTC</option>
                            <option value="IST" ${this.settings.timezone === 'IST' ? 'selected' : ''}>IST (India)</option>
                            <option value="EST" ${this.settings.timezone === 'EST' ? 'selected' : ''}>EST (New York)</option>
                            <option value="PST" ${this.settings.timezone === 'PST' ? 'selected' : ''}>PST (Los Angeles)</option>
                        </select>
                    </div>
                    
                    <div class="setting-item">
                        <div class="setting-info">
                            <div class="setting-title">Date Format</div>
                            <div class="setting-description">Choose how dates are displayed</div>
                        </div>
                        <select class="setting-control" id="settingDateFormat" onchange="settingsManager.updateSetting('dateFormat', this.value)">
                            <option value="MM/DD/YYYY" ${this.settings.dateFormat === 'MM/DD/YYYY' ? 'selected' : ''}>MM/DD/YYYY</option>
                            <option value="DD/MM/YYYY" ${this.settings.dateFormat === 'DD/MM/YYYY' ? 'selected' : ''}>DD/MM/YYYY</option>
                            <option value="YYYY-MM-DD" ${this.settings.dateFormat === 'YYYY-MM-DD' ? 'selected' : ''}>YYYY-MM-DD</option>
                        </select>
                    </div>
                    
                    <div class="setting-item">
                        <div class="setting-info">
                            <div class="setting-title">Auto Save</div>
                            <div class="setting-description">Automatically save changes</div>
                        </div>
                        <label class="toggle-switch">
                            <input type="checkbox" id="settingAutoSave" ${this.settings.autoSave ? 'checked' : ''} onchange="settingsManager.updateSetting('autoSave', this.checked)">
                            <span class="toggle-slider"></span>
                        </label>
                    </div>
                </div>
            </div>

            <!-- Notification Settings -->
            <div id="settings-notifications" class="settings-content">
                <div class="settings-section">
                    <h4>🔔 Notification Preferences</h4>
                    
                    <div class="setting-item">
                        <div class="setting-info">
                            <div class="setting-title">Email Notifications</div>
                            <div class="setting-description">Receive notifications via email</div>
                        </div>
                        <label class="toggle-switch">
                            <input type="checkbox" id="settingEmailNotifications" ${this.settings.emailNotifications ? 'checked' : ''} onchange="settingsManager.updateSetting('emailNotifications', this.checked)">
                            <span class="toggle-slider"></span>
                        </label>
                    </div>
                    
                    <div class="setting-item">
                        <div class="setting-info">
                            <div class="setting-title">Push Notifications</div>
                            <div class="setting-description">Receive browser push notifications</div>
                        </div>
                        <label class="toggle-switch">
                            <input type="checkbox" id="settingPushNotifications" ${this.settings.pushNotifications ? 'checked' : ''} onchange="settingsManager.updateSetting('pushNotifications', this.checked)">
                            <span class="toggle-slider"></span>
                        </label>
                    </div>
                    
                    <div class="setting-item">
                        <div class="setting-info">
                            <div class="setting-title">Sound Notifications</div>
                            <div class="setting-description">Play sound for notifications</div>
                        </div>
                        <label class="toggle-switch">
                            <input type="checkbox" id="settingSoundNotifications" ${this.settings.soundNotifications ? 'checked' : ''} onchange="settingsManager.updateSetting('soundNotifications', this.checked)">
                            <span class="toggle-slider"></span>
                        </label>
                    </div>
                    
                    <div class="setting-item">
                        <div class="setting-info">
                            <div class="setting-title">Desktop Notifications</div>
                            <div class="setting-description">Show desktop notifications</div>
                        </div>
                        <label class="toggle-switch">
                            <input type="checkbox" id="settingDesktopNotifications" ${this.settings.desktopNotifications ? 'checked' : ''} onchange="settingsManager.updateSetting('desktopNotifications', this.checked)">
                            <span class="toggle-slider"></span>
                        </label>
                    </div>
                    
                    <div class="setting-item">
                        <div class="setting-info">
                            <div class="setting-title">Notification Frequency</div>
                            <div class="setting-description">How often to receive notifications</div>
                        </div>
                        <select class="setting-control" id="settingNotificationFrequency" onchange="settingsManager.updateSetting('notificationFrequency', this.value)">
                            <option value="immediate" ${this.settings.notificationFrequency === 'immediate' ? 'selected' : ''}>Immediate</option>
                            <option value="hourly" ${this.settings.notificationFrequency === 'hourly' ? 'selected' : ''}>Hourly Digest</option>
                            <option value="daily" ${this.settings.notificationFrequency === 'daily' ? 'selected' : ''}>Daily Digest</option>
                        </select>
                    </div>
                    
                    <div class="notification-test">
                        <button class="btn btn-primary" onclick="testNotification('success')">Test Success Notification</button>
                        <button class="btn btn-warning" onclick="testNotification('warning')">Test Warning Notification</button>
                        <button class="btn btn-danger" onclick="testNotification('error')">Test Error Notification</button>
                    </div>
                </div>
            </div>

            <!-- Appearance Settings -->
            <div id="settings-appearance" class="settings-content">
                <div class="settings-section">
                    <h4>🎨 Appearance</h4>
                    
                    <div class="setting-item">
                        <div class="setting-info">
                            <div class="setting-title">Theme</div>
                            <div class="setting-description">Choose light or dark mode</div>
                        </div>
                        <select class="setting-control" id="settingTheme" onchange="settingsManager.updateSetting('theme', this.value)">
                            <option value="light" ${this.settings.theme === 'light' ? 'selected' : ''}>Light Mode</option>
                            <option value="dark" ${this.settings.theme === 'dark' ? 'selected' : ''}>Dark Mode</option>
                            <option value="auto" ${this.settings.theme === 'auto' ? 'selected' : ''}>Auto (System)</option>
                        </select>
                    </div>
                    
                    <div class="setting-item">
                        <div class="setting-info">
                            <div class="setting-title">Primary Color</div>
                            <div class="setting-description">Choose your primary color theme</div>
                        </div>
                        <div class="color-picker">
                            <div class="color-option ${this.settings.primaryColor === '#3a86ff' ? 'active' : ''}" style="background: #3a86ff;" onclick="settingsManager.updateSetting('primaryColor', '#3a86ff')"></div>
                            <div class="color-option ${this.settings.primaryColor === '#06d6a0' ? 'active' : ''}" style="background: #06d6a0;" onclick="settingsManager.updateSetting('primaryColor', '#06d6a0')"></div>
                            <div class="color-option ${this.settings.primaryColor === '#8338ec' ? 'active' : ''}" style="background: #8338ec;" onclick="settingsManager.updateSetting('primaryColor', '#8338ec')"></div>
                            <div class="color-option ${this.settings.primaryColor === '#ff006e' ? 'active' : ''}" style="background: #ff006e;" onclick="settingsManager.updateSetting('primaryColor', '#ff006e')"></div>
                            <div class="color-option ${this.settings.primaryColor === '#ffbe0b' ? 'active' : ''}" style="background: #ffbe0b;" onclick="settingsManager.updateSetting('primaryColor', '#ffbe0b')"></div>
                        </div>
                    </div>
                    
                    <div class="setting-item">
                        <div class="setting-info">
                            <div class="setting-title">Font Size</div>
                            <div class="setting-description">Adjust the text size</div>
                        </div>
                        <select class="setting-control" id="settingFontSize" onchange="settingsManager.updateSetting('fontSize', this.value)">
                            <option value="small" ${this.settings.fontSize === 'small' ? 'selected' : ''}>Small</option>
                            <option value="medium" ${this.settings.fontSize === 'medium' ? 'selected' : ''}>Medium</option>
                            <option value="large" ${this.settings.fontSize === 'large' ? 'selected' : ''}>Large</option>
                        </select>
                    </div>
                    
                    <div class="setting-item">
                        <div class="setting-info">
                            <div class="setting-title">Compact Mode</div>
                            <div class="setting-description">Use compact layout with less spacing</div>
                        </div>
                        <label class="toggle-switch">
                            <input type="checkbox" id="settingCompactMode" ${this.settings.compactMode ? 'checked' : ''} onchange="settingsManager.updateSetting('compactMode', this.checked)">
                            <span class="toggle-slider"></span>
                        </label>
                    </div>
                    
                    <div class="setting-item">
                        <div class="setting-info">
                            <div class="setting-title">Animations</div>
                            <div class="setting-description">Enable interface animations</div>
                        </div>
                        <label class="toggle-switch">
                            <input type="checkbox" id="settingAnimations" ${this.settings.animations ? 'checked' : ''} onchange="settingsManager.updateSetting('animations', this.checked)">
                            <span class="toggle-slider"></span>
                        </label>
                    </div>
                </div>
            </div>

            <!-- Privacy Settings -->
            <div id="settings-privacy" class="settings-content">
                <div class="settings-section">
                    <h4>🔒 Privacy & Security</h4>
                    
                    <div class="setting-item">
                        <div class="setting-info">
                            <div class="setting-title">Data Collection</div>
                            <div class="setting-description">Allow anonymous usage data collection</div>
                        </div>
                        <label class="toggle-switch">
                            <input type="checkbox" id="settingDataCollection" ${this.settings.dataCollection ? 'checked' : ''} onchange="settingsManager.updateSetting('dataCollection', this.checked)">
                            <span class="toggle-slider"></span>
                        </label>
                    </div>
                    
                    <div class="setting-item">
                        <div class="setting-info">
                            <div class="setting-title">Analytics</div>
                            <div class="setting-description">Help improve the app with analytics</div>
                        </div>
                        <label class="toggle-switch">
                            <input type="checkbox" id="settingAnalytics" ${this.settings.analytics ? 'checked' : ''} onchange="settingsManager.updateSetting('analytics', this.checked)">
                            <span class="toggle-slider"></span>
                        </label>
                    </div>
                    
                    <div class="setting-item">
                        <div class="setting-info">
                            <div class="setting-title">Auto Logout</div>
                            <div class="setting-description">Automatically logout after inactivity</div>
                        </div>
                        <select class="setting-control" id="settingAutoLogout" onchange="settingsManager.updateSetting('autoLogout', parseInt(this.value))">
                            <option value="15" ${this.settings.autoLogout === 15 ? 'selected' : ''}>15 minutes</option>
                            <option value="30" ${this.settings.autoLogout === 30 ? 'selected' : ''}>30 minutes</option>
                            <option value="60" ${this.settings.autoLogout === 60 ? 'selected' : ''}>1 hour</option>
                            <option value="0" ${this.settings.autoLogout === 0 ? 'selected' : ''}>Never</option>
                        </select>
                    </div>
                    
                    <div class="setting-item">
                        <div class="setting-info">
                            <div class="setting-title">Show Online Status</div>
                            <div class="setting-description">Let others see when you're online</div>
                        </div>
                        <label class="toggle-switch">
                            <input type="checkbox" id="settingShowOnlineStatus" ${this.settings.showOnlineStatus ? 'checked' : ''} onchange="settingsManager.updateSetting('showOnlineStatus', this.checked)">
                            <span class="toggle-slider"></span>
                        </label>
                    </div>
                </div>
            </div>

            <!-- Advanced Settings -->
            <div id="settings-advanced" class="settings-content">
                <div class="settings-section">
                    <h4>⚡ Advanced Settings</h4>
                    
                    <div class="setting-item">
                        <div class="setting-info">
                            <div class="setting-title">Performance Mode</div>
                            <div class="setting-description">Optimize for better performance</div>
                        </div>
                        <label class="toggle-switch">
                            <input type="checkbox" id="settingPerformanceMode" ${this.settings.performanceMode ? 'checked' : ''} onchange="settingsManager.updateSetting('performanceMode', this.checked)">
                            <span class="toggle-slider"></span>
                        </label>
                    </div>
                    
                    <div class="setting-item">
                        <div class="setting-info">
                            <div class="setting-title">Cache Data</div>
                            <div class="setting-description">Store data locally for faster loading</div>
                        </div>
                        <label class="toggle-switch">
                            <input type="checkbox" id="settingCacheData" ${this.settings.cacheData ? 'checked' : ''} onchange="settingsManager.updateSetting('cacheData', this.checked)">
                            <span class="toggle-slider"></span>
                        </label>
                    </div>
                    
                    <div class="setting-item">
                        <div class="setting-info">
                            <div class="setting-title">Debug Mode</div>
                            <div class="setting-description">Show debug information</div>
                        </div>
                        <label class="toggle-switch">
                            <input type="checkbox" id="settingDebugMode" ${this.settings.debugMode ? 'checked' : ''} onchange="settingsManager.updateSetting('debugMode', this.checked)">
                            <span class="toggle-slider"></span>
                        </label>
                    </div>
                    
                    <div class="setting-item">
                        <div class="setting-info">
                            <div class="setting-title">Experimental Features</div>
                            <div class="setting-description">Enable beta and experimental features</div>
                        </div>
                        <label class="toggle-switch">
                            <input type="checkbox" id="settingExperimentalFeatures" ${this.settings.experimentalFeatures ? 'checked' : ''} onchange="settingsManager.updateSetting('experimentalFeatures', this.checked)">
                            <span class="toggle-slider"></span>
                        </label>
                    </div>
                </div>
                
                <div class="reset-section">
                    <h4>🔄 Reset Settings</h4>
                    <p>Reset all settings to their default values</p>
                    <button class="btn btn-danger" onclick="settingsManager.resetToDefaults()">Reset to Defaults</button>
                </div>
            </div>
        `;
    }

    // Update a specific setting
    updateSetting(key, value) {
        this.settings[key] = value;
        this.saveSettings();
        
        // Show confirmation for important changes
        if (['theme', 'primaryColor', 'language'].includes(key)) {
            showNotification(`Setting "${key}" updated successfully!`);
        }
    }
}

// Global settings manager instance
let settingsManager = null;

// Initialize settings system
function initSettings() {
    if (!settingsManager) {
        settingsManager = new SettingsManager();
    }
}

// Open settings modal
function openSettings() {
    initSettings();
    document.getElementById('settingsModal').style.display = 'flex';
}

// Switch between settings tabs
function switchSettingsTab(tabName) {
    // Hide all tabs
    document.querySelectorAll('.settings-content').forEach(tab => {
        tab.classList.remove('active');
    });
    
    // Remove active class from all tab buttons
    document.querySelectorAll('.settings-tab').forEach(tab => {
        tab.classList.remove('active');
    });
    
    // Show selected tab
    document.getElementById(`settings-${tabName}`).classList.add('active');
    event.currentTarget.classList.add('active');
}

// Test notification function
function testNotification(type) {
    const messages = {
        success: 'This is a test success notification!',
        warning: 'This is a test warning notification!',
        error: 'This is a test error notification!'
    };
    
    showNotification(messages[type], type);
}

// Close modal function (make sure this exists)
function closeModal(modalId) {
    document.getElementById(modalId).style.display = 'none';
}

// Show notification function (make sure this exists)
function showNotification(message, type = 'success') {
    // Use your existing notification system
    const notification = document.getElementById('notification');
    if (notification) {
        notification.textContent = message;
        notification.className = 'notification';
        notification.classList.add(type === 'error' ? 'error' : 'success');
        notification.classList.add('show');
        
        setTimeout(() => {
            notification.classList.remove('show');
        }, 3000);
    } else {
        // Fallback if notification element doesn't exist
        alert(`${type === 'error' ? '❌' : '✅'} ${message}`);
    }
}

// Initialize when page loads
document.addEventListener('DOMContentLoaded', function() {
    initSettings();
});

// Simple refresh function
function refreshLeaveApplications() {
    showNotification('Refreshing leave applications...', 'info');
    
    // Simulate refresh
    setTimeout(() => {
        const container = document.getElementById('leaveApplicationsList');
        if (container) {
            container.innerHTML = '<div class="no-applications">Refreshed: No new applications</div>';
            showNotification('Leave applications refreshed successfully!');
        }
    }, 1000);
}
// Add this function for payroll refresh
function refreshPayrollData() {
    console.log('Refreshing payroll data...');
    
    const refreshBtn = event.target;
    const originalText = refreshBtn.innerHTML;
    refreshBtn.innerHTML = '⏳ Refreshing...';
    refreshBtn.disabled = true;
    
    setTimeout(() => {
        try {
            // Reload payroll data
            if (typeof loadPayrollData === 'function') {
                loadPayrollData();
            }
            showNotification('Payroll data refreshed successfully!', 'success');
            
        } catch (error) {
            console.error('Error refreshing payroll:', error);
            showNotification('Error refreshing payroll data', 'error');
        } finally {
            refreshBtn.innerHTML = originalText;
            refreshBtn.disabled = false;
        }
    }, 1000);
}

// Add this function specifically for Leave Applications refresh
function refreshLeaveApps() {
    console.log('Refreshing leave applications...');
    
    const refreshBtn = event.target;
    const originalText = refreshBtn.innerHTML;
    refreshBtn.innerHTML = '⏳ Refreshing...';
    refreshBtn.disabled = true;
    
    setTimeout(() => {
        try {
            // Reload leave applications data
            if (typeof loadLeaveApplications === 'function') {
                loadLeaveApplications();
            }
            showNotification('Leave applications refreshed successfully!', 'success');
            
        } catch (error) {
            console.error('Error refreshing leave applications:', error);
            showNotification('Error refreshing leave applications', 'error');
        } finally {
            refreshBtn.innerHTML = originalText;
            refreshBtn.disabled = false;
        }
    }, 1000);
}
// Enhanced apply filters function
function applyFilters() {
    const applyBtn = document.querySelector('.btn-primary[onclick="applyFilters()"]');
    const originalText = applyBtn.innerHTML;
    applyBtn.innerHTML = '⏳ Applying...';
    applyBtn.disabled = true;

    employeeDB.filters = {
        department: document.getElementById('filterDepartment').value,
        position: document.getElementById('filterPosition').value,
        location: document.getElementById('filterLocation').value,
        skills: document.getElementById('filterSkills').value,
        experience: document.getElementById('filterExperience').value,
        status: document.getElementById('filterStatus').value
    };

    setTimeout(() => {
        const filteredEmployees = employeeDB.filterEmployees();
        const resultCount = filteredEmployees.length;
        
        showNotification(
            resultCount === 0 ? 
            'No employees found with selected filters' : 
            `Found ${resultCount} employee${resultCount > 1 ? 's' : ''} matching your criteria`,
            resultCount === 0 ? 'warning' : 'success'
        );

        renderEmployeeDatabaseWithAnimation(filteredEmployees);
        applyBtn.innerHTML = originalText;
        applyBtn.disabled = false;
    }, 800);
}

// Animated render function
function renderEmployeeDatabaseWithAnimation(filteredEmployees) {
    const table = document.getElementById('employeeDatabaseTable');
    table.innerHTML = '';

    if (filteredEmployees.length === 0) {
        const noDataRow = document.createElement('tr');
        noDataRow.innerHTML = `
            <td colspan="9" style="text-align: center; padding: 40px; color: var(--text-secondary);">
                <div style="font-size: 1.2rem; margin-bottom: 10px;">🔍</div>
                <div>No employees found matching your criteria</div>
            </td>
        `;
        table.appendChild(noDataRow);
    } else {
        filteredEmployees.forEach((emp, index) => {
            const row = document.createElement('tr');
            row.style.opacity = '0';
            row.style.transform = 'translateY(20px)';
            row.style.transition = `all 0.3s ease ${index * 0.1}s`;
            
            row.innerHTML = `
                <td>${emp.id}</td>
                <td><strong>${emp.name}</strong></td>
                <td>${emp.department}</td>
                <td>${emp.position}</td>
                <td>${emp.location}</td>
                <td>${emp.experience} years</td>
                <td>
                    <div style="display: flex; flex-wrap: wrap; gap: 4px;">
                        ${emp.skills.map(skill => 
                            `<span style="background: var(--primary); color: white; padding: 2px 6px; border-radius: 10px; font-size: 0.7rem;">${skill}</span>`
                        ).join('')}
                    </div>
                </td>
                <td><span class="status-badge status-${emp.status}">${emp.status}</span></td>
                <td>
                    <button class="btn btn-primary btn-sm" onclick="viewEmployeeProfile('${emp.id}')">View</button>
                </td>
            `;
            table.appendChild(row);
            
            setTimeout(() => {
                row.style.opacity = '1';
                row.style.transform = 'translateY(0)';
            }, 100);
        });
    }
}

// Enhanced clear filters
function clearFilters() {
    document.getElementById('filterDepartment').value = '';
    document.getElementById('filterPosition').value = '';
    document.getElementById('filterLocation').value = '';
    document.getElementById('filterSkills').value = '';
    document.getElementById('filterExperience').value = '';
    document.getElementById('filterStatus').value = '';
    
    employeeDB.filters = {
        department: '',
        position: '',
        location: '',
        skills: '',
        experience: '',
        status: ''
    };
    
    showNotification('All filters cleared successfully!', 'success');
    renderEmployeeDatabase();
}

// Enhanced Employees Section with Working Filters
function initEnhancedEmployees() {
    addSearchFiltersToEmployees();
    loadEmployeeSearchData();
    setupEmployeeClickHandlers();
}

// Add search filters to employees section
function addSearchFiltersToEmployees() {
    const employeesSection = document.getElementById('employees');
    if (!employeesSection) return;

    const searchContainer = document.querySelector('#employees .search-container');
    if (searchContainer) {
        searchContainer.innerHTML = `
            <div class="search-box">
                <input type="text" id="searchEmployee" placeholder="Search employees by name, department, position..." onkeyup="searchEmployeesAdvanced()">
                <span class="search-icon">🔍</span>
            </div>
            <button class="btn btn-primary" onclick="showAddEmployeeModal()">+ Add Employee</button>
            <button class="btn btn-info" onclick="toggleAdvancedFilters()">🎯 Advanced Filters</button>
        `;

        // Add advanced filters section
        const advancedFiltersHTML = `
            <div class="advanced-filters-employees" id="advancedEmployeeFilters" style="display: none; margin: 20px 0;">
                <div class="filter-section">
                    <h4>🎯 Advanced Employee Search</h4>
                    <div class="filter-grid">
                        <div class="form-group">
                            <label>Department</label>
                            <select class="form-control" id="filterDepartment" onchange="applyEmployeeFilters()">
                                <option value="">All Departments</option>
                                <option value="Engineering">Engineering</option>
                                <option value="Sales">Sales</option>
                                <option value="Marketing">Marketing</option>
                                <option value="HR">Human Resources</option>
                                <option value="Finance">Finance</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label>Position</label>
                            <input type="text" class="form-control" id="filterPosition" placeholder="e.g., Developer, Manager" onkeyup="applyEmployeeFilters()">
                        </div>
                        <div class="form-group">
                            <label>Status</label>
                            <select class="form-control" id="filterEmpStatus" onchange="applyEmployeeFilters()">
                                <option value="">All Status</option>
                                <option value="active">Active</option>
                                <option value="inactive">Inactive</option>
                            </select>
                        </div>
                    </div>
                    <div class="quick-actions">
                        <button class="btn btn-success btn-sm" onclick="filterByDepartment('Engineering')">👨‍💻 Engineering</button>
                        <button class="btn btn-primary btn-sm" onclick="filterByDepartment('Sales')">💰 Sales</button>
                        <button class="btn btn-warning btn-sm" onclick="filterByDepartment('Marketing')">📢 Marketing</button>
                        <button class="btn btn-info btn-sm" onclick="filterByDepartment('HR')">👥 HR</button>
                        <button class="btn btn-secondary btn-sm" onclick="filterByDepartment('Finance')">💳 Finance</button>
                        <button class="btn" onclick="clearEmployeeFilters()">🔄 Clear All</button>
                    </div>
                </div>
            </div>
        `;

        employeesSection.insertAdjacentHTML('beforeend', advancedFiltersHTML);
    }
}

// Load employee search data
function loadEmployeeSearchData() {
    // Ensure employees have consistent data
    if (employees && employees.length > 0) {
        employees.forEach(emp => {
            // Add missing fields if needed
            if (!emp.experience) emp.experience = Math.floor(Math.random() * 10) + 1;
            if (!emp.skills) emp.skills = ['General Skills'];
            if (!emp.location) emp.location = 'Mumbai';
        });
    }
}

// Setup click handlers for employee names
function setupEmployeeClickHandlers() {
    // This will be called when table is rendered
}

// Toggle advanced filters
function toggleAdvancedFilters() {
    const filters = document.getElementById('advancedEmployeeFilters');
    if (filters.style.display === 'none') {
        filters.style.display = 'block';
        filters.scrollIntoView({ behavior: 'smooth' });
    } else {
        filters.style.display = 'none';
    }
}

// Enhanced search function
function searchEmployeesAdvanced() {
    const searchTerm = document.getElementById('searchEmployee').value.toLowerCase();
    
    if (!searchTerm) {
        renderEmployeesTable(employees);
        return;
    }
    
    const filteredEmployees = employees.filter(emp => {
        const searchText = `
            ${emp.name} ${emp.department} ${emp.position} 
            ${emp.email} ${emp.phone} ${emp.id}
        `.toLowerCase();
        
        return searchText.includes(searchTerm);
    });
    
    renderEmployeesTable(filteredEmployees);
    
    // Show notification for search results
    if (searchTerm && filteredEmployees.length > 0) {
        showNotification(`Found ${filteredEmployees.length} employee${filteredEmployees.length > 1 ? 's' : ''} for "${searchTerm}"`, 'success');
    }
}

// Apply advanced filters
function applyEmployeeFilters() {
    const department = document.getElementById('filterDepartment').value;
    const position = document.getElementById('filterPosition').value;
    const status = document.getElementById('filterEmpStatus').value;
    
    const filteredEmployees = employees.filter(emp => {
        const departmentMatch = !department || emp.department === department;
        const positionMatch = !position || emp.position.toLowerCase().includes(position.toLowerCase());
        const statusMatch = !status || emp.status === status;
        
        return departmentMatch && positionMatch && statusMatch;
    });
    
    renderEmployeesTable(filteredEmployees);
    
    // Show notification
    const resultCount = filteredEmployees.length;
    if (resultCount > 0) {
        showNotification(`Found ${resultCount} employee${resultCount > 1 ? 's' : ''} matching filters`, 'success');
    } else {
        showNotification('No employees found with selected filters', 'warning');
    }
}

// Filter by specific department
function filterByDepartment(department) {
    document.getElementById('filterDepartment').value = department;
    document.getElementById('filterPosition').value = '';
    document.getElementById('filterEmpStatus').value = '';
    
    const filteredEmployees = employees.filter(emp => emp.department === department);
    renderEmployeesTable(filteredEmployees);
    
    showNotification(`Showing ${filteredEmployees.length} ${department} employees`, 'success');
}

// Clear all employee filters
function clearEmployeeFilters() {
    document.getElementById('searchEmployee').value = '';
    document.getElementById('filterDepartment').value = '';
    document.getElementById('filterPosition').value = '';
    document.getElementById('filterEmpStatus').value = '';
    
    renderEmployeesTable(employees);
    showNotification('All filters cleared successfully!', 'success');
}

// Render employees table with clickable names
function renderEmployeesTable(employeesToShow = employees) {
    const table = document.getElementById('employeesTable');
    if (!table) return;
    
    table.innerHTML = '';
    
    if (employeesToShow.length === 0) {
        table.innerHTML = `
            <tr>
                <td colspan="10" style="text-align: center; padding: 40px; color: var(--text-secondary);">
                    <div style="font-size: 3rem; margin-bottom: 15px;">🔍</div>
                    <h4>No employees found</h4>
                    <p>Try adjusting your search criteria or filters</p>
                    <button class="btn btn-primary" onclick="clearEmployeeFilters()" style="margin-top: 15px;">
                        Show All Employees
                    </button>
                </td>
            </tr>
        `;
        return;
    }
    
    employeesToShow.forEach((emp, index) => {
        const row = document.createElement('tr');
        row.style.animationDelay = `${index * 0.1}s`;
        row.className = 'fade-in-row';
        
        row.innerHTML = `
            <td>${emp.id}</td>
            <td>
                <strong class="employee-name-clickable" onclick="viewEmployeeDetails('${emp.id}')">${emp.name}</strong>
                <div style="font-size: 0.8rem; color: var(--text-secondary);">${emp.email}</div>
            </td>
            <td>${emp.phone}</td>
            <td>${emp.department}</td>
            <td>${emp.position}</td>
            <td>${formatDate(emp.joinDate)}</td>
            <td><span class="status-badge status-${emp.status}">${emp.status}</span></td>
            <td>${emp.score}%</td>
            <td class="action-buttons">
                <button class="btn btn-primary btn-sm" onclick="viewEmployeeDetails('${emp.id}')">View</button>
                <button class="btn btn-success btn-sm" onclick="editEmployee('${emp.id}')">Edit</button>
                <button class="btn btn-danger btn-sm" onclick="deleteEmployee('${emp.id}')">Delete</button>
            </td>
        `;
        table.appendChild(row);
    });
}

// View employee details when name is clicked
function viewEmployeeDetails(empId) {
    const employee = employees.find(emp => emp.id === empId);
    if (!employee) {
        showNotification('Employee not found!', 'error');
        return;
    }
    
    // Use existing employee details modal
    showEmployeeDetails(empId);
}

// Initialize when employees tab is clicked
function initEmployeesTab() {
    renderEmployeesTable(employees);
    initEnhancedEmployees();
}

// Update the main switchTab function
const  originalswitchta = window.switchTab;
window.switchTab = function(tabName) {
    if ( originalswitchtab) {
         originalswitchtab(tabName);
    }
    
    if (tabName === 'employees') {
        setTimeout(() => {
            initEmployeesTab();
        }, 100);
    }
};

// Make sure employees are loaded initially
document.addEventListener('DOMContentLoaded', function() {
    // Initialize employees table when page loads if employees tab is active
    if (document.getElementById('employees').classList.contains('active')) {
        initEmployeesTab();
    }
});



// Time Tracking System - Add to Dashboard
function addTimeTrackingToDashboard() {
    const dashboard = document.getElementById('dashboard');
    if (!dashboard) return;

    // Check if already added
    if (document.getElementById('timeTrackingSection')) return;

    const timeTrackingHTML = `
        <div class="time-tracking-section" id="timeTrackingSection">
            <div class="time-tracking-header">
                <h3>⏰ Employee Time Tracking</h3>
                <div class="current-time" id="currentTime">${new Date().toLocaleTimeString()}</div>
            </div>
            
            <div class="time-tracking-content">
                <!-- Employee Self Tracking -->
                <div class="employee-self-tracking">
                    <h4>Your Time Status</h4>
                    <div class="time-status-card">
                        <div class="status-indicator" id="statusIndicator">
                            <span class="status-dot"></span>
                            <span class="status-text">Not Checked In</span>
                        </div>
                        <div class="time-controls">
                            <button class="btn btn-success" onclick="employeeCheckIn()">
                                🕘 Check In
                            </button>
                            <button class="btn btn-danger" onclick="employeeCheckOut()" disabled id="checkOutBtn">
                                🏁 Check Out
                            </button>
                            <button class="btn btn-warning" onclick="employeeCheckInPartTime()">
                                ⏱️ Part Time
                            </button>
                        </div>
                        <div class="session-info" id="sessionInfo">
                            <!-- Session details will appear here -->
                        </div>
                    </div>
                </div>

                <!-- Today's Summary -->
                <div class="today-summary">
                    <h4>Today's Summary</h4>
                    <div class="summary-grid">
                        <div class="summary-item">
                            <div class="summary-value" id="todayHours">0h 0m</div>
                            <div class="summary-label">Hours Today</div>
                        </div>
                        <div class="summary-item">
                            <div class="summary-value" id="todayStatus">-</div>
                            <div class="summary-label">Status</div>
                        </div>
                        <div class="summary-item">
                            <div class="summary-value" id="lastCheckIn">-</div>
                            <div class="summary-label">Last Check In</div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Time Records Table -->
            <div class="time-records-table">
                <h4>📊 Recent Time Records</h4>
                <div class="table-container">
                    <table class="employee-table">
                        <thead>
                            <tr>
                                <th>Date</th>
                                <th>Employee</th>
                                <th>Check In</th>
                                <th>Check Out</th>
                                <th>Hours</th>
                                <th>Type</th>
                            </tr>
                        </thead>
                        <tbody id="timeRecordsTable">
                            <!-- Time records will be loaded here -->
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    `;

    // Add after metrics grid
    const metricsGrid = document.querySelector('.metrics-grid');
    if (metricsGrid) {
        metricsGrid.insertAdjacentHTML('afterend', timeTrackingHTML);
    } else {
        // Fallback: add at beginning of dashboard
        dashboard.insertAdjacentHTML('afterbegin', timeTrackingHTML);
    }

    // Initialize time tracking
    initializeTimeTracking();
}

// Initialize Time Tracking
function initializeTimeTracking() {
    updateCurrentTime();
    loadTimeRecords();
    updateEmployeeStatus();
}

// Update current time
function updateCurrentTime() {
    const timeElement = document.getElementById('currentTime');
    if (timeElement) {
        setInterval(() => {
            timeElement.textContent = new Date().toLocaleTimeString();
        }, 1000);
    }
}

// Employee Check In
function employeeCheckIn() {
    const employee = employees[0]; // Current user - in real app, get logged in user
    
    // Check time restrictions (9 AM to 6 PM)
    const now = new Date();
    const currentHour = now.getHours();
    const currentMinutes = now.getMinutes();
    
    // Check if within working hours (9 AM - 6 PM)
    if (currentHour < 9 || (currentHour === 9 && currentMinutes < 0)) {
        showNotification('Check-in allowed only after 9:00 AM', 'error');
        return;
    }
    
    if (currentHour >= 18) {
        showNotification('Check-in not allowed after 6:00 PM', 'error');
        return;
    }

    // Check if already checked in
    if (localStorage.getItem(`checkedIn_${employee.id}`)) {
        showNotification('You are already checked in!', 'warning');
        return;
    }

    // Save check-in time
    const checkInData = {
        employeeId: employee.id,
        employeeName: employee.name,
        checkInTime: now.toISOString(),
        date: now.toDateString(),
        type: 'full-time'
    };
    
    localStorage.setItem(`checkedIn_${employee.id}`, JSON.stringify(checkInData));
    localStorage.setItem('lastCheckInTime', now.toISOString());
    
    // Enable check-out button
    document.getElementById('checkOutBtn').disabled = false;
    
    // Update UI
    updateEmployeeStatus();
    showNotification(`Checked in successfully at ${now.toLocaleTimeString()}`, 'success');
}

// Employee Check Out
function employeeCheckOut() {
    const employee = employees[0]; // Current user
    
    // Check if checked in
    const checkInData = localStorage.getItem(`checkedIn_${employee.id}`);
    if (!checkInData) {
        showNotification('You are not checked in!', 'error');
        return;
    }

    const checkIn = JSON.parse(checkInData);
    const now = new Date();
    const checkInTime = new Date(checkIn.checkInTime);
    
    // Calculate hours worked
    const hoursWorked = ((now - checkInTime) / (1000 * 60 * 60)).toFixed(2);
    
    // Save time record
    const timeRecord = {
        ...checkIn,
        checkOutTime: now.toISOString(),
        hoursWorked: hoursWorked,
        status: 'completed'
    };
    
    // Save to records
    saveTimeRecord(timeRecord);
    
    // Remove check-in data
    localStorage.removeItem(`checkedIn_${employee.id}`);
    
    // Disable check-out button
    document.getElementById('checkOutBtn').disabled = true;
    
    // Update UI
    updateEmployeeStatus();
    loadTimeRecords();
    showNotification(`Checked out successfully. Worked: ${hoursWorked} hours`, 'success');
}

// Part Time Check In
function employeeCheckInPartTime() {
    const employee = employees[0];
    const now = new Date();
    
    const checkInData = {
        employeeId: employee.id,
        employeeName: employee.name,
        checkInTime: now.toISOString(),
        date: now.toDateString(),
        type: 'part-time'
    };
    
    localStorage.setItem(`checkedIn_${employee.id}`, JSON.stringify(checkInData));
    localStorage.setItem('lastCheckInTime', now.toISOString());
    
    document.getElementById('checkOutBtn').disabled = false;
    updateEmployeeStatus();
    showNotification(`Part-time check in at ${now.toLocaleTimeString()}`, 'success');
}

// Update Employee Status
function updateEmployeeStatus() {
    const employee = employees[0];
    const checkInData = localStorage.getItem(`checkedIn_${employee.id}`);
    const statusIndicator = document.getElementById('statusIndicator');
    const sessionInfo = document.getElementById('sessionInfo');
    const checkOutBtn = document.getElementById('checkOutBtn');
    
    if (checkInData) {
        const data = JSON.parse(checkInData);
        const checkInTime = new Date(data.checkInTime);
        
        statusIndicator.innerHTML = `
            <span class="status-dot active"></span>
            <span class="status-text">Checked In (${data.type})</span>
        `;
        
        sessionInfo.innerHTML = `
            <p>Since: ${checkInTime.toLocaleTimeString()}</p>
            <p>Type: ${data.type === 'part-time' ? 'Part Time' : 'Full Time'}</p>
        `;
        
        checkOutBtn.disabled = false;
        
        // Update today's status
        document.getElementById('todayStatus').textContent = 'Working';
        document.getElementById('lastCheckIn').textContent = checkInTime.toLocaleTimeString();
        
    } else {
        statusIndicator.innerHTML = `
            <span class="status-dot"></span>
            <span class="status-text">Not Checked In</span>
        `;
        
        sessionInfo.innerHTML = '';
        checkOutBtn.disabled = true;
        
        document.getElementById('todayStatus').textContent = 'Not Started';
        document.getElementById('lastCheckIn').textContent = '-';
    }
    
    updateTodayHours();
}

// Save Time Record
function saveTimeRecord(record) {
    let records = JSON.parse(localStorage.getItem('timeRecords') || '[]');
    records.unshift(record);
    localStorage.setItem('timeRecords', JSON.stringify(records));
}

// Load Time Records
function loadTimeRecords() {
    const records = JSON.parse(localStorage.getItem('timeRecords') || '[]');
    const table = document.getElementById('timeRecordsTable');
    
    if (!table) return;
    
    table.innerHTML = '';
    
    if (records.length === 0) {
        table.innerHTML = `
            <tr>
                <td colspan="6" style="text-align: center; padding: 20px; color: var(--text-secondary);">
                    No time records found
                </td>
            </tr>
        `;
        return;
    }
    
    records.slice(0, 5).forEach(record => {
        const checkInTime = new Date(record.checkInTime);
        const checkOutTime = record.checkOutTime ? new Date(record.checkOutTime) : null;
        
        const row = document.createElement('tr');
        row.innerHTML = `
            <td>${checkInTime.toLocaleDateString()}</td>
            <td>${record.employeeName}</td>
            <td>${checkInTime.toLocaleTimeString()}</td>
            <td>${checkOutTime ? checkOutTime.toLocaleTimeString() : '-'}</td>
            <td>${record.hoursWorked || '-'}h</td>
            <td>
                <span class="type-badge ${record.type}">
                    ${record.type === 'part-time' ? 'Part Time' : 'Full Time'}
                </span>
            </td>
        `;
        table.appendChild(row);
    });
}

// Update Today's Hours
function updateTodayHours() {
    const today = new Date().toDateString();
    const records = JSON.parse(localStorage.getItem('timeRecords') || '[]');
    
    const todayRecords = records.filter(record => 
        new Date(record.checkInTime).toDateString() === today && 
        record.hoursWorked
    );
    
    const totalHours = todayRecords.reduce((sum, record) => sum + parseFloat(record.hoursWorked), 0);
    document.getElementById('todayHours').textContent = `${totalHours.toFixed(1)}h`;
}

// Initialize when dashboard loads
document.addEventListener('DOMContentLoaded', function() {
    // Your existing initialization code...
    
    // Add time tracking to dashboard
    setTimeout(() => {
        addTimeTrackingToDashboard();
    }, 1000);
});
// =============================================
// VIRTUAL TEAM BUILDING - COMPLETE WORKING CODE
// =============================================

// 1. Team Building Manager Class
class TeamBuildingManager {
    constructor() {
        this.activities = this.getDefaultActivities();
        this.events = this.loadEvents();
        console.log('TeamBuildingManager initialized');
    }

    getDefaultActivities() {
        return [
            {
                id: 'ACT001',
                name: 'Virtual Escape Room',
                type: 'puzzle',
                duration: 60,
                minPlayers: 3,
                maxPlayers: 8,
                cost: 0,
                equipment: ['computer', 'internet'],
                description: 'Solve puzzles together to escape virtual rooms',
                energyLevel: 'high'
            },
            {
                id: 'ACT002',
                name: 'Online Trivia Challenge', 
                type: 'competition',
                duration: 45,
                minPlayers: 4,
                maxPlayers: 20,
                cost: 0,
                equipment: ['computer'],
                description: 'Team-based trivia with fun categories',
                energyLevel: 'medium'
            },
            {
                id: 'ACT003',
                name: 'Virtual Coffee Chat',
                type: 'social',
                duration: 30,
                minPlayers: 2,
                maxPlayers: 6,
                cost: 0,
                equipment: ['computer'],
                description: 'Casual coffee break with colleagues',
                energyLevel: 'low'
            },
            {
                id: 'ACT004',
                name: 'Digital Scavenger Hunt',
                type: 'puzzle',
                duration: 90,
                minPlayers: 4,
                maxPlayers: 12,
                cost: 0,
                equipment: ['computer', 'mobile'],
                description: 'Find digital items and complete challenges',
                energyLevel: 'high'
            },
            {
                id: 'ACT005',
                name: 'Virtual Talent Show',
                type: 'creative',
                duration: 60,
                minPlayers: 5,
                maxPlayers: 15,
                cost: 0,
                equipment: ['computer', 'webcam'],
                description: 'Showcase hidden talents and skills',
                energyLevel: 'medium'
            }
        ];
    }

    loadEvents() {
        try {
            const events = JSON.parse(localStorage.getItem('teamBuildingEvents')) || [];
            console.log('Loaded events:', events.length);
            return events;
        } catch (error) {
            console.log('Error loading events:', error);
            return [];
        }
    }

    saveEvents() {
        try {
            localStorage.setItem('teamBuildingEvents', JSON.stringify(this.events));
            console.log('Events saved:', this.events.length);
            return true;
        } catch (error) {
            console.log('Error saving events:', error);
            return false;
        }
    }

    init() {
        console.log('Initializing Team Building UI...');
        this.renderActivities();
        this.renderUpcomingEvents();
        this.updateStats();
        return true;
    }

    createEvent(eventData) {
        try {
            const newEvent = {
                id: 'EVT_' + Date.now(),
                title: eventData.title,
                activity: eventData.activity,
                datetime: eventData.datetime,
                description: eventData.description,
                status: 'scheduled',
                created: new Date().toISOString(),
                participants: []
            };

            this.events.push(newEvent);
            const saved = this.saveEvents();
            
            if (saved) {
                this.renderUpcomingEvents();
                this.updateStats();
                console.log('Event created:', newEvent.title);
                return newEvent;
            }
            return null;
        } catch (error) {
            console.log('Create event error:', error);
            return null;
        }
    }

    renderActivities() {
        const container = document.getElementById('teamActivitiesGrid');
        if (!container) {
            console.log('Activities grid container not found');
            return false;
        }

        try {
            container.innerHTML = this.activities.map(activity => `
                <div class="activity-card" onclick="teamBuildingSelectActivity('${activity.id}')">
                    <div class="activity-icon">${this.getActivityIcon(activity.type)}</div>
                    <div class="activity-info">
                        <h4>${activity.name}</h4>
                        <p class="activity-description">${activity.description}</p>
                        <div class="activity-meta">
                            <span class="activity-meta-item">⏱️ ${activity.duration} min</span>
                            <span class="activity-meta-item">👥 ${activity.minPlayers}-${activity.maxPlayers}</span>
                            <span class="activity-meta-item">💰 Free</span>
                        </div>
                    </div>
                </div>
            `).join('');
            
            console.log('Activities rendered:', this.activities.length);
            return true;
        } catch (error) {
            console.log('Render activities error:', error);
            return false;
        }
    }

    renderUpcomingEvents() {
        const container = document.getElementById('teamUpcomingEvents');
        if (!container) {
            console.log('Upcoming events container not found');
            return false;
        }

        try {
            const upcoming = this.events.filter(event => 
                new Date(event.datetime) > new Date()
            ).sort((a, b) => new Date(a.datetime) - new Date(b.datetime));

            if (upcoming.length === 0) {
                container.innerHTML = `
                    <div class="no-events">
                        <div style="font-size: 3rem; margin-bottom: 15px;">🎯</div>
                        <h4>No upcoming events</h4>
                        <p>Create your first team building event to get started!</p>
                        <button class="btn btn-primary" onclick="teamBuildingShowCreateModal()" style="margin-top: 15px;">
                            Create First Event
                        </button>
                    </div>
                `;
            } else {
                container.innerHTML = upcoming.map(event => {
                    const activity = this.activities.find(a => a.id === event.activity);
                    return `
                        <div class="event-card">
                            <div class="event-header">
                                <h3 class="event-title">${event.title}</h3>
                                <span class="event-type">${activity ? activity.type : 'general'}</span>
                            </div>
                            <div class="event-details">
                                <div class="event-detail-item">
                                    <span>📅</span>
                                    <span>${new Date(event.datetime).toLocaleDateString()}</span>
                                </div>
                                <div class="event-detail-item">
                                    <span>⏰</span>
                                    <span>${new Date(event.datetime).toLocaleTimeString()}</span>
                                </div>
                                <div class="event-detail-item">
                                    <span>👥</span>
                                    <span>${event.participants.length} participants</span>
                                </div>
                            </div>
                            ${event.description ? `<p style="color: var(--text-secondary); margin: 10px 0;">${event.description}</p>` : ''}
                            <div class="event-actions">
                                <button class="btn btn-primary btn-sm" onclick="teamBuildingJoinEvent('${event.id}')">Join</button>
                                <button class="btn btn-danger btn-sm" onclick="teamBuildingCancelEvent('${event.id}')">Cancel</button>
                            </div>
                        </div>
                    `;
                }).join('');
            }
            
            console.log('Upcoming events rendered:', upcoming.length);
            return true;
        } catch (error) {
            console.log('Render events error:', error);
            return false;
        }
    }

    updateStats() {
        try {
            const now = new Date();
            const monthlyEvents = this.events.filter(event => {
                const eventDate = new Date(event.datetime);
                return eventDate.getMonth() === now.getMonth() && 
                       eventDate.getFullYear() === now.getFullYear();
            }).length;

            const totalParticipants = this.events.reduce((sum, event) => sum + event.participants.length, 0);
            const participationRate = this.events.length > 0 ? 
                Math.min(100, Math.round((totalParticipants / (this.events.length * 5)) * 100)) : 0;

            // Update DOM elements
            const elements = {
                monthly: document.getElementById('teamMonthlyEvents'),
                participation: document.getElementById('teamParticipationRate'),
                morale: document.getElementById('teamMoraleScore'),
                collaboration: document.getElementById('teamCollaborationScore')
            };

            if (elements.monthly) elements.monthly.textContent = monthlyEvents;
            if (elements.participation) elements.participation.textContent = participationRate + '%';
            if (elements.morale) elements.morale.textContent = Math.min(100, participationRate + 20) + '%';
            if (elements.collaboration) elements.collaboration.textContent = Math.min(100, participationRate + 15) + '%';

            console.log('Stats updated');
            return true;
        } catch (error) {
            console.log('Update stats error:', error);
            return false;
        }
    }

    getActivityIcon(type) {
        const icons = {
            'puzzle': '🧩',
            'social': '💬', 
            'creative': '🎨',
            'competition': '⚡',
            'learning': '📚'
        };
        return icons[type] || '🎯';
    }
}

// 2. Global Manager Instance
let teamBuildingManager = null;

// 3. Core Functions
function teamBuildingInit() {
    try {
        if (!teamBuildingManager) {
            teamBuildingManager = new TeamBuildingManager();
        }
        return teamBuildingManager.init();
    } catch (error) {
        console.log('Team building init error:', error);
        return false;
    }
}

function teamBuildingShowCreateModal() {
    try {
        const modal = document.getElementById('teamCreateEventModal');
        if (!modal) {
            console.log('Create event modal not found');
            return false;
        }
        
        // Populate activities dropdown
        const activitySelect = document.getElementById('teamEventActivity');
        if (activitySelect && teamBuildingManager) {
            activitySelect.innerHTML = '<option value="">Choose an activity</option>' +
                teamBuildingManager.activities.map(activity => 
                    `<option value="${activity.id}">${activity.name}</option>`
                ).join('');
        }
        
        // Set default datetime to next day 3 PM
        const tomorrow = new Date();
        tomorrow.setDate(tomorrow.getDate() + 1);
        tomorrow.setHours(15, 0, 0, 0);
        
        const datetimeInput = document.getElementById('teamEventDateTime');
        if (datetimeInput) {
            datetimeInput.value = tomorrow.toISOString().slice(0, 16);
        }
        
        modal.style.display = 'flex';
        console.log('Create event modal shown');
        return true;
    } catch (error) {
        console.log('Show modal error:', error);
        return false;
    }
}

function teamBuildingCreateNewEvent(event) {
    try {
        event.preventDefault();
        
        if (!teamBuildingManager) {
            alert('Team building system not initialized');
            return false;
        }
        
        const formData = {
            title: document.getElementById('teamEventTitle').value,
            activity: document.getElementById('teamEventActivity').value,
            datetime: document.getElementById('teamEventDateTime').value,
            description: document.getElementById('teamEventDescription').value || ''
        };
        
        if (!formData.title || !formData.activity || !formData.datetime) {
            alert('Please fill all required fields');
            return false;
        }
        
        const newEvent = teamBuildingManager.createEvent(formData);
        if (newEvent) {
            teamBuildingCloseModal('teamCreateEventModal');
            
            // Show success message
            if (typeof showNotification === 'function') {
                showNotification('🎉 Team building event created successfully!');
            } else {
                alert('🎉 Event created successfully!');
            }
            
            // Reset form
            document.getElementById('teamEventForm').reset();
            return true;
        } else {
            alert('Error creating event');
            return false;
        }
    } catch (error) {
        console.log('Create event error:', error);
        alert('Error creating event');
        return false;
    }
}

function teamBuildingSelectActivity(activityId) {
    teamBuildingShowCreateModal();
    const activitySelect = document.getElementById('teamEventActivity');
    if (activitySelect) {
        activitySelect.value = activityId;
    }
}

function teamBuildingJoinEvent(eventId) {
    try {
        if (!teamBuildingManager) return false;
        
        const event = teamBuildingManager.events.find(e => e.id === eventId);
        if (event) {
            // Simulate joining
            if (!event.participants.includes('current_user')) {
                event.participants.push('current_user');
                teamBuildingManager.saveEvents();
                teamBuildingManager.renderUpcomingEvents();
                teamBuildingManager.updateStats();
                
                if (typeof showNotification === 'function') {
                    showNotification('✅ Joined the event successfully!');
                } else {
                    alert('✅ Joined event!');
                }
                return true;
            } else {
                alert('You have already joined this event');
            }
        }
        return false;
    } catch (error) {
        console.log('Join event error:', error);
        return false;
    }
}

function teamBuildingCancelEvent(eventId) {
    try {
        if (!teamBuildingManager) return false;
        
        if (confirm('Are you sure you want to cancel this event?')) {
            teamBuildingManager.events = teamBuildingManager.events.filter(e => e.id !== eventId);
            teamBuildingManager.saveEvents();
            teamBuildingManager.renderUpcomingEvents();
            teamBuildingManager.updateStats();
            
            if (typeof showNotification === 'function') {
                showNotification('❌ Event cancelled successfully!');
            } else {
                alert('❌ Event cancelled!');
            }
            return true;
        }
        return false;
    } catch (error) {
        console.log('Cancel event error:', error);
        return false;
    }
}

function teamBuildingCloseModal(modalId) {
    try {
        const modal = document.getElementById(modalId);
        if (modal) {
            modal.style.display = 'none';
        }
        return true;
    } catch (error) {
        console.log('Close modal error:', error);
        return false;
    }
}

function teamBuildingGenerateAISuggestions() {
    try {
        const suggestions = [
            "🤖 AI Suggestion: Try Virtual Escape Room for high engagement",
            "🤖 AI Suggestion: Schedule Coffee Chat for team bonding", 
            "🤖 AI Suggestion: Digital Scavenger Hunt for cross-team collaboration",
            "🤖 AI Suggestion: Online Trivia for friendly competition"
        ];
        
        const randomSuggestion = suggestions[Math.floor(Math.random() * suggestions.length)];
        
        if (typeof showNotification === 'function') {
            showNotification(randomSuggestion);
        } else {
            alert(randomSuggestion);
        }
        return true;
    } catch (error) {
        console.log('AI suggestions error:', error);
        return false;
    }
}

function teamBuildingFilterActivities(type) {
    try {
        // Update filter buttons
        document.querySelectorAll('.activity-filters .btn').forEach(btn => {
            btn.classList.remove('active');
        });
        event.target.classList.add('active');
        
        // Simple filter - in real app you'd filter the activities
        if (teamBuildingManager) {
            teamBuildingManager.renderActivities();
        }
        return true;
    } catch (error) {
        console.log('Filter activities error:', error);
        return false;
    }
}

// 4. Remote Workforce Integration
function addTeamBuildingToRemoteSection() {
    try {
        const remoteSection = document.querySelector('.remote-work-section');
        if (!remoteSection) {
            console.log('Remote section not found');
            return false;
        }
        
        // Check if button already exists
        if (document.querySelector('#teamBuildingRemoteBtn')) {
            return true;
        }
        
        // Create and add button
        const teamBuildingBtn = document.createElement('button');
        teamBuildingBtn.id = 'teamBuildingRemoteBtn';
        teamBuildingBtn.className = 'btn btn-primary';
        teamBuildingBtn.innerHTML = '🎉 Team Building Activities';
        teamBuildingBtn.onclick = function() {
            console.log('Team Building button clicked from remote section');
            switchTab('teamBuilding');
        };
        teamBuildingBtn.style.marginTop = '10px';
        
        // Find quick actions section or create one
        const quickActions = remoteSection.querySelector('.remote-quick-actions');
        if (quickActions) {
            quickActions.appendChild(teamBuildingBtn);
        } else {
            remoteSection.appendChild(teamBuildingBtn);
        }
        
        console.log('Team Building button added to remote section');
        return true;
    } catch (error) {
        console.log('Add to remote section error:', error);
        return false;
    }
}

// 5. Navigation Integration
function addTeamBuildingToNavigation() {
    try {
        const navTabs = document.querySelector('.nav-tabs');
        if (!navTabs) {
            console.log('Navigation tabs not found');
            return false;
        }
        
        // Check if already exists
        if (document.querySelector('.nav-tab[onclick*="teamBuilding"]')) {
            return true;
        }
        
        const teamBuildingTab = document.createElement('div');
        teamBuildingTab.className = 'nav-tab';
        teamBuildingTab.innerHTML = '🎉 Team Building';
        teamBuildingTab.setAttribute('onclick', "switchTab('teamBuilding')");
        
        navTabs.appendChild(teamBuildingTab);
        console.log('Team Building navigation tab added');
        return true;
    } catch (error) {
        console.log('Add to navigation error:', error);
        return false;
    }
}

// 6. Main Initialization
function initializeTeamBuildingFeature() {
    console.log('=== INITIALIZING TEAM BUILDING FEATURE ===');
    
    // Add navigation tab
    addTeamBuildingToNavigation();
    
    // Add to remote workforce section
    setTimeout(() => {
        addTeamBuildingToRemoteSection();
    }, 1000);
    
    // Setup tab switching
    setupTeamBuildingTabSwitching();
    
    console.log('Team Building feature initialized successfully');
}

// 7. Tab Switching Setup
function setupTeamBuildingTabSwitching() {
    // Override switchTab to handle team building tab
    const originalSwitchTab = window.switchTab;
    
    window.switchTab = function(tabName) {
        // Call original function
        if (originalSwitchTab) {
            originalSwitchTab(tabName);
        }
        
        // Handle team building tab
        if (tabName === 'teamBuilding') {
            const teamBuildingTab = document.getElementById('teamBuilding');
            if (teamBuildingTab) {
                teamBuildingTab.style.display = 'block';
                teamBuildingTab.classList.add('active');
                
                // Initialize team building
                setTimeout(() => {
                    teamBuildingInit();
                }, 100);
            }
        }
    };
}

// 8. Auto-initialize when page loads
document.addEventListener('DOMContentLoaded', function() {
    console.log('DOM loaded - initializing Team Building feature');
    setTimeout(initializeTeamBuildingFeature, 500);
});

// 9. Manual initialization for testing
window.teamBuildingManualInit = function() {
    console.log('Manual Team Building initialization...');
    initializeTeamBuildingFeature();
};
// Enhanced Navigation with Scroll Features
function enhanceNavigation() {
    console.log('Enhancing navigation...');
    
    const navTabs = document.querySelector('.nav-tabs');
    if (!navTabs) {
        console.log('Navigation tabs not found');
        return;
    }
    
    // Add smooth scrolling behavior
    navTabs.style.scrollBehavior = 'smooth';
    
    // Add navigation wrapper for better control
    const navContainer = document.createElement('div');
    navContainer.className = 'nav-tabs-container';
    
    // Wrap the nav-tabs
    navTabs.parentNode.insertBefore(navContainer, navTabs);
    navContainer.appendChild(navTabs);
    
    // Add scroll buttons for better UX
    addScrollButtons(navContainer, navTabs);
    
    // Optimize tab content for mobile
    optimizeTabContent();
    
    console.log('Navigation enhanced successfully');
}

// Add scroll buttons to navigation
function addScrollButtons(container, navTabs) {
    // Left scroll button
    const leftBtn = document.createElement('button');
    leftBtn.className = 'nav-scroll-btn left';
    leftBtn.innerHTML = '‹';
    leftBtn.onclick = () => {
        navTabs.scrollBy({ left: -200, behavior: 'smooth' });
    };
    
    // Right scroll button
    const rightBtn = document.createElement('button');
    rightBtn.className = 'nav-scroll-btn right';
    rightBtn.innerHTML = '›';
    rightBtn.onclick = () => {
        navTabs.scrollBy({ left: 200, behavior: 'smooth' });
    };
    
    container.appendChild(leftBtn);
    container.appendChild(rightBtn);
    
    // Show/hide buttons based on scroll position
    navTabs.addEventListener('scroll', () => {
        updateScrollButtons(leftBtn, rightBtn, navTabs);
    });
    
    // Initial update
    updateScrollButtons(leftBtn, rightBtn, navTabs);
}

// Update scroll buttons visibility
function updateScrollButtons(leftBtn, rightBtn, navTabs) {
    const scrollLeft = navTabs.scrollLeft;
    const scrollWidth = navTabs.scrollWidth;
    const clientWidth = navTabs.clientWidth;
    
    leftBtn.style.display = scrollLeft > 0 ? 'flex' : 'none';
    rightBtn.style.display = scrollLeft < (scrollWidth - clientWidth - 10) ? 'flex' : 'none';
}

// Optimize tab content for better performance
function optimizeTabContent() {
    const tabs = document.querySelectorAll('.tab-content');
    
    tabs.forEach(tab => {
        // Add loading states
        tab.setAttribute('data-loaded', 'false');
        
        // Lazy load content when tab becomes active
        const observer = new MutationObserver((mutations) => {
            mutations.forEach((mutation) => {
                if (mutation.attributeName === 'style' || mutation.attributeName === 'class') {
                    if (tab.style.display === 'block' || tab.classList.contains('active')) {
                        loadTabContent(tab.id);
                    }
                }
            });
        });
        
        observer.observe(tab, { 
            attributes: true, 
            attributeFilter: ['style', 'class'] 
        });
    });
}

// Load tab content efficiently
function loadTabContent(tabId) {
    const tab = document.getElementById(tabId);
    if (!tab || tab.getAttribute('data-loaded') === 'true') return;
    
    console.log('Loading content for tab:', tabId);
    
    // Simulate content loading
    setTimeout(() => {
        tab.setAttribute('data-loaded', 'true');
        
        // Initialize specific tab features
        switch(tabId) {
            case 'dashboard':
                if (typeof initRemoteWorkforce === 'function') {
                    initRemoteWorkforce();
                }
                break;
            case 'teamBuilding':
                if (typeof teamBuildingInit === 'function') {
                    teamBuildingInit();
                }
                break;
            case 'employees':
                if (typeof loadEmployees === 'function') {
                    loadEmployees();
                }
                break;
            case 'attendance':
                if (typeof initAttendanceSystem === 'function') {
                    initAttendanceSystem();
                }
                break;
            case 'payroll':
                if (typeof initPayrollTab === 'function') {
                    initPayrollTab();
                }
                break;
        }
    }, 100);
}

// Compact navigation items for better visibility
function compactNavigationItems() {
    const navTabs = document.querySelectorAll('.nav-tab');
    
    navTabs.forEach(tab => {
        // Remove extra spacing and optimize text
        const text = tab.textContent.trim();
        
        // Create compact versions for mobile
        if (window.innerWidth <= 768) {
            const compactText = getCompactText(text);
            if (compactText !== text) {
                tab.innerHTML = compactText;
                tab.setAttribute('title', text); // Tooltip with full text
            }
        }
        
        // Add hover effects
        tab.addEventListener('mouseenter', function() {
            this.style.transform = 'translateY(-2px)';
            this.style.boxShadow = '0 4px 12px rgba(0,0,0,0.1)';
        });
        
        tab.addEventListener('mouseleave', function() {
            this.style.transform = 'translateY(0)';
            this.style.boxShadow = 'none';
        });
    });
}

// Get compact text for mobile
function getCompactText(fullText) {
    const compactMap = {
        '📊 Dashboard': '📊',
        '👥 Employees': '👥',
        '✅ Smart Attendance': '✅',
        '🎯 AI Recruitment': '🎯', 
        '📈 Analytics': '📈',
        '🚀 Projects': '🚀',
        '💰 Payroll': '💰',
        '🎉 Team Building': '🎉',
        '🗃️ Employee DB': '🗃️',
        '📊 Performance': '📊'
    };
    
    return compactMap[fullText] || fullText;
}

// Responsive navigation handler
function handleResponsiveNavigation() {
    const navTabs = document.querySelector('.nav-tabs');
    if (!navTabs) return;
    
    // Check if we need compact mode
    const needsCompact = navTabs.scrollWidth > navTabs.parentElement.offsetWidth;
    
    if (needsCompact || window.innerWidth <= 768) {
        navTabs.classList.add('compact-mode');
        compactNavigationItems();
    } else {
        navTabs.classList.remove('compact-mode');
    }
}

// Initialize enhanced navigation
function initEnhancedNavigation() {
    console.log('Initializing enhanced navigation...');
    
    // Wait for DOM to be fully ready
    setTimeout(() => {
        enhanceNavigation();
        compactNavigationItems();
        handleResponsiveNavigation();
        
        // Update on window resize
        window.addEventListener('resize', handleResponsiveNavigation);
        
        // Update on new tabs added
        const observer = new MutationObserver(() => {
            handleResponsiveNavigation();
        });
        
        observer.observe(document.querySelector('.nav-tabs'), {
            childList: true,
            subtree: true
        });
        
        console.log('Enhanced navigation initialized');
    }, 1000);
}

// Auto-initialize when page loads
document.addEventListener('DOMContentLoaded', function() {
    console.log('Setting up enhanced navigation...');
    setTimeout(initEnhancedNavigation, 500);
});

// Manual initialization
window.enhanceNav = initEnhancedNavigation;

// Lazy Loading Manager - Completely Isolated
class LazyLoadManager {
    constructor() {
        this.observers = new Map();
        this.cache = new Map();
        this.init();
    }

    init() {
        console.log('🚀 LazyLoadManager initialized');
        this.setupIntersectionObserver();
        this.setupPerformanceMonitoring();
    }

    // Lazy load images and components
    lazyLoadImages() {
        const images = document.querySelectorAll('img[data-src]');
        
        const imageObserver = new IntersectionObserver((entries, observer) => {
            entries.forEach(entry => {
                if (entry.isIntersecting) {
                    const img = entry.target;
                    this.loadImage(img);
                    observer.unobserve(img);
                }
            });
        });

        images.forEach(img => imageObserver.observe(img));
    }

    loadImage(img) {
        const src = img.getAttribute('data-src');
        if (!src) return;

        // Check cache first
        if (this.cache.has(src)) {
            img.src = this.cache.get(src);
            return;
        }

        // Create loading effect
        img.style.opacity = '0';
        img.style.transition = 'opacity 0.3s ease';

        const imageLoader = new Image();
        imageLoader.onload = () => {
            img.src = src;
            img.style.opacity = '1';
            this.cache.set(src, src);
            
            // Preload next images
            this.preloadAdjacentImages(img);
        };

        imageLoader.onerror = () => {
            console.warn('Failed to load image:', src);
            img.style.opacity = '1';
        };

        imageLoader.src = src;
    }

    preloadAdjacentImages(currentImg) {
        const allImages = document.querySelectorAll('img[data-src]');
        const currentIndex = Array.from(allImages).indexOf(currentImg);
        
        // Preload next 2 images
        for (let i = 1; i <= 2; i++) {
            const nextImg = allImages[currentIndex + i];
            if (nextImg && !this.cache.has(nextImg.getAttribute('data-src'))) {
                const preloadImg = new Image();
                preloadImg.src = nextImg.getAttribute('data-src');
                this.cache.set(nextImg.getAttribute('data-src'), nextImg.getAttribute('data-src'));
            }
        }
    }

    // Lazy load components
    lazyLoadComponent(componentId, loaderFunction) {
        const component = document.getElementById(componentId);
        if (!component) return;

        const observer = new IntersectionObserver((entries) => {
            entries.forEach(entry => {
                if (entry.isIntersecting) {
                    loaderFunction();
                    observer.unobserve(component);
                }
            });
        });

        observer.observe(component);
    }

    setupIntersectionObserver() {
        // Observe for any dynamic content
        this.intersectionObserver = new IntersectionObserver((entries) => {
            entries.forEach(entry => {
                if (entry.isIntersecting) {
                    entry.target.dispatchEvent(new CustomEvent('componentVisible'));
                }
            });
        });

        // Observe performance critical elements
        const criticalElements = document.querySelectorAll('[data-lazy-critical]');
        criticalElements.forEach(el => this.intersectionObserver.observe(el));
    }

    setupPerformanceMonitoring() {
        // Monitor Core Web Vitals
        if ('PerformanceObserver' in window) {
            const perfObserver = new PerformanceObserver((list) => {
                list.getEntries().forEach(entry => {
                    console.log('Performance Metric:', entry.name, entry.value);
                    
                    // Log to analytics in production
                    if (entry.value > 1000) { // Threshold for slow operations
                        console.warn('Slow operation detected:', entry.name);
                    }
                });
            });

            perfObserver.observe({ entryTypes: ['measure', 'navigation', 'paint'] });
        }
    }
}

// Global instance
let lazyLoadManager = null;

// Image Optimization Manager
class ImageOptimizer {
    constructor() {
        this.formats = new Set(['webp', 'avif', 'jpg', 'png']);
        this.quality = 80;
        this.init();
    }

    init() {
        console.log('🖼️ ImageOptimizer initialized');
        this.detectSupportedFormats();
        this.optimizeExistingImages();
    }

    detectSupportedFormats() {
        // Test WebP support
        const webpTest = new Image();
        webpTest.onload = webpTest.onerror = () => {
            this.formats.delete('webp');
        };
        webpTest.src = 'data:image/webp;base64,UklGRhoAAABXRUJQVlA4TA0AAAAvAAAAEAcQERGIiP4HAA==';

        // Test AVIF support
        const avifTest = new Image();
        avifTest.onload = avifTest.onerror = () => {
            this.formats.delete('avif');
        };
        avifTest.src = 'data:image/avif;base64,AAAAIGZ0eXBhdmlmAAAAAGF2aWZtaWYxbWlhZk1BMUIAAADybWV0YQAAAAAAAAAoaGRscgAAAAAAAAAAcGljdAAAAAAAAAAAAAAAAGxpYmF2aWYAAAAADnBpdG0AAAAAAAEAAAAeaWxvYwAAAABEAAABAAEAAAABAAABGgAAAB0AAAAoaWluZgAAAAAAAQAAABppbmZlAgAAAAABAABhdjAxQ29sb3IAAAAAamlwcnAAAABLaXBjbwAAABRpc3BlAAAAAAAAAAIAAAACAAAAEHBpeGkAAAAAAwgICAAAAAxhdjFDgQ0MAAAAABNjb2xybmNseAACAAIAAYAAAAAXaXBtYQAAAAAAAAABAAEEAQKDBAAAACVtZGF0EgAKCBgANogQEAwgMg8f8D///8WfhwB8+EORBKrWbA=';
    }

    optimizeExistingImages() {
        const images = document.querySelectorAll('img:not([data-optimized])');
        
        images.forEach(img => {
            this.optimizeImage(img);
        });
    }

    optimizeImage(img) {
        // Skip if already optimized
        if (img.getAttribute('data-optimized')) return;

        const originalSrc = img.src;
        
        // Only optimize external images
        if (!originalSrc || originalSrc.startsWith('data:') || originalSrc.startsWith('blob:')) {
            return;
        }

        // Add lazy loading
        if (!img.loading) {
            img.loading = 'lazy';
        }

        // Set dimensions if not set
        if (!img.width || !img.height) {
            this.setImageDimensions(img);
        }

        // Mark as optimized
        img.setAttribute('data-optimized', 'true');

        // Add error handling
        img.addEventListener('error', () => {
            console.warn('Image failed to load:', originalSrc);
            this.handleImageError(img);
        });
    }

    setImageDimensions(img) {
        // Set placeholder dimensions
        img.style.minHeight = '50px';
        img.style.background = 'var(--bg-secondary)';
    }

    handleImageError(img) {
        // Show placeholder or alternative content
        img.style.display = 'none';
        
        const placeholder = document.createElement('div');
        placeholder.className = 'image-placeholder';
        placeholder.innerHTML = '🖼️ Image not available';
        placeholder.style.cssText = `
            background: var(--bg-secondary);
            padding: 20px;
            text-align: center;
            color: var(--text-secondary);
            border-radius: 8px;
        `;
        
        img.parentNode.insertBefore(placeholder, img.nextSibling);
    }

    // Generate optimized image URL (for dynamic images)
    generateOptimizedUrl(originalUrl, width = 800, height = 600) {
        // In a real app, this would use a CDN service like Cloudinary, Imgix, etc.
        const params = new URLSearchParams({
            w: width,
            h: height,
            q: this.quality,
            format: this.getBestFormat()
        });

        return `${originalUrl}?${params.toString()}`;
    }

    getBestFormat() {
        if (this.formats.has('avif')) return 'avif';
        if (this.formats.has('webp')) return 'webp';
        return 'jpg';
    }
}

// Global instance
let imageOptimizer = null;

// Code Splitting Manager
class CodeSplitManager {
    constructor() {
        this.modules = new Map();
        this.loadedChunks = new Set();
        this.init();
    }

    init() {
        console.log('📦 CodeSplitManager initialized');
        this.setupRouteBasedSplitting();
    }

    // Dynamic import with caching
    async loadModule(moduleName) {
        // Check if already loaded
        if (this.modules.has(moduleName)) {
            return this.modules.get(moduleName);
        }

        // Show loading state
        this.showLoadingState(moduleName);

        try {
            // Dynamic import with webpack chunk name
            const module = await import(
                /* webpackChunkName: "[request]" */
                `./modules/${moduleName}.js`
            );

            // Cache the module
            this.modules.set(moduleName, module);
            this.loadedChunks.add(moduleName);

            // Hide loading state
            this.hideLoadingState(moduleName);

            console.log(`✅ Module loaded: ${moduleName}`);
            return module;

        } catch (error) {
            console.error(`❌ Failed to load module: ${moduleName}`, error);
            this.hideLoadingState(moduleName);
            throw error;
        }
    }

    // Route-based code splitting
    setupRouteBasedSplitting() {
        // Preload critical chunks
        this.preloadCriticalChunks();

        // Load chunks based on user behavior
        this.setupPredictiveLoading();
    }

    preloadCriticalChunks() {
        const criticalChunks = ['dashboard', 'common', 'utils'];
        
        criticalChunks.forEach(chunk => {
            this.preloadChunk(chunk);
        });
    }

    async preloadChunk(chunkName) {
        if (this.loadedChunks.has(chunkName)) return;

        try {
            const link = document.createElement('link');
            link.rel = 'preload';
            link.as = 'script';
            link.href = `./chunks/${chunkName}.js`;
            document.head.appendChild(link);
        } catch (error) {
            console.warn('Preload failed for:', chunkName);
        }
    }

    setupPredictiveLoading() {
        // Predict user's next action and preload accordingly
        document.addEventListener('mouseover', (e) => {
            const target = e.target;
            
            if (target.matches('[data-load-chunk]')) {
                const chunkName = target.getAttribute('data-load-chunk');
                this.preloadChunk(chunkName);
            }
        });

        // Preload on tab hover
        document.addEventListener('mouseenter', (e) => {
            if (e.target.matches('.nav-tab')) {
                const tabName = e.target.textContent.toLowerCase().replace(/\s+/g, '');
                this.preloadChunk(tabName);
            }
        }, true);
    }

    showLoadingState(moduleName) {
        // Add loading indicator to UI
        const loadingEvent = new CustomEvent('moduleLoading', {
            detail: { moduleName }
        });
        document.dispatchEvent(loadingEvent);
    }

    hideLoadingState(moduleName) {
        // Remove loading indicator
        const loadedEvent = new CustomEvent('moduleLoaded', {
            detail: { moduleName }
        });
        document.dispatchEvent(loadedEvent);
    }

    // Get loaded chunks for debugging
    getLoadedChunks() {
        return Array.from(this.loadedChunks);
    }

    // Clear cache (for development)
    clearCache() {
        this.modules.clear();
        this.loadedChunks.clear();
        console.log('🧹 Code split cache cleared');
    }
}

// Global instance
let codeSplitManager = null;


// Advanced Caching Manager
class CacheManager {
    constructor() {
        this.caches = new Map();
        this.strategies = new Map();
        this.init();
    }

    init() {
        console.log('💾 CacheManager initialized');
        this.setupCacheStrategies();
        this.setupServiceWorker();
    }

    setupCacheStrategies() {
        // Cache-First Strategy
        this.strategies.set('cache-first', async (request) => {
            const cached = await this.getFromCache(request);
            if (cached) {
                return cached;
            }
            
            const networkResponse = await fetch(request);
            await this.putInCache(request, networkResponse.clone());
            return networkResponse;
        });

        // Network-First Strategy
        this.strategies.set('network-first', async (request) => {
            try {
                const networkResponse = await fetch(request);
                await this.putInCache(request, networkResponse.clone());
                return networkResponse;
            } catch (error) {
                const cached = await this.getFromCache(request);
                if (cached) return cached;
                throw error;
            }
        });

        // Stale-While-Revalidate
        this.strategies.set('stale-while-revalidate', async (request) => {
            const cached = await this.getFromCache(request);
            
            // Return cached immediately
            if (cached) {
                // Update cache in background
                this.updateCacheInBackground(request);
                return cached;
            }
            
            // Fallback to network
            return this.strategies.get('network-first')(request);
        });
    }

    async getFromCache(request) {
        const cache = await caches.open('app-cache');
        return await cache.match(request);
    }

    async putInCache(request, response) {
        const cache = await caches.open('app-cache');
        await cache.put(request, response);
    }

    async updateCacheInBackground(request) {
        try {
            const networkResponse = await fetch(request);
            await this.putInCache(request, networkResponse);
        } catch (error) {
            console.warn('Background cache update failed:', error);
        }
    }

    setupServiceWorker() {
        if ('serviceWorker' in navigator) {
            navigator.serviceWorker.register('/sw.js')
                .then(registration => {
                    console.log('✅ Service Worker registered:', registration);
                })
                .catch(error => {
                    console.log('❌ Service Worker registration failed:', error);
                });
        }
    }

    // Precache critical assets
    async precacheAssets(assets) {
        const cache = await caches.open('precache');
        
        await Promise.all(
            assets.map(asset => 
                cache.add(asset).catch(err => 
                    console.warn('Precache failed for:', asset, err)
                )
            )
        );
    }

    // Clear specific cache
    async clearCache(cacheName) {
        const deleted = await caches.delete(cacheName);
        if (deleted) {
            console.log('🧹 Cache cleared:', cacheName);
        }
        return deleted;
    }

    // Get cache statistics
    async getCacheStats() {
        const cacheNames = await caches.keys();
        const stats = {};

        for (const name of cacheNames) {
            const cache = await caches.open(name);
            const requests = await cache.keys();
            stats[name] = requests.length;
        }

        return stats;
    }
}

// Global instance
let cacheManager = null;


// CDN Manager for Static Assets
class CDNManager {
    constructor() {
        this.cdnUrls = [
            'https://cdn1.yourapp.com',
            'https://cdn2.yourapp.com',
            'https://cdn3.yourapp.com'
        ];
        this.currentCDN = 0;
        this.fallbackCDNs = new Set();
        this.init();
    }

    init() {
        console.log('🌐 CDNManager initialized');
        this.testCDNs();
        this.rewriteAssetUrls();
    }

    async testCDNs() {
        const testPromises = this.cdnUrls.map((url, index) => 
            this.testCDN(url, index)
        );

        await Promise.allSettled(testPromises);
        this.selectOptimalCDN();
    }

    async testCDN(url, index) {
        const testStart = performance.now();
        
        try {
            const response = await fetch(`${url}/health-check`, {
                method: 'HEAD',
                timeout: 5000
            });

            if (response.ok) {
                const latency = performance.now() - testStart;
                console.log(`✅ CDN ${index} latency: ${latency.toFixed(2)}ms`);
                
                if (latency < 200) { // Good latency
                    this.currentCDN = index;
                }
                return { index, latency, healthy: true };
            }
        } catch (error) {
            console.warn(`❌ CDN ${index} failed:`, error);
            this.fallbackCDNs.add(index);
        }

        return { index, latency: Infinity, healthy: false };
    }

    selectOptimalCDN() {
        // In production, you might use more sophisticated logic
        console.log(`🎯 Selected CDN: ${this.currentCDN}`);
    }

    rewriteAssetUrls() {
        // Rewrite static asset URLs to use CDN
        const assets = document.querySelectorAll('img, script[src], link[rel="stylesheet"]');
        
        assets.forEach(asset => {
            const src = asset.src || asset.href;
            if (src && this.isLocalAsset(src)) {
                const cdnUrl = this.getCDNUrl(src);
                
                if (asset.src) asset.src = cdnUrl;
                if (asset.href) asset.href = cdnUrl;
            }
        });
    }

    isLocalAsset(url) {
        return url.startsWith('/') || url.startsWith(window.location.origin);
    }

    getCDNUrl(originalUrl) {
        const filename = originalUrl.split('/').pop();
        return `${this.cdnUrls[this.currentCDN]}/assets/${filename}`;
    }

    // Dynamic CDN URL generation
    generateCDNUrl(path, options = {}) {
        const params = new URLSearchParams();
        
        if (options.width) params.append('w', options.width);
        if (options.height) params.append('h', options.height);
        if (options.quality) params.append('q', options.quality);
        if (options.format) params.append('fm', options.format);

        const queryString = params.toString();
        return `${this.cdnUrls[this.currentCDN]}${path}${queryString ? '?' + queryString : ''}`;
    }

    // Fallback to next CDN if current fails
    async switchToNextCDN() {
        this.fallbackCDNs.add(this.currentCDN);
        
        for (let i = 0; i < this.cdnUrls.length; i++) {
            if (!this.fallbackCDNs.has(i)) {
                this.currentCDN = i;
                console.log(`🔄 Switched to CDN: ${i}`);
                this.rewriteAssetUrls();
                return;
            }
        }
        
        console.error('🚨 All CDNs failed, falling back to origin');
        this.currentCDN = -1; // Use origin
    }
}

// Global instance
let cdnManager = null;


// Performance Monitoring Manager
class PerformanceMonitor {
    constructor() {
        this.metrics = new Map();
        this.thresholds = {
            fcp: 1000,    // First Contentful Paint
            lcp: 2500,    // Largest Contentful Paint
            fid: 100,     // First Input Delay
            cls: 0.1,     // Cumulative Layout Shift
            ttfb: 800     // Time to First Byte
        };
        this.init();
    }

    init() {
        console.log('📊 PerformanceMonitor initialized');
        this.setupCoreWebVitals();
        this.setupResourceTiming();
        this.setupUserTiming();
    }

    setupCoreWebVitals() {
        // First Contentful Paint
        const fcpObserver = new PerformanceObserver((list) => {
            list.getEntries().forEach(entry => {
                this.recordMetric('fcp', entry.startTime);
                this.checkThreshold('fcp', entry.startTime);
            });
        });
        fcpObserver.observe({ entryTypes: ['paint'] });

        // Largest Contentful Paint
        const lcpObserver = new PerformanceObserver((list) => {
            const entries = list.getEntries();
            const lastEntry = entries[entries.length - 1];
            this.recordMetric('lcp', lastEntry.startTime);
            this.checkThreshold('lcp', lastEntry.startTime);
        });
        lcpObserver.observe({ entryTypes: ['largest-contentful-paint'] });

        // Cumulative Layout Shift
        const clsObserver = new PerformanceObserver((list) => {
            let clsValue = 0;
            list.getEntries().forEach(entry => {
                if (!entry.hadRecentInput) {
                    clsValue += entry.value;
                }
            });
            this.recordMetric('cls', clsValue);
            this.checkThreshold('cls', clsValue);
        });
        clsObserver.observe({ entryTypes: ['layout-shift'] });
    }

    setupResourceTiming() {
        const resourceObserver = new PerformanceObserver((list) => {
            list.getEntries().forEach(entry => {
                if (entry.duration > 1000) { // Slow resources
                    console.warn('Slow resource:', entry.name, entry.duration);
                }
            });
        });
        resourceObserver.observe({ entryTypes: ['resource'] });
    }

    setupUserTiming() {
        // Monitor custom user interactions
        document.addEventListener('click', (e) => {
            const startTime = performance.now();
            
            setTimeout(() => {
                const duration = performance.now() - startTime;
                this.recordMetric('click_response', duration);
                
                if (duration > 100) {
                    console.warn('Slow click response:', duration);
                }
            }, 0);
        });
    }

    recordMetric(name, value) {
        this.metrics.set(name, value);
        
        // Send to analytics (in production)
        if (this.shouldReportToAnalytics(name)) {
            this.reportToAnalytics(name, value);
        }
    }

    checkThreshold(metric, value) {
        const threshold = this.thresholds[metric];
        if (value > threshold) {
            console.warn(`⚠️ ${metric.toUpperCase()} threshold exceeded:`, value);
            this.triggerAlert(metric, value, threshold);
        }
    }

    shouldReportToAnalytics(metric) {
        // Report only significant metrics to avoid noise
        const reportableMetrics = ['fcp', 'lcp', 'cls', 'fid'];
        return reportableMetrics.includes(metric);
    }

    reportToAnalytics(metric, value) {
        // In production, send to your analytics service
        const data = {
            metric,
            value: Math.round(value),
            timestamp: Date.now(),
            userAgent: navigator.userAgent,
            url: window.location.href
        };

        console.log('📈 Analytics:', data);
        
        // Example: Send to Google Analytics
        if (typeof gtag === 'function') {
            gtag('event', 'performance_metric', data);
        }
    }

    triggerAlert(metric, value, threshold) {
        const alertEvent = new CustomEvent('performanceAlert', {
            detail: {
                metric,
                value,
                threshold,
                severity: value > threshold * 1.5 ? 'high' : 'medium'
            }
        });
        
        document.dispatchEvent(alertEvent);
    }

    getPerformanceReport() {
        return {
            metrics: Object.fromEntries(this.metrics),
            userTiming: performance.getEntriesByType('measure'),
            navigation: performance.getEntriesByType('navigation')[0],
            memory: 'memory' in performance ? performance.memory : null
        };
    }
}

// Global instance
let performanceMonitor = null;

// Main Performance Features Initialization
class PerformanceFeatures {
    constructor() {
        this.features = new Map();
        this.init();
    }

    async init() {
        console.log('🚀 Initializing Advanced Performance Features...');
        
        try {
            // Initialize all managers
            lazyLoadManager = new LazyLoadManager();
            imageOptimizer = new ImageOptimizer();
            codeSplitManager = new CodeSplitManager();
            cacheManager = new CacheManager();
            cdnManager = new CDNManager();
            performanceMonitor = new PerformanceMonitor();

            // Store references
            this.features.set('lazyLoading', lazyLoadManager);
            this.features.set('imageOptimization', imageOptimizer);
            this.features.set('codeSplitting', codeSplitManager);
            this.features.set('caching', cacheManager);
            this.features.set('cdn', cdnManager);
            this.features.set('monitoring', performanceMonitor);

            // Start features
            this.startFeatures();
            
            console.log('✅ All performance features initialized');
            
        } catch (error) {
            console.error('❌ Failed to initialize performance features:', error);
        }
    }

    startFeatures() {
        // Start lazy loading
        setTimeout(() => {
            lazyLoadManager.lazyLoadImages();
        }, 1000);

        // Precache critical assets
        const criticalAssets = [
            '/css/main.css',
            '/js/main.js',
            '/images/logo.png'
        ];
        
        cacheManager.precacheAssets(criticalAssets);

        // Monitor performance
        performanceMonitor.setupCoreWebVitals();
    }

    // Get feature status
    getFeatureStatus() {
        const status = {};
        
        this.features.forEach((manager, name) => {
            status[name] = {
                initialized: !!manager,
                active: manager && typeof manager.init === 'function'
            };
        });
        
        return status;
    }

    // Manual control methods
    optimizeImages() {
        if (imageOptimizer) {
            imageOptimizer.optimizeExistingImages();
        }
    }

    clearAllCaches() {
        if (cacheManager) {
            caches.keys().then(names => {
                names.forEach(name => cacheManager.clearCache(name));
            });
        }
    }

    getPerformanceMetrics() {
        if (performanceMonitor) {
            return performanceMonitor.getPerformanceReport();
        }
        return null;
    }
}

// Global initialization
let performanceFeatures = null;

// Auto-initialize with safety
document.addEventListener('DOMContentLoaded', function() {
    console.log('🔄 Starting performance features...');
    
    // Small delay to ensure page is stable
    setTimeout(() => {
        performanceFeatures = new PerformanceFeatures();
    }, 2000);
});

// Manual initialization
window.initPerformanceFeatures = function() {
    performanceFeatures = new PerformanceFeatures();
};

// Export for module usage
if (typeof module !== 'undefined' && module.exports) {
    module.exports = {
        LazyLoadManager,
        ImageOptimizer,
        CodeSplitManager,
        CacheManager,
        CDNManager,
        PerformanceMonitor,
        PerformanceFeatures
    };
}

// Service Worker for Advanced Caching
const CACHE_NAME = 'app-v1';
const STATIC_CACHE = 'static-v1';
const DYNAMIC_CACHE = 'dynamic-v1';

const STATIC_ASSETS = [
    '/',
    '/index.html',
    '/css/main.css',
    '/js/main.js',
    '/images/logo.png',
    '/manifest.json'
];

// Install event - cache static assets
self.addEventListener('install', (event) => {
    console.log('Service Worker installing...');
    
    event.waitUntil(
        caches.open(STATIC_CACHE)
            .then(cache => cache.addAll(STATIC_ASSETS))
            .then(() => self.skipWaiting())
    );
});

// Activate event - cleanup old caches
self.addEventListener('activate', (event) => {
    console.log('Service Worker activating...');
    
    event.waitUntil(
        caches.keys().then(keys => 
            Promise.all(
                keys.map(key => {
                    if (key !== STATIC_CACHE && key !== DYNAMIC_CACHE) {
                        return caches.delete(key);
                    }
                })
            )
        ).then(() => self.clients.claim())
    );
});

// Fetch event - implement caching strategies
self.addEventListener('fetch', (event) => {
    const { request } = event;
    
    // Cache strategy based on request type
    if (request.url.includes('/api/')) {
        event.respondWith(networkFirstStrategy(request));
    } else {
        event.respondWith(cacheFirstStrategy(request));
    }
});

async function cacheFirstStrategy(request) {
    const cached = await caches.match(request);
    if (cached) return cached;
    
    try {
        const response = await fetch(request);
        const cache = await caches.open(DYNAMIC_CACHE);
        cache.put(request, response.clone());
        return response;
    } catch (error) {
        // Fallback for HTML requests
        if (request.destination === 'document') {
            return caches.match('/offline.html');
        }
        throw error;
    }
}

async function networkFirstStrategy(request) {
    try {
        const response = await fetch(request);
        const cache = await caches.open(DYNAMIC_CACHE);
        cache.put(request, response.clone());
        return response;
    } catch (error) {
        const cached = await caches.match(request);
        if (cached) return cached;
        throw error;
    }
}

// AI Chatbot Manager
class AIChatbot {
    constructor() {
        this.isOpen = false;
        this.isTyping = false;
        this.conversationHistory = [];
        this.initializeChatbot();
    }

    initializeChatbot() {
        this.createWelcomeMessage();
        this.setupEventListeners();
        console.log('🤖 AI Chatbot initialized');
    }

    createWelcomeMessage() {
        const messagesContainer = document.getElementById('chatbotMessages');
        const welcomeMsg = document.createElement('div');
        welcomeMsg.className = 'welcome-message';
        welcomeMsg.innerHTML = `
            <h4>👋 Hello! I'm your HR Assistant</h4>
            <p>I can help you with:</p>
            <div style="margin-top: 10px; font-size: 0.8rem;">
                • Leave & Attendance<br>
                • Salary & Benefits<br>
                • HR Policies<br>
                • Employee Support<br>
                • And much more!
            </div>
        `;
        messagesContainer.appendChild(welcomeMsg);
    }

    setupEventListeners() {
        // Toggle chatbot
        document.getElementById('chatbotToggle').addEventListener('click', () => {
            this.toggleChatbot();
        });

        // Enter key to send message
        document.getElementById('chatbotInput').addEventListener('keypress', (e) => {
            if (e.key === 'Enter') {
                this.sendMessage();
            }
        });
    }

    toggleChatbot() {
        this.isOpen = !this.isOpen;
        const chatbotWindow = document.getElementById('chatbotWindow');
        
        if (this.isOpen) {
            chatbotWindow.classList.add('active');
            document.getElementById('chatbotInput').focus();
        } else {
            chatbotWindow.classList.remove('active');
        }
    }

    closeChatbot() {
        this.isOpen = false;
        document.getElementById('chatbotWindow').classList.remove('active');
    }

    sendMessage() {
        const input = document.getElementById('chatbotInput');
        const message = input.value.trim();
        
        if (message && !this.isTyping) {
            this.addUserMessage(message);
            input.value = '';
            this.showTypingIndicator();
            this.generateAIResponse(message);
        }
    }

    sendQuickMessage(message) {
        if (!this.isTyping) {
            this.addUserMessage(message);
            this.showTypingIndicator();
            this.generateAIResponse(message);
        }
    }

    addUserMessage(message) {
        const messagesContainer = document.getElementById('chatbotMessages');
        const messageElement = document.createElement('div');
        messageElement.className = 'message user';
        messageElement.textContent = message;
        messagesContainer.appendChild(messageElement);
        this.scrollToBottom();
        
        // Add to conversation history
        this.conversationHistory.push({ type: 'user', content: message });
    }

    addBotMessage(message, isHTML = false) {
        const messagesContainer = document.getElementById('chatbotMessages');
        const messageElement = document.createElement('div');
        messageElement.className = 'message bot';
        
        if (isHTML) {
            messageElement.innerHTML = message;
        } else {
            messageElement.textContent = message;
        }
        
        messagesContainer.appendChild(messageElement);
        this.scrollToBottom();
        
        // Add to conversation history
        this.conversationHistory.push({ type: 'bot', content: message });
    }

    showTypingIndicator() {
        if (this.isTyping) return;
        
        this.isTyping = true;
        const messagesContainer = document.getElementById('chatbotMessages');
        const typingElement = document.createElement('div');
        typingElement.className = 'message-typing';
        typingElement.id = 'typingIndicator';
        typingElement.innerHTML = `
            <div class="typing-dot"></div>
            <div class="typing-dot"></div>
            <div class="typing-dot"></div>
        `;
        messagesContainer.appendChild(typingElement);
        this.scrollToBottom();
    }

    hideTypingIndicator() {
        this.isTyping = false;
        const typingElement = document.getElementById('typingIndicator');
        if (typingElement) {
            typingElement.remove();
        }
    }

    scrollToBottom() {
        const messagesContainer = document.getElementById('chatbotMessages');
        messagesContainer.scrollTop = messagesContainer.scrollHeight;
    }

    generateAIResponse(userMessage) {
        // Simulate AI processing time
        setTimeout(() => {
            this.hideTypingIndicator();
            const response = this.getAIResponse(userMessage);
            this.addBotMessage(response.content, response.isHTML);
        }, 1500 + Math.random() * 1000);
    }

    getAIResponse(message) {
        const lowerMessage = message.toLowerCase();
        
        // HR Knowledge Base
        const responses = {
            leave: {
                content: `📅 <strong>Leave Information:</strong><br>
                • Casual Leave: 12 days/year<br>
                • Sick Leave: 12 days/year<br>
                • Earned Leave: 30 days/year<br>
                • Maternity Leave: 26 weeks<br><br>
                You currently have:<br>
                ✅ Casual: 8 days remaining<br>
                ✅ Sick: 10 days remaining<br>
                ✅ Earned: 25 days remaining`,
                isHTML: true
            },
            salary: {
                content: `💰 <strong>Salary & Compensation:</strong><br>
                • Basic Salary: As per company structure<br>
                • HRA: 40% of basic<br>
                • Bonus: Performance-based<br>
                • PF: 12% employer contribution<br><br>
                Next payroll: 5th of next month<br>
                Need detailed breakdown? Contact payroll team.`,
                isHTML: true
            },
            policy: {
                content: `📋 <strong>HR Policies:</strong><br>
                • Working Hours: 9 AM - 6 PM<br>
                • Dress Code: Business casual<br>
                • Remote Work: Hybrid policy<br>
                • Probation: 3 months<br>
                • Notice Period: 30 days<br><br>
                Full policy document available in employee portal.`,
                isHTML: true
            },
            attendance: {
                content: `⏰ <strong>Attendance Policy:</strong><br>
                • Regular timing: 9:00 AM - 6:00 PM<br>
                • Flexible hours: 8:00 AM - 10:00 AM start<br>
                • Late mark: After 10:00 AM<br>
                • Early departure: Requires manager approval<br><br>
                Your current attendance: 96% this month ✅`,
                isHTML: true
            },
            benefits: {
                content: `🎁 <strong>Employee Benefits:</strong><br>
                • Health Insurance: Family coverage<br>
                • Life Insurance: 3x annual salary<br>
                • Wellness Program: Gym membership<br>
                • Learning: Certification reimbursement<br>
                • Retirement: PF and pension plans<br><br>
                Benefits portal: https://benefits.company.com`,
                isHTML: true
            },
            default: {
                content: `I understand you're asking about "${message}". As an AI HR assistant, I can help you with:<br><br>
                • Leave balances and applications<br>
                • Salary structure and payments<br>
                • HR policies and guidelines<br>
                • Attendance and timings<br>
                • Employee benefits<br>
                • Career development<br><br>
                Could you please be more specific about what you need help with?`,
                isHTML: true
            }
        };

        // Match user query with responses
        if (lowerMessage.includes('leave') || lowerMessage.includes('holiday')) {
            return responses.leave;
        } else if (lowerMessage.includes('salary') || lowerMessage.includes('pay') || lowerMessage.includes('compensation')) {
            return responses.salary;
        } else if (lowerMessage.includes('policy') || lowerMessage.includes('rule') || lowerMessage.includes('guideline')) {
            return responses.policy;
        } else if (lowerMessage.includes('attendance') || lowerMessage.includes('time') || lowerMessage.includes('punch')) {
            return responses.attendance;
        } else if (lowerMessage.includes('benefit') || lowerMessage.includes('insurance') || lowerMessage.includes('health')) {
            return responses.benefits;
        } else {
            return responses.default;
        }
    }

    // Export conversation history (for analytics)
    exportConversation() {
        return {
            timestamp: new Date().toISOString(),
            history: this.conversationHistory
        };
    }

    // Clear conversation
    clearConversation() {
        const messagesContainer = document.getElementById('chatbotMessages');
        messagesContainer.innerHTML = '';
        this.conversationHistory = [];
        this.createWelcomeMessage();
    }
}

// Global chatbot instance
let aiChatbot = null;

// Initialize chatbot when page loads
document.addEventListener('DOMContentLoaded', function() {
    aiChatbot = new AIChatbot();
});

// Global functions for HTML onclick events
function toggleChatbot() {
    if (aiChatbot) aiChatbot.toggleChatbot();
}

function closeChatbot() {
    if (aiChatbot) aiChatbot.closeChatbot();
}

function sendMessage() {
    if (aiChatbot) aiChatbot.sendMessage();
}

function sendQuickMessage(message) {
    if (aiChatbot) aiChatbot.sendQuickMessage(message);
}

function handleChatInput(event) {
    if (event.key === 'Enter') {
        sendMessage();
    }
}

// Add this to your existing switchTab function to handle chatbot in different tabs
function enhanceSwitchTab() {
    const originalSwitchTab = window.switchTab;
    
    window.switchTab = function(tabName) {
        if (originalSwitchTab) {
            originalSwitchTab(tabName);
        }
        
        // Auto-close chatbot when switching tabs (optional)
        if (aiChatbot && aiChatbot.isOpen) {
            // aiChatbot.closeChatbot(); // Uncomment if you want auto-close
        }
    };
}

// Initialize enhanced tab switching
document.addEventListener('DOMContentLoaded', function() {
    enhanceSwitchTab();
});

// Team Building Tab Handler
function openTeamBuildingTab() {
    console.log('Opening Team Building tab...');
    
    // First, switch to the Team Building tab
    switchTab('teamBuilding');
    
    // Then initialize the team building system
    setTimeout(() => {
        if (typeof teamBuildingInit === 'function') {
            teamBuildingInit();
        } else {
            console.log('Team Building system not loaded yet');
            // Fallback: Show notification
            showNotification('🎉 Opening Team Building Activities...', 'info');
        }
    }, 300);
}

// Enhanced switchTab function to handle Team Building properly
function enhanceSwitchTabWithTeamBuilding() {
    const originalSwitchTab = window.switchTab;
    
    window.switchTab = function(tabName) {
        // Call original function first
        if (originalSwitchTab) {
            originalSwitchTab(tabName);
        }
        
        // Handle Team Building tab specifically
        if (tabName === 'teamBuilding') {
            console.log('Team Building tab activated');
            
            // Initialize team building after a short delay
            setTimeout(() => {
                if (typeof teamBuildingInit === 'function') {
                    teamBuildingInit();
                } else {
                    console.warn('Team Building system not available');
                }
            }, 500);
        }
        
        // Auto-close chatbot when switching tabs (optional)
        if (aiChatbot && aiChatbot.isOpen && tabName !== 'dashboard') {
            aiChatbot.closeChatbot();
        }
    };
}

// Remove any duplicate Team Building buttons
function cleanupDuplicateButtons() {
    // Remove Team Building buttons from remote section if they exist
    const remoteSection = document.querySelector('.remote-work-section');
    if (remoteSection) {
        const teamBuildingBtns = remoteSection.querySelectorAll('button');
        teamBuildingBtns.forEach(btn => {
            if (btn.textContent.includes('Team Building') || btn.textContent.includes('🎉')) {
                btn.remove();
            }
        });
    }
}

// Initialize all fixes
document.addEventListener('DOMContentLoaded', function() {
    // Enhance tab switching
    enhanceSwitchTabWithTeamBuilding();
    
    // Clean up duplicate buttons
    cleanupDuplicateButtons();
    
    // Initialize chatbot with dark mode support
    if (typeof AIChatbot === 'function' && !aiChatbot) {
        aiChatbot = new AIChatbot();
    }
    
    console.log('✅ Chatbot fixes applied successfully');
});

// Enhanced Responsive Features
class ResponsiveManager {
    constructor() {
        this.currentView = this.getCurrentView();
        this.init();
    }

    init() {
        this.setupViewport();
        this.setupTouchOptimizations();
        this.setupOrientationHandler();
        this.setupPerformanceOptimizations();
        console.log('📱 Responsive Manager Initialized');
    }

    getCurrentView() {
        const width = window.innerWidth;
        if (width >= 1400) return 'xl';
        if (width >= 1200) return 'lg';
        if (width >= 992) return 'md';
        if (width >= 768) return 'sm';
        if (width >= 576) return 'xs';
        return 'xxs';
    }

    setupViewport() {
        // Dynamic viewport height for mobile browsers
        const setVH = () => {
            const vh = window.innerHeight * 0.01;
            document.documentElement.style.setProperty('--vh', `${vh}px`);
        };
        
        setVH();
        window.addEventListener('resize', setVH);
        window.addEventListener('orientationchange', setVH);
    }

    setupTouchOptimizations() {
        // Better touch handling
        document.addEventListener('touchstart', function() {}, { passive: true });
        
        // Prevent double tap zoom
        let lastTouchEnd = 0;
        document.addEventListener('touchend', function(event) {
            const now = (new Date()).getTime();
            if (now - lastTouchEnd <= 300) {
                event.preventDefault();
            }
            lastTouchEnd = now;
        }, false);
    }

    setupOrientationHandler() {
        window.addEventListener('orientationchange', () => {
            setTimeout(() => {
                this.handleOrientationChange();
            }, 300);
        });
    }

    handleOrientationChange() {
        const orientation = window.screen.orientation || window.orientation;
        console.log(`🔄 Orientation changed: ${orientation}`);
        
        // Force redraw for some browsers
        setTimeout(() => {
            window.dispatchEvent(new Event('resize'));
        }, 100);
    }

    setupPerformanceOptimizations() {
        // Throttle resize events
        let resizeTimeout;
        window.addEventListener('resize', () => {
            if (!resizeTimeout) {
                resizeTimeout = setTimeout(() => {
                    resizeTimeout = null;
                    this.handleResize();
                }, 250);
            }
        });
    }

    handleResize() {
        const newView = this.getCurrentView();
        if (newView !== this.currentView) {
            console.log(`🔄 View changed: ${this.currentView} → ${newView}`);
            this.currentView = newView;
            this.optimizeForViewport();
        }
    }

    optimizeForViewport() {
        const view = this.currentView;
        
        // Optimize charts and heavy components based on viewport
        switch(view) {
            case 'xxs':
            case 'xs':
                this.optimizeForMobile();
                break;
            case 'sm':
                this.optimizeForTablet();
                break;
            default:
                this.optimizeForDesktop();
        }
    }

    optimizeForMobile() {
        // Reduce animations, simplify UI
        document.body.classList.add('mobile-view');
        
        // Lazy load heavy components
        this.lazyLoadCharts();
    }

    optimizeForTablet() {
        document.body.classList.add('tablet-view');
    }

    optimizeForDesktop() {
        document.body.classList.remove('mobile-view', 'tablet-view');
    }

    lazyLoadCharts() {
        // Implement lazy loading for charts on mobile
        const charts = document.querySelectorAll('canvas');
        charts.forEach(chart => {
            if (!this.isElementInViewport(chart)) {
                chart.style.visibility = 'hidden';
            }
        });
    }

    isElementInViewport(el) {
        const rect = el.getBoundingClientRect();
        return (
            rect.top >= 0 &&
            rect.left >= 0 &&
            rect.bottom <= (window.innerHeight || document.documentElement.clientHeight) &&
            rect.right <= (window.innerWidth || document.documentElement.clientWidth)
        );
    }

    // Utility method to check device type
    isTouchDevice() {
        return 'ontouchstart' in window || navigator.maxTouchPoints > 0;
    }

    isMobileDevice() {
        return this.currentView === 'xs' || this.currentView === 'xxs';
    }
}

// Initialize Responsive Manager
let responsiveManager = null;

// Enhanced existing functions for mobile
function optimizeNavigationForMobile() {
    if (responsiveManager && responsiveManager.isMobileDevice()) {
        // Convert navigation to more mobile-friendly
        const navTabs = document.querySelector('.nav-tabs');
        if (navTabs) {
            navTabs.style.overflowX = 'auto';
            navTabs.style.webkitOverflowScrolling = 'touch';
        }
    }
}

// Enhanced switchTab function for mobile
const originalSwitchTab = window.switchTab;
window.switchTab = function(tabName) {
    if (originalSwitchTab) {
        originalSwitchTab(tabName);
    }
    
    // Mobile optimizations
    if (responsiveManager && responsiveManager.isMobileDevice()) {
        // Scroll to top when switching tabs on mobile
        window.scrollTo(0, 0);
        
        // Close any open modals
        const openModals = document.querySelectorAll('.modal[style*="display: flex"]');
        openModals.forEach(modal => {
            modal.style.display = 'none';
        });
    }
};

// Initialize when page loads
document.addEventListener('DOMContentLoaded', function() {
    responsiveManager = new ResponsiveManager();
    optimizeNavigationForMobile();
    
    // Additional mobile optimizations
    if (responsiveManager.isMobileDevice()) {
        // Add mobile-specific classes
        document.body.classList.add('mobile-device');
        
        // Optimize tables for mobile
        const tables = document.querySelectorAll('.employee-table');
        tables.forEach(table => {
            table.classList.add('mobile-table');
        });
    }
});

// Handle iOS specific issues
if (/iPad|iPhone|iPod/.test(navigator.userAgent) && !window.MSStream) {
    document.body.classList.add('ios-device');
    
    // Fix for iOS viewport height
    const setVH = () => {
        const vh = window.innerHeight * 0.01;
        document.documentElement.style.setProperty('--vh', `${vh}px`);
    };
    
    window.addEventListener('resize', setVH);
    setVH();
}


// Resume Builder JavaScript
let currentStep = 1;
let selectedTemplate = 'modern';
let resumeData = {
    personal: {},
    skills: [],
    education: [],
    experience: [],
    certifications: []
};

// Initialize Resume Builder
function initResumeBuilder() {
    console.log('🤖 AI Resume Builder Initialized');
    setupEventListeners();
}

// Setup Event Listeners
function setupEventListeners() {
    // Template selection
    document.querySelectorAll('.template-card').forEach(card => {
        card.addEventListener('click', function() {
            document.querySelectorAll('.template-card').forEach(c => c.classList.remove('active'));
            this.classList.add('active');
            selectedTemplate = this.dataset.template;
        });
    });

    // Enter key for skills
    document.getElementById('skillInput').addEventListener('keypress', function(e) {
        if (e.key === 'Enter') {
            addSkill();
        }
    });
}

// Open Resume Builder
function openResumeBuilder() {
    console.log('Opening Resume Builder...');
    document.getElementById('resumeBuilderModal').style.display = 'flex';
    resetBuilder();
    showStep(1);
}

// Close Resume Builder
function closeResumeBuilder() {
    document.getElementById('resumeBuilderModal').style.display = 'none';
    resetBuilder();
}

// Reset Builder
function resetBuilder() {
    currentStep = 1;
    selectedTemplate = 'modern';
    resumeData = {
        personal: {},
        skills: [],
        education: [],
        experience: [],
        certifications: []
    };
    
    // Reset forms
    document.getElementById('skillsList').innerHTML = '';
    document.getElementById('educationForm').innerHTML = '';
    document.getElementById('experienceForm').innerHTML = '';
    document.getElementById('certificationForm').innerHTML = '';
    
    // Add initial empty forms
    addEducation();
    addExperience();
    addCertification();
}

// Navigation Functions
function showStep(step) {
    document.querySelectorAll('.builder-step').forEach(s => s.classList.remove('active'));
    document.getElementById(`step${step}`).classList.add('active');
    currentStep = step;
}

function nextStep(step) {
    if (validateStep(currentStep)) {
        showStep(step);
    }
}

function prevStep(step) {
    showStep(step);
}

// Step Validation
function validateStep(step) {
    switch(step) {
        case 1:
            if (!selectedTemplate) {
                alert('Please select a template');
                return false;
            }
            break;
            
        case 2:
            const name = document.getElementById('resumeName').value;
            const email = document.getElementById('resumeEmail').value;
            const phone = document.getElementById('resumePhone').value;
            
            if (!name || !email || !phone) {
                alert('Please fill all required fields (Name, Email, Phone)');
                return false;
            }
            
            // Save personal data
            resumeData.personal = {
                name: name,
                email: email,
                phone: phone,
                location: document.getElementById('resumeLocation').value,
                summary: document.getElementById('resumeSummary').value,
                photo: document.getElementById('photoPreview').querySelector('img')?.src || ''
            };
            break;
            
        case 3:
            if (resumeData.skills.length === 0) {
                alert('Please add at least one skill');
                return false;
            }
            break;
    }
    return true;
}

// Photo Upload
function previewPhoto(event) {
    const file = event.target.files[0];
    if (file) {
        const reader = new FileReader();
        reader.onload = function(e) {
            const preview = document.getElementById('photoPreview');
            preview.innerHTML = `<img src="${e.target.result}" alt="Profile Photo">`;
        };
        reader.readAsDataURL(file);
    }
}

// Skills Management
function addSkill() {
    const skillInput = document.getElementById('skillInput');
    const skill = skillInput.value.trim();
    
    if (skill && !resumeData.skills.includes(skill)) {
        resumeData.skills.push(skill);
        renderSkills();
        skillInput.value = '';
    }
}

function removeSkill(skill) {
    resumeData.skills = resumeData.skills.filter(s => s !== skill);
    renderSkills();
}

function renderSkills() {
    const skillsList = document.getElementById('skillsList');
    skillsList.innerHTML = resumeData.skills.map(skill => `
        <div class="skill-tag">
            ${skill}
            <button class="remove-skill" onclick="removeSkill('${skill}')">×</button>
        </div>
    `).join('');
}

// Dynamic Forms
function addEducation() {
    const form = document.getElementById('educationForm');
    const newRow = document.createElement('div');
    newRow.className = 'form-row';
    newRow.innerHTML = `
        <input type="text" placeholder="Degree" class="edu-degree">
        <input type="text" placeholder="Institution">
        <input type="text" placeholder="Year">
        <button class="btn btn-sm btn-danger" onclick="removeEducation(this)">−</button>
    `;
    form.appendChild(newRow);
}

function removeEducation(button) {
    if (document.querySelectorAll('#educationForm .form-row').length > 1) {
        button.parentElement.remove();
    }
}

function addExperience() {
    const form = document.getElementById('experienceForm');
    const newRow = document.createElement('div');
    newRow.className = 'form-row';
    newRow.innerHTML = `
        <input type="text" placeholder="Job Title" class="exp-title">
        <input type="text" placeholder="Company">
        <input type="text" placeholder="Duration">
        <textarea placeholder="Description"></textarea>
        <button class="btn btn-sm btn-danger" onclick="removeExperience(this)">−</button>
    `;
    form.appendChild(newRow);
}

function removeExperience(button) {
    if (document.querySelectorAll('#experienceForm .form-row').length > 1) {
        button.parentElement.remove();
    }
}

function addCertification() {
    const form = document.getElementById('certificationForm');
    const newRow = document.createElement('div');
    newRow.className = 'form-row';
    newRow.innerHTML = `
        <input type="text" placeholder="Certification Name">
        <input type="text" placeholder="Issuing Organization">
        <input type="text" placeholder="Year">
        <button class="btn btn-sm btn-danger" onclick="removeCertification(this)">−</button>
    `;
    form.appendChild(newRow);
}

function removeCertification(button) {
    if (document.querySelectorAll('#certificationForm .form-row').length > 1) {
        button.parentElement.remove();
    }
}

// Collect Form Data
function collectFormData() {
    // Education
    resumeData.education = Array.from(document.querySelectorAll('#educationForm .form-row')).map(row => {
        const inputs = row.querySelectorAll('input');
        return {
            degree: inputs[0].value,
            institution: inputs[1].value,
            year: inputs[2].value
        };
    }).filter(edu => edu.degree && edu.institution);

    // Experience
    resumeData.experience = Array.from(document.querySelectorAll('#experienceForm .form-row')).map(row => {
        const inputs = row.querySelectorAll('input');
        const textarea = row.querySelector('textarea');
        return {
            title: inputs[0].value,
            company: inputs[1].value,
            duration: inputs[2].value,
            description: textarea.value
        };
    }).filter(exp => exp.title && exp.company);

    // Certifications
    resumeData.certifications = Array.from(document.querySelectorAll('#certificationForm .form-row')).map(row => {
        const inputs = row.querySelectorAll('input');
        return {
            name: inputs[0].value,
            organization: inputs[1].value,
            year: inputs[2].value
        };
    }).filter(cert => cert.name && cert.organization);
}

// Generate Resume
function generateResume() {
    if (!validateStep(3)) return;
    
    collectFormData();
    showStep(4);
    renderResumePreview();
}

// Render Resume Preview
function renderResumePreview() {
    const preview = document.getElementById('resumePreview');
    
    switch(selectedTemplate) {
        case 'modern':
            preview.innerHTML = generateModernResume();
            break;
        case 'professional':
            preview.innerHTML = generateProfessionalResume();
            break;
        case 'creative':
            preview.innerHTML = generateCreativeResume();
            break;
        default:
            preview.innerHTML = generateModernResume();
    }
}

// Modern Resume Template
function generateModernResume() {
    const { personal, skills, education, experience, certifications } = resumeData;
    
    return `
        <div class="resume-modern">
            <div class="resume-header">
                ${personal.photo ? `<img src="${personal.photo}" alt="${personal.name}" class="resume-photo">` : ''}
                <div class="resume-basic-info">
                    <h1>${personal.name}</h1>
                    <p>${personal.summary || 'Professional Summary'}</p>
                    <div class="resume-contact">
                        ${personal.email ? `<span>📧 ${personal.email}</span>` : ''}
                        ${personal.phone ? `<span>📱 ${personal.phone}</span>` : ''}
                        ${personal.location ? `<span>📍 ${personal.location}</span>` : ''}
                    </div>
                </div>
            </div>

            ${skills.length > 0 ? `
            <div class="resume-section">
                <h3>Skills</h3>
                <div class="skills-grid">
                    ${skills.map(skill => `<div class="skill-tag">${skill}</div>`).join('')}
                </div>
            </div>
            ` : ''}

            ${experience.length > 0 ? `
            <div class="resume-section">
                <h3>Work Experience</h3>
                ${experience.map(exp => `
                    <div class="experience-item">
                        <h4>${exp.title}</h4>
                        <div class="experience-meta">${exp.company} | ${exp.duration}</div>
                        <p>${exp.description}</p>
                    </div>
                `).join('')}
            </div>
            ` : ''}

            ${education.length > 0 ? `
            <div class="resume-section">
                <h3>Education</h3>
                ${education.map(edu => `
                    <div class="education-item">
                        <h4>${edu.degree}</h4>
                        <div class="education-meta">${edu.institution} | ${edu.year}</div>
                    </div>
                `).join('')}
            </div>
            ` : ''}

            ${certifications.length > 0 ? `
            <div class="resume-section">
                <h3>Certifications</h3>
                ${certifications.map(cert => `
                    <div class="certification-item">
                        <h4>${cert.name}</h4>
                        <div class="certification-meta">${cert.organization} | ${cert.year}</div>
                    </div>
                `).join('')}
            </div>
            ` : ''}
        </div>
    `;
}

// Professional Resume Template
function generateProfessionalResume() {
    const { personal, skills, education, experience } = resumeData;
    
    return `
        <div class="resume-professional">
            <div class="resume-header" style="text-align: center; border-bottom: 3px double #333; padding-bottom: 20px;">
                <h1 style="margin: 0; color: #333;">${personal.name}</h1>
                <p style="margin: 5px 0; color: #666;">${personal.summary || 'Professional Summary'}</p>
                <div style="display: flex; justify-content: center; gap: 20px; margin-top: 10px;">
                    ${personal.email ? `<span>${personal.email}</span>` : ''}
                    ${personal.phone ? `<span>${personal.phone}</span>` : ''}
                    ${personal.location ? `<span>${personal.location}</span>` : ''}
                </div>
            </div>

            ${experience.length > 0 ? `
            <div style="margin: 25px 0;">
                <h3 style="border-bottom: 1px solid #333; padding-bottom: 5px;">PROFESSIONAL EXPERIENCE</h3>
                ${experience.map(exp => `
                    <div style="margin: 15px 0;">
                        <h4 style="margin: 0;">${exp.title}</h4>
                        <div style="color: #666; margin: 5px 0;">${exp.company} | ${exp.duration}</div>
                        <p>${exp.description}</p>
                    </div>
                `).join('')}
            </div>
            ` : ''}

            ${education.length > 0 ? `
            <div style="margin: 25px 0;">
                <h3 style="border-bottom: 1px solid #333; padding-bottom: 5px;">EDUCATION</h3>
                ${education.map(edu => `
                    <div style="margin: 10px 0;">
                        <h4 style="margin: 0;">${edu.degree}</h4>
                        <div style="color: #666;">${edu.institution} | ${edu.year}</div>
                    </div>
                `).join('')}
            </div>
            ` : ''}

            ${skills.length > 0 ? `
            <div style="margin: 25px 0;">
                <h3 style="border-bottom: 1px solid #333; padding-bottom: 5px;">SKILLS</h3>
                <div style="display: flex; flex-wrap: wrap; gap: 8px;">
                    ${skills.map(skill => `<span style="background: #f0f0f0; padding: 4px 8px; border-radius: 4px;">${skill}</span>`).join('')}
                </div>
            </div>
            ` : ''}
        </div>
    `;
}

// Creative Resume Template
function generateCreativeResume() {
    const { personal, skills, experience, education } = resumeData;
    
    return `
        <div class="resume-creative" style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; padding: 40px; min-height: 500px;">
            <div style="max-width: 800px; margin: 0 auto;">
                <div style="text-align: center; margin-bottom: 40px;">
                    ${personal.photo ? `<img src="${personal.photo}" alt="${personal.name}" style="width: 120px; height: 120px; border-radius: 50%; border: 4px solid white; margin-bottom: 20px;">` : ''}
                    <h1 style="margin: 0; font-size: 2.5rem;">${personal.name}</h1>
                    <p style="font-size: 1.2rem; opacity: 0.9;">${personal.summary || 'Creative Professional'}</p>
                    <div style="display: flex; justify-content: center; gap: 20px; margin-top: 15px;">
                        ${personal.email ? `<span>📧 ${personal.email}</span>` : ''}
                        ${personal.phone ? `<span>📱 ${personal.phone}</span>` : ''}
                    </div>
                </div>

                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 30px;">
                    ${experience.length > 0 ? `
                    <div>
                        <h3 style="border-bottom: 2px solid white; padding-bottom: 10px;">Experience</h3>
                        ${experience.map(exp => `
                            <div style="margin: 15px 0;">
                                <h4 style="margin: 0;">${exp.title}</h4>
                                <div style="opacity: 0.8;">${exp.company} | ${exp.duration}</div>
                                <p style="opacity: 0.9;">${exp.description}</p>
                            </div>
                        `).join('')}
                    </div>
                    ` : ''}

                    ${skills.length > 0 ? `
                    <div>
                        <h3 style="border-bottom: 2px solid white; padding-bottom: 10px;">Skills</h3>
                        <div style="display: flex; flex-wrap: wrap; gap: 8px;">
                            ${skills.map(skill => `<span style="background: rgba(255,255,255,0.2); padding: 6px 12px; border-radius: 20px;">${skill}</span>`).join('')}
                        </div>
                    </div>
                    ` : ''}
                </div>
            </div>
        </div>
    `;
}

// Download Resume as PDF
function downloadResume() {
    const resumeElement = document.getElementById('resumePreview');
    
    // In a real implementation, you would use a library like html2pdf.js
    // This is a simplified version
    alert('PDF download functionality would be implemented here with html2pdf.js');
    console.log('Downloading resume as PDF...', resumeData);
}

// Add to Portfolio
function addToPortfolio() {
    // Save resume to employee portfolio
    const employeeId = 'current_user'; // In real app, get from session
    const portfolioData = {
        id: 'RESUME_' + Date.now(),
        template: selectedTemplate,
        data: resumeData,
        created: new Date().toISOString()
    };
    
    // Save to localStorage (in real app, save to backend)
    let portfolio = JSON.parse(localStorage.getItem('employeePortfolio')) || {};
    if (!portfolio[employeeId]) {
        portfolio[employeeId] = [];
    }
    portfolio[employeeId].push(portfolioData);
    localStorage.setItem('employeePortfolio', JSON.stringify(portfolio));
    
    alert('✅ Resume added to your portfolio successfully!');
    console.log('Portfolio updated:', portfolioData);
}

// Share Resume
function shareResume() {
    // Generate shareable link (simulated)
    const shareUrl = `${window.location.origin}/resume/${Date.now()}`;
    
    if (navigator.share) {
        navigator.share({
            title: `${resumeData.personal.name}'s Resume`,
            text: `Check out ${resumeData.personal.name}'s professional resume`,
            url: shareUrl
        });
    } else {
        // Fallback: copy to clipboard
        navigator.clipboard.writeText(shareUrl).then(() => {
            alert('📋 Share link copied to clipboard!');
        });
    }
}

// Initialize when page loads
document.addEventListener('DOMContentLoaded', function() {
    initResumeBuilder();
});


    </script>
</body>
</html>

 